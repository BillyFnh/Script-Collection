datamodel,section.name,splunk.app.name,request.ui_context,request.ui_edit_view,disabled,display.visualizations.custom.splunk_monitoring_console.heatmap.showtooltip,display.visualizations.custom.splunk_monitoring_console.heatmap.basecolor,display.visualizations.custom.splunk_monitoring_console.heatmap.showlegend,display.visualizations.custom.splunk_monitoring_console.heatmap.showxaxis,display.visualizations.custom.splunk_monitoring_console.heatmap.showyaxis,display.visualizations.custom.splunk_monitoring_console.heatmap.legendtitle,display.visualizations.custom.splunk_monitoring_console.heatmap.xaxis,display.visualizations.custom.splunk_monitoring_console.heatmap.yaxis,search,dispatch.earliest_time,dispatch.latest_time,displayview,enablesched,counttype,relation,quantity,cron_schedule,alert.digest_mode,alert.suppress,alert.track,action.email,action.email.message.alert,action.email.usenssubject,description,display.general.timerangepicker.show,display.general.type,display.page.search.tab,display.visualizations.show,action.correlationsearch,action.correlationsearch.enabled,action.correlationsearch.label,action.email.sendresults,action.notable.param.security_domain,action.notable.param.severity,action.notable.param.rule_title,action.notable.param.rule_description,action.notable.param.nes_fields,action.notable.param.drilldown_name,action.notable.param.drilldown_search,action.notable.param.default_owner,action.notable.param.default_status,action.risk,action.risk.param._risk_object,action.risk.param._risk_object_type,action.risk.param._risk_score,alert.suppress.fields,alert.suppress.period,is_visible,request.ui_dispatch_app,schedule_window,action.notable,action.summary_index._name,dispatch.rt_backfill,action.correlationsearch.related_searches,action.notable.param.drilldown_earliest_offset,action.notable.param.drilldown_latest_offset,action.email.reportserverenabled,action.keyindicator,action.keyindicator.title,action.keyindicator.subtitle,action.keyindicator.value,action.keyindicator.threshold,action.keyindicator.delta,action.keyindicator.invert,action.keyindicator.drilldown_uri,display.general.enablepreview,display.statistics.rownumbers,display.statistics.wrap,display.visualizations.charting.drilldown,display.visualizations.singlevalue.underlabel,display.visualizations.type,action.keyindicator.group.0.name,action.keyindicator.group.0.order,dispatchas,display.visualizations.charting.chart,display.visualizations.charting.chart.nullvaluemode,display.statistics.drilldown,action.swimlane,action.swimlane.title,action.swimlane.color,action.swimlane.constraint_method,action.swimlane.constraint_fields,action.swimlane.drilldown_search,display.page.asset_investigator.0.collection_name,display.page.asset_investigator.0.order,display.page.identity_investigator.0.collection_name,display.page.identity_investigator.0.order,action.summary_index,display.events.fields,display.events.list.wrap,display.events.rownumbers,display.events.type,action.escu,action.escu.enabled,action.escu.mappings,action.escu.eli5,action.escu.how_to_implement,action.escu.known_false_positives,action.escu.creation_date,action.escu.modification_date,action.escu.confidence,action.escu.full_search_name,action.escu.search_type,action.escu.asset_at_risk,action.escu.fields_required,action.escu.providing_technologies,action.escu.analytic_story,action.notable.param.recommended_actions,action.notable.param.next_steps,action.risk.param.verbose,action.escu.earliest_time_offset,action.escu.latest_time_offset,realtime_schedule,action.customsearchbuilder.spec,action.email.to,action.notable.param.extract_assets,action.notable.param.extract_identities,action.escu.data_models,action.email.include.results_link,action.email.include.view_link,action.escu.description,action.customsearchbuilder,action.customsearchbuilder.enabled,action.customsearchbuilder.routine,display.visualizations.chartheight,action.keyindicator.group.1.name,action.keyindicator.group.1.order,action.keyindicator.value_suffix,display.visualizations.charting.axistitley.text,display.visualizations.charting.chart.stackmode,display.visualizations.charting.legend.placement,action.threat_outputlookup,action.threat_outputlookup.collections,action.output_message,action.output_message.param.name,action.output_message.param.msgid,action.output_message.param.fields,action.output_message.param.purge,action.threat_activity,action.threat_activity._threat_match,action.logevent,action.logevent.param.event,action.logevent.param.index,action.logevent.param.source,action.logevent.param.sourcetype,request.ui_dispatch_view,auto_summarize,auto_summarize.dispatch.earliest_time,display.visualizations.custom.type,action.sendmn,alert.severity,action.makestreams.param.verbose,action.nbtstat.param.verbose,action.notable.param.verbose,action.nslookup.param.verbose,action.ping.param.verbose,action.send2uba.param.verbose,action.email.inline,action.email.subject.alert,run_on_startup,display.visualizations.charting.axisy2.enabled,display.visualizations.charting.chart.overlayfields,auto_summarize.cron_schedule,action.email.subject,action.threat_add.param.verbose,dispatch.ttl,action.outputtelemetry,action.outputtelemetry.param.anonymous,action.outputtelemetry.param.support,action.outputtelemetry.param.license,action.outputtelemetry.param.optinrequired,action.outputtelemetry.param.component,action.outputtelemetry.param.input,action.outputtelemetry.param.type,action.action_history,action.action_history.enabled,action.action_history.label,action.action_history.content_type,action.action_history.content,dispatch.indexedrealtime,schedule_priority,alert.expires,action.populate_lookup,action.populate_lookup.dest,run_n_times
['Splunk_Audit.Modular_Actions'],['Modular Actions - Distinct Users'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Modular_Actions.user) as current_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` dc(Modular_Actions.user) as historical_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Action Users,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20as%20count%20from%20datamodel%3DSplunk_Audit.Modular_Actions%20where%20nodename%3D%22Modular_Actions.Modular_Action_Invocations%22%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Modular_Actions.user,1,0,0,all,Distinct Users,singlevalue,modular_action_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Modular_Actions'],['Modular Actions - Distinct Searches'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(Modular_Actions.sid) as current_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Modular_Actions.sid) as historical_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Action Searches,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20as%20count%20from%20datamodel%3DSplunk_Audit.Modular_Actions%20where%20nodename%3D%22Modular_Actions.Modular_Action_Invocations%22%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Modular_Actions.sid,1,0,0,all,Distinct Modular Action Searches,singlevalue,modular_action_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Modular_Actions'],['Modular Actions - Average Duration'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| tstats `summariesonly` avg(Modular_Actions.duration) as current_avg from datamodel=Splunk_Audit.Modular_Actions where earliest=-24h@h latest=+0s Modular_Actions.component=""main"" | appendcols [| tstats `summariesonly` avg(Modular_Actions.duration) as historical_avg from datamodel=Splunk_Audit.Modular_Actions where earliest=-48h@h latest=-24h@h Modular_Actions.component=""main""] | `get_delta(current_avg,historical_avg)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Action Duration,Average (ms),current_avg,,delta,false,search?earliest=-24h%40h&latest=now&q=%7C%20from%20datamodel%3A%22Splunk_Audit%22.%22Modular_Actions%22,1,0,0,all,Average Modular Action Duration (ms),singlevalue,modular_action_center,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - ES System Requirements'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| rest splunk_server=* count=0 /services/server/info | eval numberOfVirtualCores=if(isnum(numberOfVirtualCores) AND numberOfVirtualCores>0,numberOfVirtualCores,null()) | where ((server_roles=""search_head"" AND (max(numberOfCores,numberOfVirtualCores)<16 OR physicalMemoryMB<32000)) OR (server_roles=""indexer"" AND (max(numberOfCores,numberOfVirtualCores)<16 OR physicalMemoryMB<32000))) | fields + splunk_server,server_roles,numberOfCores,numberOfVirtualCores,physicalMemoryMB",0,+0s,,1,number of events,greater than,0,15 3 * * *,true,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,auto,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,HEALTH_CHECK:ES_SYSTEM_REQUIREMENTS,healthcheck_es_system_requirements,splunk_server,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Investigation Collection ACLs'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| rest splunk_server=local count=0 /servicesNS/nobody/search/storage/collections/config | rename title as collection,""eai:acl.perms.read"" as read_perms,""eai:acl.perms.write"" as write_perms | where 'collection' in (""investigative_canvas"", ""investigative_canvas_entries"", ""files"", ""investigation"", ""investigation_event"", ""investigation_attachment"") AND ('read_perms' in (""*"", ""ess_user"", ""ess_analyst"", ""pci_user"", ""pci_analyst"") OR 'write_perms' in (""*"", ""ess_user"", ""ess_analyst"", ""pci_user"", ""pci_analyst"")) | table collection,read_perms,write_perms",0,+0s,,1,number of events,greater than,0,15 3 * * *,true,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,auto,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,HEALTH_CHECK:INVESTIGATION_COLLECTION_ACLS,healthcheck_investigation_collection_acls,collection,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.View_Activity'],['Audit - ES View Activity Over Time'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `tstats` count from datamodel=Splunk_Audit.View_Activity where `es_context_only(""View_Activity"")` by _time,View_Activity.view span=1h | timechart span=1h useother=`useother` count by View_Activity.view | `drop_dm_object_name(""View_Activity"")`",-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Expected ES View Activity'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `expected_view_tracker(""-7d"")` | eval view=app.""|"".view | bin _time span=1d | `ctime(_time,""%m-%d-%Y"")` | chart sum(count) as count over view by _time | rex field=view ""(?<app>[^|]+)|(?<view>.*)"" | fields app,view,*",-7d@d,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Events By Urgency'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,| `es_notable_events` | search timeDiff_type=current | stats sum(count) as count by urgency,-24h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Events Over Time'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,| `es_notable_events` | search timeDiff_type=current | timechart minspan=30m sum(count) as count,-24h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Events Over Time By Security Domain'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,| `es_notable_events` | search timeDiff_type=current | timechart minspan=30m sum(count) as count by security_domain,-24h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect new API calls from user roles - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventType=AwsApiCall errorCode=success userIdentity.type=AssumedRole [search sourcetype=aws:cloudtrail eventType=AwsApiCall errorCode=success  userIdentity.type=AssumedRole | stats earliest(_time) as earliest latest(_time) as latest by userName eventName |  inputlookup append=t previously_seen_api_calls_from_user_roles | stats min(earliest) as earliest, max(latest) as latest by userName eventName | outputlookup previously_seen_api_calls_from_user_roles| eval newApiCallfromUserRole=if(earliest>=relative_time(now(), ""-70m@m""), 1, 0) | where newApiCallfromUserRole=1 | `ctime(earliest)` | `ctime(latest)` | table eventName userName]  |rename userName as user| stats values(eventName) earliest(_time) as earliest latest(_time) as latest by user | `ctime(earliest)` | `ctime(latest)`",-70m@m,-10m@m,,1,number of events,greater than,0,30 * * * *,1,1,,,,,"This search detects new API calls that have either never been seen before or that have not been seen in the previous hour, where the identity type is <code>AssumedRole</code>.",,,,,,1,Detect new API calls from user roles,,endpoint,medium,New API call by $user$ detected,A new API call made by $user$ has been detected. This API activity has either never been seen before or has not been seen within the last hour.,user,,,,,1,user,user,10,user,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch will execute first and return the user roles and names of the API calls completed within the last hour, where the type of user identity is `AssumedRole`. It then appends the historical data to those results in the lookup file. Next, it recalculates the `earliest` and `latest` fields for each user role, as well as the name of the API call, and returns only those roles and API calls that have first been seen in the past hour. This is combined with the main search to return the values of API calls, name of the user role, and the earliest and latest time of this activity. It is worth noting that the name of the role of a particular user is parsed as ""userName"" in the CloudTrail logs.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously seen API call per user roles in CloudTrail"" support search once to create a history of previously seen user roles.","It is possible that there are legitimate user roles making new or infrequently used API calls in your infrastructure, causing the search to trigger.",2018-04-01,2018-04-16,medium,ESCU - Detect new API calls from user roles - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS User Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Investigate AWS User Activities by user fieldn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Top Events'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search timeDiff_type=current | stats sparkline(sum(count),30m) as sparkline,sum(count) as count by rule_name | sort 100 - count",-24h@h,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Top Notable Event Sources'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search timeDiff_type=current src!=unknown | stats sparkline(sum(count),30m) as sparkline,dc(rule_name) as correlation_search_count,dc(security_domain) as security_domain_count,sum(count) as count by src | sort 100 - count,correlation_search_count",-24h@h,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Top Notable Event Destinations'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search timeDiff_type=current dest!=unknown | stats sparkline(sum(count),30m) as sparkline,dc(rule_name) as correlation_search_count,dc(security_domain) as security_domain_count,sum(count) as count by dest | sort 100 - count,correlation_search_count",-24h@h,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESS - Notable Events'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"`notable` | search NOT `suppression` | eval timeDiff_type=case(_time>=relative_time(now(), ""-24h@h""),""current"", 1=1, ""historical"") | expandtoken rule_title | table _time,event_id,security_domain,urgency,rule_name,rule_title,src,dest,src_user,user,dvc,status,status_group,owner,timeDiff_type,governance,control | outputlookup es_notable_events | stats count",-48h@h,+0s,,1,,,,*/5 * * * *,,0,,,,,Maintains a list containing pertinent information for the last 48 hours of notable events,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
"['Splunk_Audit"".""View_Activity']",['Dashboard Views - Action History'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"| from datamodel:""Splunk_Audit"".""View_Activity"" | where 'user'!=""-"" | rename app as content.app, view as content.view, uri as content.uri",,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,owner,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Dashboard Viewed,view,"content.view,content.app,content.uri",,,,,,
"['Splunk_Audit"".""Search_Activity']",['Search Tracking - Action History'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"| from datamodel:""Splunk_Audit"".""Search_Activity"" | where (search_type==""adhoc"" OR search_type==""realtime"") AND info==""granted"" AND NOT user=""splunk-system-user"" AND NOT LIKE(search, ""No search string available%"") AND (savedsearch_name=""quick-search-manager"" OR isnull(savedsearch_name)) | `per_panel_filter(""ppf_action_history_searches"",""search"")` | rename host as content.host, source as content.source, sourcetype as content.sourcetype, search as content.search, search_type as content.search_type, info as content.info, search_lt as content.latest, search_et as content.earliest, search_id as content.sid",,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,owner,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Search Run,search,"content.host,content.source,content.sourcetype,content.search,content.search_type,content.info,content.sid,content.earliest,content.latest",,,,,,
[],['Per-Panel Filtering - Action History'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"`ppf_updates` | `get_event_id` | rename action as content.action, lookup_file as content.lookup_file, filter as content.filter, namespace as content.namespace",,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,owner,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Panel Filtered,ppf,"content.action,content.lookup_file,content.filter,content.namespace",,,,,,
[],['Notable Suppression - Action History'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"`suppression_audit` | rename action as content.action, signature as content.signature, status as content.status, suppression as content.suppression",,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,owner,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Notable Event Suppression Updated,notable_suppression,"content.action,content.signature,content.status,content.suppression",,,,,,
[],['Notable Status - Action History'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"index=_audit sourcetype=incident_review | `get_reviewstatuses` | rename comment as content.comment, owner as content.owner, rule_id as content.rule_id, rule_name as content.rule_name, status_label as content.status, urgency as content.urgency",,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,owner,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Notable Event Updated,notable_status,"content.comment,content.owner,content.rule_id,content.rule_name,content.status,content.urgency",,,,,,
['Splunk_Audit.View_Activity'],['Audit - Active Users - Telemetry Gen'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true count from datamodel=Splunk_Audit.View_Activity where (View_Activity.app=""SplunkEnterpriseSecuritySuite"" OR View_Activity.app=""Splunk_DA-ESS*"") by View_Activity.user | join user [| rest splunk_server=local count=0 /servicesNS/nobody/search/authentication/users | rename title as user | table title,roles] | stats count(eval(roles=""admin"" or roles=""sc_admin"" or roles=""ess_admin"")) as data.admin_count,count(eval(roles=""ess_analyst"")) as data.analyst_count,count(eval(roles=""ess_user"")) as data.user_count,count as data.count | addinfo | eval version=""1.0"",begin=floor(info_min_time),end=floor(info_max_time) | makejson version(string),begin(int),end(int),data.* output=event | table event",-1d@d,@d,,1,number of events,greater than,0,0 1 * * *,,,false,,,,Sends anonymous usage statistics pertaining to the unique number of active users.,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.SplunkEnterpriseSecuritySuite.active_users,event,aggregate,,,,,,,,,,,
[],['ESCU - Detect new user AWS Console Login - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=ConsoleLogin | rename userIdentity.arn as arn  |stats earliest(_time) as earliest latest(_time) as latest by arn | inputlookup append=t previously_seen_users_console_logins.csv  | stats min(earliest) as earliest max(latest) as latest by arn | outputlookup previously_seen_users_console_logins.csv | eval userStatus=if(earliest >= relative_time(now(), ""-70m@m""), ""First Time Logging into AWS Console"",""Previously Seen User"") | convert ctime(earliest) ctime(latest) | where userStatus =""First Time Logging into AWS Console""",-70m@m,-10m@m,,1,number of events,greater than,0,5 * * * *,1,1,,,,,"This search looks for CloudTrail events wherein a console login event by a user was recorded within the last hour, then compares the event to a lookup file of previously seen users (by ARN values) who have logged into the console. The alert is fired if the user has logged into the console for the first time within the last hour",,,,,,1,Detect new user AWS Console Login,,network,medium,AWS Console Login by New User,A new user has logged into the AWS console,arn,,,,,1,arn,user,30,arn,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 16""], ""nist"": [""DE.DP"", ""DE.AE""]}","In this search, we query CloudTrail logs to look for events that indicate that a user has attempted to log in to the AWS console and group the events using ARN value. Using the `previously_seen_users_console_logins.csv` lookup file created using the support search, we compare the ARN to all the previously seen users logging into the AWS console. The `eval` and `if` functions determine whether the earliest time we see this user ARN was seen within the last hour. The alert will be fired only when a user is seen for first time in the last hour.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Run the ""Previously seen users in CloudTrail"" support search only once to create a baseline of previously seen IAM users within the last 30 days","When a legitimate new user logins for the first time, this activity will be detected. Check how old the account is and verify that the user activity is legitimate.",2018-02-26,2018-02-26,medium,ESCU - Detect new user AWS Console Login - Rule,detection,AWS Instance,[],"[""AWS""]","[""Suspicious AWS Login Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.View_Activity'],['Audit - Feature Usage - Telemetry Gen'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true avg(View_Activity.spent) as data.avg_spent,count as data.count from datamodel=Splunk_Audit.View_Activity where (View_Activity.app=""SplunkEnterpriseSecuritySuite"" OR View_Activity.app=""Splunk_DA-ESS*"") by View_Activity.view | rename View_Activity.view as data.view | lookup update=true es_instrumentation_views view as data.view OUTPUT view as is_ok | eval is_custom=if(isnull(is_ok),1,0) | appendpipe [search is_custom=1 | eval weighted_avg='data.avg_spent'*'data.count' | stats sum(weighted_avg) as weighted_avg,sum(data.count) as data.count | eval ""data.avg_spent""=weighted_avg/'data.count',""data.view""=""other"",is_ok=""true""] | where isnotnull(is_ok) | addinfo | eval version=""1.0"",begin=floor(info_min_time),end=floor(info_max_time),""data.avg_spent""=floor('data.avg_spent') | makejson version(string),begin(int),end(int),data.* output=event | table event",-1d@d,@d,,1,number of events,greater than,0,0 2 * * *,,,false,,,,Sends anonymous usage statistics pertaining to the number of view loads.,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.SplunkEnterpriseSecuritySuite.feature_usage,event,aggregate,,,,,,,,,,,
['Splunk_Audit.Search_Activity'],['Audit - Search Execution - Telemetry Gen'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true values(nodename) as nodename,avg(Search_Activity.total_run_time) as data.avg_run_time,count as data.count from datamodel=Splunk_Audit.Search_Activity where Search_Activity.search_alias!=""*Data Model Summary Director"" by Search_Activity.search_alias | rename Search_Activity.search_alias as data.search_alias | where NOT match('data.search_alias', ""searchd+"") | lookup update=true es_instrumentation_searches search_alias as data.search_alias OUTPUT search_alias as is_ok | eval is_custom=if(isnull(is_ok),1,0) | appendpipe [search is_custom=1 | eval weighted_avg='data.avg_run_time'*'data.count' | stats sum(weighted_avg) as weighted_avg,sum(data.count) as data.count | eval ""data.avg_run_time""=weighted_avg/'data.count',""data.search_alias""=""other"",is_ok=""true""] | where isnotnull(is_ok) | addinfo | eval version=""1.0"",begin=floor(info_min_time),end=floor(info_max_time),""data.is_realtime""=if(nodename==""Search_Activity.Realtime_Jobs"",1,0),""data.avg_run_time""=round('data.avg_run_time', 2) | makejson version(string),begin(int),end(int),data.* output=event | table event",-1d@d,@d,,1,number of events,greater than,0,0 3 * * *,,,false,,,,Sends anonymous usage statistics pertaining to the number of search executions.,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.SplunkEnterpriseSecuritySuite.search_execution,event,aggregate,,,,,,,,,,,
[],['Audit - Search Actions - Telemetry Gen'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"| rest splunk_server=local count=0 /servicesNS/nobody/SplunkEnterpriseSecuritySuite/saved/searches | search disabled=0 is_scheduled=1 | eval ""data.action""=split(actions, "","") | eventstats count as data.total_scheduled | stats first(data.total_scheduled) as data.total_scheduled,count as data.count by data.action | lookup update=true es_instrumentation_actions action as data.action OUTPUT action as is_ok | eval is_custom=if(isnull(is_ok),1,0) | appendpipe [search is_custom=1 | stats first(data.total_scheduled) as data.total_scheduled,sum(data.count) as data.count | eval ""data.action""=""other"",is_ok=""true""] | where isnotnull(is_ok) | join data.action type=left [| rest splunk_server=local count=0 /servicesNS/nobody/SplunkEnterpriseSecuritySuite/alerts/alert_actions | rename title as data.action | eval ""data.is_adaptive_response""=if(isnotnull('param._cam'),1,0) | table data.action,data.is_adaptive_response] | eval version=""1.0"",""data.is_adaptive_response""=if(isnull('data.is_adaptive_response'),0,1) | makejson version(string),data.* output=event | table event",0,+0s,,1,number of events,greater than,0,0 4 * * *,,,false,,,,Sends anonymous statistics pertaining to the usage of custom alert actions.,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.SplunkEnterpriseSecuritySuite.search_actions,event,event,,,,,,,,,,,
"['Splunk_Audit.Datamodel_Acceleration', 'OUTPUT datamodel']",['Audit - Datamodel Distribution - Telemetry Gen'],SplunkEnterpriseSecuritySuite-default,,,False,,,,,,,,,"| from datamodel:Splunk_Audit.Datamodel_Acceleration | rename datamodel as data.datamodel,size as data.size | lookup update=true es_instrumentation_datamodels datamodel as data.datamodel OUTPUT datamodel as is_ok | eval is_custom=if(isnull(is_ok),1,0) | appendpipe [search is_custom=1 | stats sum(data.size) as data.size | eval ""data.datamodel""=""other"",is_ok=""true""] | eventstats sum(data.size) as total_size | where isnotnull(is_ok) | eval version=""1.0"",""data.perc""=round('data.size'/total_size*100, 2) | makejson version(string),data.* output=event | table event",0,+0s,,1,number of events,greater than,0,0 5 * * *,,,false,,,,Sends anonymous statistics pertaining to the usage of datamodels.,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.SplunkEnterpriseSecuritySuite.datamodel_distribution,event,event,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Detect processes used for System Network Configuration Discovery - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes by Processes.dest Processes.process_name Processes.user _time | `ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(Processes)` | search `system_network_configuration_discovery_tools` | transaction dest maxpause=5m |where eventcount>=5 | table firstTime lastTime dest user process_name process parent_process eventcount,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for fast execution of processes used for system network configuration discovery on the endpoint.,,,,,,1,Detect processes used for System Network Configuration Discovery,,endpoint,high,Fast execution of processes $process_name$ related to network discovery seen on $dest$,Fast execution of processes $related to network system configuration discovery seen on $dest$.,"dest, process, user",,,,,1,dest,system,50,"dest,user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Installation"", ""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 2""], ""nist"": [""ID.AM"", ""PR.DS""]}","Attackers have a range of built-in Windows tools they leverage to ascertain the topography of a network from the point of view of a compromised machine. It is uncommon to see these commands execute quickly within short periods of time. This search returns the number of times, as well as the first time and last times, that every process has run for each endpoint. It then executes the macro `system_network_configuration_discovery_tools`, which looks for processes that are typically used for network configuration discovery. Once you have a list of suspicious process launches for each destination, you can leverage the transaction command to see what processes are fired within a five-minute span on an endpoint and detect only those events where the count of these processes is greater than five.","You must be ingesting data that records registry activity from your hosts to populate the Endpoint data model in the processes node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or endpoint data sources, such as Sysmon. The data used for this search is usually generated via logs that report reads and writes to the registry or that are populated via Windows event logs, after enabling process tracking in your Windows audit settings.",It is uncommon for normal users to execute a series of commands used for network discovery. System administrators often use scripts to execute these commands. These can generate false positives.,2018-11-04,2018-11-20,high,ESCU - Detect processes used for System Network Configuration Discovery - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Unusual Processes""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.lastSent'],splunk_instrumentation-default,,,,,,,,,,,,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=success | fillnull value=anonymous visibility | eval anonymous_send_time = if(visibility LIKE ""%anonymous%"", _time, null) | eval license_send_time = if(visibility LIKE ""%license%"", _time, null) | eval support_send_time = if(visibility LIKE ""%support%"", _time, null) | stats latest(anonymous_send_time) as latest_anonymous_send_time latest(license_send_time) as latest_license_send_time latest(support_send_time) as latest_support_send_time",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.reportingErrorCount'],splunk_instrumentation-default,,,,,,,,,,,,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=failed | fillnull value=anonymous visibility | stats count(eval(visibility LIKE ""%anonymous%"")) as anonymous_errors count(eval(visibility LIKE ""%license%"")) as license_errors count(eval(visibility LIKE ""%support%"")) as support_errors",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.anonymized.eventsByTime'],splunk_instrumentation-default,,,,,,,,,,,,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" visibility=*anonymous* | append [| savedsearch instrumentation.licenseUsage]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.support.eventsByTime'],splunk_instrumentation-default,,,,,,,,,,,,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" visibility=*support* | append [| savedsearch instrumentation.licenseUsage]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.deployment.clustering.indexer'],splunk_instrumentation-default,,,,,,,,,,,,"| makeresults annotate=true | append [localop | rest /services/cluster/config] | sort -mode | head 1 | eval data=if(mode==""master"",""{""host"":""""+splunk_server+"""",""timezone"":""""+strftime(now(),""%z"")+"""",""multiSite"":""+multisite+"",""summaryReplication"":""+if(summary_replication=1,""true"",""false"")+"",""enabled"":true,""replicationFactor"":""+tostring(replication_factor)+"",""siteReplicationFactor"":""+coalesce(replace(replace(site_replication_factor, ""origin"", """"origin""""), ""total"", """"total""""), ""null"")+"",""siteSearchFactor"":""+coalesce(replace(replace(site_search_factor, ""origin"", """"origin""""), ""total"", """"total""""),""null"")+"",""searchFactor"":""+tostring(search_factor)+""}"",""{""host"":""""+splunk_server+"""",""timezone"":""""+strftime(now(),""%z"")+"""",""enabled"":false}"") | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.deployment.forwarders'],splunk_instrumentation-default,,,,,,,,,,,,"index=_internal source=*metrics.log* TERM(group=tcpin_connections) (TERM(connectionType=cooked) OR TERM(connectionType=cookedSSL)) fwdType=* guid=* | rename sourceIp as forwarderHost | eval connectionType=case(fwdType==""uf"" or fwdType==""lwf"" or fwdType==""full"", fwdType, 1==1,""Splunk fwder"") | eval version=if(isnull(version),""pre 4.2"",version) | bin _time span=1d | stats sum(kb) as kb, latest(connectionType) as connectionType, latest(arch) as arch, latest(os) as os, latest(version) as version latest(forwarderHost) as forwarderHost by guid _time | stats estdc(forwarderHost) as numHosts estdc(guid) as numInstances `instrumentation_distribution_values(kb)` by connectionType arch os version _time | eval data=""{""hosts"":""+tostring(numHosts)+"",""instances"":""+tostring(numInstances)+"",""architecture"":""""+arch+"""",""os"":""""+os+"""",""splunkVersion"":""""+version+"""",""type"":""""+connectionType+"""",""bytes"":{"" + `instrumentation_distribution_strings(""kb"",1024,0)` + ""}}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.deployment.app'],splunk_instrumentation-default,,,,,,,,,,,,"| rest /services/apps/local | eval _time=now() | fields splunk_server title updated version disabled | eval data=""{""host"":""""+splunk_server+"""",""name"":""""+title+"""",""version"":""""+coalesce(version, """")+"""",""enabled"":""+if(disabled=0, ""true"", ""false"")+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields data _time date",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.deployment.node'],splunk_instrumentation-default,,,,,,,,,,,,"index=_introspection sourcetype=splunk_disk_objects component::Partitions | bin _time span=1d | stats latest(data.free) as partitionFree, latest(data.capacity) as partitionCapacity by host data.fs_type data.mount_point _time | eval partitionUtilized=round(1-partitionFree/partitionCapacity,2) | eval partitions=""{""utilization"":""+`instrumentation_number_format(partitionUtilized,1,2)`+"",""capacity"":""+`instrumentation_number_format(partitionCapacity,1048576,0)`+"",""fileSystem"":""""+'data.fs_type' + """"}"" | stats delim="","" values(partitions) as partitions by host _time | rename _time as date | mvcombine partitions | rename date as _time | join type=left host _time [search index=_introspection sourcetype=splunk_resource_usage component::Hostwide | eval cpuUsage = 'data.cpu_system_pct' + 'data.cpu_user_pct' | rename data.mem_used as memUsage | bin _time span=1d | stats latest(data.cpu_count) as coreCount, latest(data.virtual_cpu_count) as virtualCoreCount, latest(data.mem) as memAvailable, latest(data.splunk_version) as splunkVersion, latest(data.cpu_arch) as cpuArch, latest(data.os_name) as osName, latest(data.os_name_ext) as osNameExt, latest(data.os_version) as osVersion, `instrumentation_distribution_values(cpuUsage)`, `instrumentation_distribution_values(memUsage)`, latest(data.instance_guid) as guid by host _time] | fillnull value=""null"" coreCount virtualCoreCount memAvailable | eval splunkVersion=coalesce(""""""+splunkVersion+"""""", ""null""), cpuArch=coalesce(""""""+cpuArch+"""""", ""null""), osName=coalesce(""""""+osName + """""", ""null""), osNameExt=coalesce(""""""+osNameExt+"""""", ""null""), osVersion=coalesce(""""""+osVersion+"""""", ""null""), guid=coalesce(""""""+guid+"""""", ""null"") | eval data = ""{""guid"":""+guid+"",""host"":""""+replace(host,"""""", ""\"""")+"""",""partitions"": "" + coalesce(""["" + partitions + ""]"", ""null"") + "",""cpu"":{""architecture"":""+cpuArch+"",""coreCount"":"" + tostring(coreCount)+ "",""virtualCoreCount"":""+tostring(virtualCoreCount)+"",""utilization"":{"" + `instrumentation_distribution_strings(""cpuUsage"",.01,2)` + ""}},""memory"":""+""{""capacity"":""+ `instrumentation_number_format(memAvailable,1048576,0)`+"",""utilization"":{"" + `instrumentation_distribution_strings(""memUsage"",1/memAvailable,2)` + ""}},""os"":""+osName+"",""osExt"":""+osNameExt + "",""osVersion"":""+osVersion+"",""splunkVersion"":""+splunkVersion+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.deployment.index'],splunk_instrumentation-default,,,,,,,,,,,,"| rest /services/data/indexes | join type=outer splunk_server title [| rest /services/data/indexes-extended] | append [| rest /services/data/indexes datatype=metric | join type=outer splunk_server title [| rest /services/data/indexes-extended datatype=metric]] | eval warm_bucket_size = if(isnotnull('bucket_dirs.home.warm_bucket_size'), 'bucket_dirs.home.warm_bucket_size', 'bucket_dirs.home.size') | eval cold_bucket_size_gb = tostring(round(coalesce('bucket_dirs.cold.bucket_size', 'bucket_dirs.cold.size', 0) / 1024, 2)) | eval warm_bucket_size_gb = tostring(round(coalesce(warm_bucket_size,0) / 1024, 2)) | eval hot_bucket_size = tostring(round(coalesce(total_size / 1024 - cold_bucket_size_gb - warm_bucket_size_gb, 0),2)) | eval hot_bucket_size_gb = tostring(round(coalesce(hot_bucket_size,0) / 1024, 2)) | eval thawed_bucket_size_gb = tostring(round(coalesce('bucket_dirs.thawed.bucket_size', 'bucket_dirs.thawed.size',0) / 1024, 2)) | eval warm_bucket_count = tostring(coalesce('bucket_dirs.home.warm_bucket_count', 0)) | eval hot_bucket_count = tostring(coalesce('bucket_dirs.home.hot_bucket_count',0)) | eval cold_bucket_count = tostring(coalesce('bucket_dirs.cold.bucket_count',0)) | eval thawed_bucket_count = tostring(coalesce('bucket_dirs.thawed.bucket_count',0)) | eval home_event_count = tostring(coalesce('bucket_dirs.home.event_count',0)) | eval cold_event_count = tostring(coalesce('bucket_dirs.cold.event_count',0)) | eval thawed_event_count = tostring(coalesce('bucket_dirs.thawed.event_count',0)) | eval home_bucket_capacity_gb = coalesce(if('homePath.maxDataSizeMB' == 0, """"unlimited"""", round('homePath.maxDataSizeMB' / 1024, 2)), """"unlimited"""") | eval cold_bucket_capacity_gb = coalesce(if('coldPath.maxDataSizeMB' == 0, """"unlimited"""", round('coldPath.maxDataSizeMB' / 1024, 2)), """"unlimited"""") | eval currentDBSizeGB = tostring(round(coalesce(currentDBSizeMB,0) / 1024, 2)) | eval maxTotalDataSizeGB = tostring(if(maxTotalDataSizeMB = 0, ""unlimited"", coalesce(round(maxTotalDataSizeMB / 1024, 2), ""null""))) | eval minTime = tostring(coalesce(strptime(minTime,""%Y-%m-%dT%H:%M:%S%z""),""null"")) | eval maxTime = tostring(coalesce(strptime(maxTime,""%Y-%m-%dT%H:%M:%S%z""),""null"")) | eval total_bucket_count = tostring(if(isnotnull(total_bucket_count), total_bucket_count, 0)) | eval totalEventCount = tostring(coalesce(totalEventCount, 0)) | eval total_raw_size_gb = tostring(coalesce(round(total_raw_size / 1024, 2), ""null"")) | eval index_type = coalesce(datatype ,""event"") | rename eai:acl.app as App | eval _time=now() | fields splunk_server, title,index_type, currentDBSizeGB, totalEventCount, total_bucket_count, total_raw_size_gb, minTime, maxTime, home_bucket_capacity_gb, cold_bucket_capacity_gb, hot_bucket_size_gb, warm_bucket_size_gb, cold_bucket_size_gb, thawed_bucket_size_gb, hot_bucket_count, warm_bucket_count, cold_bucket_count, thawed_bucket_count, home_event_count, cold_event_count, thawed_event_count, maxTotalDataSizeGB, maxHotBuckets, maxWarmDBCount App _time | eval data=""{""host"":""""+splunk_server+"""",""name"":""""+title+"""",""type"":""""+index_type+"""",""app"":""""+App+"""",""total"":{""currentDBSizeGB"":""+currentDBSizeGB+"",""maxDataSizeGB"":""+maxTotalDataSizeGB+"",""events"":""+totalEventCount+"",""buckets"":""+total_bucket_count+"",""rawSizeGB"":""+total_raw_size_gb+"",""minTime"":""+minTime+"",""maxTime"":""+maxTime+""},""buckets"":{""homeCapacityGB"":""+home_bucket_capacity_gb+"",""homeEventCount"":""+home_event_count+"",""coldCapacityGB"":""+cold_bucket_capacity_gb+"",""hot"":{""sizeGB"":""+hot_bucket_size_gb+"",""count"":""+hot_bucket_count+"",""max"":""+maxHotBuckets+""},""warm"":{""sizeGB"":""+warm_bucket_size_gb+"",""count"":""+warm_bucket_count+""},""cold"":{""sizeGB"":""+cold_bucket_size_gb+"",""count"":""+cold_bucket_count+"",""events"":""+cold_event_count+""},""thawed"":{""sizeGB"":""+thawed_bucket_size_gb+"",""count"":""+thawed_bucket_count+"",""events"":""+thawed_event_count+""}}}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields data _time date",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web where'],['ESCU - Detect web traffic to dynamic domain providers - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true count values(Web.url) as url min(_time) as firstTime from datamodel=Web where Web.status=200 by Web.src Web.dest Web.status | `drop_dm_object_name(""Web"")` | `ctime(firstTime)` | `dynamic_dns_web_traffic`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for web connections to dynamic DNS providers.,,,,,,1,Detect web traffic to dynamic domain providers,,network,high,Dynamic DNS web traffic detected on $src$.,"The host $src$ has been detected making a web request to $url$, which is a listed as a dynamic DNS provider.","src, url, dest",,,,,1,src,system,40,"src, url , dest",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Web Service"", ""Exfiltration Over Command and Control Channel"", ""Defense Evasion""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 7"", ""CIS 8""], ""nist"": [""PR.IP"", ""DE.DP""]}","This search looks for hosts in your environment that may be communicating with a dynamic DNS provider. It checks each URL an endpoint is connecting to against a list of dynamic DNS providers. It returns the source and destination IP address of the web request, the URL requested, and the first time the event occurred.","This search requires you to be ingesting web-traffic logs. You can obtain these logs from indexing data from a web proxy or by using a network-traffic-analysis tool, such as Bro or Splunk Stream. The web data model must contain the URL being requested, the IP address of the host initiating the request, and the destination IP. This search also leverages a lookup file, `dynamic_dns_providers_default.csv`, which contains a non-exhaustive list of dynamic DNS providers. Consider periodically updating this local lookup file with new domains.",It is possible that list of dynamic DNS providers is outdated and/or that the URL being requested is legitimate.,2018-09-06,2018-09-06,high,ESCU - Detect web traffic to dynamic domain providers - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro"", ""Bluecoat"", ""Palo Alto Firewall""]","[""Dynamic DNS""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get DNS Server History for a hostnESCU - Get DNS traffic rationESCU - Get Process responsible for the DNS trafficnESCU - Investigate Web Activity From src_ipn""}",0,3600,86400,0,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.licenseUsage'],splunk_instrumentation-default,,,,,,,,,,,,"NOT() | append [search index=_telemetry type=RolloverSummary | eval date=strftime(_time-43200, ""%Y-%m-%d"") | eval licenseIDs=coalesce(replace(replace(replace(replace(licenseGuids,""["",""[""""),""]"",""""]""),"","","""",""""),"" "", """"),""null""), subgroup_id=coalesce(subgroupId, ""Production""), group_id=coalesce(""""""+licenseGroup+"""""", ""null""), lmGuid=coalesce(""""""+guid+"""""", ""null""), productType=coalesce(""""""+productType+"""""", ""null""), type_id=if(substr(stack,1,16)=""fixed-sourcetype"", ""fixed-sourcetype"",stack) | stats max(_time) as lastTime latest(stacksz) as stack_quota, latest(poolsz) as pool_quota, sum(b) as consumption by pool stack host lmGuid licenseIDs type_id group_id subgroup_id productType date | rename stack as stack_id | eval pool=""{""quota"":"" + pool_quota+"",""consumption"":""+consumption+""}"" | stats delim="","" values(pool) as pools, max(lastTime) as lastTime max(stack_quota) as stack_quota sum(consumption) as stack_consumption by stack_id group_id subgroup_id type_id lmGuid host licenseIDs productType date | mvcombine pools | eval _raw=""{""component"":""licensing.stack"",""data"":{""host"":""""+host+"""",""guid"":""+lmGuid+"",""name"":""""+replace(stack_id,"""""", ""\"""")+"""",""type"":"""" + type_id + """",""subgroup"":"""" + subgroup_id + """",""product"":""+productType+"",""quota"":"" + stack_quota+"",""consumption"":""+stack_consumption+"",""pools"":[""+pools+""],""licenseIDs"":""+licenseIDs+""}, ""date"":""""+date+"""",""visibility"":""anonymous,license""}"", _time=lastTime]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.licensing.stack'],splunk_instrumentation-default,,,,,,,,,,,,"index=_telemetry source=*license_usage_summary.log* sourcetype=splunkd TERM(type=RolloverSummary) | eval date=strftime(_time, ""%m-%d-%Y""), licenseIDs=coalesce(replace(replace(replace(replace(licenseGuids,""["",""[""""),""]"",""""]""),"","","""",""""),"" "", """"),""null""), subgroup_id=coalesce(subgroupId, ""Production""), group_id=coalesce(""""""+licenseGroup+"""""", ""null""), lmGuid=coalesce(""""""+guid+"""""", ""null""), productType=coalesce(""""""+productType+"""""", ""null""), type_id=if(substr(stack,1,16)=""fixed-sourcetype"", ""fixed-sourcetype"",stack) | stats latest(stacksz) as stack_quota, latest(poolsz) as pool_quota, sum(b) as consumption by pool stack host lmGuid licenseIDs type_id group_id subgroup_id productType date | rename stack as stack_id | eval pool=""{""quota"":"" + pool_quota+"",""consumption"":""+consumption+""}"" | stats delim="","" values(pool) as pools, max(stack_quota) as stack_quota sum(consumption) as stack_consumption by stack_id group_id subgroup_id type_id lmGuid host licenseIDs productType date | mvcombine pools | eval data=""{""host"":""""+host+"""",""guid"":""+lmGuid+"",""name"":""""+replace(stack_id,"""""", ""\"""")+"""",""type"":"""" + type_id + """",""subgroup"":"""" + subgroup_id + """",""product"":""+productType+"",""quota"":"" + stack_quota+"",""consumption"":""+stack_consumption+"",""pools"":[""+pools+""],""licenseIDs"":""+licenseIDs+""}"" | eval _time=strptime(date, ""%m-%d-%Y"")-43200 | fields data _time",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.performance.indexing'],splunk_instrumentation-default,,,,,,,,,,,,"index=_internal TERM(group=thruput) TERM(name=index_thruput) source=*metrics.log* | bin _time span=30s | stats sum(kb) as kb sum(instantaneous_kbps) as instantaneous_kbps by host _time | bin _time span=1d | stats sum(kb) as totalKB `instrumentation_distribution_values(instantaneous_kbps)` by host _time | eval data=""{""host"":""""+host+"""",""thruput"":{""total"":"" + tostring(round(totalKB*1024)) + "","" + `instrumentation_distribution_strings(""instantaneous_kbps"",1024,0)`+""}}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.performance.search'],splunk_instrumentation-default,,,,,,,,,,,,"index=_audit sourcetype=audittrail TERM(action=search) TERM(info=completed) total_run_time=* | eval search_et=if(search_et=""N/A"", 0, search_et) | eval search_lt=if(search_lt=""N/A"", exec_time, min(exec_time,search_lt)) | eval timerange=search_lt-search_et | bin _time span=1d | stats latest(searched_buckets) as searched_buckets latest(total_slices) as total_slices latest(scan_count) as scan_count latest(timerange) as timerange latest(total_run_time) as runtime by search_id _time | stats `instrumentation_distribution_values(runtime)`, `instrumentation_distribution_values(searched_buckets)`, `instrumentation_distribution_values(total_slices)`, `instrumentation_distribution_values(scan_count)`, `instrumentation_distribution_values(timerange)` count as numSearches by _time | eval data=""{""searches"":""+tostring(numSearches)+"",""latency"":{""+`instrumentation_distribution_strings(""runtime"",1,2)`+""},""buckets"":{""+`instrumentation_distribution_strings(""searched_buckets"",1,2)`+""},""slices"":{""+`instrumentation_distribution_strings(""total_slices"",1,2)`+""},""scanCount"":{""+`instrumentation_distribution_strings(""scan_count"",1,2)`+""},""dayRange"":{""+`instrumentation_distribution_strings(""timerange"",1/86400,2)`+""}}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.anonymous.firstEvent'],splunk_instrumentation-default,,,,,,,,,,,,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" visibility=*anonymous* | append [savedsearch instrumentation.licenseUsage] | where date >= ""$beginDate$"" AND date <= ""$endDate$"" | head 1",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.support.firstEvent'],splunk_instrumentation-default,,,,,,,,,,,,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" visibility=*support* | append [savedsearch instrumentation.licenseUsage] | where date >= ""$beginDate$"" AND date <= ""$endDate$"" | head 1",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.license.firstEvent'],splunk_instrumentation-default,,,,,,,,,,,,"| savedsearch instrumentation.licenseUsage | where date >= ""$beginDate$"" AND date <= ""$endDate$"" | head 1",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.reporting'],splunk_instrumentation-default,,,,,,,,,,,,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log | fields _raw | spath | eval time_formatted = strftime(_time, ""%Y-%m-%d %H:%M:%S"") | search (status=success OR status=failed)",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.reporting.errors'],splunk_instrumentation-default,,,,,,,,,,,,index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=failed visibility=*$visibility$*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.usage.app.page'],splunk_instrumentation-default,,,,,,,,,,,,"index=_internal sourcetype=splunk_web_access uri_path=""/*/app/*/*"" NOT uri_path=""/*/static/*"" | eval uri_parts=split(uri_path, ""/""),locale=mvindex(uri_parts,1), app=mvindex(uri_parts,3), page=mvindex(uri_parts,4) | bin _time span=1d | eventstats estdc(user) as appUsers count as appOccurrences by app _time | bin _time span=1d | stats latest(locale) as locale count as occurrences estdc(user) as users by app page appUsers appOccurrences _time | sort app -occurrences | streamstats count as pageRank by app _time | where pageRank<=10 | eval data=""{""app"":""""+app+"""",""page"":""""+page+"""",""locale"":""""+locale+"""",""occurrences"":"" + tostring(occurrences) + "",""users"":"" + tostring(users) + ""}"" | eval data=if(pageRank==1,data+"";{""app"":""""+app+"""",""locale"":""""+locale+"""",""occurrences"":"" + tostring(appOccurrences) + "",""users"":"" + tostring(appUsers) + ""}"", data) | stats values(data) as data by app appOccurrences appUsers _time | sort _time -appOccurrences | streamstats count as appRank by _time | where appRank<=25 | mvexpand data | makemv delim="";"" data | mvexpand data | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution'],['ESCU - Detection of DNS Tunnels - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` dc(""DNS.query"") as count  from datamodel=Network_Resolution  where nodename=DNS ""DNS.message_type""=""QUERY"" NOT (`cim_corporate_web_domain_search(""DNS.query"")`) NOT ""DNS.query""=""*.in-addr.arpa"" NOT (""DNS.src_category""=""svc_infra_dns"" OR ""DNS.src_category""=""svc_infra_webproxy"" OR ""DNS.src_category""=""svc_infra_email*""   ) by ""DNS.src"",""DNS.query"" | rename ""DNS.src"" as src  ""DNS.query"" as message | eval length=len(message) | stats sum(length) as length by src | append [ tstats `summariesonly` dc(""DNS.answer"") as count  from datamodel=Network_Resolution  where nodename=DNS ""DNS.message_type""=""QUERY"" NOT (`cim_corporate_web_domain_search(""DNS.query"")`) NOT ""DNS.query""=""*.in-addr.arpa"" NOT (""DNS.src_category""=""svc_infra_dns"" OR ""DNS.src_category""=""svc_infra_webproxy"" OR ""DNS.src_category""=""svc_infra_email*""   ) by ""DNS.src"",""DNS.answer"" | rename ""DNS.src"" as src  ""DNS.answer"" as message | eval message=if(message==""unknown"","""", message) | eval length=len(message) | stats sum(length) as length by src ] | stats sum(length) as length by src | where length > 10000",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search is used to detect DNS tunneling, by calculating the sum of the length of DNS queries and DNS answers. The search also filters out potential false positives by filtering out queries made to internal systems and the queries originating from internal DNS, Web, and Email servers. Endpoints using DNS as a method of transmission for data exfiltration, command and control, or evasion of security controls can often be detected by noting an unusually large volume of DNS traffic.",,,,,,1,Detection of DNS Tunnels,,network,low,DNS tunnel detected on $src$,Potential DNS tunnel detected from $src$ which may be exfiltrating large data,src,,,,,1,src,system,20,"src, query",43200s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Exfiltration"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 13""], ""nist"": [""PR.PT"", ""PR.DS""]}","The search will calculate the distinct count and sum of the length of DNS queries made and DNS answers received by a particular host to alert the analyst if the combined length is greater than 10000, which is not typical behavior.","To successfully implement this search, we must ensure that DNS data is being ingested and mapped to the appropriate fields in the Network_Resolution data model. Fields like src_category are automatically provided by the Assets and Identity Framework shipped with Splunk Enterprise Security. You will need to ensure you are using the Assets and Identity Framework and populating the src_category field. You will also need to enable the `cim_corporate_web_domain_search()` macro which will essentially filter out the DNS queries made to the corporate web domains to reduce alert fatigue.","It's possible that normal DNS traffic will exhibit this behavior. If an alert is generated, please investigate and validate as appropriate. The threshold can also be modified to better suit your environment.",2017-07-19,2017-09-18,low,ESCU - Detection of DNS Tunnels - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""Data Protection"", ""Suspicious DNS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get DNS Server History for a hostnESCU - Get DNS traffic rationESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.usage.indexing.sourcetype'],splunk_instrumentation-default,,,,,,,,,,,,"index=_internal source=*metrics.log* TERM(group=per_sourcetype_thruput) | bin _time span=1d | stats sum(ev) as events, sum(kb) as size, estdc(host) as hosts by series _time | eval data=""{""name"":""""+replace(series,"""""", ""\"""") + """",""events"":""+tostring(events)+"",""bytes"":""+tostring(round(size*1024))+"",""hosts"":""+tostring(hosts)+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.usage.search.concurrent'],splunk_instrumentation-default,,,,,,,,,,,,"index=_introspection sourcetype=splunk_resource_usage component::PerProcess data.search_props.sid::* | bin _time span=10s | stats estdc(data.search_props.sid) AS concurrent_searches by _time host | bin _time span=1d | stats `instrumentation_distribution_values(concurrent_searches)` by host _time | eval data=""{""host"":""""+host+"""",""searches"":{"" + `instrumentation_distribution_strings(""concurrent_searches"",1,0)` +""}}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.usage.search.type'],splunk_instrumentation-default,,,,,,,,,,,,"index=_introspection sourcetype=splunk_resource_usage component::PerProcess data.search_props.sid::* | rename data.search_props.type as searchType | bin _time span=1d | stats estdc(data.search_props.sid) AS search_count by searchType _time | eval data=""""""+searchType+"""":""+tostring(search_count) | stats delim="","" values(data) as data by _time | rename _time as date | mvcombine data | eval data=""{""+data+""}"" | rename date as _time | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.usage.users.active'],splunk_instrumentation-default,,,,,,,,,,,,"index=_audit sourcetype=audittrail TERM(action=search) user!=""splunk-system-user"" user!=""n/a"" | bin _time span=1d | stats estdc(user) as active by _time | eval data=""{""active"":""+tostring(active)+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.topology.deployment.clustering.member'],splunk_instrumentation-default,,,,,,,,,,,,"| localop | rest /services/cluster/master/peers | eval data=""{""master"":""""+splunk_server+"""",""member"":{""host"":""""+label+"""",""guid"":""""+title+"""",""status"":""""+status+""""},""site"":""""+site+""""}"" | where isnotnull(data) | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.topology.deployment.clustering.searchhead'],splunk_instrumentation-default,,,,,,,,,,,,"| localop | rest /services/cluster/master/searchheads | where splunk_server!=label | eval data=""{""master"":""""+splunk_server+"""",""searchhead"":{""host"":""""+label+"""",""guid"":""""+title+"""",""status"":""""+status+""""},""site"":""""+site+""""}"" | where isnotnull(data) | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.topology.deployment.shclustering.member'],splunk_instrumentation-default,,,,,,,,,,,,"| localop | rest /services/shcluster/captain/members | eval data=""{""site"":""""+site+"""",""captain"":""""+splunk_server+"""",""member"":{""host"":""""+label+"""",""guid"":""""+title+"""",""status"":""""+status+""""}}"" | where isnotnull(data) | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.topology.deployment.distsearch.peer'],splunk_instrumentation-default,,,,,,,,,,,,"| localop | rest /services/search/distributed/peers | eval data=""{""host"":""""+splunk_server+"""",""peer"":{""host"":""""+peerName+"""",""guid"":""""+guid+"""",""status"":""""+status+""""}}"" | where isnotnull(data) | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.topology.deployment.licensing.slave'],splunk_instrumentation-default,,,,,,,,,,,,"| localop | rest /services/licenser/slaves | eval data=""{""master"":""""+splunk_server+"""",""slave"":{""host"":""""+label+"""",""guid"":""""+title+"""",""pool"":""""+active_pool_ids+""""}}"" | where isnotnull(data) | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['instrumentation.usage.search.report_acceleration'],splunk_instrumentation-default,,,,,,,,,,,,"| localop | rest /servicesNS/-/-/admin/summarization | stats count as existing_report_accelerations, sum(summary.access_count) as access_count_of_existing_report_accelerations | makejson access_count_of_existing_report_accelerations(int) existing_report_accelerations(int) output=""data"" | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Detection of tools built by NirSoft - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) values(Processes.process) as process max(_time) as lastTime from datamodel=Endpoint.Processes where (Processes.process=""* /stext *"" OR Processes.process=""* /scomma *"" ) by Processes.parent_process Processes.process_name Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` |`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for specific command-line arguments that may indicate the execution of tools made by Nirsoft, which are legitimate, but may be abused by attackers.",,,,,,1,Detection of tools built by NirSoft,,endpoint,medium,Potential abuse of NirSoft tools on $dest$,"This search looks for specific arguments passed via the command line and detects execution of tools built by NirSoft, which are often abused by attackers.","dest, user, process",,,,,1,dest,system,80,"dest, process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Third-party Software"", ""Account Discovery""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 3""], ""nist"": [""PR.IP""]}","The search looks for process-creation events accompanied by specific command-line arguments (""scomma"" and ""stext""). These parameters may be leveraged by a set of free, legitimate tools built by NirSoft. Attackers have been seen abusing the tools' capabilities to steal passwords, set up key loggers, recover account information from mail clients, and conduct other nefarious activities. The search will identify the count, the first and last times a process is executed, the command-line arguments, and the parent process.","You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","While legitimate, these NirSoft tools are prone to abuse. You should verfiy that the tool was used for a legitimate purpose.",2018-09-11,2018-12-03,medium,ESCU - Detection of tools built by NirSoft - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Emotet Malware (TA18-201A)""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DMC Alert - Total License Usage Near Daily Quota'],splunk_monitoring_console-default,,,1,,,,,,,,,"| rest splunk_server_group=dmc_group_license_master /services/licenser/pools | join type=outer stack_id splunk_server [rest splunk_server_group=dmc_group_license_master /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields splunk_server stack_id is_active] | search is_active=1 | fields splunk_server, stack_id, used_bytes | join type=outer stack_id splunk_server [rest splunk_server_group=dmc_group_license_master /services/licenser/stacks | eval stack_id=title | eval stack_quota=quota | fields splunk_server stack_id stack_quota] | stats sum(used_bytes) as used_bytes max(stack_quota) as stack_quota by splunk_server | eval usedGB=round(used_bytes/1024/1024/1024,3) | eval totalGB=round(stack_quota/1024/1024/1024,3) | eval percentage=round(usedGB / totalGB, 3)*100 | fields splunk_server, percentage, usedGB, totalGB | where percentage > 90 | rename splunk_server AS Instance, percentage AS ""License quota used (%)"", usedGB AS ""License quota used (GB)"", totalGB as ""Total license quota (GB)""",,,,1,number of events,greater than,0,"3,33 * * * *",1,1,1,,,,You have used 90% of your total daily license quota.,,,,,,,,1,,,,,,,,,,,,,,,4h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,14400,,,,,,,,,,,,,,,,7d,,,
[],['DMC Alert - Missing forwarders'],splunk_monitoring_console-default,,,1,,,,,,,,,"| inputlookup dmc_forwarder_assets| search status=""missing"" | rename hostname as Instance",,,,1,number of events,greater than,0,*/15 * * * *,,0,1,,,,One or more forwarders are missing.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-1d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DMC Alert - Expired and Soon To Expire Licenses'],splunk_monitoring_console-default,,,1,,,,,,,,,"| rest splunk_server_group=dmc_group_license_master /services/licenser/licenses | join type=outer group_id splunk_server [     rest splunk_server_group=dmc_group_license_master /services/licenser/groups     | where is_active = 1     | rename title AS group_id     | fields is_active group_id splunk_server] | where is_active = 1 | eval days_left = floor((expiration_time - now()) / 86400)  | where (status == ""EXPIRED"" OR days_left < 15) AND NOT (quota = 1048576 OR label == ""Splunk Enterprise Reset Warnings"" OR label == ""Splunk Lite Reset Warnings"") | eval expiration_status = case(days_left >= 14, days_left."" days left"", days_left < 14 AND days_left >= 0, ""Expires soon: "".days_left."" days left"", days_left < 0, ""Expired"") | eval total_gb=round(quota/1024/1024/1024,3) | fields splunk_server label license_hash type group_id total_gb expiration_time expiration_status | convert ctime(expiration_time) | rename splunk_server AS Instance label AS ""Label"" license_hash AS ""License Hash"" type AS Type group_id AS Group total_gb AS Size expiration_time AS ""Expires On"" expiration_status AS Status",,,,1,number of events,greater than,0,3 0 * * *,1,0,1,,,,You have licenses that expired or will expire within 2 weeks.,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,14400,,,,,,,,,,,,,,,,7d,,,
[],['DMC Alert - Saturated Event-Processing Queues'],splunk_monitoring_console-default,,,1,,,,,,,,,"| rest splunk_server_group=dmc_group_indexer /services/server/introspection/queues | search title=tcpin_queue OR title=parsingQueue OR title=aggQueue OR title=typingQueue OR title=indexQueue | eval fifteen_min_fill_perc = round(value_cntr3_size_bytes_lookback / max_size_bytes * 100,2) | fields title fifteen_min_fill_perc splunk_server | where fifteen_min_fill_perc > 90 | rename splunk_server as Instance, title AS ""Queue name"", fifteen_min_fill_perc AS ""Average queue fill percentage (last 15min)""",,,,1,number of events,greater than,0,"3,13,23,33,43,53 * * * *",1,1,1,,,,"One or more of your indexer queues is reporting a fill percentage, averaged over the last 15 minutes, of 90% or more.",,,,,,,,1,,,,,,,,,,,,,,,1h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,14400,,,,,,,,,,,,,,,,7d,,,
[],['DMC Alert - Abnormal State of Indexer Processor'],splunk_monitoring_console-default,,,1,,,,,,,,,"| rest splunk_server_group=dmc_group_indexer /services/server/introspection/indexer | fields splunk_server, average_KBps, status, reason | where status != ""normal"" | eval average_KBps = round(average_KBps, 0) | eval status= if(status==""normal"", status, status."" - "".reason) | fields - reason | rename splunk_server as Instance, average_KBps as ""Average KB/s (last 30s)"", status as Status",,,,1,number of events,greater than,0,"3,8,13,18,23,28,33,38,43,48,53,58 * * * *",1,1,1,,,,One or more of your indexers is reporting an abnormal state.,,,,,,,,1,,,,,,,,,,,,,,,30m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,14400,,,,,,,,,,,,,,,,7d,,,
[],['DMC Alert - Search Peer Not Responding'],splunk_monitoring_console-default,,,1,,,,,,,,,"| rest splunk_server=local /services/search/distributed/peers/ | where status!=""Up"" AND disabled=0 | fields peerName, status | rename peerName as Instance, status as Status",,,,1,number of events,greater than,0,"3,8,13,18,23,28,33,38,43,48,53,58 * * * *",1,1,1,,,,One or more of your search peers is currently down.,,,,,,,,1,,,,,,,,,,,,,,,30m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,14400,,,,,,,,,,,,,,,,7d,,,
[],['DMC Alert - Critical System Physical Memory Usage'],splunk_monitoring_console-default,,,1,,,,,,,,,"| rest splunk_server_group=dmc_group_* /services/server/status/resource-usage/hostwide | eval percentage=round(mem_used/mem,3)*100 | where percentage > 90 | fields splunk_server, percentage, mem_used, mem | rename splunk_server AS Instance, mem AS ""Physical memory installed (MB)"", percentage AS ""Memory used (%)"", mem_used AS ""Memory used (MB)""",,,,1,number of events,greater than,0,"3,8,13,18,23,28,33,38,43,48,53,58 * * * *",1,1,1,,,,One or more instances has exceeded 90% memory usage.,,,,,,,,1,,,,,,,,,,,,,,,30m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,14400,,,,,,,,,,,,,,,,7d,,,
[],['DMC Alert - Near Critical Disk Usage'],splunk_monitoring_console-default,,,1,,,,,,,,,"| rest splunk_server_group=dmc_group_* /services/server/status/partitions-space | eval free = if(isnotnull(available), available, free) | eval usage = capacity - free | eval pct_usage = floor(usage / capacity * 100) | where pct_usage > 80 | stats first(fs_type) as fs_type first(capacity) AS capacity first(usage) AS usage first(pct_usage) AS pct_usage by splunk_server, mount_point | eval usage = round(usage / 1024, 2) | eval capacity = round(capacity / 1024, 2) | rename splunk_server AS Instance mount_point as ""Mount Point"", fs_type as ""File System Type"", usage as ""Usage (GB)"", capacity as ""Capacity (GB)"", pct_usage as ""Usage (%)""",,,,1,number of events,greater than,0,"3,33 * * * *",1,1,1,,,,You have used 80% of your disk capacity.,,,,,,,,1,,,,,,,,,,,,,,,4h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,7d,,,
[],['DMC Asset - Build Standalone Asset Table'],splunk_monitoring_console-default,,,0,,,,,,,,,"| `dmc_get_local_instance_asset` | rename search_groups AS search_group | inputlookup append=true dmc_assets | stats last(*) AS * by peerURI, search_group | fields peerURI serverName host machine search_group",,,,1,,,,*/1 * * * *,,,,,,,This search establishes an updated cache of metadata necessary for the localhost to be included in DMC dashboards. This search will be disabled when user go throught the setup process. and will be re-enabled when user resets to factory mode.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,user,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,1,dmc_assets,1
[],['DMC Asset - Build Standalone Computed Groups Only'],splunk_monitoring_console-default,,,0,,,,,,,,,| `dmc_get_local_instance_asset` | rename search_groups AS search_group | fields peerURI serverName host machine search_group,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,user,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,dmc_assets,
['Endpoint.Registry'],['ESCU - Disabling Remote User Account Control - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Registry where Registry.registry_path=""*Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy"" by Registry.dest, Registry.registry_key_name Registry.status Registry.user Registry.registry_path Registry.action | `drop_dm_object_name(Registry)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for modifications to registry keys that control the enforcement of Windows User Account Control (UAC).,,,,,,1,Disabling Remote User Account Control,,endpoint,medium,Registry Key Associated With Disabling Remote UAC Modified on $dest$,The registry key SOFTWAREMicrosoftWindowsCurrentVersionPoliciesSystemLocalAccountTokenFilterPolicy was modified.  This registry key is associated with disabling remote UAC on Windows.,"dest, user, registry_path",,,,,1,dest,system,30,"dest, user, registry_path",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Modify Registry""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search checks to see if the registry key SOFTWAREMicrosoftWindowsCurrentVersionPoliciesSystemLocalAccountTokenFilterPolicy was modified.  This registry key can be used to disable remote User Account Control.  The search returns the count, the first time activity was seen, last time activity was seen, the registry path that was modified, the host where the modification took place and the user that performed the modification.","To successfully implement this search, you must be ingesting data that records registry activity from your hosts to populate the endpoint data model in the registry node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or via other endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report registry modifications.",This registry key may be modified via administrators to implement a change in system policy. This type of change should be a very rare occurrence.,2017-10-12,2018-12-03,medium,ESCU - Disabling Remote User Account Control - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious Windows Registry Activities"", ""Windows Defense Evasion Tactics""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DMC Asset - Build Full'],splunk_monitoring_console-default,,,0,,,,,,,,,"| rest splunk_server=local /services/search/distributed/peers | search status=Up disabled=0 | eval os = os_name | fields guid title peerName host host_fqdn server_roles search_groups cpu_arch os numberOfCores physicalMemoryMB version | rename title AS peerURI peerName AS serverName host_fqdn AS machine numberOfCores AS cpu_count physicalMemoryMB AS mem version AS splunk_version server_roles AS inherited_server_roles | where isnotnull(mvfind(search_groups,""dmc_group_"")) | join type=outer peerURI [     | rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/configs/conf-splunk_monitoring_console_assets     | fields title host host_fqdn     | rename title AS peerURI host_fqdn AS machine] | mvexpand search_groups | append [ | `dmc_get_local_instance_asset_in_distributed_mode` ] | fields peerURI serverName host machine search_groups | rename search_groups AS search_group",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,user,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,dmc_assets,
[],['DMC Forwarder - Build Asset Table'],splunk_monitoring_console-default,,,1,,,,,,,,,"`dmc_build_forwarder_assets(1m)` | inputlookup append=true dmc_forwarder_assets | stats values(forwarder_type) as forwarder_type, max(version) as version, values(arch) as arch, values(os) as os, max(last_connected) as last_connected, values(new_sum_kb) as sum_kb, values(new_avg_tcp_kbps_sparkline) as avg_tcp_kbps_sparkline, values(new_avg_tcp_kbps) as avg_tcp_kbps, values(new_avg_tcp_eps) as avg_tcp_eps by guid, hostname | addinfo | eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (info_max_time - 900)), ""missing"", ""active"") | eval sum_kb = round(sum_kb, 2) | eval avg_tcp_kbps = round(avg_tcp_kbps, 2) | eval avg_tcp_eps = round(avg_tcp_eps, 2) | fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps | outputlookup dmc_forwarder_assets",-16m@m,-1m@m,,1,,,,"3,18,33,48 * * * *",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,user,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DMC License Usage Data Cube'],splunk_monitoring_console-default,,,,,,,,,,,,"index=_internal source=*license_usage.log* type=""Usage"" | eval h=if(len(h)=0 OR isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | eval idx=if(len(idx)=0 OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, host, pool, s, st, h, idx",-31d,-0d,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,-1mon@d,,,,,,,,,,,,,,,"3,13,23,33,43,53 * * * *",,,,,,,,,,,,,,,,,,,,,,
"['Malware.Malware_Attacks', 'Network_Traffic.All_Traffic', 'Intrusion_Detection.IDS_Attacks', 'Vulnerabilities.Vulnerabilities']",['CIM - Vendor Product Tracker - Lookup Gen'],Splunk_SA_CIM-default,,,,,,,,,,,,"| tstats prestats=true summariesonly=true min(_time),max(_time) from datamodel=Malware.Malware_Attacks by Malware_Attacks.vendor_product | `drop_dm_object_name(""Malware_Attacks"")` | eval model=""Malware"" | tstats prestats=true summariesonly=true append=true min(_time),max(_time) from datamodel=Network_Traffic.All_Traffic by All_Traffic.vendor_product | `drop_dm_object_name(""All_Traffic"")` | eval model=if(isnull(model),""Network_Traffic"",model) | tstats prestats=true summariesonly=true append=true min(_time),max(_time) from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.vendor_product | `drop_dm_object_name(""IDS_Attacks"")` | eval model=if(isnull(model),""Intrusion_Detection"",model) | tstats prestats=true summariesonly=true append=true min(_time),max(_time) from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.vendor_product | `drop_dm_object_name(""Vulnerabilities"")` | eval model=if(isnull(model),""Vulnerabilities"",model) | stats min(_time) as firstTime,max(_time) as lastTime by vendor_product,model | inputlookup append=true cim_vendor_product_tracker | stats min(firstTime) as firstTime,max(lastTime) as lastTime by vendor_product,model | outputlookup cim_vendor_product_tracker | stats count",-30m@m,+0s,,0,,,,"5,20,35,50 * * * *",,,,,,,Maintains a list of vendor_product values and the first and list time they have been seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit'],['CIM - Top Data Model Accelerations'],Splunk_SA_CIM-default,,,,,,,,,,,,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | `drop_dm_object_name(""Datamodel_Acceleration"")` | join type=outer last_sid [| rest splunk_server=local count=0 /services/search/jobs reportSearch=summarize* | rename sid as last_sid | fields last_sid,runDuration] | eval ""size(MB)""=round(size/1048576,1), ""retention(days)""=if(retention==0,""unlimited"",round(retention/86400,1)), ""complete(%)""=round(complete*100,1), ""runDuration(s)""=round(runDuration,1)",,now,,,,,,,,,,,,,Maintains a data cube of DMA statistics for use in Datamodel Audit view,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,user,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit'],['CIM - Top Data Model Accelerations By Size'],Splunk_SA_CIM-default,,,,,,,,,,,,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | `drop_dm_object_name(""Datamodel_Acceleration"")` | eval size(MB)=size/1048576 | sort 100 - size | table datamodel,size(MB)",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit'],['CIM - Top Data Model Accelerations By Run Duration'],Splunk_SA_CIM-default,,,,,,,,,,,,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | `drop_dm_object_name(""Datamodel_Acceleration"")` | join type=outer last_sid [| rest splunk_server=local count=0 /services/search/jobs reportSearch=summarize* | rename sid as last_sid | fields last_sid,runDuration] | sort 100 - runDuration | table datamodel,runDuration",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit'],['CIM - Data Model Acceleration Details'],Splunk_SA_CIM-default,,,,,,,,,,,,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | `drop_dm_object_name(""Datamodel_Acceleration"")` | eval size(MB)=round(size/1048576,1) | eval retention(days)=retention/86400 | eval complete(%)=round(complete*100,1) | sort 100 + datamodel | fieldformat earliest=strftime(earliest, ""%m/%d/%Y %H:%M:%S"") | fieldformat latest=strftime(latest, ""%m/%d/%Y %H:%M:%S"") | fields datamodel,app,cron,retention(days),earliest,latest,is_inprogress,complete(%),size(MB),last_error",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table cvss,""cvss_base_score"",""cvss_vector"",cwe,description,""exploit_available"",""exploit_framework_canvas"",""exploit_framework_core"",""exploit_framework_exploithub"",""exploit_framework_metasploit"",""exploitability_ease"",""exploited_by_malware"",""exploithub_sku"",""family_name"",fname,id,""metasploit_name"",""patch_publication_date"",""plugin_modification_date"",""plugin_name"",""plugin_publication_date"",""plugin_type"",""risk_factor"",""script_version"",signature,""signature_id"",solution,synopsis | inputlookup append=t nessus_plugin_lookup | dedup id | outputlookup nessus_plugin_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - EC2 Instance Modified With Previously Unseen User - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail `ec2ModificationAPIs` [search sourcetype=aws:cloudtrail `ec2ModificationAPIs` errorCode=success | stats earliest(_time) as firstTime latest(_time) as lastTime by userIdentity.arn | rename userIdentity.arn as arn | inputlookup append=t previously_seen_ec2_modifications_by_user | stats min(firstTime) as firstTime, max(lastTime) as lastTime by arn | outputlookup previously_seen_ec2_modifications_by_user | eval newUser=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newUser=1 | `ctime(firstTime)` | `ctime(lastTime)` | rename arn as userIdentity.arn | table userIdentity.arn] | spath output=dest responseElements.instancesSet.items{}.instanceId | spath output=user userIdentity.arn | table _time, user, dest",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for EC2 instances being modified by users who have not previously modified them.,,,,,,1,EC2 Instance Modified With Previously Unseen User,,endpoint,medium,EC2 Instance Modified By Previously Unseen User $user$,The EC2 instance $dest$ was modified by $user$. This user has never modified an EC2 instance before.,"user, dest",,,,,1,dest,system,30,"user, dest",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns the ARNs of all successful EC2 instance modifications within the last hour and then appends the historical data in the lookup file to those results. EC2 modification APIs are defined by the macro `ec2ModificationAPIs`. The search then recalculates the `firstTime` and `lastTime` field for each ARN and returns only those ARNs that have first been seen in the past hour. This is combined with the main search to return the time, user, and instance ID of those systems.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen EC2 Launches By User"" support search once to create a history of previously seen ARNs. To add or remove APIs that modify an EC2 instance, edit the macro `ec2ModificationAPIs`.",It's possible that a new user will start to modify EC2 instances when they haven't before for any number of reasons. Verify with the user that is modifying instances that this is the intended behavior.,2018-04-09,2018-04-09,medium,ESCU - EC2 Instance Modified With Previously Unseen User - Rule,detection,AWS Instance,[],"[""AWS""]","[""Unusual AWS EC2 Modifications""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get EC2 Instance Details by instanceIdnESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins cve'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,cve | inputlookup append=t nessus_mv_cve_lookup | dedup id | mvexpand cve | outputlookup nessus_mv_cve_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins cpe'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,cpe | inputlookup append=t nessus_mv_cpe_lookup | dedup id | mvexpand cpe | outputlookup nessus_mv_cpe_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins bugtraq'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,bugtraq | inputlookup append=t nessus_mv_bugtraq_lookup | dedup id | mvexpand bugtraq | outputlookup nessus_mv_bugtraq_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins osvdb'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,osvdb | inputlookup append=t nessus_mv_osvdb_lookup | dedup id | mvexpand osvdb | outputlookup nessus_mv_osvdb_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins xref'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,xref | inputlookup append=t nessus_mv_xref_lookup | dedup id | mvexpand xref | outputlookup nessus_mv_xref_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins msft'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,msft | inputlookup append=t nessus_mv_msft_lookup | dedup id | mvexpand msft | outputlookup nessus_mv_msft_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins mskb'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,mskb | inputlookup append=t nessus_mv_mskb_lookup | dedup id | mvexpand mskb | outputlookup nessus_mv_mskb_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Nessus plugins cert'],Splunk_TA_nessus-default,,,1,,,,,,,,,"sourcetype=nessus:plugin | dedup id | table id,cert | inputlookup append=t nessus_mv_cert_lookup | dedup id | mvexpand cert | outputlookup nessus_mv_cert_lookup",0,now,,1,,,,0 0 * * *,,,0,,,1,Saved search which populates Nessus plugins into lookup CSV,,statistics,,0,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,-30d@h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - EC2 Instance Started In Previously Unseen Region - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail earliest=-1h StartInstances  | stats earliest(_time) as earliest latest(_time) as latest by awsRegion| inputlookup append=t previously_seen_aws_regions.csv | stats min(earliest) as earliest max(latest) as latest by awsRegion | outputlookup previously_seen_aws_regions.csv | eval regionStatus=if(earliest >= relative_time(now(), ""-1d@d""), ""Instance Started in a New Region"",""Previously Seen Region"") | convert ctime(earliest) ctime(latest) | where regionStatus=""Instance Started in a New Region""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for CloudTrail events where an instance is started in a particular region in the last one hour and then compares it to a lookup file of previously seen regions where an instance was started,,,,,,1,EC2 Instance Started In Previously Unseen Region,,network,medium,AWS instance is started in a new region,"An AWS instance is started in a new, previously unseen, region",awsRegion,,,,,1,awsRegion,other,30,awsRegion,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 12""], ""nist"": [""DE.DP"", ""DE.AE""]}","In this search, we query CloudTrail logs to look for events that indicate that an instance was started in a particular region. Using the `previously_seen_aws_regions.csv` lookup file created using the support search, we compare the region where this instance was started to all previously observed regions. The `eval` and `if` functions determine that the earliest times seen for this region and instance were within the last day. If a new region is detected, it will alert you with ""Instance Started in a New Region"". However, this region will be added to the list of `previously_seen_aws_regions.csv`. Please maintain `previously_seen_aws_regions.csv`","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Run the ""Previously seen AWS Regions"" support search only once to create of baseline of previously seen regions.",It's possible that a user has unknowingly started an instance in a new region. Please verify that this activity is legitimate.,2018-02-01,2018-02-23,medium,ESCU - EC2 Instance Started In Previously Unseen Region - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Cryptomining"", ""Suspicious AWS EC2 Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get EC2 Instance Details by instanceIdnESCU - Investigate AWS activities via region namenESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - EC2 Instance Started With Previously Unseen AMI - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=RunInstances [search sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success | stats earliest(_time) as earliest latest(_time) as latest by requestParameters.instancesSet.items{}.imageId | rename requestParameters.instancesSet.items{}.imageId as amiID | inputlookup append=t previously_seen_ec2_amis.csv | stats min(earliest) as earliest max(latest) as latest by amiID | outputlookup previously_seen_ec2_amis.csv | eval newAMI=if(earliest >= relative_time(now(), ""-70m@m""), 1, 0) | convert ctime(earliest) ctime(latest) | where newAMI=1 | rename amiID as requestParameters.instancesSet.items{}.imageId | table requestParameters.instancesSet.items{}.imageId] | rename requestParameters.instanceType as instanceType, responseElements.instancesSet.items{}.instanceId as dest, userIdentity.arn as arn, requestParameters.instancesSet.items{}.imageId as amiID | table _time, arn, amiID, dest, instanceType",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for EC2 instances being created with previously unseen AMIs.,,,,,,1,EC2 Instance Started With Previously Unseen AMI,,endpoint,medium,EC2 Instance Type $dest$ Created With New AMI,The EC2 instance $dest$ was created with previously unused AMI $amiID$,dest,,,,,1,dest,system,30,dest,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns the AMI image ID of all successful EC2 instance launches within the last hour and then appends the historical data from the lookup file to those results.  It then recalculates the earliest and latest seen time field for each AMI image ID and returns only those AMI image IDs that have first been seen in the past hour.  This is combined with the main search to return the time, user, and instance id of those systems.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen EC2 AMIs"" support search once to create a history of previously seen AMIs.","After a new AMI is created, the first systems created with that AMI will cause this alert to fire.  Verify that the AMI being used was created by a legitimate user.",2018-03-12,2018-03-12,medium,ESCU - EC2 Instance Started With Previously Unseen AMI - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Cryptomining""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get EC2 Launch Detailsn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Distinct Apps'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Authentication.app) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.app) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Auth. Apps,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(Authentication.app)%20as%20count%20from%20datamodel%3DAuthentication.Authentication%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Authentication.app,1,0,0,all,Distinct Apps,singlevalue,access_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - EC2 Instance Started With Previously Unseen Instance Type - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=RunInstances [search sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success | fillnull value=""m1.small"" requestParameters.instanceType | stats earliest(_time) as earliest latest(_time) as latest by requestParameters.instanceType | rename requestParameters.instanceType as instanceType | inputlookup append=t previously_seen_ec2_instance_types.csv | stats min(earliest) as earliest max(latest) as latest by instanceType | outputlookup previously_seen_ec2_instance_types.csv | eval newType=if(earliest >= relative_time(now(), ""-70m@m""), 1, 0) | convert ctime(earliest) ctime(latest) | where newType=1 | rename instanceType as requestParameters.instanceType | table requestParameters.instanceType] | spath output=user userIdentity.arn | rename requestParameters.instanceType as instanceType, responseElements.instancesSet.items{}.instanceId as dest | table _time, user, dest, instanceType",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for EC2 instances being created with previously unseen instance types.,,,,,,1,EC2 Instance Started With Previously Unseen Instance Type,,endpoint,medium,New EC2 Instance Type $instanceType$ detected,The EC2 instance type $instanceType$ was used for the first time to create $dest$.,instanceType,,,,,1,dest,system,30,dest,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns the instance types of all successful EC2 instance launches within the last hour and then appends the historical data in the lookup file to those results.  It then recalculates the earliest seen time field for each instance type and returns only those instance types that has first been seen in the past hour.  This is combined with the main search to return the time, user, and instance id of those systems.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen EC2 Instance Types"" support search once to create a history of previously seen instance types.",It is possible that an admin will create a new system using a new instance type never used before. Verify with the creator that they intended to create the system with the new instance type.,2018-03-12,2018-03-12,medium,ESCU - EC2 Instance Started With Previously Unseen Instance Type - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Cryptomining""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get EC2 Launch Detailsn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - EC2 Instance Started With Previously Unseen User - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=RunInstances [search sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success | stats earliest(_time) as firstTime latest(_time) as lastTime by userIdentity.arn | rename userIdentity.arn as arn | inputlookup append=t previously_seen_ec2_launches_by_user.csv | stats min(firstTime) as firstTime, max(lastTime) as lastTime by arn | outputlookup previously_seen_ec2_launches_by_user.csv | eval newUser=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newUser=1 | `ctime(firstTime)` | `ctime(lastTime)` | rename arn as userIdentity.arn | table userIdentity.arn] | rename requestParameters.instanceType as instanceType, responseElements.instancesSet.items{}.instanceId as dest, userIdentity.arn as user | table _time, user, dest, instanceType",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for EC2 instances being created by users who have not created them before.,,,,,,1,EC2 Instance Started With Previously Unseen User,,endpoint,medium,EC2 Instance Created By Previously Unseen User $user$,The EC2 instance $dest$ was created by $user$.  This user has never created an EC2 instance before.,"user, dest",,,,,1,dest,system,30,"user, dest",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns the ARNs of all successful EC2 instance launches within the last hour and then appends the historical data in the lookup file to those results.  It then recalculates the `firstTime` and `lastTime` field for each ARN and returns only those ARNs that have first been seen in the past hour.  This is combined with the main search to return the time, user, and instance id of those systems.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen EC2 Launches By User"" support search once to create a history of previously seen ARNs.",It's possible that a user will start to create EC2 instances when they haven't before for any number of reasons. Verify with the user that is launching instances that this is the intended behavior.,2018-03-15,2018-03-12,medium,ESCU - EC2 Instance Started With Previously Unseen User - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Cryptomining"", ""Suspicious AWS EC2 Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get EC2 Instance Details by instanceIdnESCU - Investigate AWS activities via region namenESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email where'],['ESCU - Email Attachments With Lots Of Spaces - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(All_Email.recipient) as recipient_address min(_time) as firstTime max(_time) as lastTime from datamodel=Email where All_Email.file_name=""*"" by All_Email.src_user, All_Email.file_name All_Email.message_id | `ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(""All_Email"")` | eval space_ratio = (mvcount(split(file_name,"" ""))-1)/len(file_name) | search space_ratio >= 0.1 |  rex field=recipient_address ""(?<recipient_user>.*)@""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,Attackers often use spaces as a means to obfuscate an attachment's file extension. This search looks for messages with email attachments that have many spaces within the filename.,,,,,,1,Email Attachments With Lots Of Spaces,,network,high,Suspicious Email Attachment from $src_user$,The sender $src_user$ has sent an email with a suspicious amount of spaces in the file name: $file_name$,"src_user, file_name",,,,,1,src_user,user,60,src_user,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 7""], ""nist"": [""PR.IP""]}","This search looks at any emails with file attachment names that contain many spaces relative to the length of the file name. Specifically, it checks if spaces make up more than 10% of the number of characters in the file name. This percentage can be tuned for each environment. The search will then output the message ID of the email, the count, the recipient address and the recipient user, first and last time this event was seen and the space ratio of the file attachment name.","You need to ingest data from emails. Specifically, the sender's address and the file names of any attachments must be mapped to the Email data model. The threshold ratio is set to 10%, but this value can be configured to suit each environment.",None at this time,2017-04-21,2017-09-19,high,ESCU - Email Attachments With Lots Of Spaces - Rule,detection,Endpoint,[],"[""Microsoft Exchange""]","[""Emotet Malware (TA18-201A)"", ""Suspicious Emails""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Email InfonESCU - Get Emails From Specific SendernESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Email""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Email files written outside of the Outlook directory - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Filesystem.file_path) as file_path min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Filesystem where (Filesystem.file_name=*.dll OR Filesystem.file_name=*.ost) Filesystem.file_path != ""C:\Users\*\My Documents\Outlook Files\*"" by Filesystem.action Filesystem.process_id Filesystem.file_name Filesystem.dest | `drop_dm_object_name(""Filesystem"")` | `ctime(firstTime)` | `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks at the change-analysis data model and detects email files created outside the normal Outlook directory.,,,,,,1,Email files written outside of the Outlook directory,,endpoint,medium,Email files created or modified on $dest$ that are not in the normal Outlook directory,The system $dest$ has email files outside of the normal Outlook directory,"dest, file_path, action, file_name",,,,,1,dest,system,50,"dest, file_path",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Collection"", ""Email Collection""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""]}","In this search, we are looking for activities consistent with an adversary collecting email data from local machines. The search will detect email files (files with .pst or .ost extensions) created in directories other than the standard Outlook directory (c:usersusernameMy DocumentsOutlook Files.","To successfully implement this search, you must be ingesting data that records the file-system activity from your hosts to populate the Endpoint.Filesystem data model node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or by other endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report file-system reads and writes.",Administrators and users sometimes prefer backing up their email data by moving the email files into a different folder. These attempts will be detected by the search.,2017-12-13,2018-11-02,medium,ESCU - Email files written outside of the Outlook directory - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Collection and Staging""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Email servers sending high volume traffic to hosts - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` sum(All_Traffic.bytes_out) as bytes_out from datamodel=Network_Traffic where All_Traffic.src_category=email_server by All_Traffic.dest_ip _time span=1d | `drop_dm_object_name(""All_Traffic"")` | eventstats avg(bytes_out) as avg_bytes_out stdev(bytes_out) as stdev_bytes_out | eventstats count as num_data_samples avg(eval(if(_time < relative_time(now(), ""@d""), bytes_out, null))) as per_source_avg_bytes_out stdev(eval(if(_time < relative_time(now(), ""@d""), bytes_out, null))) as per_source_stdev_bytes_out by dest_ip | eval minimum_data_samples = 4, deviation_threshold = 3 | where num_data_samples >= minimum_data_samples AND bytes_out > (avg_bytes_out + (deviation_threshold * stdev_bytes_out)) AND bytes_out > (per_source_avg_bytes_out + (deviation_threshold * per_source_stdev_bytes_out)) AND _time >= relative_time(now(), ""@d"") | eval num_standard_deviations_away_from_server_average = round(abs(bytes_out - avg_bytes_out) / stdev_bytes_out, 2), num_standard_deviations_away_from_client_average = round(abs(bytes_out - per_source_avg_bytes_out) / per_source_stdev_bytes_out, 2) | table dest_ip, _time, bytes_out, avg_bytes_out, per_source_avg_bytes_out, num_standard_deviations_away_from_server_average, num_standard_deviations_away_from_client_average",-30d@d,-10m@m,,1,number of events,greater than,0,0 0 * * *,1,1,,,,,This search looks for an increase of data transfers from your email server to your clients. This could be indicative of a malicious actor collecting data using your email server.,,,,,,1,Email servers sending high volume traffic to hosts,,network,medium,High volume of traffic from an email server sent to $dest_ip$,High volume of traffic that originated from an email server is being sent to $dest_ip$,dest_ip,,,,,1,dest_ip,system,50,dest_ip,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Collection"", ""Email Collection"", ""Commonly Used Port""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 7""], ""nist"": [""PR.PT"", ""DE.CM"", ""DE.AE""]}","This search may look complex, but it's a neat representation of how statistics can help you understand your dataset to bubble up events that are not normal compared to its behavior. The search consists of three parts. The first part of the SPL fetches the data you want to work on. In this search, we calculate the sum of bytes sent and bytes_out from systems categorized as email_server to each host. We then calculate the average and standard deviation for the bytes sent to all the hosts combined and on a per-host basis. Then we set threshold values to deviation_threshold and minimum_data_samples using eval statements. The ""deviation_threshold"" field is a multiplying factor to control how much variation you're willing to tolerate. The ""minimum_data_samples"" field is the minimum number of connections of data samples required for the statistic to be valid.  We then check for byte transfers that are statistically significantly higher than normal. The search then gives IP address of the host, the time of the increased byte transfer, how much data was transferred, and the average amount of data transfer the email server normally sends to all hosts and to this specific host. Finally, it includes the number of standard deviations away the byte count was from these averages.","This search requires you to be ingesting your network traffic and populating the Network_Traffic data model.  Your email servers must be categorized as ""email_server"" for the search to work, as well. You may need to adjust the deviation_threshold and minimum_data_samples values based on the network traffic in your environment. The ""deviation_threshold"" field is a multiplying factor to control how much variation you're willing to tolerate. The ""minimum_data_samples"" field is the minimum number of connections of data samples required for the statistic to be valid.",The false-positive rate will vary based on how you set the deviation_threshold and data_samples values. Our recommendation is to adjust these values based on your network traffic to and from your email servers.,2017-12-20,2017-12-20,medium,ESCU - Email servers sending high volume traffic to hosts - Rule,detection,Endpoint,[],"[""Bro"", ""Splunk Stream""]","[""Collection and Staging""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution where'],['ESCU - Excessive DNS Failures - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(""DNS.query"") as queries from datamodel=Network_Resolution where nodename=DNS ""DNS.reply_code""!=""No Error"" ""DNS.reply_code""!=""NoError"" DNS.reply_code!=""unknown"" NOT ""DNS.query""=""*.arpa"" ""DNS.query""=""*.*"" by ""DNS.src"",""DNS.query""| `drop_dm_object_name(""DNS"")`| lookup cim_corporate_web_domain_lookup domain as query OUTPUT domain| where isnull(domain)| lookup update=true alexa_lookup_by_str domain as query OUTPUT rank| where isnull(rank)| stats sum(count) as count mode(queries) as queries by src| `get_asset(src)`| where count>50",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search identifies DNS query failures by counting the number of DNS responses that do not indicate success, and trigger on more than 50 occurrences.",,,,,,1,Excessive DNS Failures,,network,medium,Excessive DNS Failures,This search identifies DNS query failures by counting the number of DNS responses that do not indicate success and triggers on more than 50 occurrences.,"src, query",,,,,1,src,system,20,"src,query",43200s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Exfiltration"", ""Exfiltration Over Alternative Protocol"", ""Command and Control"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 8"", ""CIS 9"", ""CIS 12""], ""nist"": [""PR.PT"", ""DE.AE"", ""DE.CM""]}","This search looks at DNS traffic with a reply code that is NOT indicative of a successful response. Numerous unsuccessful replies may be indicative of DNS protocol tampering or other malicious activity. If more than 50 of these unsuccessful responses are observed over the time frame of the search, a notable event will be generated.",To successfully implement this search you must ensure that DNS data is populating the Network_Resolution data model.,It is possible legitimate traffic can trigger this rule. Please investigate as appropriate. The threshold for generating an event can also be customized to better suit your environment.,2016-09-13,2017-09-18,medium,ESCU - Excessive DNS Failures - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""Suspicious DNS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get DNS Server History for a hostnESCU - Get DNS traffic rationESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Execution of File With Spaces Before Extension - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process_path) as process_path min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process = ""*     .*"" by Processes.dest Processes.user Processes.process Processes.process_name | `ctime(firstTime)`| `ctime(lastTime)` | `drop_dm_object_name(Processes)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for processes launched from files with at least five spaces in the name before the extension. This is typically done to obfuscate the file extension by pushing it outside of the default view.,,,,,,1,Execution of File With Spaces Before Extension,,endpoint,medium,Process $process$ with spaces before extension Launched on $dest$,The system $dest$ executed a file with spaces before its extension.,dest,,,,,1,dest,system,60,"dest,process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Persistence"", ""Change Default File Association""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 8""], ""nist"": [""DE.CM"", ""PR.PT"", ""PR.IP""]}",This search uses the endpoint data model to look for process names with at least five spaces between the file name and its extension.,"To successfully implement this search, you must be ingesting data that records process activity from your hosts to populate the endpoint data model in the processes node. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",None identified.,2018-01-26,2018-01-26,medium,ESCU - Execution of File With Spaces Before Extension - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Windows File Extension and Association Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Execution of File with Multiple Extensions - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process = *.doc.exe OR Processes.process = *.htm.exe OR Processes.process = *.html.exe OR Processes.process = *.txt.exe OR Processes.process = *.pdf.exe OR Processes.process = *.doc.exe by Processes.dest Processes.user Processes.process Processes.parent_process | `ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(Processes)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for processes launched from files that have double extensions in the file name. This is typically done to obscure the ""real"" file extension and make it appear as though the file being accessed is a data file, as opposed to executable content.",,,,,,1,Execution of File with Multiple Extensions,,endpoint,high,Process With Multiple Extensions Launched on $dest$,The system $dest$ executed a file with a double extension.,"dest, process",,,,,1,dest,system,60,"dest, process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Persistence"", ""Change Default File Association""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 8""], ""nist"": [""DE.CM"", ""PR.PT"", ""PR.IP""]}","This search uses the ""Application State"" data model to look for process names with specific combinations of double extensions. Relatively straightforward, the search looks for strings in the ""process"" field that match what you're looking for.","To successfully implement this search, you must be ingesting data that records process activity from your hosts to populate the endpoint data model in the processes node.",None identified.,2018-01-26,2018-11-02,high,ESCU - Execution of File with Multiple Extensions - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Windows File Extension and Association Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Extended Period Without Successful Netbackup Backups - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""netbackup_logs"" MESSAGE=""Disk/Partition backup completed successfully."" | stats latest(_time) as latestTime by COMPUTERNAME | `ctime(latestTime)` | rename COMPUTERNAME as dest | eval isOutlier=if(latestTime <= relative_time(now(), ""-7d@d""), 1, 0) | search isOutlier=1 | table latestTime, dest",-7d@d,-10m@m,,1,number of events,greater than,0,0 0 1 * *,1,1,,,,,This search returns a list of hosts that have not successfully completed a backup in over a week.,,,,,,1,Extended Period Without Successful Netbackup Backups,,endpoint,high,Extended period of no successful backups by $dest$,The system $dest$ has not had a successful backup for an extended period.,dest,,,,,1,dest,system,10,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 10""], ""nist"": [""PR.IP""]}","This search finds all the successful backup messages in your logs, and then looks for the most recent backup time for each system. It then identifies those systems where the most recent successful backup time is over a week ago, and reports on them.","To successfully implement this search you need to first obtain data from your backup solution, either from the backup logs on your hosts, or from a central server responsible for performing the backups. If you do not use Netbackup, you can modify this search for your backup solution. Depending on how often you backup your systems, you may want to modify how far in the past to look for a successful backup, other than the default of seven days.",None identified,2017-06-15,2017-09-12,high,ESCU - Extended Period Without Successful Netbackup Backups - Rule,detection,Endpoint,[],"[""Netbackup""]","[""Monitor Backup Solution""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - All backup logs for hostn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - File with Samsam Extension - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.user) as user values(Filesystem.dest) as dest values(Filesystem.file_path) as file_path from datamodel=Endpoint.Filesystem by Filesystem.file_name | `drop_dm_object_name(Filesystem)` | `ctime(lastTime)` | `ctime(firstTime)`| rex field=file_name ""(?<file_extension>.[^.]+)$"" | search file_extension=.stubbin OR file_extension=.berkshire OR file_extension=.satoshi OR file_extension=.sophos OR file_extension=.keyxml",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for file writes with extensions consistent with a SamSam ransomware attack.,,,,,,1,File with Samsam Extension,,endpoint,high,File with known SamSam extension detected on $dest$,A file with an extension associated with SamSam ransomware was written on $dest$.,"dest, file_name",,,,,1,dest,system,80,"dest,file_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Installation""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks at file modifications across your hosts and creates notable events when it identifies files with extensions associated with the SamSam ransomware, including `.stubbin`, `.berkshire`, `.satoshi`, `.sophos`, or `.keyxml`. Files with these extensions have been observed in SamSam attacks consisting of payload data or keying material.","You must be ingesting data that records file-system activity from your hosts to populate the Endpoint file-system data-model node. If you are using Sysmon, you will need a Splunk Universal Forwarder on each endpoint from which you want to collect data.","Because these extensions are not typically used in normal operations, you should investigate all results.",2018-12-14,2018-12-14,high,ESCU - File with Samsam Extension - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Distinct Destinations'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Authentication.dest) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.dest) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Auth. Dest's,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(Authentication.app)%20as%20count%20from%20datamodel%3DAuthentication.Authentication%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Authentication.user_category%3Ddefault%20by%20Authentication.app,1,0,0,all,Distinct Destinations,singlevalue,access_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - First Time Seen Running Windows Service - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"eventtype=wineventlog_system signature_id=7036 | rex field=Message ""The (?<serviceName>[ws-]*) service entered the (?<action>w*) state"" | where action=""running"" | inputlookup append=t previously_seen_running_windows_services | multireport [| stats earliest(eval(coalesce(_time, firstTime))) as firstTime, latest(eval(coalesce(_time, lastTime))) as lastTime by serviceName | outputlookup previously_seen_running_windows_services | where fact=fiction] [| eventstats earliest(eval(coalesce(_time, firstTime))) as firstTime, latest(eval(coalesce(_time, lastTime))) as lastTime by serviceName | where firstTime >= relative_time(now(), ""-60m@m"") AND isnotnull(_time) | stats values(dest) as dest by _time, serviceName] | table _time, serviceName, dest",-70m@m,-10m@m,,1,number of events,greater than,0,30 * * * *,1,1,,,,,This search looks for the first time a Windows service is seen running in your environment.,,,,,,1,First Time Seen Running Windows Service,,endpoint,medium,First Time Seen Windows Service $serviceName$,The service $serviceName$ is running on $dest$. This is the first time this service has been run on any system.,serviceName,,,,,1,dest,system,40,"serviceName, dest",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""New Service""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 2"", ""CIS 9""], ""nist"": [""ID.AM"", ""PR.DS"", ""PR.AC"", ""DE.AE""]}","This search looks for a change in the status of a Windows service and extracts the name of the service and the action taken by the service. Then the cache file of previously seen Windows services is added to the search. At this point, the search takes two different paths: the first updates the cache file with the latest information and the second searches for services that have never before been seen. It returns the time, the Windows host name, and the service name.","While this search does not require you to adhere to Splunk CIM, you must be ingesting your Windows security-event logs in order for this search to execute successfully. The support search, `Previously Seen Running Windows Services`, should be run before this search to create the baseline of known Windows services.",A previously unseen service is not necessarily malicious. Verify that the service is legitimate and that was installed by a legitimate process.,2018-07-22,2019-02-27,medium,ESCU - First Time Seen Running Windows Service - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Orangeworm Attack Group"", ""Windows Service Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - First time seen command line argument - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = cmd.exe Processes.process = ""* /c *"" by Processes.process Processes.process_name Processes.parent_process_name Processes.dest| `drop_dm_object_name(Processes)`| `ctime(firstTime)` | `ctime(lastTime)` | search [| tstats `summariesonly` earliest(_time) as firstTime latest(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = cmd.exe Processes.process = ""* /c *"" by Processes.process | `drop_dm_object_name(Processes)` | inputlookup append=t previously_seen_cmd_line_arguments | stats min(firstTime) as firstTime, max(lastTime) as lastTime by process | outputlookup previously_seen_cmd_line_arguments | eval newCmdLineArgument=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newCmdLineArgument=1 | `ctime(firstTime)` | `ctime(lastTime)` | table process]",-70m@m,-10m@m,,1,number of events,greater than,0,30 * * * *,1,1,,,,,This search looks for command-line arguments that use a <code>/c</code> parameter to execute a command that has not previously been seen.,,,,,,1,First time seen command line argument,,endpoint,medium,First-time seen command-line argument was detected on $dest$.,"The system $dest$ executed a command-line argument, $process$, that has not previously been seen.","dest, user, process",,,,,1,dest,system,50,"dest, process, process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Scripting"", ""Persistence"", ""Command-Line Interface""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","The subsearch returns all events where `cmd.exe` was used with a `/c` parameter in the command-line arguments to execute other commands/programs. It appends the historical data to those results in the lookup file. Next, it recalculates the `firstTime` and `lastTime` field for command-line execution and outputs this data to the lookup file to update the local cache. It returns only those events that have first been seen in the past one hour. This is combined with the main search to return the time, user, destination, process, parent process, and value of the command-line argument.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must be ingesting logs with both the process name and command line from your endpoints. The complete process name with command-line arguments are mapped to the ""process"" field in the Endpoint data model. Please make sure you run the support search ""Previously seen command line arguments,""&#151;which creates a lookup file called `previously_seen_cmd_line_arguments.csv`&#151;a historical baseline of all command-line arguments. You must also validate this list. For the search to do accurate calculation, ensure the search scheduling is the same value as the `relative_time` evaluation function.",Legitimate programs can also use command-line arguments to execute. Please verify the command-line arguments to check what command/program is being executed.,2018-04-09,2019-03-04,medium,ESCU - First time seen command line argument - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A"", ""Hidden Cobra Malware"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Suspicious Command-Line Executions""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Hiding Files And Directories With Attrib.exe - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) values(Processes.process) as process max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=attrib.exe (Processes.process=*+h*) by Processes.parent_process Processes.process_name Processes.user | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`|`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,30 * * * *,1,1,,,,,"Attackers leverage an existing Windows binary, attrib.exe, to mark specific as hidden by using specific flags so that the victim does not see the file.  The search looks for specific command-line arguments to detect the use of attrib.exe to hide files.",,,,,,1,Hiding Files And Directories With Attrib.exe,,endpoint,medium,Suspicious usage of attrib.exe on $dest$,Attrib.exe is often used by attackers to hide malware files and directories in windows environments. This rule detects command-line arguments used to hide a file/directory,"dest, user, process",,,,,1,dest,system,50,"dest, process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}",This search is looking to detect command-line execution with of attrib.exe binary with the +h flag set.  The +h flag is used to hide a file.,"You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",Some applications and users may legitimately use attrib.exe to interact with the files.,2017-10-23,2018-11-15,medium,ESCU - Hiding Files And Directories With Attrib.exe - Rule,detection,,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Windows Defense Evasion Tactics"", ""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Hosts receiving high volume of network traffic from email server - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` sum(All_Traffic.bytes_in) as bytes_in from datamodel=Network_Traffic where All_Traffic.dest_category=email_server by All_Traffic.src_ip _time span=1d | `drop_dm_object_name(""All_Traffic"")` | eventstats avg(bytes_in) as avg_bytes_in stdev(bytes_in) as stdev_bytes_in | eventstats count as num_data_samples avg(eval(if(_time < relative_time(now(), ""@d""), bytes_in, null))) as per_source_avg_bytes_in stdev(eval(if(_time < relative_time(now(), ""@d""), bytes_in, null))) as per_source_stdev_bytes_in by src_ip | eval minimum_data_samples = 4, deviation_threshold = 3 | where num_data_samples >= minimum_data_samples AND bytes_in > (avg_bytes_in + (deviation_threshold * stdev_bytes_in)) AND bytes_in > (per_source_avg_bytes_in + (deviation_threshold * per_source_stdev_bytes_in)) AND _time >= relative_time(now(), ""@d"") | eval num_standard_deviations_away_from_server_average = round(abs(bytes_in - avg_bytes_in) / stdev_bytes_in, 2), num_standard_deviations_away_from_client_average = round(abs(bytes_in - per_source_avg_bytes_in) / per_source_stdev_bytes_in, 2) | table src_ip, _time, bytes_in, avg_bytes_in, per_source_avg_bytes_in, num_standard_deviations_away_from_server_average, num_standard_deviations_away_from_client_average",-30d@d,-10m@m,,1,number of events,greater than,0,0 0 * * *,1,1,,,,,This search looks for an increase of data transfers from your email server to your clients. This could be indicative of a malicious actor collecting data using your email server.,,,,,,1,Hosts receiving high volume of network traffic from email server,,network,medium,High volume traffic from email server received by $src_ip$,$src_ip$ receiving high volume of traffic that originated from an email server,src_ip,,,,,1,src_ip,system,50,src_ip,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Collection"", ""Commonly Used Port""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 7""], ""nist"": [""PR.PT"", ""DE.CM"", ""DE.AE""]}","This search may look complex, but it's a neat representation of how statistics can help you understand your dataset to bubble up events that are not normal compared to its behavior. The search consists of three parts. The first part of the SPL fetches the data you want to work on. In this search, we calculate the sum of bytes sent and bytes_out from systems categorized as email_server to each host. We then calculate the average and standard deviation for the bytes sent to all the hosts combined and on a per-host basis. Then we set threshold values to deviation_threshold and minimum_data_samples using eval statements. The ""deviation_threshold"" field is a multiplying factor to control how much variation you're willing to tolerate. The ""minimum_data_samples"" field is the minimum number of connections of data samples required for the statistic to be valid.  We then check for byte transfers that are statistically significantly higher than normal. The search then gives IP address of the host, the time of the increased byte transfer, how much data was transferred, and the average amount of data transfer the email server normally sends to all hosts and to this specific host. Finally, it includes the number of standard deviations away the byte count was from these averages.","This search requires you to be ingesting your network traffic and populating the Network_Traffic data model.  Your email servers must be categorized as ""email_server"" for the search to work, as well. You may need to adjust the deviation_threshold and minimum_data_samples values based on the network traffic in your environment. The ""deviation_threshold"" field is a multiplying factor to control how much variation you're willing to tolerate. The ""minimum_data_samples"" field is the minimum number of connections of data samples required for the statistic to be valid.",The false-positive rate will vary based on how you set the deviation_threshold and data_samples values. Our recommendation is to adjust these values based on your network traffic to and from your email servers.,2017-12-20,2017-12-20,medium,ESCU - Hosts receiving high volume of network traffic from email server - Rule,detection,Endpoint,[],"[""Bro"", ""Splunk Stream""]","[""Collection and Staging""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Identity_Management.All_Identities'],['ESCU - Identify New User Accounts - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| from datamodel Identity_Management.All_Identities  | eval empStatus=case((now()-startDate)<604800, ""Accounts created in last week"") | search empStatus=""Accounts created in last week""| `ctime(endDate)` | `ctime(startDate)`| table identity empStatus endDate startDate",-24h@h,-10m@m,,1,number of events,greater than,0,0 0 * * *,1,1,,,,,This detection search will help profile user accounts in your environment by identifying newly created accounts that have been added to your network in the past week.,,,,,,1,Identify New User Accounts,,access,medium,Identify Temporary Users,Using the identities lookup and macro from Enterprise Security to identify (report) new users (6 month period) and temp users (3 months until account expiration),user,,,,,1,user,system,40,identity,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Valid Accounts""], ""cis20"": [""CIS 16""], ""nist"": [""PR.IP""]}","Adversaries will often seek to create new user accounts as a means of maintaining access to a target environment. Using this search, we identify accounts created in the last week by comparing the start date in the Identity_Management data model against the current time.","To successfully implement this search, you need to be populating the Enterprise Security Identity_Management data model in the assets and identity framework.","If the Identity_Management data model is not updated regularly, this search could give you false positive alerts. Please consider this and investigate appropriately.",2017-08-05,2017-09-12,medium,ESCU - Identify New User Accounts - Rule,detection,Domain Server,[],"[""Active Directory""]","[""Account Monitoring and Controls""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get Notable InfonESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Logon Rights Modifications For UsernESCU - Get Logon Rights Modifications For Endpointn""}",0,3600,86400,0,,,,,"[""Identity_Management""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution where'],['ESCU - Large Volume of DNS ANY Queries - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Resolution where nodename=DNS ""DNS.message_type""=""QUERY"" ""DNS.record_type""=""ANY"" by ""DNS.dest"" | `drop_dm_object_name(""DNS"")` | where count>200",-15m@m,-10m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,,,,,The search is used to identify attempts to use your DNS Infrastructure for DDoS purposes via a DNS amplification attack leveraging ANY queries.,,,,,,1,Large Volume of DNS ANY Queries,,network,high,Large Volume of DNS ANY Queries,The search is used to identify attempts to use your DNS Infrastructure for DDoS purposes via a DNS amplification attack leveraging ANY queries.,dest,,,,,1,dest,system,60,dest,7200s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 11"", ""CIS 12""], ""nist"": [""PR.PT"", ""DE.AE"", ""PR.IP""]}","This search counts the number of DNS ANY queries received in 5 minutes, and generates a Notable Event if the count exceeds a predefined threshold. The search returns the count, the first time, and the last time a DNS packet was observed with the ANY flag set.",To successfully implement this search you must ensure that DNS data is populating the Network_Resolution data model.,"Legitimate ANY requests may trigger this search, however it is unusual to see a large volume of them under typical circumstances. You may modify the threshold in the search to better suit your environment.",2016-08-24,2017-09-20,high,ESCU - Large Volume of DNS ANY Queries - Rule,detection,DNS Servers,[],"[""Splunk Stream"", ""Bro""]","[""DNS Amplification Attacks""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For Endpointn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Malicious PowerShell Process - Connect To Internet With Hidden Window - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=powershell.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` | search process=""*-Exec*"" process=""*-WindowStyle*"" process=""*hidden*"" process=""*New-Object*"" process=""*System.Net.WebClient*""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for PowerShell processes started with parameters to modify the execution policy of the run, run in a hidden window, and connect to the Internet. This combination of command-line options is suspicious because it's overriding the default PowerShell execution policy, attempts to hide its activity from the user, and connects to the Internet.",,,,,,1,Malicious PowerShell Process - Connect To Internet With Hidden Window,,endpoint,medium,Malicious PowerShell Process detected on $dest$,The system $dest$ executed a PowerShell process that connects to the Internet with a hidden window.,"dest, user, process_name",,,,,1,dest,system,75,"process_name, dest",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""PowerShell"", ""Scripting""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 7"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","This search looks for PowerShell processes running with specific command-line arguments that indicate that the process will download a file from the Internet without display anything to the user. The search for ""*-Exec*"" is to check and see if the default execution policy for PowerShell is being overridden on the command-line. The search for ""*-WindowStyle*"" and ""*hidden*"" are to see if the window that would normally be displayed will be hidden from the user instead. Finally, the search for ""*New-Object*"" and ""*System.Net.WebClient*"" are there to check to see if a PowerShell object that can be used to download files will be created. This search will return the host, the user the process ran under, the process and it's command-line arguments, the number of times it's seen this process, and the first and last times it saw this process.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Legitimate process can have this combination of command-line options, but it's not common.",2016-09-18,2018-12-03,medium,ESCU - Malicious PowerShell Process - Connect To Internet With Hidden Window - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Malicious PowerShell"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Malicious PowerShell Process - Encoded Command - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=powershell.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` | search process=*-EncodedCommand* OR  process=*-enc*,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for PowerShell processes that have encoded the script within the command-line. Malware has been seen using this parameter, as it obfuscates the code and makes it relatively easy to pass a script on the command-line.",,,,,,1,Malicious PowerShell Process - Encoded Command,,endpoint,medium,PowerShell process with an encoded command detected on $dest$,The system $dest$ executed a PowerShell process that has an encoded command on the command-line,"dest, user, process_name",,,,,1,dest,system,20,"dest, user, process_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""PowerShell"", ""Scripting""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 7"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","This search looks for PowerShell processes that are passing encoded commands on the command-line. The flags ""-EncodedCommand"" and ""-enc"" are two different possible flags that can be used to pass base64 encoded commands to PowerShell.  This search will return the host, the user the process ran under, the process and it's command-line arguments, the number of times it's seen this process, and the first and last times it saw this process.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","System administrators may use this option, but it's not common.",2016-09-18,2018-12-03,medium,ESCU - Malicious PowerShell Process - Encoded Command - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Malicious PowerShell""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Malicious PowerShell Process - Execution Policy Bypass - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=powershell.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)`| search process=* -ex* OR process=* bypass *,-70m@m,-10m@m,,1,number of events,greater than,0,50 * * * *,1,1,,,,,This search looks for PowerShell processes started with parameters used to bypass the local execution policy for scripts. These parameters are often observed in attacks leveraging PowerShell scripts as they override the default PowerShell execution policy.,,,,,,1,Malicious PowerShell Process - Execution Policy Bypass,,endpoint,medium,PowerShell process with -executionpolicy bypass detected on $dest$,The system $dest$ executed a PowerShell process with parameters to bypass the local execution policy.,"dest, user, process_name",,,,,1,dest,system,50,"dest, process_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""PowerShell"", ""Scripting""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 7"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","This search looks for PowerShell processes that were launched using a parameter designed to bypass the local PowerShell execution policy. By default, the policy is set to ""Restricted,"" which disables the execution of PowerShell scripts. In environments that make heavy use of PowerShell, the policy can be set to allow only scripts signed by a trusted publisher. Malicious PowerShell use almost always includes the parameter `-ExecutionPolicy bypass`. PowerShell is very liberal when it comes to interpreting command-line parameters passed to it. For example, the parameter we look for, `-ExecutionPolicy`, can be abbreviated to `-Execution`, `-Exec`, or even `-ex`. As such, we look for `* -ex*`, which should catch all variations of this parameter, followed by the keyword `bypass`. This search will return the host, the user the process ran under, the process and its command-line arguments, the number of times it has seen this process, and the first and last times it saw this process.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",There may be legitimate reasons to bypass the PowerShell execution policy. The PowerShell script being run with this parameter should be validated to ensure that it is legitimate.,2018-03-19,2018-12-03,medium,ESCU - Malicious PowerShell Process - Execution Policy Bypass - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Malicious PowerShell Process - Multiple Suspicious Command-Line Arguments - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=powershell.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)`| search (process=*-EncodedCommand* OR process=*-enc*) process=*-Exec* AND process=*-NonI*,-70m@m,-10m@m,,1,number of events,greater than,0,50 * * * *,1,1,,,,,"This search looks for PowerShell processes started with a base64 encoded command-line passed to it, with parameters to modify the execution policy for the process, and those that prevent the display of an interactive prompt to the user. This combination of command-line options is suspicious because it overrides the default PowerShell execution policy, attempts to hide itself from the user, and passes an encoded script to be run on the command-line.",,,,,,1,Malicious PowerShell Process - Multiple Suspicious Command-Line Arguments,,endpoint,medium,PowerShell process with multiple suspicious command-line arguments detected on $dest$,"The system $dest$ executed a PowerShell that had an encoded command on the command-line, attempted to bypass local execution policy, and prevented the display of an interactive prompt to the user.","dest, user, process, process_name",,,,,1,dest,system,60,"dest, process_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""PowerShell"", ""Scripting""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 7"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","This search looks for PowerShell processes that have a number of suspicious flags on the command-line. It is looking for flags are passing encoded commands on the command-line. The flags `-EncodedCommand` and `-enc` are two different possible flags that can be used to pass base64 encoded commands to PowerShell. The `*-Exec*` flag looks to see it the default execution policy of PowerShell is being overridden, while the `*-NonI*` flag tells the PowerShell process that this will be a noninteractive process, so the user doesn't know about the process. This search will return the host, the user the process ran under, the process and it's command-line arguments, the number of times it's seen this process, and the first and last times it saw this process.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Legitimate process can have this combination of command-line options, but it's not common.",2016-09-18,2018-12-03,medium,ESCU - Malicious PowerShell Process - Multiple Suspicious Command-Line Arguments - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Malicious PowerShell""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Distinct Sources'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Authentication.src) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.src) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,2,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Auth. Sources,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(Authentication.src)%20as%20count%20from%20datamodel%3DAuthentication.Authentication%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Authentication.src,1,0,0,all,Distinct Sources,singlevalue,access_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Malicious PowerShell Process With Obfuscation Techniques - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=powershell.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)`| eval num_obfuscation = (mvcount(split(process, ""`""))-1) + (mvcount(split(process, ""^""))-1) | search num_obfuscation > 0",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for PowerShell processes launched with arguments that have characters indicative of obfuscation on the command-line.,,,,,,1,Malicious PowerShell Process With Obfuscation Techniques,,endpoint,medium,PowerShell process with an obfuscation techniques detected on $dest$,The system $dest$ executed a PowerShell process that has evidence of obfuscation on the command-line,"dest, user, process_name, process",,,,,1,dest,system,60,"dest,process_name,process",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""PowerShell"", ""Scripting""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 7"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}",This search looks for PowerShell processes that are passing command-line arguments with unusual characters (backticks and carets) that are PowerShell specific escape characters. Attackers use this obfuscation technique since it does not affect the functionality of PowerShell and it will bypass standard security controls that look for straight up malicious strings and commands. The search counts the occurrence of these obfuscation characters and lists out destination IPs running these PowerShell commands.,"You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","These characters might be legitimately on the command-line, but it is not common.",2017-04-25,2018-12-03,medium,ESCU - Malicious PowerShell Process With Obfuscation Techniques - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Malicious PowerShell""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution by'],['ESCU - Monitor DNS For Brand Abuse - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(DNS.answer) as IPs min(_time) as firstTime from datamodel=Network_Resolution by DNS.src, DNS.query | `drop_dm_object_name(""DNS"")` | `ctime(firstTime)`| `brand_abuse_dns`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for DNS requests for faux domains similar to the domains that you want to have monitored for abuse.,,,,,,1,Monitor DNS For Brand Abuse,,network,high,DNS Query Brand Abuse from $src$,The host $src$ issued a DNS request for a domain to that which you are monitoring for brand abuse.,"src, query",,,,,1,src,system,40,"src,query",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""kill_chain_phases"": [""Delivery"", ""Actions on Objectives""]}","This search gathers all the answers to each system's DNS query, then filters out all queries that do not appear on the list of faux ""look-a-like"" domains that have been generated from the brand abuse domains you are monitoring.","You need to ingest data from your DNS logs. Specifically you must ingest the domain that is being queried and the IP of the host originating the request. Ideally, you should also be ingesting the answer to the query and the query type. This approach allows you to also create your own localized passive DNS capability which can aid you in future investigations. You also need to have run the search ""ESCU - DNSTwist Domain Names"", which creates the permutations of the domain that will be checked for.",None at this time,2017-06-01,2017-09-23,high,ESCU - Monitor DNS For Brand Abuse - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro""]","[""Brand Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Email InfonESCU - Get Emails From Specific SendernESCU - Investigate Web Activity From HostnESCU - Get DNS Server History for a hostnESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email by'],['ESCU - Monitor Email For Brand Abuse - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(All_Email.recipient) as recipients, min(_time) as firstTime, max(_time) as lastTime from datamodel=Email by All_Email.src_user, All_Email.message_id | `drop_dm_object_name(""All_Email"")` | `ctime(firstTime)` | `ctime(lastTime)` | eval temp=split(src_user, ""@"") | eval email_domain=mvindex(temp, 1) | lookup update=true brandMonitoring_lookup domain as email_domain OUTPUT domain_abuse | search domain_abuse=true | table message_id, src_user, email_domain, recipients, firstTime, lastTime",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for emails claiming to be sent from a domain similar to one that you want to have monitored for abuse.,,,,,,1,Monitor Email For Brand Abuse,,network,high,Possible Brand Abuse from $src_user$,The sender $src_user$ has sent an email from a similar domain to that which you are monitoring for brand abuse.,"src_user, message_id",,,,,1,src_user,user,80,"message_id, src_user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 7""], ""nist"": [""PR.IP""]}","This search looks at the sender address in email headers, and identifies those with a sender address using a domain name that matches the list of permutations generated for the domain you want to monitor.","You need to ingest email header data. Specifically the sender's address (src_user) must be populated.  You also need to have run the search ""ESCU - DNSTwist Domain Names"", which creates the permutations of the domain that will be checked for.",None at this time,2017-06-01,2018-01-05,high,ESCU - Monitor Email For Brand Abuse - Rule,detection,Endpoint,[],"[""Microsoft Exchange"", ""Bro"", ""Splunk Stream""]","[""Brand Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Email InfonESCU - Get Emails From Specific SendernESCU - Investigate Web Activity From HostnESCU - Get DNS Server History for a hostnESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Email""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Registry'],['ESCU - Monitor Registry Keys for Print Monitors - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Registry where Registry.action=modified AND Registry.registry_path=""*CurrentControlSet\Control\Print\Monitors*"" by Registry.dest, Registry.registry_key_name Registry.status Registry.user Registry.registry_path Registry.action | `drop_dm_object_name(Registry)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for registry activity associated with modifications to the registry key <code>HKLMSYSTEMCurrentControlSetControlPrintMonitors</code>. In this scenario, an attacker can load an arbitrary .dll into the print-monitor registry by giving the full path name to the after.dll. The system will execute the .dll with elevated (SYSTEM) permissions and will persist after reboot.",,,,,,1,Monitor Registry Keys for Print Monitors,,endpoint,medium,Registry Key changes for Print Monitors detected on $dest$,A registry key associated with adding print monitors can potentially be misused by giving it a path of a malicious .dll in the registry.,"dest, user, registry_path",,,,,1,dest,system,30,"dest, registry_path",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Privilege Escalation"", ""Local Port Monitor""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8"", ""CIS 5""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.AC""]}","In this search, we look for modifications to registry keys used for adding print-monitor entries on Microsoft platforms via the `registry_path` field in the endpoint data model. It then provides the destination, command used to initiate the change, the user who conducted this activity, the resource affected (registry_key_name), and the entire path of the registry.","To successfully implement this search, you must be ingesting data that records registry activity from your hosts to populate the endpoint data model in the registry node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or via other endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report registry modifications.",You will encounter noise from legitimate print-monitor registry entries.,2017-12-01,2018-11-02,medium,ESCU - Monitor Registry Keys for Print Monitors - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Suspicious Windows Registry Activities"", ""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web by'],['ESCU - Monitor Web Traffic For Brand Abuse - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Web.url) as urls min(_time) as firstTime from datamodel=Web by Web.src | `drop_dm_object_name(""Web"")` | `ctime(firstTime)` | `brand_abuse_web`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for Web requests to faux domains similar to the one that you want to have monitored for abuse.,,,,,,1,Monitor Web Traffic For Brand Abuse,,network,high,Web URL Brand Abuse from $src$,The host $src$ connected to a web site with a domain similar to that which you are monitoring for brand abuse.,"src, url",,,,,1,src,system,80,src,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 7""], ""nist"": [""PR.IP""]}",This search looks at all the URLs an endpoint is connecting to and then checks the URL against a list of faux domains that could be indicative of brand abuse.,"You need to ingest data from your web traffic. This can be accomplished by indexing data from a web proxy, or using a network traffic analysis tool, such as Bro or Splunk Stream. You also need to have run the search ""ESCU - DNSTwist Domain Names"", which creates the permutations of the domain that will be checked for.",None at this time,2017-06-01,2017-09-23,high,ESCU - Monitor Web Traffic For Brand Abuse - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro"", ""Bluecoat"", ""Palo Alto Firewall""]","[""Brand Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Email InfonESCU - Get Emails From Specific SendernESCU - Investigate Web Activity From HostnESCU - Get DNS Server History for a hostnESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates where'],['ESCU - No Windows Updates in a time frame - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true latest(_time) as latestTime from datamodel=Updates where Updates.status=Installed Updates.vendor_product=""Microsoft Windows"" by Updates.dest Updates.status Updates.vendor_product | rename Updates.dest as Host | rename Updates.status as ""Update Status"" | rename Updates.vendor_product as Product | eval isOutlier=if(latestTime <= relative_time(now(), ""-60d@d""), 1, 0)  | `ctime(latestTime)`  | search isOutlier=1 | rename latestTime as ""Last Update Time"", | table Host, ""Update Status"", Product, ""Last Update Time""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for Windows endpoints that have not generated an event indicating a successful Windows update in the last 60 days. Windows updates are typically released monthly and applied shortly thereafter. An endpoint that has not successfully applied an update in this time frame indicates the endpoint is not regularly being patched for some reason.,,,,,,1,No Windows Updates in a time frame,,endpoint,medium,No Windows updates in last 60 days on $src$,The system $src$ has not generated a successful Windows Update event in 60 days or more.,"src, user",,,,,1,dest,system,50,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 18""], ""nist"": [""PR.PT"", ""PR.MA""]}","Keeping your systems up-to-date with the latest patches is an important step in keeping your systems secured. For Windows endpoints, Microsoft typically releases patches on the second Tuesday of every month. These patches contain fixes for vulnerabilities in the system that could potentially be exploited by malicious actors. This search checks for messages regarding Windows updates in the 'Update' data model. If a message indicating a successful update has not been observed in 60 days, a notable event will be generated. These systems should be checked to determine why it has not been updated in that time frame.","To successfully implement this search, it requires that the 'Update' data model is being populated. This can be accomplished by ingesting Windows events or the Windows Update log via a universal forwarder on the Windows endpoints you wish to monitor. The Windows add-on should be also be installed and configured to properly parse Windows events in Splunk. There may be other data sources which can populate this data model, including vulnerability management systems.",None identified,2017-08-15,2017-09-15,medium,ESCU - No Windows Updates in a time frame - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Monitor for Updates""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For Endpointn""}",0,3600,86400,0,,,,,"[""Updates""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Open Redirect in Splunk Web - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"index=_internal sourcetype=splunk_web_access return_to=""/%09/*""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search allows you to look for evidence of exploitation for CVE-2016-4859, the Splunk Open Redirect Vulnerability.",,,,,,1,Open Redirect in Splunk Web,,network,medium,Open Redirect in Splunk Web,Search for exploitation of the Splunk Open Redirect Vulnerability,host,,,,,1,host,system,40,host,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Exploitation of Vulnerability""], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 3"", ""CIS 4"", ""CIS 18""], ""nist"": [""ID.RA"", ""RS.MI"", ""PR.PT"", ""PR.AC"", ""PR.IP"", ""DE.CM""]}",This search looks within Splunk's internal logs for evidence of CVE-2016-4859 open redirect exploitation attempts.,No extra steps needed to implement this search.,None identified,2016-09-13,2017-09-19,medium,ESCU - Open Redirect in Splunk Web - Rule,detection,Splunk Server,[],"[""Splunk Enterprise""]","[""Splunk Enterprise Vulnerability""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For Endpointn""}",0,3600,86400,0,,,,,[],,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Alerts.Alerts'],['ESCU - Osquery pack - ColdRoot detection - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| from datamodel Alerts.Alerts | search app=osquery:results (name=pack_osx-attacks_OSX_ColdRoot_RAT_Launchd OR name=pack_osx-attacks_OSX_ColdRoot_RAT_Files) | rename columns.path as path | bucket _time span=30s | stats count(path) by _time, host, user, path",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for ColdRoot events from the osx-attacks osquery pack.,,,,,,1,Osquery pack - ColdRoot detection,,threat,medium,Osquery ColdRoot alert for $host$,Host $host$ generated an alert for the macOS RAT ColdRoot,"host, user",,,,,1,host,system,80,host,3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Persistence"", ""Command and Control""], ""kill_chain_phases"": [""Installation"", ""Command and Control""], ""cis20"": [""CIS 4"", ""CIS 8""], ""nist"": [""DE.DP"", ""DE.CM"", ""PR.PT""]}","The search looks at the Alerts data model to identify those  generated from the osquery osx-attacks.conf pack, which search for the ColdRoot RAT.","In order to properly run this search, Splunk needs to ingest data from your osquery deployed agents with the [osx-attacks.conf](https://github.com/facebook/osquery/blob/experimental/packs/osx-attacks.conf#L599) pack enabled. Also the [TA-OSquery](https://github.com/d1vious/TA-osquery) must be deployed across your indexers and universal forwarders in order to have the osquery data populate the Alerts data model",There are no known false positives.,2019-01-29,2019-01-29,medium,ESCU - Osquery pack - ColdRoot detection - Rule,detection,Endpoint,[],"[""OSquery""]","[""ColdRoot MacOS RAT""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Investigate Network Traffic From src_ipnESCU - Investigate Web Activity From src_ipn""}",0,3600,86400,0,,,,,"[""Alerts""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Overwriting Accessibility Binaries - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.user) as user values(Filesystem.dest) as dest values(Filesystem.file_path) as file_path from datamodel=Endpoint.Filesystem where (Filesystem.file_path=*WindowsSystem32sethc.exe* OR Filesystem.file_path=*WindowsSystem32utilman.exe* OR Filesystem.file_path=*WindowsSystem32osk.exe* OR Filesystem.file_path=*WindowsSystem32Magnify.exe* OR Filesystem.file_path=*WindowsSystem32Narrator.exe* OR Filesystem.file_path=*WindowsSystem32DisplaySwitch.exe* OR Filesystem.file_path=*WindowsSystem32AtBroker.exe*) by Filesystem.file_name Filesystem.dest | `drop_dm_object_name(Filesystem)` | `ctime(lastTime)` | `ctime(firstTime)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,Microsoft Windows contains accessibility features that can be launched with a key combination before a user has logged in. An adversary can modify or replace these programs so they can get a command prompt or backdoor without logging in to the system. This search looks for modifications to these binaries.,,,,,,1,Overwriting Accessibility Binaries,,endpoint,high,"Modification to accessibility binary, $file_path$, was detected on $dest$","A file, $file_name$, was created in the default shim database directory on $dest.","dest, file_name",,,,,1,dest,system,40,dest,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Accessibility Features""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}",This search returns all the different accessibility binaries that have been modified for each Windows host.,"You must be ingesting data that records the filesystem activity from your hosts to populate the Endpoint file-system data model node. If you are using Sysmon, you will need a Splunk Universal Forwarder on each endpoint from which you want to collect data.",Microsoft may provide updates to these binaries. Verify that these changes do not correspond with your normal software update cycle.,2017-12-07,2018-11-15,high,ESCU - Overwriting Accessibility Binaries - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Windows Privilege Escalation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Process Execution via WMI - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes where Processes.process_name = ""scrcons.exe"" by Processes.user Processes.dest Processes.process_name  | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for processes launched via WMI.,,,,,,1,Process Execution via WMI,,endpoint,medium,Process launched via WMI on $dest$,"This search looks for child processes of WmiPrvSE.exe, which indicates that a process was launched via WMI.","dest, user, process",,,,,1,dest,system,70,"dest, user",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Windows Management Instrumentation""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","Attackers are increasingly abusing Windows Management Infrastructure (WMI) for stealth, persistence, lateral movement, or just to leverage its functionality. This search looks for processes launched via WMI, either remotely or locally, by looking for processes launched by WmiPrvSE.exe, which is the process WMI uses to execute new processes and commands.","You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Although unlikely, administrators may use wmi to execute commands for legitimate purposes.",2018-10-23,2019-02-28,medium,ESCU - Process Execution via WMI - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious WMI Use""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Sysmon WMI Activity for Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Distinct Users'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Authentication.user) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Authentication.user) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Auth. Users,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(Authentication.user)%20as%20count%20from%20datamodel%3DAuthentication.Authentication%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Authentication.user,,0,0,all,Distinct Users,singlevalue,access_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Alerts.Alerts'],['ESCU - Processes Tapping Keyboard Events - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| from datamodel Alerts.Alerts | search app=osquery:results name=pack_osx-attacks_Keyboard_Event_Taps | rename columns.cmdline as cmd, columns.name as process_name, columns.pid as process_id| dedup host,process_name | table host,process_name, cmd, process_id",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for processes in an MacOS system that is tapping keyboard events in MacOS, and essentially monitoring all keystrokes made by a user. This is a common technique used by RATs to log keystrokes from a victim, although it can also be used by legitimate processes like Siri to react on human input",,,,,,1,Processes Tapping Keyboard Events,,threat,medium,Host $host has process $process_id$ monitoring its keystrokes,Host $host$ has process $process_id$ tapping keyboard events with command $cmd$,"host, cmd, process_id",,,,,1,host,system,50,host,3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Collection""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 4"", ""CIS 8""], ""nist"": [""DE.DP""]}","The search leverages Alerts generated from the osquery osx-attacks.conf pack search `Keyboard_Event_Taps` to detect when a process is monitoring the keystrokes of a machine, This is a common technique used by macOS remote access trojans to log keystrokes from a machine","In order to properly run this search, Splunk needs to ingest data from your osquery deployed agents with the [osx-attacks.conf](https://github.com/facebook/osquery/blob/experimental/packs/osx-attacks.conf#L599) pack enabled. Also the [TA-OSquery](https://github.com/d1vious/TA-osquery) must be deployed across your indexers and universal forwarders in order to have the osquery data populate the Alerts data model.","There might be some false positives as keyboard event taps are used by processes like Siri and Zoom video chat, for some good examples of processes to exclude please see [this](https://github.com/facebook/osquery/pull/5345#issuecomment-454639161) comment.",2019-01-25,2019-01-25,medium,ESCU - Processes Tapping Keyboard Events - Rule,detection,Endpoint,[],"[""OSquery""]","[""ColdRoot MacOS RAT""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Investigate Network Traffic From src_ipnESCU - Investigate Web Activity From src_ipn""}",0,3600,86400,0,,,,,"[""Alerts""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Processes created by netsh - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.parent_process=""C:WindowsSystem32netsh.exe"" by Processes.parent_process Processes.process_name Processes.user Processes.dest | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`|`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for processes launching netsh.exe to execute various commands via the netsh command-line utility. Netsh.exe is a command-line scripting utility that allows you to, either locally or remotely, display or modify the network configuration of a computer that is currently running. Netsh can be used as a persistence proxy technique to execute a helper .dll when netsh.exe is executed. In this search, we are looking for processes spawned by netsh.exe that are executing commands via the command line.",,,,,,1,Processes created by netsh,,endpoint,medium,Process spawned by netsh.exe detected on $dest$,"A process, $process$, is spawned by netsh.exe. It is highly unlikely for netsh to have any child processes.","dest, process, parent_process",,,,,1,dest,system,50,"dest, process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface"", ""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks for all processes with the parent process ""c:WindowsSystem32netsh.exe"" and returns the process, the command line used to execute it, the host name, and the user context under which it ran.","To successfully implement this search, you must be ingesting logs with the process name, command-line arguments, and parent processes from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",It is unusual for netsh.exe to have any child processes in most environments. It makes sense to investigate the child process and verify whether the process spawned is legitimate.,2018-01-04,2018-11-02,medium,ESCU - Processes created by netsh - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Netsh Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Processes launching netsh - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process=netsh.exe by Processes.parent_process Processes.process_name Processes.user Processes.dest | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`|`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for processes launching netsh.exe. Netsh is a command-line scripting utility that allows you to, either locally or remotely, display or modify the network configuration of a computer that is currently running. Netsh can be used as a persistence proxy technique to execute a helper DLL when netsh.exe is executed. In this search, we are looking for processes spawned by netsh.exe and executing commands via the command line.",,,,,,1,Processes launching netsh,,endpoint,medium,Process launching netsh.exe detected on $dest$,A process detected on $dest$ is launching netsh.exe.,"dest, process, parent_process, cmdline",,,,,1,dest,system,50,"dest, parent_process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface"", ""Persistence"", ""Defense Evasion"", ""Disabling Security Tools""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks for all the parent processes of netsh.exe and returns that process, the command-line used to execute it, the host name, and the user context under which it ran.","To successfully implement this search, you must be ingesting data that records process activity from your hosts to populate the endpoint data model","Some VPN applications are known to launch netsh.exe. Outside of these instances, it is unusual for an executable to launch netsh.exe and run commands.",2017-01-08,2018-11-02,medium,ESCU - Processes launching netsh - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A"", ""Disabling Security Tools"", ""Netsh Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Prohibited Network Traffic Allowed - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic where All_Traffic.action = allowed by All_Traffic.src_ip All_Traffic.dest_ip All_Traffic.dest_port All_Traffic.action | lookup update=true interesting_ports_lookup dest_port as All_Traffic.dest_port OUTPUT app is_prohibited note transport | search is_prohibited=true | `ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(""All_Traffic"")`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for network traffic defined by port and transport layer protocol in the Enterprise Security lookup table ""lookup_interesting_ports"", that is marked as prohibited, and has an associated 'allow' action in the Network_Traffic data model. This could be indicative of a misconfigured network device.",,,,,,1,Prohibited Network Traffic Allowed,,network,medium,Prohibited Network Traffic Allowed from $src_ip$,"This search looks for network traffic defined by port and transport in the ES lookup table ""lookup_interesting_ports"", that is marked as prohibited, and yet has an 'allow' action in the Network_Traffic data model. This should help to identify areas where a network device is not properly configured.","src_ip, dest_ip",,,,,1,src_ip,system,40,"dest_ip,src_ip",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Commonly Used Port"", ""Exfiltration"", ""Exfiltration Over Alternative Protocol""], ""kill_chain_phases"": [""Delivery"", ""Command and Control""], ""cis20"": [""CIS 9"", ""CIS 12""], ""nist"": [""DE.AE"", ""PR.AC""]}","The search looks for traffic marked 'is_prohibited' in the Enterprise Security lookup table 'interesting_ports_lookup', and then determines if any network devices have an associated 'allow' action on that traffic by checking the Network_Traffic data model.","In order to properly run this search, Splunk needs to ingest data from firewalls or other network control devices that mediate the traffic allowed into an environment. This is necessary so that the search can identify an 'action' taken on the traffic of interest. The search requires the Network_Traffic data model be populated.",None identified,2017-04-18,2017-09-11,medium,ESCU - Prohibited Network Traffic Allowed - Rule,detection,Endpoint,[],"[""Palo Alto Firewall"", ""Bro"", ""Splunk Stream""]","[""Command and Control"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Prohibited Software On Endpoint - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes by Processes.dest Processes.user Processes.process | `ctime(firstTime)`| `ctime(lastTime)` | `drop_dm_object_name(Processes)` | `prohibited_softwares`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for applications on the endpoint that you have marked as prohibited.,,,,,,1,Prohibited Software On Endpoint,,endpoint,high,Prohibited Software Detected On $dest$,Prohibited software $process_name$ has been detected on $dest$.,"dest, process, user",,,,,1,dest,system,50,"dest,user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Installation"", ""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 2""], ""nist"": [""ID.AM"", ""PR.DS""]}","This search returns the number of times, as well as the first and last time, every process has run for each endpoint and user. It then displays only those processes that you have marked as ""prohibited"" in the Enterprise Security ""Interesting Processes"" table.","To successfully implement this search, you must be ingesting data that records registry activity from your hosts to populate the endpoint data model in the processes node. This is typically populated via endpoint detection-and-response products, such as Carbon Black or endpoint data sources, such as Sysmon. The data used for this search is usually generated via logs that report reads and writes to the registry or populated via Windows event logs, after enabling process tracking in your Windows audit settings. In addition, you must also have processes marked as ""prohibited"" in the Enterprise Security `interesting processes` table. To include the processes marked as ""prohibited"", which is included with ES Content Updates, run the included search `Support - Add Prohibited Processes to ES`.",None identified,2017-06-26,2010-11-02,high,ESCU - Prohibited Software On Endpoint - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Emotet Malware (TA18-201A)"", ""Monitor for Unauthorized Software"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Protocol or Port Mismatch - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic where (All_Traffic.app=dns NOT All_Traffic.dest_port=53) OR ((All_Traffic.app=web-browsing OR All_Traffic.app=http) NOT (All_Traffic.dest_port=80 OR All_Traffic.dest_port=8080 OR All_Traffic.dest_port=8000)) OR (All_Traffic.app=ssl NOT (All_Traffic.dest_port=443 OR All_Traffic.dest_port=8443)) OR (All_Traffic.app=smtp NOT All_Traffic.dest_port=25) by All_Traffic.src_ip, All_Traffic.dest_ip, All_Traffic.app, All_Traffic.dest_port |`ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(""All_Traffic"")`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for network traffic on common ports where a higher layer protocol does not match the port that is being used. For example, this search should identify cases where protocols other than HTTP are running on TCP port 80. This can be used by attackers to circumvent firewall restrictions, or as an attempt to hide malicious communications over ports and protocols that are typically allowed and not well inspected.",,,,,,1,Protocol or Port Mismatch,,network,medium,Protocol / Port Mismatch from $src_ip$,"This search looks for network traffic on common ports where the underlying protocol does not match the port being used. For example, this search should identify cases where protocols other than HTTP are running on port 80. This can be used by attackers to circumvent firewall restrictions, or as an attempt to hide malicious communications in traffic that is typically allowed and not well inspected.","dest_ip, src_ip",,,,,1,src_ip,system,40,"dest_ip, dest_port",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 9"", ""CIS 12""], ""nist"": [""DE.AE"", ""PR.AC""]}","This search looks for instances in which the protocol observed is not consistent with the port and transport protocol typically used for that protocol. For example, looking for network traffic other than HTTP running over TCP port 80. Such behavior could indicate a misconfiguration or a custom command and control protocol that has been designed to look like ordinary web traffic. The search will also identify if HTTP traffic is observed running on unexpected ports. This can be common in many environments.","Running this search properly requires a technology that can inspect network traffic and identify common protocols. Technologies such as Bro and Palo Alto Networks firewalls are two examples that will identify protocols via inspection, and not just assume a specific protocol based on the transport protocol and ports.",None identified,2017-04-18,2017-09-11,medium,ESCU - Protocol or Port Mismatch - Rule,detection,Endpoint,[],"[""Palo Alto Firewall"", ""Bro"", ""Splunk Stream""]","[""Command and Control"", ""Prohibited Traffic Allowed or Protocol Mismatch""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Information For Port Activityn""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Protocols passing authentication in cleartext - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic where All_Traffic.protocol=""tcp"" AND (All_Traffic.dest_port=""23"" OR All_Traffic.dest_port=""143"" OR All_Traffic.dest_port=""110"" OR (All_Traffic.dest_port=""21"" AND All_Traffic.user != ""anonymous"")) groupby All_Traffic.user All_Traffic.src All_Traffic.dest All_Traffic.dest_port | `ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(""All_Traffic"")`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for cleartext protocols at risk of leaking credentials. Currently, this consists of legacy protocols such as telnet, POP3, IMAP, and non-anonymous FTP sessions. While some of these protocols can be used over SSL, they typically run on different assigned ports in those cases.",,,,,,1,Protocols passing authentication in cleartext,,network,medium,Possible credential leak over cleartext protocol,This search looks for the use of cleartext protocols that are known to pass authentication information in the clear. The cleartext credentials are typically passed at the beginning of the session.,"src, dest, user",,,,,1,user,user,60,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Lateral Movement"", ""Collection""], ""kill_chain_phases"": [""Reconnaissance"", ""Actions on Objectives""], ""cis20"": [""CIS 9"", ""CIS 14""], ""nist"": [""PR.PT"", ""DE.AE"", ""PR.AC"", ""PR.DS""]}",This search is checking for traffic on well-known ports that are associated with protocols that pass authentication in cleartext.,"This search requires you to be ingesting your network traffic, and populating the Network_Traffic data model.","Some networks may use kerberized FTP or telnet servers, however, this is rare.",2017-08-03,2017-09-15,medium,ESCU - Protocols passing authentication in cleartext - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro""]","[""Use of Cleartext Protocols""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Information For Port Activityn""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Processes', 'Endpoint.Registry']",['ESCU - Reg.exe Manipulating Windows Services Registry Keys - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Processes.process_name) as process_name values(Processes.parent_process_name) as parent_process_name FROM datamodel=Endpoint.Processes where Processes.process_name = reg.exe by Processes.process_id Processes.dest | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)` | `ctime(lastTime)` | join [| tstats `summariesonly` values(Registry.registry_path) as registry_path count  FROM datamodel=Endpoint.Registry where Registry.registry_path=""*\services\*"" by Registry.process_id Registry.dest | `drop_dm_object_name(""Registry"")` | table process_id dest registry_path]",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for reg.exe modifying registry keys that define Windows services and their configurations.,,,,,,1,Reg.exe Manipulating Windows Services Registry Keys,,endpoint,high,Modification of Windows Services Via Reg.exe on $dest$,A registry key associated with Windows services was modified via reg.exe on $dest$ by $src_user$.,"dest, process",,,,,1,dest,system,80,"dest, process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Privilege Escalation"", ""New Service"", ""Modify Existing Service"", ""Defense Evasion"", ""Disabling Security Tools""], ""kill_chain_phases"": [""Installation""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 8""], ""nist"": [""PR.IP"", ""PR.PT"", ""PR.AC"", ""PR.AT"", ""DE.CM""]}","This search looks for modifications to registry paths that specify the definition and configuration of Windows services by reg.exe. Reg.exe is a Windows utility that allows for manipulation of the registry via the command line. Malware often uses the Windows services architecture to persist, hide in plain sight, and gain the ability to interact with the Windows kernel. While it is common to modify the configuration of Windows services (and new services may be created with software installs), the use of reg.exe to create or modify a service configuration is unusual and a technique commonly used by attackers. The search returns the count, the first time the activity was seen, the last time activity was seen, the registry path that was modified, the host where the modification took place, and the user that performed the modification.",To successfully implement this search you need to be ingesting information on registry changes that include the name of the process responsible for the changes from your endpoints into the `Endpoint` datamodel in the `Processes` and `Registry` nodes.,"It is unusual for a service to be created or modified by directly manipulating the registry. However, there may be legitimate instances of this behavior. It is important to validate and investigate, as appropriate.",2018-6-29,2019-03-01,high,ESCU - Reg.exe Manipulating Windows Services Registry Keys - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Windows Persistence Techniques"", ""Windows Service Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Reg.exe used to hide files/directories via registry keys - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = reg.exe Processes.process=""*add*"" Processes.process=""*Hidden*"" Processes.process=""*REG_DWORD*"" by Processes.process_name Processes.parent_process_name Processes.dest Processes.user| `drop_dm_object_name(Processes)` | `ctime(firstTime)` |`ctime(lastTime)`| regex process = ""(/ds+2)""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for command-line arguments used to hide a file or directory using the reg add command.,,,,,,1,Reg.exe used to hide files/directories via registry keys,,endpoint,medium,Regedit.exe used to hide a file/directory on $dest$,Regedit.exe is used by attackers to hide malware files/directories in windows environments via registry key settings. This rule detects command-line arguments used to hide a file/directory,"dest, process",,,,,1,dest,system,50,"dest,process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}","Reg.exe is a binary native to Windows platform used to edit the registry hives of the system. Attackers can leverage this binary to hide files by passing in arguments that are used to hide the files. In the search, we first gather results with keywords, add, Hidden, and REG_DWORD, that will be in the raw event and filter by process and the command-line. We then leverage regular expressions on the command-line field to look for /d value as 2 which is responsible for hiding a file or directory.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",None at the moment,2017-10-27,2019-02-27,medium,ESCU - Reg.exe used to hide files/directories via registry keys - Rule,detection,,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious Windows Registry Activities"", ""Windows Defense Evasion Tactics"", ""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Registry'],['ESCU - Registry Keys Used For Persistence - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Registry.registry_key_name) as registry_key_name values(Registry.registry_path) as registry_path min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Registry where (Registry.registry_path=*currentversion\run* OR Registry.registry_path=*currentVersion\Windows\Appinit_Dlls* OR Registry.registry_path=CurrentVersion\Winlogon\Shell* OR Registry.registry_path=*CurrentVersion\Winlogon\Userinit* OR Registry.registry_path=*CurrentVersion\Winlogon\VmApplet* OR Registry.registry_path=*currentversion\policies\explorer\run* OR Registry.registry_path=*currentversion\runservices* OR Registry.registry_path=*\CurrentControlSet\Control\Lsa\* OR Registry.registry_path=""*Microsoft\Windows NT\CurrentVersion\Image File Execution Options*"" OR Registry.registry_path=HKLM\SOFTWARE\Microsoft\Netsh\*) by Registry.dest , Registry.status, Registry.user | `ctime(lastTime)` | `ctime(firstTime)` | `drop_dm_object_name(Registry)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for modifications to registry keys that can be used to launch an application or service at system startup.,,,,,,1,Registry Keys Used For Persistence,,endpoint,medium,Registry Key Associated With Persistence Modified on $dest$,A registry key that is used for persistence on Windows was modified on $dest$ by $src_user$.,"dest, user, registry_path",,,,,1,dest,system,30,"dest,user,registry_path",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Registry Run Keys / Start Folder"", ""AppInit DLLs"", ""Authentication Package""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""DE.AE""]}","This search looks for specific registry paths that malware often uses to ensure survivability and persistence on system startup. The search returns the count, the first time the activity was seen, the last time the activity was seen, the registry path that was modified, the host where the modification took place and the user that performed the modification.","To successfully implement this search, you must be ingesting data that records registry activity from your hosts to populate the endpoint data model in the registry node. This is typically populated via endpoint detection-and-response products, such as Carbon Black or endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report reads and writes to the registry.",There are many legitimate applications that must execute on system startup and will use these registry keys to accomplish that task.,2017-08-23,2017-10-10,medium,ESCU - Registry Keys Used For Persistence - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Ransomware"", ""Suspicious MSHTA Activity"", ""Suspicious Windows Registry Activities"", ""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Total Access Attempts'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h] | `get_ksi_fields(current_count,historical_count)` | xsFindBestConcept current_count from count_1d in authentication as current_count_qual | xsfindbestconcept delta from percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Auth. Attempts,Total Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DAuthentication.Authentication%20where%20earliest%3D-24h%40h%20latest%3D%2B0s,1,0,0,all,Total Access Attempts,singlevalue,access_center,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Registry'],['ESCU - Registry Keys Used For Privilege Escalation - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Registry.registry_key_name) as registry_key_name values(Registry.registry_path) as registry_path min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Registry where (Registry.registry_path=""*Microsoft\Windows NT\CurrentVersion\Image File Execution Options*"") by Registry.dest , Registry.status, Registry.user | `ctime(lastTime)` | `ctime(firstTime)` | `drop_dm_object_name(Registry)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for modifications to registry keys that can be used to elevate privileges. The registry keys under ""Image File Execution Options"" are used to intercept calls to an executable and can be used to attach malicious binaries to benign system binaries.",,,,,,1,Registry Keys Used For Privilege Escalation,,endpoint,medium,Registry Key Associated With Privilege Escalation Modified on $dest$,A registry key used for privilege escalation was modified on $dest$ by $user$.,"dest, user, registry_path",,,,,1,dest,system,30,"dest, user, registry_path",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Privilege Escalation"", ""Persistence"", ""Accessibility Features""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks for specific registry paths that malware often uses to elevate privileges. The search returns the count, the first time the activity was seen, the last time the activity was seen, the registry path that was modified, the host where the modification took place, and the user who performed the modification.","To successfully implement this search, you must be ingesting data that records registry activity from your hosts to populate the endpoint data model in the registry node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report reads and writes to the registry.",There are many legitimate applications that must execute upon system startup and will use these registry keys to accomplish that task.,2017-12-07,2018-11-02,medium,ESCU - Registry Keys Used For Privilege Escalation - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Suspicious Windows Registry Activities"", ""Windows Privilege Escalation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change_Analysis.All_Changes'],['ESCU - Registry Keys for Creating SHIM Databases - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Change_Analysis.All_Changes where All_Changes.object_category=registry AND (All_Changes.object_path=""*CurrentVersion\AppCompatFlags\Custom*"" OR All_Changes.object_path=""*CurrentVersion\AppCompatFlags\InstalledSDB*"") by All_Changes.dest, All_Changes.command, All_Changes.user, All_Changes.object, All_Changes.object_path | `drop_dm_object_name(""All_Changes"")`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for registry activity associated with application compatibility shims, which can be leveraged by attackers for various nefarious purposes.",,,,,,1,Registry Keys for Creating SHIM Databases,,endpoint,medium,Registry Key Associated With SHIM databases on $dest$,A registry key that is used for persistence on Windows was modified on $dest$ by $user$,"dest, user",,,,,1,dest,system,30,"dest,object_path",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Application Shimming""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","In this search, we look for modifications to registry keys used for shim databases on Microsoft platforms via the object_category and object_path field in the Change_Analysis data model and give you the destination, command used to initiate the change, the user who conducted this activity, the resource affected(object), and the whole path of the object. An application compatibility shim is a small library that transparently intercepts an API (via hooking), changes the parameters passed, handles the operation itself, or redirects the operation elsewhere, such as additional code stored on a system. This capability can be also leveraged by attackers to create and store malicious files in a shim database as observed in CARBANAK backdoor.","To successfully implement this search, you must populate the Change_Analysis data model. This is typically populated via endpoint detection and response products, such as Carbon Black or other endpoint data sources such as Sysmon. The data used for this search is typically generated via logs that report reads and writes to the registry.",There are many legitimate applications that leverage shim databases for compatibility purposes for legacy applications,2017-08-27,2017-09-15,medium,ESCU - Registry Keys for Creating SHIM Databases - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Suspicious Windows Registry Activities"", ""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Change_Analysis""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Remote Desktop Network Bruteforce - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic where All_Traffic.app=rdp by All_Traffic.src All_Traffic.dest All_Traffic.dest_port | eventstats stdev(count) AS stdev avg(count) AS avg p50(count) AS p50| where count>(stdev*2) | rename All_Traffic.src AS src All_Traffic.dest AS dest | table firstTime lastTime src dest count avg p50 stdev,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for RDP application network traffic and filters any source/destination pair generating more than twice the standard deviation of the average traffic.,,,,,,1,Remote Desktop Network Bruteforce,,network,medium,Bruteforce Remote Desktop Network Traffic detected from $src$ to $dest$,Remote-desktop traffic detected from $src$ to $dest$. This activity is consistent with a brute-force attack.,"dest, src",,,,,1,src,system,75,"dest,src",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Remote Desktop Protocol"", ""Lateral Movement""], ""kill_chain_phases"": [""Reconnaissance"", ""Delivery""], ""cis20"": [""CIS 12"", ""CIS 9"", ""CIS 16""], ""nist"": [""DE.AE"", ""PR.AC"", ""PR.IP""]}","This search monitors for abnormal amounts of remote-desktop (RDP) traffic from a source to a destination that may be indicative of a brute-force attack. It does this by filtering out RDP traffic from the Network_Traffic.All_Traffic data model, using twice the standard deviation of all source-to-destination connections. If any tuple is within more than two standard deviations of all other usual RDP traffic flows, it is indicative of a brute-force attack.",You must ensure that your network traffic data is populating the Network_Traffic data model.,RDP gateways may have unusually high amounts of traffic from all other hosts' RDP applications in the network.,2018-12-14,2018-12-14,medium,ESCU - Remote Desktop Network Bruteforce - Rule,detection,Endpoint,[],"[""Bro"", ""Splunk Stream""]","[""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Remote Desktop Network Traffic - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic where All_Traffic.dest_port=3389 AND All_Traffic.dest_category!=common_rdp_destination AND All_Traffic.src_category!=common_rdp_source by All_Traffic.src All_Traffic.dest All_Traffic.dest_port | `drop_dm_object_name(""All_Traffic"")` | `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for network traffic on TCP/3389, the default port used by remote desktop. While remote desktop traffic is not uncommon on a network, it is usually associated with known hosts. This search allows for whitelisting both source and destination hosts to remove them from the output of the search so you can focus on the uncommon uses of remote desktop on your network.",,,,,,1,Remote Desktop Network Traffic,,network,medium,Uncommon Remote Desktop Network Traffic between $src$ and $dest$,Remote Desktop Traffic detected between $src$ and $dest$.  These two systems typically do not communicate with RDP,"dest, src",,,,,1,src,system,50,"dest,src",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Lateral Movement"", ""Remote Desktop Protocol"", ""Commonly Used Port""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 9"", ""CIS 16""], ""nist"": [""DE.AE"", ""PR.AC"", ""PR.IP""]}","This search finds systems that do not commonly communicate use remote desktop.  It does this by filtering out all systems that have the ""common_rdp_source"" or ""common_rdp_destination"" category applied to that system.  Categories are applied to systems using the Assets and Identity framework.","To successfully implement this search you need to identify systems that commonly originate remote desktop traffic and that commonly receive remote desktop traffic. You can use the included support search ""Identify Systems Creating Remote Desktop Traffic"" to identify systems that originate the traffic and the search ""Identify Systems Receiving Remote Desktop Traffic"" to identify systems that receive a lot of remote desktop traffic. After identifying these systems, you will need to add the ""common_rdp_source"" or ""common_rdp_destination"" category to that system depending on the usage, using the Enterprise Security Assets and Identities framework.  This can be done by adding an entry in the assets.csv file located in SA-IdentityManagement/lookups.",Remote Desktop may be used legitimately by users on the network.,2016-09-13,2017-09-15,medium,ESCU - Remote Desktop Network Traffic - Rule,detection,Endpoint,[],"[""Bro"", ""Splunk Stream""]","[""Hidden Cobra Malware"", ""Lateral Movement"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Remote Desktop Process Running On System - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process=mstsc.exe AND Processes.dest_category!=common_rdp_source by Processes.dest Processes.user Processes.process | `ctime(firstTime)`| `ctime(lastTime)` | `drop_dm_object_name(Processes)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for the remote desktop process mstsc.exe running on systems upon which it doesn't typically run. This is accomplished by filtering out all systems that are noted in the <code>common_rdp_source category</code> in the Assets and Identity framework.,,,,,,1,Remote Desktop Process Running On System,,endpoint,medium,Remote Desktop Process Running On $dest$,"The system $dest$ is running the remote desktop process, mstsc.exe. This system does not commonly run this application.","dest, user, process",,,,,1,dest,system,40,"dest,user",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Lateral Movement"", ""Remote Desktop Protocol""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 9"", ""CIS 16""], ""nist"": [""DE.AE"", ""PR.AC"", ""PR.IP""]}","This search finds systems that do not commonly use remote desktop, but which begin using it. It filters out all systems that have the ""common_rdp_source"" category applied. Categories are applied to systems using the Assets and Identity framework.","To successfully implement this search, you must be ingesting data that records process activity from your hosts to populate the endpoint data model in the processes node. The search requires you to identify systems that do not commonly use remote desktop. You can use the included support search ""Identify Systems Using Remote Desktop"" to identify these systems. After identifying them, you will need to add the ""common_rdp_source"" category to that system using the Enterprise Security Assets and Identities framework. This can be done by adding an entry in the assets.csv file located in `SA-IdentityManagement/lookups`.",Remote Desktop may be used legitimately by users on the network.,2016-09-13,2018-11-02,medium,ESCU - Remote Desktop Process Running On System - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Hidden Cobra Malware"", ""Lateral Movement""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Remote Process Instantiation via WMI - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = wmic.exe Processes.process=""*/node*"" Processes.process=""*process*"" Processes.process=""*call*"" Processes.process=""*create*""   by Processes.process_name Processes.parent_process_name Processes.dest Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` |`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for wmic.exe being launched with parameters to spawn a process on a remote system.,,,,,,1,Remote Process Instantiation via WMI,,endpoint,medium,Remote process instantiation via WMI on $dest$,This search looks for wmic.exe being launched with parameters to spawn a process on a remote system.,"dest, user, process",,,,,1,dest,system,70,"dest,user,process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Windows Management Instrumentation""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","Attackers are increasingly abusing native Windows utilities such as wmic.exe as a means to ""live off the land"", and avoid introducing new executables to the target system. In this search, we are looking for instances of wmic.exe being run with various parameters that are not typically used by administrators.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","The wmic.exe utility is a benign Windows application. It may be used legitimately by Administrators with these parameters for remote system administration, but it's relatively uncommon.",2017-01-13,2019-02-27,medium,ESCU - Remote Process Instantiation via WMI - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware"", ""Suspicious WMI Use""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Sysmon WMI Activity for Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Registry'],['ESCU - Remote Registry Key modifications - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Registry.registry_key_name) as registry_key_name values(Registry.registry_path) as registry_path min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Registry where  Registry.registry_path=""\\*""  by Registry.dest , Registry.status, Registry.user | `ctime(lastTime)` | `ctime(firstTime)` | `drop_dm_object_name(Registry)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search monitors for remote modifications to registry keys.,,,,,,1,Remote Registry Key modifications,,endpoint,medium,Remote Registry Key Modification detection on $dest$,A registry key was modified remotely using the machine $dest$ by $user$.,"dest, user",,,,,1,dest,system,30,"dest, user,registry_path",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Persistence"", ""Lateral Movement""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks for modifications made to the Windows registry from remote locations using reg.exe&#151;a tool used to create/update/delete/modify Windows registry keys. It is accomplished through specifying the machine names in the registry path, by entering double backslashes, followed by a computer name. In this search, we look for registry changes where the registry path contains the name of a remote computer. The search returns the number of times the remote server has been accessed, the first and last times the activity occurred, the name of the modified registry path, the host on which the modification took place, and the name of the user that performed the modification.","To successfully implement this search, you must populate the `Change_Analysis` data model. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report reads and writes to the registry.","This technique may be legitimately used by administrators to modify remote registries, so it's important to filter these events out.",2018-05-31,2018-05-31,medium,ESCU - Remote Registry Key modifications - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Lateral Movement"", ""Suspicious Windows Registry Activities"", ""Windows Defense Evasion Tactics"", ""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Remote WMI Command Attempt - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=wmic.exe  AND Processes.process= */node* by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)`,-70m@m,-10m@m,,1,number of events,greater than,0,50 * * * *,1,1,,,,,This search looks for wmic.exe being launched with parameters to operate on remote systems.,,,,,,1,Remote WMI Command Attempt,,endpoint,medium,Endpoint - Remote WMI command attempt,This search looks for wmic.exe being launched with parameters to operate on remote systems.,"dest,user,process_name",,,,,1,dest,system,30,"dest,user,process_name",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Windows Management Instrumentation""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","Many a times, attackers leverage native Windows utilities that are designed to help administrators better manage their systems, infrastructure, and auditing, but are instead leveraged for malicious purposes. In this case, we are looking for instances of wmic.exe being run with various parameters that are not typically used by administrators.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",Administrators may use this legitimately to gather info from remote systems.,2017-01-13,2018-12-03,medium,ESCU - Remote WMI Command Attempt - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious WMI Use""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Sysmon WMI Activity for Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - RunDLL Loading DLL By Ordinal - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = rundll32.exe Processes.process=""*AppData*"" Processes.process=""*,#2"" by Processes.process_name Processes.parent_process_name Processes.dest Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for DLLs under %AppData% being loaded by rundll32.exe that are calling the exported function at ordinal 2. Calling exported functions by ordinal is not as common as calling by exported name. There was a bug fixed in IDAPro on 2016-08-08 that would not display functions without names.  Calling functions by ordinal would overcome the lack of name and make it harder for analyst to reverse engineer.,,,,,,1,RunDLL Loading DLL By Ordinal,,endpoint,medium,Endpoint - Suspicious RunDLL usage,This search looks for DLLs under %AppData% being loaded by rundll32.exe that are calling the exported function at ordinal 2.  Calling exported functions by ordinal is not as common as calling by exported name.  There was a bug fixed in IDAPro on 2016-08-08 that would not display functions with no names.  Calling functions by ordinal would overcome the lack of name and make it harder for analyst to reverse engineer.,"dest, user, process",,,,,1,dest,system,50,"dest,user",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Rundll32""], ""kill_chain_phases"": [""Installation""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks for rundll32.exe being run, loading a DLL out of a directory or subdirectory of AppData, and specifying the function at ordinal 2 be run.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","While not common, loading a DLL under %AppData% and calling a function by ordinal is possible by a legitimate process",2016-08-09,2019-02-27,medium,ESCU - RunDLL Loading DLL By Ordinal - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Unusual Processes""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - SMB Traffic Spike - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Traffic where All_Traffic.dest_port=139 OR All_Traffic.dest_port=445 OR All_Traffic.app=smb by _time span=1h, All_Traffic.src | `drop_dm_object_name(""All_Traffic"")` | eventstats max(_time) as maxtime | stats count as num_data_samples max(eval(if(_time >= relative_time(maxtime, ""-70m@m""), count, null))) as count avg(eval(if(_time<relative_time(maxtime, ""-70m@m""), count, null))) as avg stdev(eval(if(_time<relative_time(maxtime, ""-70m@m""), count, null))) as stdev by src | eval upperBound=(avg+stdev*2), isOutlier=if(count > upperBound AND num_data_samples >=50, 1, 0) | where isOutlier=1 | table src count",-7d@d,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for spikes in the number of Server Message Block (SMB) traffic connections.,,,,,,1,SMB Traffic Spike,,network,medium,SMB Traffic Spike from $src$,There was a spike in SMB traffic from $src$.,src,,,,,1,src,system,50,src,28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Commonly Used Port""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}","Server Message Block (SMB) traffic, a protocol used for Windows file sharing-activity, is often leveraged by attackers. One example of SMB abuse was the WannaCry ransomware, which leveraged a vulnerability in the SMB protocol to propagate to other systems. Attackers have also used SMB for lateral movement with a target environment and to test credentials against target systems. While SMB is highly prevalent in Windows environments, a spike in SMB traffic may still be indicative of this type of malicious activity. This search looks for a traffic spike in SMB traffic from a particular system. If such a spike is detected, you may want to investigate the source and analyze the cause of the abnormal traffic.",This search requires you to be ingesting your network traffic logs and populating the `Network_Traffic` data model.,A file server may experience high-demand loads that could cause this analytic to trigger.,2017-08-20,2017-09-10,medium,ESCU - SMB Traffic Spike - Rule,detection,Endpoint,[],"[""Bro"", ""Splunk Stream""]","[""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Access Over Time'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| `tstats` count from datamodel=Authentication.Authentication by _time span=10m | timechart minspan=10m count,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web where'],['ESCU - SQL Injection with Long URLs - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web where Web.dest_category=web_server AND (Web.url_length > 1024 OR Web.http_user_agent_length > 200) by Web.src Web.dest Web.url Web.url_length Web.http_user_agent | `drop_dm_object_name(""Web"")` | eval num_sql_cmds=mvcount(split(url, ""alter%20table"")) + mvcount(split(url, ""between"")) + mvcount(split(url, ""create%20table"")) + mvcount(split(url, ""create%20database"")) + mvcount(split(url, ""create%20index"")) + mvcount(split(url, ""create%20view"")) + mvcount(split(url, ""delete"")) + mvcount(split(url, ""drop%20database"")) + mvcount(split(url, ""drop%20index"")) + mvcount(split(url, ""drop%20table"")) + mvcount(split(url, ""exists"")) + mvcount(split(url, ""exec"")) + mvcount(split(url, ""group%20by"")) + mvcount(split(url, ""having"")) + mvcount(split(url, ""insert%20into"")) + mvcount(split(url, ""inner%20join"")) + mvcount(split(url, ""left%20join"")) + mvcount(split(url, ""right%20join"")) + mvcount(split(url, ""full%20join"")) + mvcount(split(url, ""select"")) + mvcount(split(url, ""distinct"")) + mvcount(split(url, ""select%20top"")) + mvcount(split(url, ""union"")) + mvcount(split(url, ""xp_cmdshell"")) - 24 | where num_sql_cmds > 3",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for long URLs that have several SQL commands visible within them.,,,,,,1,SQL Injection with Long URLs,,network,medium,SQL Injection with Long URLs,Using the length of url or user agent to identify SQL injection,"dest, src, url",,,,,1,dest,system,30,"dest,src,url",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Exploitation of Vulnerability"", ""Execution"", ""Commonly Used Port""], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 4"", ""CIS 13"", ""CIS 18""], ""nist"": [""PR.DS"", ""ID.RA"", ""PR.PT"", ""PR.IP"", ""DE.CM""]}","This search looks only at your web servers and returns the source, the web server, the URL and its length, and the user agent associated with HTTP GET requests for extremely long URLs or user agent lengths with more than three common SQL commands found within the URL.","To successfully implement this search, you need to be monitoring network communications to your web servers or ingesting your HTTP logs and populating the Web data model. You must also identify your web servers in the Enterprise Security assets table.",It's possible that legitimate traffic will have long URLs or long user agent strings and that common SQL commands may be found within the URL. Please investigate as appropriate.,2016-09-13,2017-09-19,medium,ESCU - SQL Injection with Long URLs - Rule,detection,Database Server,[],"[""Splunk Stream"", ""Bro""]","[""SQL Injection""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For Endpointn""}",0,3600,86400,0,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Samsam Test File Write - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.user) as user values(Filesystem.dest) as dest values(Filesystem.file_name) as file_name from datamodel=Endpoint.Filesystem where Filesystem.file_path=*\windows\system32\test.txt by Filesystem.file_path | `drop_dm_object_name(Filesystem)` | `ctime(lastTime)` | `ctime(firstTime)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"The search looks for a file named ""test.txt"" written to the windows system directory tree, which is consistent with Samsam propagation.",,,,,,1,Samsam Test File Write,,endpoint,high,File consistent with SamSam probes detected on $dest$,"A file named ""test.txt,"" which is indicative of a SamSam ransomware attack, was written to system32 on $dest$.","dest, file_name",,,,,1,dest,system,80,"dest,file_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks at file modifications across your hosts and monitors for a file named ""test.txt"" written to ""windowssystem32"". This file is copied to potential targets during SamSam ransomware attacks to test the attacker's ability to access remote systems. If the file is successfully copied to the system, the system is added to a list of targets on which to deploy ransomware.","You must be ingesting data that records the file-system activity from your hosts to populate the Endpoint file-system data-model node. If you are using Sysmon, you will need a Splunk Universal Forwarder on each endpoint from which you want to collect data.",No false positives have been identified.,2018-12-14,2018-12-14,high,ESCU - Samsam Test File Write - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Sc.exe Manipulating Windows Services - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = sc.exe Processes.process=""* create *"" Processes.process=""* config *"" by Processes.process_name Processes.parent_process_name Processes.dest Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for arguments to sc.exe indicating the creation or modification of a Windows service.,,,,,,1,Sc.exe Manipulating Windows Services,,endpoint,medium,Sc.exe Manipulating Windows Services on $dest$,This search looks for arguments to sc.exe indicating the creation or modification of a Windows service.,"dest, user, process",,,,,1,dest,system,60,"dest, process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Privilege Escalation"", ""New Service"", ""Modify Existing Service"", ""Defense Evasion"", ""Disabling Security Tools""], ""kill_chain_phases"": [""Installation""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 8""], ""nist"": [""PR.IP"", ""PR.PT"", ""PR.AC"", ""PR.AT"", ""DE.CM""]}","This search looks for the execution of sc.exe with parameters that indicate the utility is being used to create a new Windows service, or modify an existing one. Attackers often create a new service to host their malicious code, or they may take a non-critical service or one that is disabled, and modify it to point to their malware and enable the service if necessary. It is unusual for a service to be created or modified using the sc.exe utility.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Using sc.exe to manipulate Windows services is uncommon. However, there may be legitimate instances of this behavior. It is important to validate and investigate as appropriate.",2017-11-03,2019-02-27,medium,ESCU - Sc.exe Manipulating Windows Services - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A"", ""Disabling Security Tools"", ""Orangeworm Attack Group"", ""Windows Persistence Techniques"", ""Windows Service Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Scheduled Task Name Used by Dragonfly Threat Actors - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=schtasks.exe  by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` | search (process=*delete* OR process=*create*) process=*reset*,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for flags passed to schtasks.exe on the command-line that indicate a task name associated with the Dragonfly threat actor was created or deleted.,,,,,,1,Scheduled Task Name Used by Dragonfly Threat Actors,,endpoint,medium,Scheduled task used by Dragonfly threat actor detected on $dest$,This search looks for flags passed to schtasks.exe on the command line that indicate that a task--whose name is associated with the Dragonfly threat actor--has been created or deleted,"dest, user, process_name",,,,,1,dest,system,80,"dest, process_name, process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Scheduled Task""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3""], ""nist"": [""PR.IP""]}","The search looks for execution of schtasks.exe with parameters that indicate that a specific task ""reset,"" whose name is associated with the Dragonfly threat actor--has been created or deleted. Schtasks.exe is a native Windows program that is used to schedule tasks on local or remote systems. Attackers often leverage this capability to schedule the execution of commands or establish persistence.","You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",No known false positives,2018-03-19,2018-12-03,medium,ESCU - Scheduled Task Name Used by Dragonfly Threat Actors - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Scheduled tasks used in BadRabbit ransomware - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Processes.process) as process  from datamodel=Endpoint.Processes where Processes.process_name=schtasks.exe (Processes.process= ""*create*""  OR Processes.process= ""*delete*"") by Processes.parent_process Processes.process_name Processes.user | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`|`ctime(lastTime)` | search (process=*rhaegal* OR process=*drogon* OR *viserion_*)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for flags passed to schtasks.exe on the command-line that indicate that task names related to the execution of Bad Rabbit ransomware were created or deleted.,,,,,,1,Scheduled tasks used in BadRabbit ransomware,,endpoint,medium,Scheduled tasks used in BadRabbit ransomware detected on $dest$,This search looks for flags passed to schtasks.exe on the command-line that indicate that task names specific to Bad Rabbit ransomware has been created or deleted,"dest, user, process_name",,,,,1,dest,system,80,"dest, process_name",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Lateral Movement"", ""Execution"", ""Scheduled Task""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3""], ""nist"": [""PR.IP""]}","The search looks for execution of schtasks.exe with parameters that indicate that specific task names related to the Bad Rabbit ransomware were created or deleted. The specific task name used are rhaegal, drogon and viserion_. Schtasks.exe is a native windows program that is used to schedule tasks on local or remote systems. Attackers often leverage this capability to schedule the execution of commands or establish persistence.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",No known false positives,2017-11-03,2019-02-28,medium,ESCU - Scheduled tasks used in BadRabbit ransomware - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Schtasks scheduling job on remote system - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = schtasks.exe Processes.process=""*/create*"" Processes.process=""* /s *"" by Processes.process_name Processes.parent_process_name Processes.dest Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for flags passed to schtasks.exe on the command-line that indicate a job is being scheduled on a remote system.,,,,,,1,Schtasks scheduling job on remote system,,endpoint,medium,Schtasks scheduling job on remote system,This search looks for flags passed to schtasks.exe on the command-line that indicate a job is being scheduled on a remote system.,"dest, user, process",,,,,1,dest,system,50,"dest,process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Lateral Movement"", ""Execution"", ""Scheduled Task"", ""Remote Services""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3""], ""nist"": [""PR.IP""]}",The search looks for execution of schtasks.exe with parameters that indicate a task is being scheduled on a remote host. Schtasks.exe is a native windows program that is used to schedule tasks on local or remote systems. Attackers often leverage this capability to schedule the execution of commands or malicious executables on remote systems.,"You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Administrators may create jobs on remote systems, but this activity is usually limited to a small set of hosts or users. It is important to validate and investigate as appropriate.",2016-09-13,2019-02-27,medium,ESCU - Schtasks scheduling job on remote system - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Lateral Movement""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Schtasks used for forcing a reboot - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = schtasks.exe Processes.process=""*shutdown*"" Processes.process=""*/r*"" Processes.process=""*/f*"" by Processes.process_name Processes.parent_process_name Processes.dest Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)`",-5h@h,-1h@h,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for flags passed to schtasks.exe on the command-line that indicate that a forced reboot of system is scheduled.,,,,,,1,Schtasks used for forcing a reboot,,endpoint,medium,Schtasks used for scheduling a force reboot,This search looks for flags passed to schtasks.exe on the command-line that indicate a job is scheduled to force a reboot,"dest, user, process",,,,,1,dest,system,80,"dest, process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Execution"", ""Scheduled Task""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3""], ""nist"": [""PR.IP""]}",The search looks for execution of schtasks.exe with parameters that indicate a task is being scheduled that would cause a forced reboot on the host. Schtasks.exe is a native windows program that is used to schedule tasks on local or remote systems. Attackers often leverage this capability to schedule the execution of commands or establish persistence. This tactic is leveraged by the Bad Rabbit Ransomware.,"To successfully implement this search you need to be ingesting logs with both the process name and command-line from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.","Administrators may create jobs on systems forcing reboots to perform updates, maintenance, etc.",2017-11-03,2019-02-27,medium,ESCU - Schtasks used for forcing a reboot - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware"", ""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Script Execution via WMI - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes where Processes.process_name = ""scrcons.exe"" by Processes.user Processes.dest Processes.process_name  | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for scripts launched via WMI.,,,,,,1,Script Execution via WMI,,endpoint,medium,Script execution via WMI on $dest$,"This search looks for scrcons.exe, which indicates that a script was launched via WMI.","dest, user, process",,,,,1,dest,system,70,"dest,process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Windows Management Instrumentation""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","Attackers are increasingly abusing Windows Management Infrastructure for stealth, persistence, lateral movement, or just to leverage its functionality. This search looks for scripts launched via WMI, either remotely or locally, by looking for the execution of scrcons.exe, which is the scripting host used by WMI, similar to wscript or cscript.","You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Although unlikely, administrators may use wmi to launch scripts for legitimate purposes.",2018-10-23,2019-03-01,medium,ESCU - Script Execution via WMI - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious WMI Use""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Sysmon WMI Activity for Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Shim Database File Creation - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Filesystem.action) values(Filesystem.file_hash) as file_hash values(Filesystem.file_path) as file_path  min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Filesystem where Filesystem.file_path=*WindowsAppPatchCustom* by Filesystem.file_name Filesystem.dest | `ctime(lastTime)` | `ctime(firstTime)` |`drop_dm_object_name(Filesystem)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for shim database files being written to default directories. The sdbinst.exe application is used to install shim database files (.sdb). According to Microsoft, a shim is a small library that transparently intercepts an API, changes the parameters passed, handles the operation itself, or redirects the operation elsewhere.",,,,,,1,Shim Database File Creation,,endpoint,high,Shim database file created on $dest$,"A file, $file_name$, was created in the default shim database directory on $dest.","dest, file_name",,,,,1,dest,system,20,dest,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Application Shimming""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}","This search looks for files being created in `WindowsAppPatchCustom and WindowsAppPatchCustom64`, the location where shim databases are installed. It will return all the files created, as well as the time of creation for the first and last file for each endpoint.","You must be ingesting data that records the filesystem activity from your hosts to populate the Endpoint file-system data model node. If you are using Sysmon, you will need a Splunk Universal Forwarder on each endpoint from which you want to collect data.","Because legitimate shim files are created and used all the time, this event, in itself, is not suspicious. However, if there are other correlating events, it may warrant further investigation.",2017-10-03,2018-11-02,high,ESCU - Shim Database File Creation - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Shim Database Installation With Suspicious Parameters - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = sdbinst.exe Processes.process=""*-p*"" Processes.process=""*-q*"" by Processes.process_name Processes.parent_process_name Processes.dest Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search detects the process execution and arguments required to silently create a shim database.  The sdbinst.exe application is used to install shim database files (.sdb). A shim is a small library which transparently intercepts an API, changes the parameters passed, handles the operation itself, or redirects the operation elsewhere.",,,,,,1,Shim Database Installation With Suspicious Parameters,,endpoint,medium,Shim Database Installation on $dest$,The system $dest$ had a shim database installed.,"dest, user, process",,,,,1,dest,system,20,"dest,user",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Application Shimming""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}","This search looks for the execution of sdbinst.exe with command-line arguments of -q and -p.  The -q option performs a silent installation with no visible window, status, or warning information.  The -p option allows the shim database to contain patches.  It will return the count, the first time, and the last time these command-line arguments were seen on each endpoint and by each user.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",None identified,2017-10-03,2019-03-01,medium,ESCU - Shim Database Installation With Suspicious Parameters - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Access Over Time By Action'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Authentication.Authentication by _time,Authentication.action span=10m | timechart minspan=10m useother=`useother` count by Authentication.action | `drop_dm_object_name(""Authentication"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change_Analysis where'],['ESCU - Short Lived Windows Accounts - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Change_Analysis where All_Changes.result_id=4720 OR All_Changes.result_id=4726 by All_Changes.result_id All_Changes.user All_Changes.dest | `ctime(lastTime)` | `ctime(firstTime)` | `drop_dm_object_name(""All_Changes"")` | transaction user maxspan=240m  | search result_id=4720 result_id=4726",-245m@m,-10m@m,,1,number of events,greater than,0,"0 0,4,8,12,16,20 * * *",1,1,,,,,This search detects accounts that were created and deleted in a short time period.,,,,,,1,Short Lived Windows Accounts,,access,medium,Short lived account $user$ on $dest,The account $user$ was created and deleted in a short amount of time.,user,,,,,1,user,system,40,user,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Valid Accounts""], ""cis20"": [""CIS 16""], ""nist"": [""PR.IP""]}",This search looks for Windows Event Logs 4720 (account creation) and 4726 (account deletion) and determines if they happen for the same user within 4 hours of each other.  It will report the user and machine that reported the events and the time it first and last saw this activity.,This search requires you to have enabled your Group Management Audit Logs in your Local Windows Security Policy and be ingesting those logs.  More information on how to enable them can be found here: http://whatevernetworks.com/auditing-group-membership-changes-in-active-directory/,It is possible that an administrator created and deleted an account in a short time period.  Verifying activity with an administrator is advised.,2018-01-05,2018-01-05,medium,ESCU - Short Lived Windows Accounts - Rule,detection,Windows,[],"[""Microsoft Windows""]","[""Account Monitoring and Controls""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get Notable InfonESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Logon Rights Modifications For UsernESCU - Get Logon Rights Modifications For Endpointn""}",0,3600,86400,0,,,,,"[""Change_Analysis""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Single Letter Process On Endpoint - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes by Processes.dest, Processes.user, Processes.process, Processes.process_name | `drop_dm_object_name(Processes)` | `ctime(lastTime)` | `ctime(firstTime)` | eval process_name_length = len(process_name), endExe = if(substr(process_name, -4) == "".exe"", 1, 0) | search process_name_length=5 AND endExe=1 | table count, firstTime, lastTime, dest, user, process, process_name",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for process names that consist only of a single letter.,,,,,,1,Single Letter Process On Endpoint,,endpoint,high,Single-letter executable $process_name$ on $dest$.,"A process with a single letter, $process_name$ was detected on $dest$","dest, process, user",,,,,1,dest,system,50,"dest, user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 2""], ""nist"": [""ID.AM"", ""PR.DS""]}",This search returns all the processes for each endpoint and user and filters out any process that isn't 5 characters long and ends with .exe.,"You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",Single-letter executables are not always malicious. Investigate this activity with your normal incident-response process.,2018-03-22,2019-04-01,high,ESCU - Single Letter Process On Endpoint - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities where'],['ESCU - Spectre and Meltdown Vulnerable Systems - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime max(_time) as lastTime from datamodel=Vulnerabilities where Vulnerabilities.cve =""CVE-2017-5753"" OR Vulnerabilities.cve =""CVE-2017-5715"" OR Vulnerabilities.cve =""CVE-2017-5754"" by Vulnerabilities.dest",-25h@h,-1h@h,,1,number of events,greater than,0,0 6 * * *,1,1,,,,,The search is used to detect systems that are still vulnerable to the Spectre and Meltdown vulnerabilities.,,,,,,1,Spectre and Meltdown Vulnerable Systems,,endpoint,high,$dest is vulnerable to the Spectre or Meltdown CPU vulnerabilities,$dest is vulnerable to the Spectre or Meltdown CPU vulnerabilities.,dest,,,,,1,dest,system,100,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 4""], ""nist"": [""ID.RA"", ""RS.MI"", ""PR.IP"", ""DE.CM""]}",This search looks for the three CVEs associated with the Spectre and Meltdown vulnerabilities.,The search requires that you are ingesting your vulnerability-scanner data and that it reports the CVE of the vulnerability identified.,It is possible that your vulnerability scanner is not detecting that the patches have been applied.,2018-01-07,2017-01-07,high,ESCU - Spectre and Meltdown Vulnerable Systems - Rule,detection,Endpoint,[],"[""Nessus"", ""Qualys""]","[""Spectre And Meltdown Vulnerabilities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For Endpointn""}",0,3600,86400,0,,,,,"[""Vulnerabilities""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Spike in File Writes - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count FROM datamodel=Endpoint.Filesystem where Filesystem.action=created by _time span=1h, Filesystem.dest | `drop_dm_object_name(Filesystem)` | eventstats max(_time) as maxtime | stats count as num_data_samples max(eval(if(_time >= relative_time(maxtime, ""-1d@d""), count, null))) as ""count"" avg(eval(if(_time<relative_time(maxtime, ""-1d@d""), count,null))) as avg stdev(eval(if(_time<relative_time(maxtime, ""-1d@d""), count, null))) as stdev by ""dest"" | eval upperBound=(avg+stdev*4), isOutlier=if((count > upperBound) AND num_data_samples >=20, 1, 0) | search isOutlier=1",-7d@d,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for a sharp increase in the number of files written to a particular host,,,,,,1,Spike in File Writes,,endpoint,low,Spike in file writes on $dest$,A sharp increase in file writes was detected on $dest,dest,,,,,1,dest,system,30,dest,7200s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}",This search calculates counts the number of file modification events per hour per host in your environment. It then takes the average and standard deviations of those numbers and displays any hosts with more than 20 events that have over four times the standard deviation more than the average number of file modifications.,"In order to implement this search, you must populate the Endpoint file-system data model node. This is typically populated via endpoint detection and response products, such as Carbon Black or endpoint data sources such as Sysmon. The data used for this search is typically generated via logs that report reads and writes to the file system.","It is important to understand that if you happen to install any new applications on your hosts or are copying a large number of files, you can expect to see a large increase of file modifications.",2017-08-20,2018-12-03,low,ESCU - Spike in File Writes - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Splunk Enterprise Information Disclosure - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"index=_internal sourcetype=splunkd_ui_access server-info | search clientip!=127.0.0.1 uri_path=""*raw/services/server/info/server-info"" | rename clientip as src_ip, splunk_server as dest | stats earliest(_time) as firstTime, latest(_time) as lastTime, values(uri) as uri, values(useragent) as http_user_agent, values(user) as user by src_ip, dest | convert ctime(firstTime) ctime(lastTime)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search allows you to look for evidence of exploitation for CVE-2018-11409, a Splunk Enterprise Information Disclosure Bug.",,,,,,1,Splunk Enterprise Information Disclosure,,network,medium,Possible Splunk Information Disclosure Exploitation Attempt from $src_ip$,The Splunk Server $dest$ had a possible Splunk information-disclosure possibility from $src_ip$,"dest, src_ip",,,,,1,dest,system,80,"dest, src_ip",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Exploitation of Vulnerability""], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 3"", ""CIS 4"", ""CIS 18""], ""nist"": [""ID.RA"", ""RS.MI"", ""PR.PT"", ""PR.AC"", ""PR.IP"", ""DE.CM""]}",This search searches Splunk's internal logs for evidence of CVE-2018-11409 exploitation attempts.,The REST endpoint that exposes system information is also necessary for the proper operation of Splunk clustering and instrumentation. Whitelisting your Splunk systems will reduce false positives.,Retrieving server information may be a legitimate API request. Verify that the attempt is a valid request for information.,2018-06-14,2018-06-14,medium,ESCU - Splunk Enterprise Information Disclosure - Rule,detection,Splunk Server,[],"[""Splunk Enterprise""]","[""Splunk Enterprise Vulnerability CVE-2018-11409""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get Risk Modifiers For EndpointnESCU - Investigate Web Activity From src_ipnESCU - Investigate Network Traffic From src_ipn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Processes', 'Endpoint.Registry']",['ESCU - Suspicious Changes to File Associations - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Processes.process_name) as process_name values(Processes.parent_process_name) as parent_process_name FROM datamodel=Endpoint.Processes where Processes.process_name!=Explorer.exe AND Processes.process_name!=OpenWith.exe by Processes.process_id Processes.dest | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)` | `ctime(lastTime)` | join [| tstats `summariesonly` values(Registry.registry_path) as registry_path count  FROM datamodel=Endpoint.Registry where Registry.registry_path=*\Explorer\FileExts* by Registry.process_id Registry.dest | `drop_dm_object_name(""Registry"")` | table process_id dest registry_path]",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for changes to registry values that control Windows file associations, executed by a process that is not typical for legitimate, routine changes to this area.",,,,,,1,Suspicious Changes to File Associations,,endpoint,medium,Suspicious File Association Change on $dest$,The system $dest$ had an unusual change to a file association,"dest, user, process_name, process",,,,,1,dest,system,40,"dest,user",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Change Default File Association""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 8""], ""nist"": [""DE.CM"", ""PR.PT"", ""PR.IP""]}","This search looks for changes made to the registry that control Windows file associations. It is typical for users to change the file association to open certain types of files with specific applications. However, when these changes are legitimately performed, they are typically done via the processes explorer.exe or openwith.exe. The search first executes the subsearch that looks at the Registry node, which specifies setting a value in the registry and creates a table of process_id and dest. It then uses those arguments to find out what process and parent process were responsible for making those registry changes.",To successfully implement this search you need to be ingesting information on registry changes that include the name of the process responsible for the changes from your endpoints into the `Endpoint` datamodel in the `Processes` and `Registry` nodes.,"There may be other processes in your environment that users may legitimately use to modify file associations. If this is the case and you are finding false positives, you can modify the search to add those processes as exceptions.",2018-01-26,2018-01-26,medium,ESCU - Suspicious Changes to File Associations - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious Windows Registry Activities"", ""Windows File Extension and Association Abuse""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email where'],['ESCU - Suspicious Email Attachment Extensions - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Email where All_Email.file_name=""*"" by All_Email.src_user, All_Email.file_name All_Email.message_id | `ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(""All_Email"")` | `suspicious_email_attachments`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for emails that have attachments with suspicious file extensions.,,,,,,1,Suspicious Email Attachment Extensions,,network,high,Suspicious Email Attachment from $src_user$,The sender $src_user$ has sent an email with a suspicious file named $file_name$,"src_user, file_name",,,,,1,src_user,user,60,"src_user,message_id",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Defense Evasion""], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 3"", ""CIS 7"", ""CIS 12""], ""nist"": [""DE.AE"", ""PR.IP""]}",This search looks at any email messages with attachments and checks the file names of those attachments against an included lookup file to see if it has a suspicious file extension.,"You need to ingest data from emails. Specifically, the sender's address and the file names of any attachments must be mapped to the Email data model.",None identified,2017-04-20,2017-09-19,high,ESCU - Suspicious Email Attachment Extensions - Rule,detection,Endpoint,[],"[""Microsoft Exchange""]","[""Emotet Malware (TA18-201A)"", ""Suspicious Emails""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Email InfonESCU - Get Emails From Specific SendernESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Email""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Suspicious File Write - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Filesystem.action) as action values(Filesystem.file_path) as file_path min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Filesystem by Filesystem.file_name Filesystem.dest | `ctime(lastTime)` | `ctime(firstTime)` | `drop_dm_object_name(Filesystem)` | `suspicious_writes`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for files created with names that have been linked to malicious activity.,,,,,,1,Suspicious File Write,,endpoint,high,Suspicious File Write Detected on $dest$,A write to a filename associated with malicious activity detected on $dest$.,"dest, file_name",,,,,1,dest,system,80,"dest,file_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks at files being created or modified in the Endpoint file-system data model. The names of those files are checked against an included lookup file, which contains the names of files associated with malware or attack activity. The search returns any files with matching names, along with a note (also specified in the lookup file) that gives or points to more information about the files.","You must be ingesting data that records the filesystem activity from your hosts to populate the Endpoint file-system data model node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or via other endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report file system reads and writes. In addition, this search leverages an included lookup file that contains the names of the files to watch for, as well as a note to communicate why that file name is being monitored. This lookup file can be edited to add or remove file the file names you want to monitor.",It's possible for a legitimate file to be created with the same name as one noted in the lookup file. Filenames listed in the lookup file should be unique enough that collisions are rare. Looking at the location of the file and the process responsible for the activity can help determine whether or not the activity is legitimate.,2018-06-14,2019-04-25,high,ESCU - Suspicious File Write - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Hidden Cobra Malware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Get Outbound Emails to Hidden Cobra Threat Actorsn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Suspicious Java Classes - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""stream:http"" http_method=POST http_content_length>1 | regex form_data=""(?i)java.lang.(?:runtime|processbuilder)"" | rename src_ip as src | stats count earliest(_time) as firstTime, latest(_time) as lastTime, values(url) as uri, values(status) as status, values(http_user_agent) as http_user_agent by src, dest | convert ctime(firstTime) ctime(lastTime)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for suspicious Java classes that are often used to exploit remote command execution in common Java frameworks, such as Apache Struts.",,,,,,1,Suspicious Java Classes,,threat,medium,Suspicious Java Classes: Possible RCE against Struts or similar Java framework from $src$,"The host $src$ with user agent $http_user_agent$ is sending web traffic to $url$, which contains suspicious Java classes. These classes may be indicative of remote code execution in Java frameworks, such as Apache Struts.","src, url, http_user_agent",,,,,1,src,system,50,"src, url, http_user_agent",3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Exploitation""], ""cis20"": [""CIS 7"", ""CIS 12""], ""nist"": [""DE.AE""]}","The search leverages HTTP form data from typically POST events that can be captured with Splunk streams or similar wire data capture tools. The search looks for java classes like `processbuilder` and `runtime` are used to create a new process and execute commands inside java, and are synonymous with spawning a shell. There are very exceptional reasons to ever these classes in Java via an HTTP API and hence when seen are highly suspicious. Also, this is a common vectors leverage to exploit Apache Struts.","In order to properly run this search, Splunk needs to ingest data from your web-traffic appliances that serve or sit in the path of your Struts application servers. This can be accomplished by indexing data from a web proxy, or by using network traffic-analysis tools, such as Splunk Stream or Bro.",There are no known false positives.,2018-12-06,2018-12-06,medium,ESCU - Suspicious Java Classes - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro"", ""Bluecoat"", ""Apache""]","[""Apache Struts Vulnerability""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Investigate Suspicious Strings in HTTP HeadernESCU - Investigate Web POSTs From srcn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Processes']",['ESCU - Suspicious LNK file launching a process - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Filesystem where Filesystem.file_name=""*.lnk"" AND (Filesystem.file_path=""C:\Users*"" OR Filesystem.file_path=""*Local\Temp*"")  by _time span=1h Filesystem.process_id Filesystem.file_name Filesystem.file_path Filesystem.file_hash Filesystem.user | `drop_dm_object_name(Filesystem)` | rename process_id as lnk_pid | join lnk_pid, _time [| tstats `summariesonly` count FROM datamodel=Endpoint.Processes where Processes.process_name=*  by _time span=1h Processes.parent_process_id Processes.process_id Processes.process_name Processes.dest Processes.process_path Processes.process | `drop_dm_object_name(Processes)` | rename parent_process_id as lnk_pid | fields _time lnk_pid process_id dest process_name process_path process] | `ctime(firstTime)` | `ctime(lastTime)` | table firstTime, lastTime, lnk_pid, process_id, user, dest, file_name, file_path, process_name, process, process_path, file_hash",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for a ``*.lnk` file under `C:User*` or `*LocalTemp*` executing a process. This is common behavior used by various spear phishing tools.,,,,,,1,Suspicious LNK file launching a process,,network,high,LNK file $file_name$ is executing process $process_name$ on $dest$,suspicious LNK file from $file_name$ is executing a process $process_name$ on $dest$,"dest, process_name, file_name",,,,,1,dest,system,40,"dest,file_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Spearphishing Attachment""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 7"", ""CIS 8""], ""nist"": [""ID.AM"", ""PR.DS""]}","In this search, we are essentially trying to detect if a LNK file created under the C:User* or *LocalTemp* directory structures is launching a process with in 1 hour of its creation. LNK files or also known as Windows shortcut files are commonly associated with phishing and are a [preferred method used for exploitation](https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html).","You must be ingesting data that records filesystem and process activity from your hosts to populate the Endpoint data model. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or endpoint data sources, such as Sysmon.",This detection should yield little or no false positive results. It is uncommon for LNK files to execute process from temporary or user directories.,2019-04-29,2019-04-29,high,ESCU - Suspicious LNK file launching a process - Rule,detection,Endpoint,"[""dest""]","[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Phishing Payloads""]",escu_investigate,,0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Access Over Time By App'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Authentication.Authentication by _time,Authentication.app span=10m | timechart minspan=10m useother=`useother` count by Authentication.app",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Suspicious Reg.exe Process - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes where Processes.parent_process_name != explorer.exe Processes.process_name =cmd.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest Processes.process_id Processes.parent_process_id | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)` | `ctime(lastTime)` | search [| tstats `summariesonly` count FROM datamodel=Endpoint.Processes where Processes.parent_process_name=cmd.exe Processes.process_name= reg.exe by Processes.parent_process_id Processes.dest Processes.process_name | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)` | `ctime(lastTime)` | rename parent_process_id as process_id |dedup process_id| table process_id dest]",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for reg.exe being launched from a command prompt not started by the user. When a user launches cmd.exe, the parent process is usually explorer.exe. This search filters out those instances.",,,,,,1,Suspicious Reg.exe Process,,endpoint,medium,Suspicious reg.exe process detected on $dest$,The system $dest$ had reg.exe process run not initiated by a user.,"dest, user, process_name",,,,,1,dest,system,80,"dest, user",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Modify Registry"", ""Disabling Security Tools""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}",This search looks for the execution of reg.exe with a parent process of cmd.exe. It then executes a subsearch looking for those cmd.exe processes with a parent that is not explorer.exe. It then joins those two searches to make sure that the reg.exe process is a grandchild of the non explorer.exe process. The search will return the number of such instances and the first and last time this activity has been seen on each endpoint and user.,"You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","It's possible for system administrators to write scripts that exhibit this behavior. If this is the case, the search will need to be modified to filter them out.",2017-10-11,2019-03-01,medium,ESCU - Suspicious Reg.exe Process - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A"", ""Disabling Security Tools"", ""Windows Defense Evasion Tactics""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Suspicious wevtutil Usage - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = wevtutil.exe Processes.process=""*cl*"" (Processes.process=""*System*"" OR Processes.process=""*Security*"" OR Processes.process=""*Setup*"" OR Processes.process=""*Application*"") by Processes.process_name Processes.parent_process_name Processes.dest Processes.user| `drop_dm_object_name(Processes)` | `ctime(firstTime)` |`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"The wevtutil.exe application is the windows event log utility. This searches for wevtutil.exe with parameters for clearing the application, security, setup, or system event logs.",,,,,,1,Suspicious wevtutil Usage,,endpoint,medium,Suspicious wevtutil Usage,wevtutil is the windows event log tool. This searches for wevtutil clearing the security or system logs.,"dest, process, user",,,,,1,dest,system,50,"dest,process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Indicator Removal on Host""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 6""], ""nist"": [""DE.DP"", ""PR.IP"", ""PR.PT"", ""PR.AC"", ""PR.AT"", ""DE.AE""]}","This search looks for execution of wevtutil.exe with command-line arguments that indicate that it has been used to delete the setup, application, security, or system event logs. The search returns the number of times the behavior was observed, the first and last time it was seen, the host exhibiting the behavior and the user context of the process execution.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",The wevtutil.exe application is a legitimate Windows event log utility. Administrators may use it to manage Windows event logs.,2017-02-17,2019-02-28,medium,ESCU - Suspicious wevtutil Usage - Rule,detection,,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware"", ""Windows Log Manipulation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Suspicious writes to System Volume Information - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"(sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR tag=process) EventCode=11 process_id!=4 file_path=*System Volume Information* | stats count min(_time) as firstTime max(_time) as lastTime by dest, Image, file_path | `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search detects writes to the 'System Volume Information' folder by something other than the System process.,,,,,,1,Suspicious writes to System Volume Information,,endpoint,medium,Suspicious process $process$ wrote to 'System Volume Information' on $dest$,The process $process$ on $dest$ wrote $file_name$ to 'System Volume Information'.,"dest, file_name, process",,,,,1,dest,system,70,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Collection"", ""Data Staged""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}","This search uses data on file writes captured via Sysmon to watch for writes to the ""System Volume Information"" folder by processes other than the system process. The search looks for event code 11 in the Sysmon events, which indicates a file-creation event. It then looks for a file created with a path that includes ""System Volume Information"" and a process ID (PID) other than 4. PID 4 is assigned to the System process on Windows systems. Excluding these writes allows us to filter out legitimate activity. It will report the system where the activity occurred, the path to which the file was written, the process responsible for the write, and the times it first and last saw this activity.","You need to be ingesting logs with both the process name and command-line from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",It is possible that other utilities or system processes may legitimately write to this folder. Investigate and modify the search to include exceptions as appropriate.,2018-01-08,2018-01-08,medium,ESCU - Suspicious writes to System Volume Information - Rule,detection,Windows,[],"[""Sysmon""]","[""Collection and Staging""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Processes']",['ESCU - Suspicious writes to windows Recycle Bin - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.file_path) as file_path values(Filesystem.file_name) as file_name FROM datamodel=Endpoint.Filesystem where Filesystem.filepath = ""*$Recycle.Bin*"" by Filesystem.process_id Filesystem.dest | `drop_dm_object_name(""Filesystem"")`| search [| tstats `summariesonly` values(Processes.user) as user values(Processes.process_name) as process_name values(Processes.parent_process_name) as parent_process_name FROM datamodel=Endpoint.Processes where Processes.process_name != ""explorer.exe"" by Processes.process_id Processes.dest| `drop_dm_object_name(""Processes"")` | table process_id dest]",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search detects writes to the recycle bin by a process other than explorer.exe.,,,,,,1,Suspicious writes to windows Recycle Bin,,endpoint,medium,Suspicious process $process_name$ wrote to the Recycle Bin on $dest$,The process $process_name$ on $dest$ wrote $file_name$ to the Recycle Bin.,"dest, file_name, process_name",,,,,1,dest,system,70,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Collection"", ""Data Staged""], ""cis20"": [""CIS 8""], ""nist"": [""DE.CM""]}","This search uses data on file writes captured via Sysmon to watch for writes to the Recycle Bin by processes other than explorer.exe. The search looks for event code 11 in the Sysmon events, which indicates a file-creation event. Next, it looks for files created with a path that includes the string ""$Recycle.Bin"" by processes other than explorer.exe, which is the process responsible for copying files to the Recycle Bin on delete. It will report the system where the activity occurred, the path to which the file was written, the process responsible for the write, and the times it first and last saw this activity.",To successfully implement this search you need to be ingesting information on filesystem and process logs responsible for the changes from your endpoints into the `Endpoint` datamodel in the `Processes` and `Filesystem` nodes.,"Because the Recycle Bin is a hidden folder in modern versions of Windows, it would be unusual for a process other than explorer.exe to write to it. Incidents should be investigated as appropriate.",2018-01-08,2019-03-01,medium,ESCU - Suspicious writes to windows Recycle Bin - Rule,detection,Windows,[],"[""Sysmon""]","[""Collection and Staging""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - System Processes Run From Unexpected Locations - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes where Processes.process_path !=""C:\Windows\System32*"" Processes.process_path !=""C:\Windows\SysWOW64*"" by Processes.user Processes.dest Processes.process_name Processes.process_path Processes.process_id | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`| `ctime(lastTime)`| `isWindowsSystemFile`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for system processes that normally run out of C:WindowsSystem32 or C:WindowsSysWOW64 that are not run from that location.  This can indicate a malicious process that is trying to hide as a legitimate process.,,,,,,1,System Processes Run From Unexpected Locations,,endpoint,medium,System Processes Run From Unexpected Location on $dest$,The system $dest$ has a process that normally runs out of WindowsSystem32 that is not being run from that location.,"user, process_name, dest",,,,,1,dest,system,50,"dest,process_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Masquerading""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search returns all the processes that are not executing out of the C:WindowsSystem32 or C:WindowsSysWOW64 directories. It then uses a regular expression to extract the file name of the running process. Next, it takes the filename and looks it up in a table of files that should normally run out of the C:WindowsSystem32 or C:WindowsSysWOW64 directory. Any matches are then returned.","To successfully implement this search you need to ingest details about process execution from your hosts. Specifically, this search requires the process name and the full path to the process executable.",None identified,2016-08-24,2019-02-28,medium,ESCU - System Processes Run From Unexpected Locations - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware"", ""Suspicious Command-Line Executions"", ""Unusual Processes""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - TOR Traffic - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic where All_Traffic.app=tor AND All_Traffic.action=allowed by All_Traffic.src_ip All_Traffic.dest_ip All_Traffic.dest_port All_Traffic.action | `ctime(firstTime)` | `ctime(lastTime)` | `drop_dm_object_name(""All_Traffic"")`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for network traffic identified as The Onion Router (TOR), a benign anonymity network which can be abused for a variety of nefarious purposes.",,,,,,1,TOR Traffic,,network,medium,TOR Network Traffic Allowed from $src_ip$,Network traffic accessing TOR detected from $src_ip$,"src_ip, dest_ip",,,,,1,src_ip,system,40,src_ip,28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Commonly Used Port"", ""Exfiltration""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 9"", ""CIS 12""], ""nist"": [""DE.AE""]}",The search leverages the Enterprise Security Network_Traffic data model to look for network traffic that has been identified as TOR and marked as 'allowed'.,"In order to properly run this search, Splunk needs to ingest data from firewalls or other network control devices that mediate the traffic allowed into an environment. This is necessary so that the search can identify an 'action' taken on the traffic of interest. The search requires the Network_Traffic data model be populated.",None at this time,2017-08-21,2017-09-11,medium,ESCU - TOR Traffic - Rule,detection,Endpoint,[],"[""Palo Alto Firewall"", ""Bro"", ""Splunk Stream""]","[""Command and Control"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - USN Journal Deletion - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=fsutil.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` | search process=""*deletejournal*"" AND process=""*usn*""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The fsutil.exe application is a legitimate Windows utility used to perform tasks related to the file allocation table (FAT) and NTFS file systems. The update sequence number (USN) change journal provides a log of all changes made to the files on the disk. This search looks for fsutil.exe deleting the USN journal.,,,,,,1,USN Journal Deletion,,endpoint,medium,File System Journal Deleted on $dest$,The system $dest$ deleted its NTFS journals.,"dest, user, process_name",,,,,1,dest,system,80,"dest,user,process_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Indicator Removal on Host""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 6"", ""CIS 8"", ""CIS 10""], ""nist"": [""DE.CM"", ""PR.PT"", ""DE.AE"", ""DE.DP"", ""PR.IP""]}","This search looks for the execution of fsutil.exe with command-line arguments to delete the USN journal. The search returns the count of the number of times it's seen this process execution with these arguments, the first and last time it's seen this behavior, the hosts it was executed on, and the user context under which it was executed.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",None identified,2017-06-27,2018-12-03,medium,ESCU - USN Journal Deletion - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware"", ""Windows Log Manipulation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Uncommon Processes On Endpoint - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes by Processes.dest Processes.user Processes.process Processes.process_name | `ctime(firstTime)`| `ctime(lastTime)` | `drop_dm_object_name(Processes)` | `uncommon_processes`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for applications on the endpoint that you have marked as uncommon.,,,,,,1,Uncommon Processes On Endpoint,,endpoint,high,Prohibited Software Detected On $dest$,Prohibited software $process_name$ has been detected on $dest$,"dest, process_name, user",,,,,1,dest,system,50,"dest, user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Accessibility Features""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 2""], ""nist"": [""ID.AM"", ""PR.DS""]}","This search returns the number of times, as well as the first and last time, it has seen every process run for each endpoint and user, and then displays only those processes that you have marked as uncommon in the `uncommon_processes_default.csv` table.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model. This search uses a lookup file `uncommon_processes_default.csv` to track various features of process names that are usually uncommon in most environments. Please consider updating `uncommon_processes_local.csv` to hunt for processes that are uncommon in your environment.",None identified,2017-12-08,2019-04-01,high,ESCU - Uncommon Processes On Endpoint - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Unusual Processes"", ""Windows Privilege Escalation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Unsuccessful Netbackup backups - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""netbackup_logs"" | stats latest(_time) as latestTime by COMPUTERNAME, MESSAGE | search MESSAGE=""An error occurred, failed to backup."" | `ctime(latestTime)` | rename COMPUTERNAME as dest, MESSAGE as signature | table latestTime, dest, signature",-24h@h,-10m@m,,1,number of events,greater than,0,0 7 * * *,1,1,,,,,This search gives you the hosts where a backup was attempted and then failed.,,,,,,1,Unsuccessful Netbackup backups,,endpoint,high,Failed backup attempt by $dest$,The system $dest$ attempted a backup but encountered an error.,dest,,,,,1,dest,system,10,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 10""], ""nist"": [""PR.IP""]}","This search looks across the most recent backup events for each host, and returns those messages that indicate there was a backup failure.","To successfully implement this search you need to obtain data from your backup solution, either from the backup logs on your endpoints or from a central server responsible for performing the backups. If you do not use Netbackup, you can modify this search for your specific backup solution.",None identified,2017-06-15,2017-09-12,high,ESCU - Unsuccessful Netbackup backups - Rule,detection,Endpoint,[],"[""Netbackup""]","[""Monitor Backup Solution""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - All backup logs for hostn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Unusually Long Command Line - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes by Processes.user Processes.dest Processes.process_name Processes.process | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`| `ctime(lastTime)`|  eval processlen=len(process) | eventstats stdev(processlen) as stdev, avg(processlen) as avg by dest | stats max(processlen) as maxlen, values(stdev) as stdevperhost, values(avg) as avgperhost by dest, user, process_name, process| eval threshold = 10 | where maxlen > ((threshold*stdevperhost) + avgperhost)",-1d@d,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,Command-lines that are extremely long can be indicative of malicious activity on your hosts.,,,,,,1,Unusually Long Command Line,,endpoint,medium,Unusually Long Command-Line on $dest$,An unusually long command-line $cmdline$ was found on $dest$,"dest, process, user",,,,,1,dest,system,50,"dest,user,process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}",This search calculates the average and standard deviation for the length of the command-lines on each of your endpoints and alerts when a command-line is found with a length over 10 times the standard deviation larger than the average command-line.,"You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model. Please consider changing the value of threshold in the search for reducing false positives.",Some legitimate applications start with long command-lines.,2017-08-23,2019-02-28,medium,ESCU - Unusually Long Command Line - Rule,detection,,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Ransomware"", ""Suspicious Command-Line Executions"", ""Unusual Processes""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Account Usage For Expired Identities'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,values(Authentication.dest) as dest from datamodel=Authentication.Authentication by Authentication.user | `drop_dm_object_name(""Authentication"")` | `get_identity4events(user)` | where isnotnull(user_endDate) | where _time>user_endDate | `uitime(user_endDate,""%m/%d/%Y %H:%M:%S"")` | fields _time,user,user_first,user_last,user_endDate,dest",-7d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Unusually Long Content-Type Length - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=stream:http | eval cs_content_type_length = len(cs_content_type) | where cs_content_type_length > 100 | table endtime src_ip dest_ip cs_content_type_length cs_content_type url,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for unusually long strings in the Content-Type http header that the client sends the server.,,,,,,1,Unusually Long Content-Type Length,,network,high,Unusually Long Content-Type Length,This search looks for unusually long strings in the Content-Type http header,"src_ip, dest_ip, url",,,,,1,dest,system,75,dest_ip,28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Exploitation of Vulnerability""], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 3"", ""CIS 4"", ""CIS 18"", ""CIS 12""], ""nist"": [""ID.RA"", ""RS.MI"", ""PR.PT"", ""PR.IP"", ""DE.AE"", ""PR.MA"", ""DE.CM""]}","This detection search uses HTTP traffic data captured with Splunk Stream.  The search is constructed to use ""stream:http"" sourcetype and counts of the number of times an HTTP request is received by a destination which the length of the Content-Type header value the client sends the server is greater than 100 characters long. We calculate this content_type_length field and output the results.",This particular search leverages data extracted from Stream:HTTP. You must configure the http stream using the Splunk Stream App on your Splunk Stream deployment server to extract the cs_content_type field.,Very few legitimate Content-Type fields will have a length greater than 100 characters.,2017-03-14,2017-10-13,high,ESCU - Unusually Long Content-Type Length - Rule,detection,Web Server,[],"[""Splunk Stream""]","[""Apache Struts Vulnerability""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Investigate Suspicious Strings in HTTP HeadernESCU - Investigate Web POSTs From srcn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - WMI Permanent Event Subscription - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""wineventlog:microsoft-windows-wmi-activity/operational"" EventCode=5861 Binding | rex field=Message ""Consumer =s+(?<consumer>[^;|^$]+)"" | search consumer!=""NTEventLogEventConsumer=""SCM Event Log Consumer"""" | stats count min(_time) as firstTime max(_time) as lastTime by ComputerName, consumer, Message | `ctime(firstTime)`| `ctime(lastTime)` | rename ComputerName as dest",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for the creation of WMI permanent event subscriptions.,,,,,,1,WMI Permanent Event Subscription,,endpoint,medium,WMI Event Subscription Detected on $dest$,This search looks for the creation of a permanent WMI event subscription via Windows event logs.,dest,,,,,1,dest,system,70,dest,28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Windows Management Instrumentation"", ""Persistence"", ""Windows Management Instrumentation Event Subscription""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","Attackers are increasingly abusing Windows Management Infrastructure (WMI) for stealth, persistence, lateral movement, or just to leverage its functionality. This search looks for the creation of a WMI event subscription by watching for Windows event ID 5861.","To successfully implement this search, you must be ingesting the Windows WMI activity logs. This can be done by adding a stanza to inputs.conf on the system generating logs with a title of [WinEventLog://Microsoft-Windows-WMI-Activity/Operational].","Although unlikely, administrators may use event subscriptions for legitimate purposes.",2018-10-23,2018-10-23,medium,ESCU - WMI Permanent Event Subscription - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Suspicious WMI Use""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Sysmon WMI Activity for Hostn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - WMI Permanent Event Subscription - Sysmon - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"" EventCode=21 | rename host as dest | table _time, dest, user, Operation, EventType, Query, Consumer, Filter",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for the creation of WMI permanent event subscriptions.,,,,,,1,WMI Permanent Event Subscription - Sysmon,,endpoint,medium,WMI Event Subscription Detected on $dest$,This search looks for the creation of a permanent WMI event subscription via Sysmon logs.,"dest, user",,,,,1,dest,system,70,"dest,user",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Windows Management Instrumentation"", ""Persistence"", ""Windows Management Instrumentation Event Subscription""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","Attackers are increasingly abusing Windows Management Infrastructure (WMI) for stealth, persistence, lateral movement, or just to leverage its functionality. This search looks for the creation of a WMI event subscription by watching for Sysmon event ID 21.","To successfully implement this search, you must be collecting Sysmon data using Sysmon version 6.1 or greater and have Sysmon configured to generate alerts for WMI activity. In addition, you must have at least version 6.0.4 of the Sysmon TA installed to properly parse the fields.","Although unlikely, administrators may use event subscriptions for legitimate purposes.",2018-10-23,2018-10-23,medium,ESCU - WMI Permanent Event Subscription - Sysmon - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Suspicious WMI Use""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Sysmon WMI Activity for Hostn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - WMI Temporary Event Subscription - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""wineventlog:microsoft-windows-wmi-activity/operational"" EventCode=5860 Temporary | rex field=Message ""NotificationQuery =s+(?<query>[^;|^$]+)"" | search query!=""SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName = 'wsmprovhost.exe'"" AND query!=""SELECT * FROM __InstanceOperationEvent WHERE TargetInstance ISA 'AntiVirusProduct' OR TargetInstance ISA 'FirewallProduct' OR TargetInstance ISA 'AntiSpywareProduct'"" | stats count min(_time) as firstTime max(_time) as lastTime by ComputerName, query  | `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for the creation of WMI temporary event subscriptions.,,,,,,1,WMI Temporary Event Subscription,,endpoint,medium,Temporary WMI Event Subscription Detected on $dest$,This search looks for the creation of a temporary WMI event subscription via Windows event logs.,"dest, user, process",,,,,1,dest,system,70,"dest,user",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Windows Management Instrumentation"", ""Persistence"", ""Windows Management Instrumentation Event Subscription""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","Attackers are increasingly abusing Windows Management Infrastructure (WMI) for stealth, persistence, lateral movement, or just to leverage its functionality. This search looks for the creation of a WMI temporary event subscription by watching for Windows event ID 5860.","To successfully implement this search, you must be ingesting the Windows WMI activity logs. This can be done by adding a stanza to inputs.conf on the system generating logs with a title of [WinEventLog://Microsoft-Windows-WMI-Activity/Operational].",Some software may create WMI temporary event subscriptions for various purposes. The included search contains an exception for two of these that occur by default on Windows 10 systems. You may need to modify the search to create exceptions for other legitimate events.,2018-10-23,2018-10-23,medium,ESCU - WMI Temporary Event Subscription - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Suspicious WMI Use""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Sysmon WMI Activity for Hostn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Web Fraud - Account Harvesting - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=stream:http http_content_type=text* uri=""/magento2/customer/account/loginPost/"" | rex field=cookie ""form_key=(?<SessionID>w+)"" | rex field=form_data ""login[username]=(?<Username>[^&|^$]+)"" | search Username=* | rex field=Username ""@(?<email_domain>.*)""|stats dc(Username) as UniqueUsernames list(Username) as src_user by email_domain|where UniqueUsernames> 25",-1445m@m,-10m@m,,1,number of events,greater than,0,0 1 * * *,1,1,,,,,This search is used to identify the creation of multiple user accounts using the same email domain name.,,,,,,1,Web Fraud - Account Harvesting,,threat,medium,Web Fraud Detection: Possible Account Harvesting,This search is used to identify multiple created accounts tied to a specific email domain. Such activity is often indicative of account harvesting. A list of $src_user$ accounts were created.,src_user,,,,,1,src_user,user,40,user,3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Create Account""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 16""], ""nist"": [""DE.CM"", ""DE.DP""]}","When a fraudster is setting the stage for a campaign, they will often create many user accounts on the website. This is a simple example of how to detect a many-account creation hosted on a Magento2 e-commerce platform, where the fraudster is using email addresses from a single email domain.","We start with a dataset that provides visibility into the email address used for the account creation. In this example, we are narrowing our search down to the single web page that hosts the Magento2 e-commerce platform (via URI) used for account creation, the single http content-type to grab only the user's clicks, and the http field that provides the username (form_data), for performance reasons.  After we have the username and email domain, we look for numerous account creations per email domain.  Common data sources used for this detection are customized Apache logs or Splunk Stream.","As is common with many fraud-related searches, we are usually looking to attribute risk or synthesize relevant context with loosely written detections that simply detect anamolous behavior. This search will need to be customized to fit your environment&#151;improving its fidelity by counting based on something much more specific, such as a device ID that may be present in your dataset. Consideration for whether the large number of registrations are occuring from a first-time seen domain may also be important.  Extending the search window to look further back in time, or even calculating the average per hour/day for each email domain to look for an anomalous spikes, will improve this search.  You can also use Shannon entropy or Levenshtein Distance (both courtesy of URL Toolbox) to consider the randomness or similarity of the email name or email domain, as the names are often machine-generated.",2018-07-12,2018-10-08,medium,ESCU - Web Fraud - Account Harvesting - Rule,detection,Account,[],"[""Splunk Stream"", ""Palo Alto Firewall"", ""Bro""]","[""Web Fraud Detection""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get Emails From Specific SendernESCU - Get Web Session Information via session_idn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Web Fraud - Anomalous User Clickspeed - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=stream:http http_content_type=text* | rex field=cookie ""form_key=(?<session_id>w+)"" | streamstats window=2 current=1 range(_time) as TimeDelta by session_id | where TimeDelta>0 |stats count stdev(TimeDelta) as ClickSpeedStdDev avg(TimeDelta) as ClickSpeedAvg by session_id | where count>5 AND (ClickSpeedStdDev<.5 OR ClickSpeedAvg<.5)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search is used to examine web sessions to identify those where the clicks are occurring too quickly for a human or are occurring with a near-perfect cadence (high periodicity or low standard deviation), resembling a script driven session.",,,,,,1,Web Fraud - Anomalous User Clickspeed,,threat,medium,Web Fraud Detection: Anomalous User Clickspeed,"This search is used to examine web sessions in order to identify unnaturally rapid clicks with near-perfect cadence (high periodicity or low standard deviation), which resemble a script-driven session.",session_id,,,,,1,session_id,other,40,session_id,3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Valid Accounts""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 6""], ""nist"": [""DE.AE"", ""DE.CM""]}","It's suspicious when someone or something is moving throughout your website too quickly or with a perfect click cadence. Fortunately, it's easy to detect by calculating the time between clicks for each session and highlighting the anomalous behavior.","Start with a dataset that allows you to see clickstream data for each user click on the website. That data must have a time stamp and must contain a reference to the session identifier being used by the website. This ties the clicks together into clickstreams. This value is usually found in the http cookie. With a bit of tuning, a version of this search could be used in high-volume scenarios, such as scraping, crawling, application DDOS, credit-card testing, account takeover, etc. Common data sources used for this detection are customized Apache logs, customized IIS, and Splunk Stream.","As is common with many fraud-related searches, we are usually looking to attribute risk or synthesize relevant context with loosly written detections that simply detect anamoluous behavior.",2018-07-12,2018-10-08,medium,ESCU - Web Fraud - Anomalous User Clickspeed - Rule,detection,account,[],"[""Splunk Stream"", ""Palo Alto Firewall"", ""Bro""]","[""Web Fraud Detection""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get Emails From Specific SendernESCU - Get Web Session Information via session_idn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Web Fraud - Password Sharing Across Accounts - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=stream:http http_content_type=text* uri=/magento2/customer/account/loginPost*  | rex field=form_data ""login[username]=(?<Username>[^&|^$]+)"" | rex field=form_data ""login[password]=(?<Password>[^&|^$]+)"" | stats dc(Username) as UniqueUsernames values(Username) as user list(src_ip) as src_ip by Password|where UniqueUsernames>5",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search is used to identify user accounts that share a common password.,,,,,,1,Web Fraud - Password Sharing Across Accounts,,threat,medium,Web Fraud Detection: Password Sharing Across Accounts,"This search is used to identify user accounts, $user$, that share common passwords",user,,,,,1,user,other,10,user,3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 16""], ""nist"": [""DE.DP""]}","A common password across user accounts generally indicates that the users are choosing poor passwords or that a fraudster has a common password across multiple accounts embedded within a script. The search will extract the username and password information from the form_data field, then calculate the number and values for usernames that have the same passwords. Finally, it outputs the values where the unique usernames sharing passwords are greater than 5","We need to start with a dataset that allows us to see the values of usernames and passwords that users are submitting to the website hosting the Magento2 e-commerce platform (commonly found in the HTTP form_data field). A tokenized or hashed value of a password is acceptable and certainly preferable to a clear-text password. Common data sources used for this detection are customized Apache logs, customized IIS, and Splunk Stream.","As is common with many fraud-related searches, we are usually looking to attribute risk or synthesize relevant context with loosely written detections that simply detect anamoluous behavior.",2018-07-12,2018-10-08,medium,ESCU - Web Fraud - Password Sharing Across Accounts - Rule,detection,account,[],"[""Splunk Stream"", ""Palo Alto Firewall"", ""Bro""]","[""Web Fraud Detection""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get Emails From Specific SendernESCU - Get Web Session Information via session_idn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Web Servers Executing Suspicious Processes - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.dest_category=""web_server"" AND (Processes.process=""*whoami*"" OR Processes.process=""*ping*"" OR Processes.process=""*iptables*"" OR Processes.process=""*wget*"" OR Processes.process=""*service*"" OR Processes.process=""*curl*"") by Processes.process Processes.process_name, Processes.dest Processes.user| `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for suspicious processes on all systems labeled as web servers.,,,,,,1,Web Servers Executing Suspicious Processes,,endpoint,medium,Web Servers Executing Suspicious Processes,This search looks for suspicious processes on all systems labeled as web servers,"dest, user, process",,,,,1,dest,system,75,"dest, process",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Exploitation of Vulnerability"", ""Execution"", ""Discovery"", ""System Information Discovery""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3""], ""nist"": [""PR.IP""]}","This detection search uses the Enterprise Security Endpoint data model. The search uses tstats to search within an accelerated data model to find suspicious applications or processes such as whoami, ping, iptables, wget, service, or curl, running on hosts which are marked as web servers in the Assets and Identity Framework of ES.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model. In addition, web servers will need to be identified in the Assets and Identity Framework of Enterprise Security.",Some of these processes may be used legitimately on web servers during maintenance or other administrative tasks.,2017-03-14,2019-04-01,medium,ESCU - Web Servers Executing Suspicious Processes - Rule,detection,Web Server,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Apache Struts Vulnerability""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Investigate Suspicious Strings in HTTP HeadernESCU - Investigate Web POSTs From srcn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Windows Event Log Cleared - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,((eventtype=wineventlog_security) AND (signature_id=1102 OR signature_id=1100)) OR ((eventtype=wineventlog_system) AND signature_id=104) | stats count min(_time) as firstTime max(_time) as lastTime by signature_id dest user| `ctime(firstTime)` | `ctime(lastTime)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for Windows events that indicate one of the Windows event logs has been purged.,,,,,,1,Windows Event Log Cleared,,endpoint,high,Windows Event Log Cleared on $dest$,The Event Logging System has been cleared or shutdown on $dest$,dest,,,,,1,dest,system,60,"dest, signature_id",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Indicator Removal on Host""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 6""], ""nist"": [""DE.DP"", ""PR.IP"", ""PR.AC"", ""PR.AT"", ""DE.AE""]}","This search looks at the Windows security and system event logs. EventCode 1002 in the security log indicates that the log has been cleared, EventCode 1000 in the security log indicates the event logging service has been shut down, and EventCode 104 in the system log indicates the application log has been cleared. If any of these events are found, a notable will be generated.","To successfully implement this search, you need to be ingesting Windows event logs from your hosts.",It is possible that these logs may be legitimately cleared by Administrators.,2017-02-17,2019-02-27,high,ESCU - Windows Event Log Cleared - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Ransomware"", ""Windows Log Manipulation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Windows hosts file modification - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Filesystem  by Filesystem.file_name Filesystem.file_path Filesystem.dest | `ctime(lastTime)` | `ctime(firstTime)` | search Filesystem.file_name=hosts AND Filesystem.file_path=*Windows\System32\* | `drop_dm_object_name(Filesystem)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for modifications to the hosts file on all Windows endpoints across your environment.,,,,,,1,Windows hosts file modification,,endpoint,high,Modification of hosts file detected on $dest$,A file modification was noted for the hosts file on $dest$.,"dest, file_name",,,,,1,dest,system,80,"dest,user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Exfiltration""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 3"", ""CIS 8"", ""CIS 12""], ""nist"": [""PR.IP"", ""PR.PT"", ""PR.AC"", ""DE.AE"", ""DE.CM""]}","The hosts file is present on both Windows and Linux endpoints. The purpose of the hosts file is to provide a mapping between hostnames and IP addresses, the same way DNS is used to provide such a mapping. However, the information in the hosts file takes precedence over information received via DNS and a DNS query will not be issued if the hostname of interest is found in the hosts file. As such, attackers have been observed adding entries to the host file to override any DNS resolution. For this reason, it is useful to monitor for changes to this file, which typically do not occur very often in legitimate cases.","To successfully implement this search, you must be ingesting data that records the file-system activity from your hosts to populate the Endpoint.Filesystem data model node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or by other endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report file-system reads and writes.",There may be legitimate reasons for system administrators to add entries to this file.,2017-06-07,2018-11-02,high,ESCU - Windows hosts file modification - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Host Redirection""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Investigate Web Activity From HostnESCU - Get DNS Server History for a hostnESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Default Account Usage Over Time'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| `tstats` count from datamodel=Authentication.Authentication where nodename=Authentication.Default_Authentication Authentication.action=success by _time span=1h | timechart minspan=1h count,-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Investigate User Activities By ARN'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search sourcetype=aws:cloudtrail userIdentity.arn={arn} | table _time userIdentity.type userIdentity.userName userIdentity.arn aws_account_id src awsRegion eventName eventType,,,,,,,,,,,,,,,"This search lists all the logged CloudTrail activities by a specific user ARN and will create a table containing the source of the user, the region of the activity, the name and type of the event, the action taken, and all the user's identity information.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-01-22,2018-02-25,,ESCU - AWS Investigate User Activities By ARN,investigative,,"[""arn""]","[""AWS""]","[""AWS Cryptomining"", ""AWS Network ACL Activity"", ""Suspicious AWS EC2 Activities"", ""Suspicious AWS Login Activities"", ""Suspicious AWS S3 Activities"", ""Unusual AWS EC2 Modifications""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Investigate User Activities By AccessKeyId'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=aws:cloudtrail userIdentity.accessKeyId={accessKeyId} | spath output=user path=userIdentity.arn  | rename sourceIPAddress as src_ip | table _time, user, src_ip, awsRegion, eventName, errorCode, errorMessage",,,,,,,,,,,,,,,"This search retrieves the times, ARN, source IPs, AWS regions, event names, and the result of the event for specific credentials.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-06-08,2018-06-08,,ESCU - AWS Investigate User Activities By AccessKeyId,investigative,,"[""accessKeyId""]","[""AWS""]","[""AWS Cross Account Activity""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Investigate User Activities By Source User'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=aws:cloudtrail userIdentity.arn={src_user} | spath output=user path=userIdentity.arn | rename sourceIPAddress as src_ip | table _time, user, src_ip, awsRegion, eventName, errorCode, errorMessage",,,,,,,,,,,,,,,"This search retrieves the times, ARN, source IPs, AWS regions, event names, and the result of the event for specific ARNs.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-06-08,2018-06-08,,ESCU - AWS Investigate User Activities By Source User,investigative,,"[""src_user""]","[""AWS""]","[""AWS Cross Account Activity""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Network ACL Details from ID'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search sourcetype=aws:description id={networkAclId} | table id account_id vpc_id network_acl_entries{}.*,,,,,,,,,,,,,,,This search queries AWS description logs and returns all the information about a specific network ACL via network ACL ID,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"In order to implement this search, you must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS(version 4.4.0 or later) and configure your AWS description inputs.",None at this time,2018-01-18,2017-01-22,,ESCU - AWS Network ACL Details from ID,investigative,,"[""networkAclId""]","[""AWS""]","[""AWS Network ACL Activity""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Network Interface details via resourceId'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search sourcetype=aws:config resourceId={resourceId} | table _time ARN relationships{}.resourceType relationships{}.name relationships{}.resourceId  configuration.privateIpAddresses{}.privateIpAddress configuration.privateIpAddresses{}.association.publicIp,,,,,,,,,,,,,,,"This search queries AWS configuration logs and returns the information about a specific network interface via network interface ID. The information will include the ARN of the network interface, its relationships with other AWS resources, the public and the private IP associated with the network interface.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"In order to implement this search, you must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS(version 4.4.0 or later) and configure your AWS configuration inputs",None at this time,2018-05-07,2018-05-07,,ESCU - AWS Network Interface details via resourceId,investigative,,"[""resourceId""]","[""AWS""]","[""AWS Network ACL Activity"", ""Command and Control"", ""Suspicious AWS Traffic""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS S3 Bucket details via bucketName'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search sourcetype=aws:config resourceId={bucketName} | table resourceCreationTime resourceId awsRegion action aws_account_id supplementaryConfiguration.AccessControlList,,,,,,,,,,,,,,,"This search queries AWS configuration logs and returns the information about a specific S3 bucket. The information returned includes the time the S3 bucket was created, the resource ID, the region it belongs to, the value of action performed, AWS account ID, and configuration values of the access-control lists associated with the bucket.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To implement this search, you must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later) and configure your AWS inputs.",None at this time,2018-06-26,2018-06-26,,ESCU - AWS S3 Bucket details via bucketName,investigative,,"[""bucketName""]","[""AWS""]","[""Suspicious AWS S3 Activities""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - All backup logs for host'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=""netbackup_logs"" dest={dest}",,,,,,,,,,,,,,,Retrieve the backup logs for the last 2 weeks for a specific host in order to investigate why backups are not completing successfully.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,The successfully implement this search you must first send your backup logs to Splunk.,None at this time,2017-06-19,2017-09-12,,ESCU - All backup logs for host,investigative,,"[""dest""]","[""Netbackup""]","[""Monitor Backup Solution""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get All AWS Activity From City'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=aws:cloudtrail | iplocation sourceIPAddress | search City={City} | spath output=user path=userIdentity.arn | spath output=awsUserName path=userIdentity.userName | spath output=userType path=userIdentity.type | rename sourceIPAddress as src_ip | table _time, City, user, userName, userType, src_ip, awsRegion, eventName, errorCode",,,,,,,,,,,,,,,"This search retrieves all the activity from a specific city and will create a table containing the time, city, ARN, username, the type of user, the source IP address, the AWS region the activity was in, the API called, and whether or not the API call was successful.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-03-19,2018-03-19,,ESCU - Get All AWS Activity From City,investigative,,"[""City""]","[""AWS""]","[""AWS Suspicious Provisioning Activities""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get All AWS Activity From Country'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=aws:cloudtrail | iplocation sourceIPAddress | search Country={Country} | spath output=user path=userIdentity.arn | spath output=awsUserName path=userIdentity.userName | spath output=userType path=userIdentity.type | rename sourceIPAddress as src_ip | table _time, Country, user, userName, userType, src_ip, awsRegion, eventName, errorCode",,,,,,,,,,,,,,,"This search retrieves all the activity from a specific country and will create a table containing the time, country, ARN, username, the type of user, the source IP address, the AWS region the activity was in, the API called, and whether or not the API call was successful.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-03-19,2018-03-19,,ESCU - Get All AWS Activity From Country,investigative,,"[""Country""]","[""AWS""]","[""AWS Suspicious Provisioning Activities""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get All AWS Activity From IP Address'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=aws:cloudtrail | iplocation sourceIPAddress | search sourceIPAddress={src_ip} | spath output=user path=userIdentity.arn | spath output=awsUserName path=userIdentity.userName | spath output=userType path=userIdentity.type | rename sourceIPAddress as src_ip | table _time, user, userName, userType, src_ip, awsRegion, eventName, errorCode",,,,,,,,,,,,,,,"This search retrieves all the activity from a specific IP address and will create a table containing the time, ARN, username, the type of user, the IP address, the AWS region the activity was in, the API called, and whether or not the API call was successful.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-03-19,2018-03-19,,ESCU - Get All AWS Activity From IP Address,investigative,,"[""src_ip""]","[""AWS""]","[""AWS Network ACL Activity"", ""AWS Suspicious Provisioning Activities"", ""Command and Control"", ""Suspicious AWS S3 Activities"", ""Suspicious AWS Traffic""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Default Account Usage Over Time By App'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Authentication.Authentication where nodename=Authentication.Default_Authentication Authentication.action=success by _time,Authentication.app span=1h | timechart minspan=1h count by Authentication.app | `drop_dm_object_name(""Authentication"")`",-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get All AWS Activity From Region'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=aws:cloudtrail | iplocation sourceIPAddress | search Region={Region} | spath output=user path=userIdentity.arn | spath output=awsUserName path=userIdentity.userName | spath output=userType path=userIdentity.type | rename sourceIPAddress as src_ip | table _time, Region, user, userName, userType, src_ip, awsRegion, eventName, errorCode",,,,,,,,,,,,,,,"This search retrieves all the activity from a specific geographic region and will create a table containing the time, geographic region, ARN, username, the type of user, the source IP address, the AWS region the activity was in, the API called, and whether or not the API call was successful.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-03-19,2018-03-19,,ESCU - Get All AWS Activity From Region,investigative,,"[""Region""]","[""AWS""]","[""AWS Suspicious Provisioning Activities""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication where'],['ESCU - Get Authentication Logs For Endpoint'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats count from datamodel=Authentication where Authentication.dest={dest} by _time, Authentication.dest, Authentication.user, Authentication.app, Authentication.action | `drop_dm_object_name(""Authentication"")`",,,,,,,,,,,,,,,This search returns all users that have attempted to access a particular endpoint.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you need to be ingesting authentication logs from your various systems and populating the Authentication data model.,None at this time,2017-04-10,2017-11-01,,ESCU - Get Authentication Logs For Endpoint,investigative,,"[""dest""]","[""Microsoft Windows"", ""Linux"", ""macOS""]","[""Account Monitoring and Controls"", ""Apache Struts Vulnerability"", ""Asset Tracking"", ""Brand Monitoring"", ""ColdRoot MacOS RAT"", ""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""Data Protection"", ""Disabling Security Tools"", ""Dynamic DNS"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Host Redirection"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor for Unauthorized Software"", ""Monitor for Updates"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""Router & Infrastructure Security"", ""SQL Injection"", ""SamSam Ransomware"", ""Spectre And Meltdown Vulnerabilities"", ""Splunk Enterprise Vulnerability"", ""Suspicious Command-Line Executions"", ""Suspicious DNS Traffic"", ""Suspicious Emails"", ""Suspicious MSHTA Activity"", ""Suspicious WMI Use"", ""Suspicious Windows Registry Activities"", ""Unusual Processes"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Log Manipulation"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,"[""Authentication""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get Backup Logs For Endpoint'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=""netbackup_logs"" COMPUTERNAME={dest} | rename COMPUTERNAME as dest, MESSAGE as signature | table _time, dest, signature",,,,,,,,,,,,,,,This search will tell you the backup status from your netbackup_logs of a specific endpoint for the last week.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,You must be ingesting your backup logs.,None at this time,2017-08-24,2017-09-14,,ESCU - Get Backup Logs For Endpoint,investigative,,"[""dest""]","[""Netbackup""]","[""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['ESCU - Get Certificate logs for a domain'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Certificates.All_Certificates where All_Certificates.SSL.ssl_subject_common_name=*{domain}  by All_Certificates.dest All_Certificates.src All_Certificates.SSL.ssl_issuer_common_name All_Certificates.SSL.ssl_subject_common_name All_Certificates.SSL.ssl_hash | `drop_dm_object_name(All_Certificates)` | `drop_dm_object_name(SSL)` | rename ssl_subject_common_name as domain | `ctime(firstTime)` | `ctime(lastTime)`,,,,,,,,,,,,,,,This search queries the Certificates datamodel and give you all the information for a specific domain. Please note that if the certificate information,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must be ingesting your certificates or SSL logs from your network traffic into your Certificates datamodel. Please note the wildcard(*) before domain in the search syntax, we use to match for all domain and subdomain combinations",None at this time,2019-04-29,2019-04-29,,ESCU - Get Certificate logs for a domain,investigative,,,"[""Splunk Stream"", ""Bro""]","[""Common Phishing Frameworks""]",,,,3600,86400,,,,,,"[""Certificates""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get DNS Server History for a host'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search tag=dns src_ip={src_ip} dest_port=53 | streamstats time_window=1d count values(dest_ip) as dcip by src_ip | table date_mday src_ip dcip count | sort -count,,,,,,,,,,,,,,,While investigating any detections it is important to understand which and how many DNS servers a host has connected to in the past. This search uses data that is tagged as DNS and gives you a count and list of DNS servers that a particular host has connected to the previous 24 hours.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search, you must be ingesting your DNS traffic",None at this time,2017-04-10,2017-11-09,,ESCU - Get DNS Server History for a host,investigative,,"[""src_ip""]","[""Splunk Stream"", ""Bro""]","[""Brand Monitoring"", ""Command and Control"", ""DNS Hijacking"", ""Data Protection"", ""Dynamic DNS"", ""Hidden Cobra Malware"", ""Host Redirection"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Suspicious DNS Traffic""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Get DNS traffic ratio'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats allow_old_summaries=true sum(All_Traffic.bytes_out) as ""bytes_out"" sum(All_Traffic.bytes_in) as ""bytes_in"" from datamodel=Network_Traffic where nodename=All_Traffic All_Traffic.dest_port=53 All_Traffic.src={src_ip} All_Traffic.dest={dest_ip} | eval ratio = (bytes_out/bytes_in) | table ratio",,,,,,,,,,,,,,,"This search calculates the ratio of DNS traffic originating and coming from a host to a list of DNS servers over the last 24 hours. A high value of this ratio could be very useful to quickly understand if a src_ip (host) is sending a high volume of data out via port 53, could be an indicator of data exfiltration via DNS.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,You must be ingesting your network traffic,None at this time,2017-04-10,2017-11-09,,ESCU - Get DNS traffic ratio,investigative,,"[""src_ip"", ""dest_ip""]","[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""Data Protection"", ""Dynamic DNS"", ""Hidden Cobra Malware"", ""Suspicious DNS Traffic""]",,,,3600,86400,,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get EC2 Instance Details by instanceId'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=""aws:description"" source=""*:ec2_instances""| dedup id sortby -_time | search id={instanceId} | spath output=tags path=tags | eval tags=mvzip(key,value,"" = ""), ip_address=if((ip_address == ""null""),private_ip_address,ip_address) | table id, tags.Name, aws_account_id, placement, instance_type, key_name, ip_address, launch_time, state, vpc_id, subnet_id, tags | rename aws_account_id as ""Account ID"", id as ID, instance_type as Type, ip_address as ""IP Address"", key_name as ""Key Pair"", launch_time as ""Launch Time"", placement as ""Availability Zone"", state as State, subnet_id as Subnet, ""tags.Name"" as Name, vpc_id as VPC",,,,,,,,,,,,,,,This search queries AWS description logs and returns all the information about a specific instance via the instanceId field,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"In order to implement this search, you must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS(version 4.4.0 or later) and configure your AWS description inputs.",None at this time,2018-02-12,2018-02-12,,ESCU - Get EC2 Instance Details by instanceId,investigative,,"[""instanceId""]","[""AWS""]","[""AWS Cryptomining"", ""Suspicious AWS EC2 Activities"", ""Unusual AWS EC2 Modifications""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get EC2 Launch Details'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=aws:cloudtrail responseElements.instancesSet.items{}.instanceId={dest} |rename userIdentity.arn as arn, responseElements.instancesSet.items{}.instanceId as instanceId, responseElements.instancesSet.items{}.privateIpAddress as privateIpAddress, responseElements.instancesSet.items{}.imageId as amiID, responseElements.instancesSet.items{}.architecture as architecture, responseElements.instancesSet.items{}.keyName as keyName | table arn, awsRegion, instanceId, architecture, privateIpAddress, amiID, keyName",,,,,,,,,,,,,,,This search returns some of the launch details for a EC2 instance.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"In order to implement this search, you must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS(version 4.4.0 or later) and configure your AWS description inputs.",None at this time,2018-03-12,2018-03-12,,ESCU - Get EC2 Launch Details,investigative,,"[""dest""]","[""AWS""]","[""AWS Cryptomining""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['ESCU - Get Email Info'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel Email.All_Email | search message_id={message_id},,,,,,,,,,,,,,,This search returns all the information Splunk might have collected a specific email message over the last 2 hours.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you must be ingesting your email logs or capturing unencrypted network traffic which contains email communications.,None at this time,2017-04-21,2017-11-09,,ESCU - Get Email Info,investigative,,"[""message_id""]","[""Microsoft Exchange""]","[""Brand Monitoring"", ""Emotet Malware (TA18-201A)"", ""Suspicious Emails""]",,,,3600,86400,,,,,,"[""Email""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['ESCU - Get Emails From Specific Sender'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel Email.All_Email | search src_user={src_user},,,,,,,,,,,,,,,This search returns all the emails from a specific sender over the last 24 and next hours.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search you must ingest your email logs or capture unencrypted email communications within network traffic, and populate the Email data model.",None at this time,2017-04-21,2017-11-09,,ESCU - Get Emails From Specific Sender,investigative,,"[""src_user""]","[""Microsoft Exchange""]","[""Brand Monitoring"", ""Emotet Malware (TA18-201A)"", ""Suspicious Emails"", ""Web Fraud Detection""]",,,,3600,86400,,,,,,"[""Email""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Default Accounts In Use'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,values(Authentication.user_category) as user_category,dc(Authentication.dest) as dc(dest) from datamodel=Authentication.Authentication where Authentication.user_category=default by Authentication.user | `drop_dm_object_name(""Authentication"")` | sort 100 - _time | fields _time,user,user_category,dc(dest)",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Sessions where'],['ESCU - Get First Occurrence and Last Occurrence of a MAC Address'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats allow_old_summaries=true count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Sessions where nodename=All_Sessions.DHCP All_Sessions.signature=DHCPREQUEST All_Sessions.All_Sessions.src_mac= {src_mac} by All_Sessions.src_ip All_Sessions.user | `ctime(lastTime)` | `ctime(firstTime)`,,,,,,,,,,,,,,,This search allows you to gather more context around a notable which has detected a new device connecting to your network. Use this search to determine the first and last occurrences of the suspicious device attempting to connect with your network.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search, you must be ingesting the logs from your DHCP server.",None at this time,2017-06-14,2017-09-13,,ESCU - Get First Occurrence and Last Occurrence of a MAC Address,investigative,,"[""src_mac""]","[""Splunk Stream"", ""Bro"", ""Microsoft Windows""]","[""Asset Tracking""]",,,,3600,86400,,,,,,"[""Network_Sessions""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['ESCU - Get History Of Email Sources'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,|tstats `summariesonly` values(All_Email.dest) as dest values(All_Email.recipient) as recepient  min(_time) as firstTime max(_time) as lastTime count from datamodel=Email.All_Email by All_Email.src |`drop_dm_object_name(All_Email)` | `ctime(firstTime)` | `ctime(lastTime)`,,,,,,,,,,,,,,,"This search returns a list of all email sources seen in the 48 hours prior to the notable event to 24 hours after, and the number of emails from each source.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search you must ingest your email logs or capture unencrypted email communications within network traffic, and populate the Email data model.",None at this time,2019-02-21,2019-02-21,,ESCU - Get History Of Email Sources,investigative,,"[""src""]","[""Microsoft Exchange""]",[],,,,3600,86400,,,,,,"[""Email""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get Logon Rights Modifications For Endpoint'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search eventtype=wineventlog_security (signature_id=4718 OR signature_id=4717) dest={dest} | rename user as ""Account Modified"" | table _time, dest, ""Account Modified"", Access_Right, signature",,,,,,,,,,,,,,,This search allows you to retrieve any modifications to logon rights associated with a specific host.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you must be ingesting your Windows event logs,None at this time,2017-08-16,2017-09-12,,ESCU - Get Logon Rights Modifications For Endpoint,investigative,,"[""dest""]","[""Microsoft Windows""]","[""Account Monitoring and Controls""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get Logon Rights Modifications For User'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search eventtype=wineventlog_security (signature_id=4718 OR signature_id=4717) user={user} | rename user as ""Account Modified"" | table _time, dest, ""Account Modified"", Access_Right, signature",,,,,,,,,,,,,,,This search allows you to retrieve any modifications to logon rights for a specific user account.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you must be ingesting your Windows event logs,None at this time,2017-08-16,2019-02-27,,ESCU - Get Logon Rights Modifications For User,investigative,,"[""user""]","[""Microsoft Windows""]","[""Account Monitoring and Controls""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get Notable History'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search `notable` | search dest={dest} | table _time, rule_name, owner, priority, severity, status_description",,,,,,,,,,,,,,,"This search queries the notable index and returns all the Notable Events for the particular destination host, giving the analyst an overview of the incidents that may have occurred with the host under investigation.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,If you are using Enterprise Security you are likely already creating notable events with your correlation rules. No additional configuration is necessary.,None at this time,2017-03-15,2017-09-20,,ESCU - Get Notable History,investigative,,"[""dest""]","[""Splunk Enterprise Security""]","[""AWS Cross Account Activity"", ""AWS Cryptomining"", ""AWS Network ACL Activity"", ""AWS User Monitoring"", ""Account Monitoring and Controls"", ""Apache Struts Vulnerability"", ""Asset Tracking"", ""Brand Monitoring"", ""ColdRoot MacOS RAT"", ""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""DNS Amplification Attacks"", ""Data Protection"", ""Disabling Security Tools"", ""Dynamic DNS"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Host Redirection"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor Backup Solution"", ""Monitor for Unauthorized Software"", ""Monitor for Updates"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""Router & Infrastructure Security"", ""SQL Injection"", ""SamSam Ransomware"", ""Spectre And Meltdown Vulnerabilities"", ""Splunk Enterprise Vulnerability"", ""Splunk Enterprise Vulnerability CVE-2018-11409"", ""Suspicious AWS EC2 Activities"", ""Suspicious AWS Login Activities"", ""Suspicious AWS S3 Activities"", ""Suspicious AWS Traffic"", ""Suspicious Command-Line Executions"", ""Suspicious DNS Traffic"", ""Suspicious Emails"", ""Suspicious MSHTA Activity"", ""Suspicious WMI Use"", ""Suspicious Windows Registry Activities"", ""Unusual AWS EC2 Modifications"", ""Unusual Processes"", ""Use of Cleartext Protocols"", ""Web Fraud Detection"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Log Manipulation"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get Notable Info'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search `notable_by_id({event_id})` | table time, rule_name, dest, dest_asset_id, dest_owner, priority, severity, owner, status_description",,,,,,,,,,,,,,,"This search queries the notable index to retrieve detailed information captured within the notable. Every notable has a unique ID associated with it, which is used to point us directly to the notable event under investigation.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,If you are using Enterprise Security you are likely already creating notable events with your correlation rules. No additional configuration is necessary.,None at this time,2017-03-15,2017-09-20,,ESCU - Get Notable Info,investigative,,"[""event_id""]","[""Splunk Enterprise Security""]","[""AWS Cryptomining"", ""AWS Network ACL Activity"", ""AWS User Monitoring"", ""Account Monitoring and Controls"", ""Apache Struts Vulnerability"", ""Asset Tracking"", ""Brand Monitoring"", ""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""DNS Amplification Attacks"", ""Data Protection"", ""Disabling Security Tools"", ""Dynamic DNS"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Host Redirection"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor for Updates"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Ransomware"", ""Router & Infrastructure Security"", ""SQL Injection"", ""SamSam Ransomware"", ""Spectre And Meltdown Vulnerabilities"", ""Splunk Enterprise Vulnerability"", ""Splunk Enterprise Vulnerability CVE-2018-11409"", ""Suspicious AWS EC2 Activities"", ""Suspicious AWS Login Activities"", ""Suspicious AWS S3 Activities"", ""Suspicious AWS Traffic"", ""Suspicious Command-Line Executions"", ""Suspicious DNS Traffic"", ""Suspicious MSHTA Activity"", ""Suspicious WMI Use"", ""Suspicious Windows Registry Activities"", ""Unusual Processes"", ""Use of Cleartext Protocols"", ""Web Fraud Detection"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Log Manipulation"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['ESCU - Get Outbound Emails to Hidden Cobra Threat Actors'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| from datamodel Email.All_Email | search recipient=misswang8107@gmail.com OR src_user=redhat@gmail.com | stats count earliest(_time) as firstTime, latest(_time) as lastTime values(dest) values(src) by src_user recipient | `ctime(firstTime)` | `ctime(lastTime)`",,,,,,,,,,,,,,,"This search returns the information of the users that sent emails to the accounts controlled by the Hidden Cobra Threat Actors: specifically to <code>misswang8107@gmail.com</code>, and from <code>redhat@gmail.com</code>.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search you must ingest your email logs or capture unencrypted email communications within network traffic, and populate the Email data model.",None at this time,2018-06-14,2018-06-14,,ESCU - Get Outbound Emails to Hidden Cobra Threat Actors,investigative,,"[""src_user"", ""recipient""]","[""Microsoft Exchange""]","[""DHS Report TA18-074A"", ""Hidden Cobra Malware""]",,,,3600,86400,,,,,,"[""Email""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Get Parent Process Info'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes where Processes.process_name = {process_name} Processes.dest = {dest} by Processes.user Processes.parent_process_name  Processes.process_name  | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`| `ctime(lastTime)`",,,,,,,,,,,,,,,This search queries the Endpoint data model to give you details about the parent process of a process running on a host which is under investigation. Enter the values of the process name in question and the dest,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",None at this time,2017-08-22,2019-02-28,,ESCU - Get Parent Process Info,investigative,,"[""process_name"", ""dest""]","[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""Disabling Security Tools"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor for Unauthorized Software"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Phishing Payloads"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware"", ""Suspicious Command-Line Executions"", ""Suspicious MSHTA Activity"", ""Suspicious Windows Registry Activities"", ""Unusual Processes"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Get Process Info'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time)  max(_time) as lastTime from datamodel=Endpoint.Processes where Proceses.dest={dest} Proceses.process_name={process_name} by Processes.parent_process Processes.process_name Processes.user Processes.dest | `drop_dm_object_name(Processes)` | `ctime(firstTime)`|`ctime(lastTime)`,,,,,,,,,,,,,,,"This search queries the Endpoint data model to give you details about the process running on a host which is under investigation. To gather the process info, enter the values for the process name in question and the destination IP address.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you must be ingesting endpoint data and populating the Endpoint data model.,None at this time,2017-03-15,2019-04-01,,ESCU - Get Process Info,investigative,,"[""process_name"", ""dest""]","[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""Disabling Security Tools"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor for Unauthorized Software"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware"", ""Suspicious Command-Line Executions"", ""Suspicious MSHTA Activity"", ""Suspicious WMI Use"", ""Suspicious Windows Registry Activities"", ""Unusual Processes"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Log Manipulation"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Processes', 'Endpoint.Ports']",['ESCU - Get Process Information For Port Activity'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time)  max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.dest = {dest} by Processes.process_name Processes.user Processes.dest Processes.process_id | `drop_dm_object_name(Processes)` | `ctime(firstTime)`|`ctime(lastTime)` | search [| tstats `summariesonly` count from datamodel=Endpoint.Ports where Ports.dest_port={dest_port} by Ports.process_id Ports.src  | `drop_dm_object_name(Ports)` | rename src as dest],,,,,,,,,,,,,,,This search will return information about the process associated with observed network traffic to a specific destination port from a specific host.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you must be ingesting endpoint data that associates processes with network events and populate the Endpoint Datamodel,None at this time,2017-06-25,2019-04-01,,ESCU - Get Process Information For Port Activity,investigative,,"[""dest_port"", ""dest""]","[""Splunk Stream"", ""Bro"", ""Bluecoat"", ""Palo Alto Firewall""]","[""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware"", ""Use of Cleartext Protocols""]",,,,3600,86400,,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - Default Local Accounts'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| `useraccounts_tracker` | search user_category=default | stats max(lastTime) as _time,values(user_category) as user_category,dc(dest) as dc(dest) by user | sort 100 - _time | fields _time,user,user_category,dc(dest)",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Processes', 'Endpoint.Ports']",['ESCU - Get Process responsible for the DNS traffic'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time)  max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.dest = {dest} by Processes.parent_process Processes.process_name Processes.user Processes.dest Processes.process_id | `drop_dm_object_name(Processes)` | `ctime(firstTime)`|`ctime(lastTime)` | search [| tstats `summariesonly` count from datamodel=Endpoint.Ports where Ports.dest_port=53 by Ports.process_id Ports.src | `drop_dm_object_name(Ports)` | rename src as dest],,,,,,,,,,,,,,,"While investigating, an analyst will want to know what process and parent_process is responsible for generating suspicious DNS traffic. Use the following search and enter the value of `dest` in the search to get specific details on the process responsible for creating the DNS traffic.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must be ingesting endpoint data that associates processes with network events into the Endpoint datamodel. This can come from endpoint protection products such as carbon black, or endpoint data sources such as Sysmon.",None at this time,2017-04-10,2019-04-01,,ESCU - Get Process responsible for the DNS traffic,investigative,,"[""dest""]","[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Brand Monitoring"", ""Command and Control"", ""Data Protection"", ""Dynamic DNS"", ""Hidden Cobra Malware"", ""Host Redirection"", ""Suspicious DNS Traffic""]",,,,3600,86400,,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Registry', 'Endpoint.Processes']",['ESCU - Get Registry Activities'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Registry.registry_path) as registry_path values(Registry.registry_key_name) as registry_key_name count FROM datamodel=Endpoint.Registry where Registry.dest = ""{dest}"" by Registry.process_id Registry.dest | `drop_dm_object_name(""Registry"")` | join [| tstats `summariesonly` count values(Processes.user) as user values(Processes.process_name) as process_name values(Processes.parent_process_name) as parent_process_name FROM datamodel=Endpoint.Processes where Processes.process_name = reg.exe by Processes.process_id | `drop_dm_object_name(""Processes"")`]",,,,,,,,,,,,,,,This search queries the Endpoint Datamodel to give you details of the latest registry values for a specific destination computer.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you need to be ingesting information on registry changes that include the name of the process responsible for the changes from your endpoints into the `Endpoint` datamodel in the `Processes` and `Registry` nodes.,None at this time,2018-08-07,2019-03-01,,ESCU - Get Registry Activities,investigative,,"[""dest""]","[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious Command-Line Executions"", ""Suspicious MSHTA Activity"", ""Suspicious Windows Registry Activities""]",,,,3600,86400,,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['ESCU - Get Risk Modifiers For Endpoint'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel:Risk.All_Risk | search risk_object_type=system risk_object={dest} | stats count sum(risk_score) as risk_score values(search_name)  min(_time) as firstTime max(_time) as lastTime by risk_object | `ctime(firstTime)` | `ctime(lastTime)`,,,,,,,,,,,,,,,"For the last 7 days, the search will query the Risk data model in Splunk Enterprise Security and calculate the count, sum of the risk_scores, names of the correlation searches that contributed to create a risk score for a specific endpoint(machine_name)",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,Enable the correlation searches included in Splunk Enterprise Security that include Risk Analysis alert actions by leveraging the Risk Analysis Framework,None at this time,2017-10-14,2017-10-19,,ESCU - Get Risk Modifiers For Endpoint,investigative,,"[""dest""]","[""Splunk Enterprise Security""]","[""Account Monitoring and Controls"", ""Apache Struts Vulnerability"", ""Asset Tracking"", ""Brand Monitoring"", ""ColdRoot MacOS RAT"", ""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""DNS Amplification Attacks"", ""Data Protection"", ""Disabling Security Tools"", ""Dynamic DNS"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Host Redirection"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor Backup Solution"", ""Monitor for Unauthorized Software"", ""Monitor for Updates"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""Router & Infrastructure Security"", ""SQL Injection"", ""SamSam Ransomware"", ""Spectre And Meltdown Vulnerabilities"", ""Splunk Enterprise Vulnerability"", ""Splunk Enterprise Vulnerability CVE-2018-11409"", ""Suspicious Command-Line Executions"", ""Suspicious DNS Traffic"", ""Suspicious Emails"", ""Suspicious MSHTA Activity"", ""Suspicious WMI Use"", ""Suspicious Windows Registry Activities"", ""Unusual Processes"", ""Use of Cleartext Protocols"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Log Manipulation"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,"[""Risk""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['ESCU - Get Risk Modifiers For User'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel:Risk.All_Risk | search risk_object_type=user risk_object={user} | stats count sum(risk_score) as risk_score values(search_name)  min(_time) as firstTime max(_time) as lastTime by risk_object |`ctime(firstTime)` |`ctime(lastTime)`,,,,,,,,,,,,,,,"For the last 7 days, the search will query the Risk data model in Splunk Enterprise Security and calculate the count, sum of the risk_scores, names of the correlation searches that contributed to create a risk score for a specific user",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,Enable the correlation searches included in Splunk Enterprise Security that include Risk Analysis alert actions by leveraging the Risk Analysis Framework,None at this time,2017-10-14,2017-10-19,,ESCU - Get Risk Modifiers For User,investigative,,"[""user""]","[""Splunk Enterprise Security""]","[""Account Monitoring and Controls"", ""Apache Struts Vulnerability"", ""Asset Tracking"", ""Brand Monitoring"", ""ColdRoot MacOS RAT"", ""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""DNS Amplification Attacks"", ""Data Protection"", ""Disabling Security Tools"", ""Dynamic DNS"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Host Redirection"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor Backup Solution"", ""Monitor for Unauthorized Software"", ""Monitor for Updates"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""Router & Infrastructure Security"", ""SQL Injection"", ""SamSam Ransomware"", ""Spectre And Meltdown Vulnerabilities"", ""Splunk Enterprise Vulnerability"", ""Suspicious Command-Line Executions"", ""Suspicious DNS Traffic"", ""Suspicious Emails"", ""Suspicious MSHTA Activity"", ""Suspicious WMI Use"", ""Suspicious Windows Registry Activities"", ""Unusual Processes"", ""Use of Cleartext Protocols"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Log Manipulation"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,"[""Risk""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get Sysmon WMI Activity for Host'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"" EventCode>18 EventCode<22 host={dest} | rename host as dest | table _time, dest, user, Name, Operation, EventType, Type, Query, Consumer, Filter",,,,,,,,,,,,,,,This search queries Sysmon WMI events for the host of interest.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search, you must be collecting Sysmon data using Sysmon version 6.1 or greater and have Sysmon configured to generate events for WMI activity. In addition, you must have at least version 6.0.4 of the Sysmon TA installed to properly parse the fields.",None at this time,2018-10-23,2018-10-23,,ESCU - Get Sysmon WMI Activity for Host,investigative,,"[""process"", ""dest""]","[""Sysmon""]","[""Ransomware"", ""Suspicious WMI Use""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['ESCU - Get Update Logs For Endpoint'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| from datamodel Updates.Updates  | search (vendor_product=""Microsoft Windows"" OR vendor_product=""OSX:Update"" OR vendor_product=""Linux:Update"") dest={dest}",,,,,,,,,,,,,,,This search will tell you give you the update logs for a specific endpoint for the last week.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,You need to be ingesting the update logs from your various systems.,None at this time,2017-08-24,2017-08-24,,ESCU - Get Update Logs For Endpoint,investigative,,"[""dest""]","[""Microsoft Windows"", ""Linux"", ""macOS""]","[""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware""]",,,,3600,86400,,,,,,"[""Updates""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get User Information from Identity Table'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| `identities` | search identity={user} | table _time, identity, first, last, email, category, watchlist",,,,,,,,,,,,,,,Gather more information about the user identified in the Notable Event.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you must have populated the identity table with information about your users.,None at this time,2017-04-10,2017-09-20,,ESCU - Get User Information from Identity Table,investigative,,"[""user""]","[""Splunk Enterprise Security""]","[""AWS Cryptomining"", ""AWS Network ACL Activity"", ""Account Monitoring and Controls"", ""Apache Struts Vulnerability"", ""Asset Tracking"", ""Brand Monitoring"", ""ColdRoot MacOS RAT"", ""Collection and Staging"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""Data Protection"", ""Disabling Security Tools"", ""Dynamic DNS"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Host Redirection"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Malicious PowerShell"", ""Monitor for Unauthorized Software"", ""Monitor for Updates"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""Router & Infrastructure Security"", ""SQL Injection"", ""SamSam Ransomware"", ""Spectre And Meltdown Vulnerabilities"", ""Splunk Enterprise Vulnerability"", ""Suspicious AWS EC2 Activities"", ""Suspicious AWS Login Activities"", ""Suspicious AWS S3 Activities"", ""Suspicious Command-Line Executions"", ""Suspicious DNS Traffic"", ""Suspicious Emails"", ""Suspicious MSHTA Activity"", ""Suspicious WMI Use"", ""Suspicious Windows Registry Activities"", ""Unusual Processes"", ""Use of Cleartext Protocols"", ""Windows Defense Evasion Tactics"", ""Windows File Extension and Association Abuse"", ""Windows Log Manipulation"", ""Windows Persistence Techniques"", ""Windows Privilege Escalation"", ""Windows Service Abuse""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['ESCU - Get Vulnerability Logs For Endpoint'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel Vulnerabilities.Vulnerabilities | search dest={dest},,,,,,,,,,,,,,,This search will show you any vulnerabilities noted for a specific endpoint for the last week.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,You need to be ingesting the logs from your vulnerability scanner.,None at this time,2017-08-24,2017-09-10,,ESCU - Get Vulnerability Logs For Endpoint,investigative,,"[""dest""]","[""Nessus""]","[""ColdRoot MacOS RAT"", ""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware""]",,,,3600,86400,,,,,,"[""Vulnerabilities""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Get Web Session Information via session_id'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search sourcetype=stream:http {session_id} | stats values(url) values(http_user_agent) by src_ip status,,,,,,,,,,,,,,,"This search helps an analyst investigate a notable event to find out more about a specific web session. The search looks for a specific web session ID in the HTTP web traffic and outputs the URL and user agents, grouped by source IP address and HTTP status code.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,This search leverages data extracted from Stream:HTTP. You must configure the HTTP stream using the Splunk Stream App on your Splunk Stream deployment server.,None at this time,2018-10-08,2018-10-08,,ESCU - Get Web Session Information via session_id,investigative,,"[""session_id""]","[""Splunk Stream""]","[""Web Fraud Detection""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Investigate AWS User Activities by user field'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search sourcetype=aws:cloudtrail user={user} | table _time userIdentity.type userIdentity.userName userIdentity.arn aws_account_id src awsRegion eventName eventType,,,,,,,,,,,,,,,"This search lists all the logged CloudTrail activities by a specific user and will create a table containing the source of the user, the region of the activity, the name and type of the event, the action taken, and the user's identity information.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-03-12,2018-03-12,,ESCU - Investigate AWS User Activities by user field,investigative,,"[""user""]","[""AWS""]","[""AWS User Monitoring""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - First Time Account Access'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| from inputlookup:access_tracker | stats min(firstTime) as firstTime,values(dest) as dest by user | sort 100 - firstTime | `uitime(firstTime)` | fields dest user firstTime",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Investigate AWS activities via region name'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| search sourcetype=aws:cloudtrail awsRegion={awsRegion}| rename requestParameters.instancesSet.items{}.instanceId as instanceId| stats values(eventName) by userName instanceId,,,,,,,,,,,,,,,"This search lists all the user activities logged by CloudTrail for a specific region in question and will create a table of the values of parameters requested, the type of the event and the response from the AWS API by each user",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",None at this time,2018-02-09,2018-02-09,,ESCU - Investigate AWS activities via region name,investigative,,"[""awsRegion""]","[""AWS""]","[""AWS Cryptomining"", ""Suspicious AWS EC2 Activities"", ""Suspicious AWS S3 Activities""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['ESCU - Investigate Network Traffic From src_ip'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel Network_Traffic.All_Traffic | search src_ip={src_ip},,,,,,,,,,,,,,,This search allows you to find all the network traffic from a specific IP address.,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search, you must be ingesting your web-traffic logs and populating the web data model.",None at this time,2018-06-15,2018-06-15,,ESCU - Investigate Network Traffic From src_ip,investigative,,"[""src_ip""]","[""Splunk Stream"", ""Bro"", ""Palo Alto Firewall""]","[""ColdRoot MacOS RAT"", ""Splunk Enterprise Vulnerability CVE-2018-11409""]",,,,3600,86400,,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication where'],['ESCU - Investigate Successful Remote Desktop Authentications'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Authentication where Authentication.signature_id=4624 Authentication.app=win:remote by Authentication.src Authentication.dest Authentication.app Authentication.user Authentication.signature Authentication.src_nt_domain | `ctime(lastTime)` | `ctime(firstTime)` | `drop_dm_object_name(""Authentication"")`| table firstTime lastTime src src_nt_domain dest user app count | sort count",,,,,,,,,,,,,,,"This search returns the source, destination, and user for all successful remote-desktop authentications. A successful authentication after a brute-force attack on a destination machine is suspicious behavior.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,You must be populating the Authentication data model with security events from your Windows event logs.,None at this time,2018-12-14,2018-12-14,,ESCU - Investigate Successful Remote Desktop Authentications,investigative,,"[""dest""]","[""Microsoft Windows""]","[""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Ransomware"", ""SamSam Ransomware""]",,,,3600,86400,,,,,,"[""Authentication""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Investigate Suspicious Strings in HTTP Header'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| search sourcetype=stream:http src_ip=""{src_ip}"" dest_ip=""{dest_ip}"" | eval cs_content_type_length = len(cs_content_type) | search cs_content_type_length > 100 | rex field=""cs_content_type"" (?<suspicious_strings>cmd.exe) | eval suspicious_strings_found=if(match(cs_content_type, ""application""), ""True"", ""False"")  | rename suspicious_strings_found AS ""Suspicious Content-Type Found"" | fields ""Suspicious Content-Type Found"", dest_ip, src_ip, suspicious_strings, cs_content_type, cs_content_type_length, url",,,,,,,,,,,,,,,"This search helps an analyst investigate a notable event related to a potential Apache Struts exploitation. To investigate, we will want to isolate and analyze the ""payload"" or the commands that were passed to the vulnerable hosts by creating a few regular expressions to carve out the commands focusing on common keywords from the payload, such as cmd.exe, /bin/bash and whois. The search returns these suspicious strings found in the HTTP logs of the system of interest.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,This particular search leverages data extracted from Stream:HTTP. You must configure the http stream using the Splunk Stream App on your Splunk Stream deployment server to extract the cs_content_type field.,None at this time,2017-06-26,2017-10-20,,ESCU - Investigate Suspicious Strings in HTTP Header,investigative,,"[""src_ip"", ""dest_ip""]","[""Splunk Stream""]","[""Apache Struts Vulnerability""]",,,,3600,86400,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['ESCU - Investigate Web Activity From Host'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel Web.Web | search src={dest},,,,,,,,,,,,,,,"This search allows you to find all the web activity from a specific host. During an investigation, it is important to profile web activity to characterize user or host activity.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,To successfully implement this search you must be ingesting your web traffic and populating the Web data model.,None at this time,2017-04-21,2017-11-09,,ESCU - Investigate Web Activity From Host,investigative,,"[""dest""]","[""Splunk Stream"", ""Bro"", ""Bluecoat"", ""Palo Alto Firewall""]","[""Brand Monitoring"", ""Command and Control"", ""Credential Dumping"", ""DHS Report TA18-074A"", ""Disabling Security Tools"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Host Redirection"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Netsh Abuse"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware"", ""Suspicious Command-Line Executions"", ""Suspicious Emails"", ""Unusual Processes""]",,,,3600,86400,,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['ESCU - Investigate Web Activity From src_ip'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel Web.Web | search src={src_ip},,,,,,,,,,,,,,,"This search searches for all web activity from a specific host. During an investigation, it is important to profile web activity to characterize user or host activity.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search, you must be ingesting your web traffic and populating the web data model.",None at this time,2018-06-15,2018-06-15,,ESCU - Investigate Web Activity From src_ip,investigative,,"[""src_ip""]","[""Splunk Stream"", ""Bro"", ""Bluecoat"", ""Palo Alto Firewall""]","[""ColdRoot MacOS RAT"", ""Dynamic DNS"", ""Splunk Enterprise Vulnerability CVE-2018-11409""]",,,,3600,86400,,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web by'],['ESCU - Investigate Web POSTs From src'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Web.url) as url from datamodel=Web by Web.src,Web.http_user_agent,Web.http_method | `drop_dm_object_name(""Web"")`| where like(src, ""{src}"") and like(http_method, ""POST"")",,,,,,,,,,,,,,,"This investigative search retrieves POST requests from a specified source IP or hostname. Identifying the POST requests, as well as their associated destination URLs and user agent(s), may help you scope and characterize the suspicious traffic.",,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,none,"To successfully implement this search, you must be ingesting your web-traffic logs and populating the web data model.",None at this time,2018-12-06,2018-12-06,,ESCU - Investigate Web POSTs From src,investigative,,"[""src""]","[""Splunk Stream"", ""Bro"", ""Bluecoat"", ""Palo Alto Firewall""]","[""Apache Struts Vulnerability""]",,,,3600,86400,,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Add Prohibited Processes to Enterprise Security'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| inputlookup interesting_processes_lookup | search note!=ESCU* | inputlookup append=T prohibitedProcesses_lookup | fillnull value=* dest dest_pci_domain | fillnull value=false is_required is_secure | fillnull value=true is_prohibited | outputlookup interesting_processes_lookup | stats count,-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search outputs the interesting processes lookup table and filters out all processes in the table that haven't already been inserted by ESCU. It then appends to those results all the processes currently identified by ESCU that should be prohibited. Next, it fills in the required fields with processes identified by ESCU, and then writes the results back to the interesting process lookup table. This is done so any new processes identified that should be prohibited will be added to the lookup table without creating any duplicate entries.",This search should be run on each new install of ESCU.,,2017-06-27,2017-09-15,,ESCU - Add Prohibited Processes to Enterprise Security,support,,,"[""Splunk Enterprise Security""]","[""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Ransomware"", ""SamSam Ransomware""]",,,,,,,,,,,[],,,"This search takes the existing interesting process table from ES, filters out any existing additions added by ESCU and then updates the table with processes identified by ESCU that should be prohibited on your endpoints.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Baseline of API Calls per User ARN'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventType=AwsApiCall | spath output=arn path=userIdentity.arn | bucket _time span=1h | stats count as apiCalls by _time, arn | stats count(apiCalls) as numDataPoints, latest(apiCalls) as latestCount, avg(apiCalls) as avgApiCalls, stdev(apiCalls) as stdevApiCalls by arn | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup api_call_by_user_baseline | stats count",-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search returns all log events that are API calls, pulls out the ARN that initiated each call, and collects them in one-hour groupings. Next, it calculates the number of API calls made per ARN per hour. For each ARN, it calculates the average and standard deviation of this count on a per-hour basis.  It also includes the number of data points each ARN had. This table is then stored in a lookup file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs.",,2018-04-09,2018-04-09,,ESCU - Baseline of API Calls per User ARN,support,,,"[""AWS""]","[""AWS User Monitoring""]",,,,,,,,,,,,,,"This search establishes, on a per-hour basis, the average and the standard deviation of the number of API calls made by each user. Also recorded is the number of data points for each user. This table is then outputted to a lookup file to allow the detection search to operate quickly.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Baseline of Network ACL Activity by ARN'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail `NetworkACLEvents` | spath output=arn path=userIdentity.arn | bucket _time span=1h | stats count as apiCalls by _time, arn | stats count(apiCalls) as numDataPoints, latest(apiCalls) as latestCount, avg(apiCalls) as avgApiCalls, stdev(apiCalls) as stdevApiCalls by arn | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup network_acl_activity_baseline | stats count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"Use this search to create a baseline for API calls related to network ACLs for the users who initiated this activity. It returns all logged API calls for network activity, pulls out the ARN that initiated each call, and collects the `eventNames` in one-hour groupings. Next, it calculates the number of API calls made per ARN per-hour. For each ARN, it calculates the average and standard deviation of this count on a per-hour basis. It also includes the number of data points for each ARN. This table is stored in a lookup file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs. To add or remove API event names for network ACLs, edit the macro `NetworkACLEvents`.",,2018-05-21,2018-05-21,,ESCU - Baseline of Network ACL Activity by ARN,support,,,"[""AWS""]","[""AWS Network ACL Activity""]",,,,,,,,,,,,,,"This search establishes, on a per-hour basis, the average and the standard deviation of the number of API calls that were related to network ACLs made by each user. Also recorded is the number of data points for each user. This table is then outputted to a lookup file to allow the detection search to operate quickly.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - First Time Account Access Over Time'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| inputlookup append=T access_tracker where `tracker_trp(firstTime_user,firstTime_user)` | rename firstTime as _time | timechart count",-30d@d,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Baseline of S3 Bucket deletion activity by ARN'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=DeleteBucket | spath output=arn path=userIdentity.arn | bucket _time span=1h | stats count as apiCalls by _time, arn | stats count(apiCalls) as numDataPoints, latest(apiCalls) as latestCount, avg(apiCalls) as avgApiCalls, stdev(apiCalls) as stdevApiCalls by arn | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup s3_deletion_baseline | stats count",-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"Use this search to create a baseline for API calls related to deleting an S3 bucket, grouped by the users who initiated this activity. It returns all logged API calls for S3 bucket-deletion activity and then pulls out the ARN that initiated each call. Next, it calculates the number of API calls made per ARN per hour. For each ARN, it calculates the average and standard deviation of this count on a per-hour basis. It also includes the number of data points for each ARN. This table is stored in a lookup file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs.",,2018-07-17,2018-07-17,,ESCU - Baseline of S3 Bucket deletion activity by ARN,support,,,"[""AWS""]","[""Suspicious AWS S3 Activities""]",,,,,,,,,,,,,,"This search establishes, on a per-hour basis, the average and standard deviation for the number of API calls related to deleting an S3 bucket by each user. Also recorded is the number of data points for each user. This table is then outputted to a lookup file to allow the detection search to operate quickly.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Baseline of Security Group Activity by ARN'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail `securityGroupAPIs` | spath output=arn path=userIdentity.arn | bucket _time span=1h | stats count as apiCalls by _time, arn | stats count(apiCalls) as numDataPoints, latest(apiCalls) as latestCount, avg(apiCalls) as avgApiCalls, stdev(apiCalls) as stdevApiCalls by arn | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup security_group_activity_baseline | stats count",-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"Use this search to create a baseline for API calls related to security groups by the users who initiated this activity. It returns all logged API calls for all security-group-related activity, pulls out the ARN that initiated each call, and collects the `eventNames` in one-hour groupings. Next, it calculates the number of API calls made per ARN per hour. For each ARN, it calculates the average and standard deviation of this count on a per-hour basis. It also includes the number of data points for each ARN. This table is stored in a lookup file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs. To add or remove API event names for security groups, edit the macro `securityGroupAPIs`.",,2018-04-17,2018-04-17,,ESCU - Baseline of Security Group Activity by ARN,support,,,"[""AWS""]","[""AWS User Monitoring""]",,,,,,,,,,,,,,"This search establishes, on a per-hour basis, the average and the standard deviation for the number of API calls related to security groups made by each user. Also recorded is the number of data points for each user. This table is then outputted to a lookup file to allow the detection search to operate quickly.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Baseline of blocked outbound traffic from AWS'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudwatchlogs:vpcflow action=blocked (src_ip=10.0.0.0/8 OR src_ip=172.16.0.0/12 OR src_ip=192.168.0.0/16) ( dest_ip!=10.0.0.0/8 AND dest_ip!=172.16.0.0/12 AND dest_ip!=192.168.0.0/16) | bucket _time span=1h | stats count as numberOfBlockedConnections by _time, src_ip | stats count(numberOfBlockedConnections) as numDataPoints, latest(numberOfBlockedConnections) as latestCount, avg(numberOfBlockedConnections) as avgBlockedConnections, stdev(numberOfBlockedConnections) as stdevBlockedConnections by src_ip | table src_ip, latestCount, numDataPoints, avgBlockedConnections, stdevBlockedConnections | outputlookup baseline_blocked_outbound_connections | stats count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"Use this search to create a baseline of blocked outbound network connections by each source IP in your AWS environment. This search returns all log events that correspond to a blocked outbound network connection, extracts the source IP from where the outbound connection was initiated, and collects the events in one-hour groupings. Next, it calculates the number of outbound connections blocked per hour. For each source IP, it calculates the average and standard deviation of this count on a per-hour basis.  It also includes the number of data points each source IP had. This table is then stored in a lookup file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your `VPC flow logs.`.",,2018-04-26,2018-05-07,,ESCU - Baseline of blocked outbound traffic from AWS,support,,,"[""AWS""]","[""AWS Network ACL Activity"", ""Command and Control"", ""Suspicious AWS Traffic""]",,,,,,,,,,,,,,"This search establishes, on a per-hour basis, the average and the standard deviation of the number of outbound connections blocked in your VPC flow logs by each source IP address (IP address of your EC2 instances). Also recorded is the number of data points for each source IP. This table outputs to a lookup file to allow the detection search to operate quickly.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic by'],['ESCU - Count of Unique IPs Connecting to Ports'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count dc(All_Traffic.src) as numberOfUniqueHosts from datamodel=Network_Traffic by All_Traffic.dest_port | `drop_dm_object_name(""All_Traffic"")` | sort - count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"For each port being accessed on the network, this search gives the total number of connections observed, and the number of unique IP addresses making those connections.","To successfully implement this search, you must be ingesting network traffic, and populating the Network_Traffic data model.",,2017-06-24,2017-09-13,,ESCU - Count of Unique IPs Connecting to Ports,support,,,"[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""Prohibited Traffic Allowed or Protocol Mismatch""]",,,,,,,,,,,"[""Network_Traffic""]",,,"The search counts the number of times a connection was observed to each destination port, and the number of unique source IPs connecting to them.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Identity_Management.All_Assets'],['ESCU - Count of assets by category'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| from datamodel Identity_Management.All_Assets | stats count values(nt_host) by category | sort -count,-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,This search gives you the number and the names of the hosts of each host in your environment by category. It will then sort them by the count.,To successfully implement this search you must first leverage the Assets and Identity framework in Enterprise Security to populate your assets_by_str.csv file which should then be mapped to the Identity_Management data model. The Identity_Management data model will contain a list of known authorized company assets. Ensure that all inventoried systems are constantly vetted and updated.,,2017-06-11,2017-09-13,,ESCU - Count of assets by category,support,,,"[""Splunk Enterprise Security""]","[""Asset Tracking""]",,,,,,,,,,,"[""Identity_Management""]",,,This search shows you every asset category you have and the assets that belong to those categories.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Create a list of approved AWS service accounts'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail errorCode=success | rename userName as identity | search NOT [inputlookup identity_lookup_expanded | fields identity] | stats count by identity | table identity | outputlookup aws_service_accounts | stats count,-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,We first look for all successful CloudTrail API activity caused by types of user accounts and then remove all the events caused by users in the Identity table. This generates a list of accounts--typically service accounts--configured in your AWS environment. We output this list of service accounts to `aws_service_accounts.csv`.,"You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Please validate the service account entires in `aws_service_accounts.csv`, which is a lookup file created as a result of running this support search. Please remove the entries of service accounts that are not legitimate.",,2018-03-12,2018-12-03,,ESCU - Create a list of approved AWS service accounts,support,,,"[""AWS""]","[""AWS User Monitoring""]",,,,,,,,,,,,,,"This search looks for successful API activity in CloudTrail within the last 30 days, filters out known users from the identity table, and outputs values of users into <code>aws_service_accounts.csv</code> lookup file.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - DNSTwist Domain Names'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| dnstwist domainlist=domains.csv | `remove_valid_domains` | eval domain_abuse=""true"" | table domain, domain_abuse | outputlookup brandMonitoring_lookup | stats count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search starts with the dnstwist command consuming domains from a file called domains.csv in the DA-ESS-SOC/lookups directory. This search then adds a domain_abuse=true term to each permutation, removes all the valid domain names and stores all that information into a lookup file that is used in the associated detection search. Alternatively domain dnstwist permutations can be calculated from domains in the `cim_corporate_email_domains.csv` and `cim_corporate_web_domains.csv` lookups located in **Splunk_SA_CIM** using argument `populate_from_cim=true`. Also an individual domain can be passed using argument `domain=<domain>`",To successfully implement this search you need to update the file called domains.csv in the DA-ESS-SOC/lookup directory. Or `cim_corporate_email_domains.csv` and `cim_corporate_web_domains.csv` from **Splunk_SA_CIM**.,,2017-06-01,2018-10-08,,ESCU - DNSTwist Domain Names,support,,,"[""Splunk Enterprise""]","[""Brand Monitoring""]",,,,,,,,,,,,,,"This search creates permutations of your existing domains, removes the valid domain names and stores them in a specified lookup file so they can be checked for in the associated detection searches.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution where'],['ESCU - Discover DNS records'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| inputlookup cim_corporate_email_domains.csv | inputlookup append=T cim_corporate_web_domains.csv | inputlookup append=T cim_cloud_domains.csv | eval domain = trim(replace(domain, ""*"", """")) | join domain [|tstats summariesonly=true count values(DNS.record_type) as type, values(DNS.answer) as answer from datamodel=Network_Resolution where DNS.message_type=RESPONSE DNS.answer!=""unknown"" DNS.answer!="""" by DNS.query | rename DNS.query as query | where query!=""unknown"" | rex field=query ""(?<domain>w+.w+?)(?:$|/)""] | makemv delim="" "" answer |  makemv delim="" "" type | sort -count | table count,domain,type,query,answer | outputlookup createinapp=true discovered_dns_records.csv",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,Discover the DNS records and their answers for domains owned by the company using network traffic events. The discovered events are exported as a lookup named `discovered_dns_records.csv`,"To successfully implement this search, you must be ingesting DNS logs, and populating the Network_Resolution data model. Also make sure that the cim_corporate_web_domains and cim_corporate_email_domains lookups are populated with the domains owned by your corporation",Please vet the lookup created by this baseline search,2019-02-14,2019-02-14,,ESCU - Discover DNS records,support,,"[""query"", ""answer""]","[""Splunk Stream"", ""Bro""]","[""DNS Hijacking""]",,,,,,,,,,,"[""Network_Resolution""]",,,"The search takes corporate and common cloud provider domains configured under `cim_corporate_email_domains.csv`, `cim_corporate_web_domains.csv`, and `cloud_domains.csv` finds their responses across the last 30 days from data in the `Network_Resolution ` datamodel, then stores the output under the `discovered_dns_records.csv` lookup",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Identify Systems Creating Remote Desktop Traffic'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Traffic where All_Traffic.dest_port=3389 by All_Traffic.src | `drop_dm_object_name(""All_Traffic"")` | sort - count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search counts the numbers of times the system has tried to connect to another system on TCP/3389, the default port used for RDP traffic.","To successfully implement this search, you must ingest network traffic and populate the Network_Traffic data model.",,2017-04-24,2017-09-15,,ESCU - Identify Systems Creating Remote Desktop Traffic,support,,,"[""Splunk Stream"", ""Bro""]","[""Hidden Cobra Malware"", ""Lateral Movement""]",,,,,,,,,,,"[""Network_Traffic""]",,,This search counts the numbers of times the system has generated remote desktop traffic.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Identify Systems Receiving Remote Desktop Traffic'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Traffic where All_Traffic.dest_port=3389 by All_Traffic.dest | `drop_dm_object_name(""All_Traffic"")` | sort - count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search counts the numbers of times the system has received a connection to TCP/ 3389, the default port used for RDP traffic.","To successfully implement this search you must ingest network traffic and populate the Network_Traffic data model. If a system receives a lot of remote desktop traffic, you can apply the category common_rdp_destination to it.",,2017-04-24,2017-09-15,,ESCU - Identify Systems Receiving Remote Desktop Traffic,support,,,"[""Splunk Stream"", ""Bro""]","[""Hidden Cobra Malware"", ""Lateral Movement""]",,,,,,,,,,,"[""Network_Traffic""]",,,This search counts the numbers of times the system has created remote desktop traffic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - Inactive Accounts'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| `inactive_accounts(90)` | sort 100 + lastTime | `uitime(lastTime)` | fields user lastTime inactiveDays,,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Identify Systems Using Remote Desktop'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Endpoint.Processes where Processes.process_name=""*mstsc.exe*"" by Processes.dest Processes.process_name | `drop_dm_object_name(Processes)` | sort - count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search counts the numbers of times the remote desktop process, mstsc.exe, has run on each system. It does this by looking for the process name in the Endpoint data model.",To successfully implement this search you must be ingesting endpoint data that records process activity.,,2017-04-18,2019-04-01,,ESCU - Identify Systems Using Remote Desktop,support,,,"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Hidden Cobra Malware"", ""Lateral Movement""]",,,,,,,,,,,"[""Endpoint""]",,,"This search counts the numbers of times the remote desktop process, mstsc.exe, has run on each system.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Monitor Successful Backups'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""netbackup_logs"" ""Disk/Partition backup completed successfully."" | bucket _time span=1d | stats dc(COMPUTERNAME) as count values(COMPUTERNAME) as dest by _time, MESSAGE",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,This search gives you the count and the hostname of all the systems that had a successful backup each day.,To successfully implement this search you must be ingesting your backup logs.,,2017-08-24,2017-09-12,,ESCU - Monitor Successful Backups,support,,,"[""Netbackup""]","[""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor Backup Solution"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware""]",,,,,,,,,,,,,,This search is intended to give you a feel for how often successful backups are conducted in your environment. Fluctuations in these numbers will allow you to determine when you should investigate.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Monitor Unsuccessful Backups'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=""netbackup_logs"" ""An error occurred, failed to backup."" | bucket _time span=1d | stats dc(COMPUTERNAME) as count values(COMPUTERNAME) as dest by _time, MESSAGE",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,This search gives you the count and hostname of all the systems that had a backup failure each day,To successfully implement this search you must be ingesting your backup logs.,,2017-08-24,2017-09-12,,ESCU - Monitor Unsuccessful Backups,support,,,"[""Netbackup""]","[""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor Backup Solution"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware""]",,,,,,,,,,,,,,This search is intended to give you a feel for how often backup failures happen in your environments.  Fluctuations in these numbers will allow you to determine when you should investigate.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen AWS Cross Account Activity'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=AssumeRole | spath output=requestingAccountId path=userIdentity.accountId | spath output=requestedAccountId path=resources{}.accountId | search requestingAccountId=* | where requestingAccountId!=requestedAccountId | stats earliest(_time) as firstTime latest(_time) as lastTime by requestingAccountId, requestedAccountId | outputlookup previously_seen_aws_cross_account_activity | stats count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we look for **AssumeRole** events where the requesting account is different from the requested account. The first and last times these events are seen are written to a lookup file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Validate the user name entries in `previously_seen_aws_cross_account_activity.csv`, a lookup file created by this support search.",,2018-06-04,2018-06-04,,ESCU - Previously Seen AWS Cross Account Activity,support,,,"[""AWS""]","[""AWS Cross Account Activity""]",,,,,,,,,,,,,,"This search looks for <b>AssumeRole</b> events where the requesting account differs from the requested account, then writes these relationships to a lookup file.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen AWS Provisioning Activity Sources'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | stats earliest(_time) as firstTime, latest(_time) as lastTime by sourceIPAddress, City, Region, Country | outputlookup previously_seen_provisioning_activity_src.csv | stats count",-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search includes any event name that begins with ""run"" or ""create,"" and then determines the first and last time these events were seen for each IP address that initiated the action. The search then consults a **GeoIP** database to determine the physical location of this IP address. This table outputs to a file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",,2018-03-16,2018-03-16,,ESCU - Previously Seen AWS Provisioning Activity Sources,support,,,"[""AWS""]","[""AWS Suspicious Provisioning Activities""]",,,,,,,,,,,,,,This search builds a table of the first and last times seen for every IP address (along with its physical location) previously associated with cloud-provisioning activity. This is broadly defined as any event that runs or creates something.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen AWS Regions'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail StartInstances | stats earliest(_time) as earliest latest(_time) as latest by awsRegion | outputlookup previously_seen_aws_regions.csv | stats count,-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we create a table of the first time (earliest) and most recent time (latest) that this region has been seen in our dataset, grouped by the value `awsRegion`. We only look for those events where an instance has been started. All of these entries will be added to the `previously_seen_aws_regions.csv` lookup file, which will act like a baseline for detections. Please validate the entries of region names in the lookup file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs.",,2018-01-08,2018-01-08,,ESCU - Previously Seen AWS Regions,support,,,"[""AWS""]","[""AWS Cryptomining"", ""Suspicious AWS EC2 Activities""]",,,,,,,,,,,,,,This search looks for CloudTrail events where an AWS instance is started and creates a baseline of most recent time (latest) and the first time (earliest) we've seen this region in our dataset grouped by the value awsRegion for the last 30 days,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen EC2 AMIs'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success | rename requestParameters.instancesSet.items{}.imageId as amiID | stats earliest(_time) as earliest latest(_time) as latest by amiID | outputlookup previously_seen_ec2_amis.csv | stats count,-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we create a table of the earliest and latest time that a specific AMI ID has been seen. This table is then outputted to a csv file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs.",,2018-03-12,2018-03-12,,ESCU - Previously Seen EC2 AMIs,support,,,"[""AWS""]","[""AWS Cryptomining""]",,,,,,,,,,,,,,This search builds a table of previously seen AMIs used to launch EC2 instances,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen EC2 Instance Types'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success | rename requestParameters.instanceType as instanceType | fillnull value=""m1.small"" instanceType | stats earliest(_time) as earliest latest(_time) as latest by instanceType | outputlookup previously_seen_ec2_instance_types.csv | stats count",-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we create a table of the earliest and latest time that a specific EC2 instance type has been seen. The instanceType request field is not required and defaults to m1.small, so any time this field is null, the search defaults the field to m1.small. This table is then outputted to a csv file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs.",,2018-03-08,2018-03-08,,ESCU - Previously Seen EC2 Instance Types,support,,,"[""AWS""]","[""AWS Cryptomining""]",,,,,,,,,,,,,,This search builds a table of previously seen EC2 instance types,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen EC2 Launches By User'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success | rename userIdentity.arn as arn | stats earliest(_time) as firstTime latest(_time) as lastTime by arn | outputlookup previously_seen_ec2_launches_by_user.csv | stats count,-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we create a table of the earliest and latest times that an ARN has launched a EC2 instance. This table is then outputted to a csv file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs.",,2018-03-15,2018-03-15,,ESCU - Previously Seen EC2 Launches By User,support,,,"[""AWS""]","[""AWS Cryptomining"", ""Suspicious AWS EC2 Activities""]",,,,,,,,,,,,,,This search builds a table of previously seen ARNs that have launched a EC2 instance.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen EC2 Modifications By User'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail `ec2ModificationAPIs` errorCode=success | spath output=arn userIdentity.arn | stats earliest(_time) as firstTime latest(_time) as lastTime by arn | outputlookup previously_seen_ec2_modifications_by_user | stats count,-90d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we create a table of the earliest and latest times that an ARN has modified a EC2 instance. The list of APIs that modify an EC2 are defined in the `ec2ModificationAPIs` macro for ease of use. This table is then outputted to a file.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS version (4.4.0 or later), then configure your CloudTrail inputs. To add or remove APIs that modify an EC2 instance, edit the macro `ec2ModificationAPIs`.",,2018-04-05,2018-04-05,,ESCU - Previously Seen EC2 Modifications By User,support,,,"[""AWS""]","[""Unusual AWS EC2 Modifications""]",,,,,,,,,,,,,,This search builds a table of previously seen ARNs that have launched a EC2 instance.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - Inactive Account Usage'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| `inactive_account_usage(90,24)` | sort 100 - lastTime | `uitime(second2lastTime)` | `uitime(lastTime)` | fields user second2lastTime lastTime inactiveDays",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously Seen Running Windows Services'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"eventtype=wineventlog_system signature_id=7036 | rex field=Message ""The (?<serviceName>[ws-]*) service entered the (?<action>w*) state"" | where action=""running"" | stats earliest(_time) as firstTime, latest(_time) as lastTime by serviceName | outputlookup previously_seen_running_windows_services | stats count",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we look for Windows system-event code that indicates a status change of a Windows service. It extracts both the name of the service and the action taken by the service from the logs. It keeps only services that have entered the running state. Finally, it finds the first time the service has been seen running across the enterprise and writes that file to a lookup table.","While this search does not require you to adhere to Splunk CIM, you must be ingesting your Windows security-event logs for it to execute successfully.",,2018-07-20,2019-02-27,,ESCU - Previously Seen Running Windows Services,support,,,"[""Microsoft Windows""]","[""DHS Report TA18-074A"", ""Disabling Security Tools"", ""Orangeworm Attack Group"", ""Windows Persistence Techniques"", ""Windows Service Abuse""]",,,,,,,,,,,,,,This collects the services that have been started across your entire enterprise.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously seen API call per user roles in CloudTrail'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail eventType=AwsApiCall errorCode=success userIdentity.type=AssumedRole | stats earliest(_time) as earliest latest(_time) as latest by userName eventName | outputlookup previously_seen_api_calls_from_user_roles | stats count,-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we are looking for successful API calls made by user roles within your AWS infrastructure. The intent is to create an initial baseline cache of names of the API calls per security role for the previous 30 days--including the earliest and latest times seen in our dataset--grouped by the value of user role and the name of the API call. It is also worth noting that the role of a particular user is parsed as ""userName"" in the CloudTrail logs.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Please validate the user role entries in `previously_seen_api_calls_from_user_roles.csv`, which is a lookup file created as a result of running this support search.",,2018-04-01,2018-04-16,,ESCU - Previously seen API call per user roles in CloudTrail,support,,,"[""AWS""]","[""AWS User Monitoring""]",,,,,,,,,,,,,,"This search looks for successful API calls made by different user roles, then creates a baseline of the earliest and latest times we have encountered this user role. It also returns the name of the API call in our dataset--grouped by user role and name of the API call--that occurred within the last 30 days. In this support search, we are only looking for events where the user identity is Assumed Role.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously seen S3 bucket access by remote IP'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:s3:accesslogs http_status=200  | stats  earliest(_time) as earliest latest(_time) as latest by bucket_name remote_ip | outputlookup previously_seen_S3_access_from_remote_ip | stats count,-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we are looking for successful S3 bucket-access attempts made from remote IPs. The intent is to create an initial baseline cache of remote IP addresses per bucket name for the previous 30 days--including the earliest and latest times seen in our dataset--grouped by the value of remote IP and the name of the S3 bucket.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your S3 access-logs inputs. You must validate the remote IP and bucket name entries in `previously_seen_S3_access_from_remote_ip.csv`, which is a lookup file created as a result of running this support search.",,2018-06-28,2018-06-28,,ESCU - Previously seen S3 bucket access by remote IP,support,,,"[""AWS""]","[""Suspicious AWS S3 Activities""]",,,,,,,,,,,,,,"This search looks for successful access to S3 buckets from remote IP addresses, then creates a baseline of the earliest and latest times we have encountered this remote IP within the last 30 days. In this support search, we are only looking for S3 access events where the HTTP response code from AWS is ""200""",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Previously seen command line arguments'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = cmd.exe Processes.process = ""* /c *"" by Processes.process | `drop_dm_object_name(Processes)`",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we look for command-line arguments using the parameter `/c` to execute processes and create an initial baseline cache for the previous 30 days. This will include the earliest and latest times a particular command-line argument is seen in our dataset, grouped by the command-line value.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must be ingesting logs with both the process name and command line from your endpoints. The complete process name with command-line arguments are mapped to the ""process"" field in the Endpoint data model.",,2018-04-09,2019-03-01,,ESCU - Previously seen command line arguments,support,,,"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""Malicious PowerShell"", ""Orangeworm Attack Group"", ""Possible Backdoor Activity Associated With MUDCARP Espionage Campaigns"", ""Suspicious Command-Line Executions""]",,,,,,,,,,,"[""Endpoint""]",,,"This search looks for command-line arguments where <code>cmd.exe /c</code> is used to execute a program, then creates a baseline of the earliest and latest times we have encountered this command-line argument in our dataset within the last 30 days.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Previously seen users in CloudTrail'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail eventName=ConsoleLogin | rename userIdentity.arn as arn | stats earliest(_time) as earliest latest(_time) as latest by arn | outputlookup previously_seen_users_console_logins.csv | stats count,-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"In this support search, we look for console login events by a particular user and create an initial baseline cache for the previous seven days, including the earliest and latest times a particular user ARN is seen in our dataset, grouped by the ARN value.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Please validate the user name entries in `previously_seen_users_console_logins.csv`, which is a lookup file created as a result of running this support search.",,2018-02-23,2018-02-23,,ESCU - Previously seen users in CloudTrail,support,,,"[""AWS""]","[""Suspicious AWS Login Activities""]",,,,,,,,,,,,,,"This search looks for CloudTrail events where a user logs into the console, then creates a baseline of the latest and earliest times we have encountered this user in our dataset, grouped by ARN, within the last 30 days.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change_Analysis.All_Changes'],['ESCU - Systems Ready for Spectre-Meltdown Windows Patch'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Change_Analysis.All_Changes where All_Changes.object_category=registry AND (All_Changes.object_path=""HKLMSoftwareMicrosoftWindowsCurrentVersionQualityCompat*"") by All_Changes.dest, All_Changes.command, All_Changes.user, All_Changes.object, All_Changes.object_path | `ctime(lastTime)` | `ctime(firstTime)` | `drop_dm_object_name(""All_Changes"")`",-1d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,"This search looks to see if a registry key was created at `HKLMSoftwareMicrosoftWindowsCurrentVersionQualityCompat`. It will tell you when it was created and, if possible, what process created it.","You need to be ingesting logs with both the process name and command-line from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",,2018-01-08,2018-01-08,,ESCU - Systems Ready for Spectre-Meltdown Windows Patch,support,,,"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Spectre And Meltdown Vulnerabilities""]",,,,,,,,,,,"[""Change_Analysis""]",,,"Some AV applications can cause the Spectre/Meltdown patch for Windows not to install successfully. This registry key is supposed to be created by the AV engine when it has been patched to be able to handle the Windows patch. If this key has been written, the system can then be patched for Spectre and Meltdown.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates where'],['ESCU - Windows Updates Install Failures'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` dc(Updates.dest) as count FROM datamodel=Updates where Updates.vendor_product=""Microsoft Windows"" AND Updates.status=failure by _time span=1d",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,This search gives you the count of the number of systems that attempted and failed to install a Windows update each day.,You must be ingesting your Windows Update Logs,,2017-08-24,2017-09-14,,ESCU - Windows Updates Install Failures,support,,,"[""Microsoft Windows""]","[""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware""]",,,,,,,,,,,"[""Updates""]",,,This search is intended to give you a feel for how often Windows updates fail to install in your environment. Fluctuations in these numbers will allow you to determine when you should be concerned.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates where'],['ESCU - Windows Updates Install Successes'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` dc(Updates.dest) as count FROM datamodel=Updates where Updates.vendor_product=""Microsoft Windows"" AND Updates.status=installed by _time span=1d",-30d@d,-10m@m,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,,This search gives you the count and name of all the systems that had a successful update applied each day,You must be ingesting your Windows Update Logs,,2017-08-24,2017-09-14,,ESCU - Windows Updates Install Successes,support,,,"[""Microsoft Windows""]","[""Command and Control"", ""DHS Report TA18-074A"", ""Emotet Malware (TA18-201A)"", ""Hidden Cobra Malware"", ""JBoss Vulnerability"", ""Lateral Movement"", ""Monitor for Unauthorized Software"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Ransomware"", ""SamSam Ransomware""]",,,,,,,,,,,"[""Updates""]",,,This search is intended to give you a feel for how often successful Windows updates are applied in your environments. Fluctuations in these numbers will allow you to determine when you should be concerned.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - Notable Access Events'],DA-ESS-AccessProtection-default,,,,,,,,,,,,`notable` | search security_domain=access | stats sum(count) as count by rule_name,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Endpoint - Host Sending Excessive Email - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` sum(All_Email.recipient_count) as count,dc(All_Email.dest) as dest_count from datamodel=Email.All_Email where NOT All_Email.src_category=""email_servers"" by ""All_Email.src"",_time span=1h | `drop_dm_object_name(""All_Email"")` | xswhere count from recipients_by_src_1h in email is above medium OR dest_count from destinations_by_src_1h in email is above medium",-70m@m,+0s,,True,number of events,greater than,0,55 * * * *,1,1,false,,,,Alerts when an host not designated as an e-mail server sends excessive e-mail to one or more target hosts.,,,,,0,1,Host Sending Excessive Email,0,endpoint,high,Host Sending Excessive Email ($src$),The device $src$ was detected making $count$ SMTP connections to $dest_count$ destinations.,src,View email-related traffic for source $src$ for this event,"| from datamodel:""Email"".""All_Email"" | where 'src'=""$src$""",,,1,src,system,80,src,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,"[    ""Endpoint - Emails By Source - Context Gen"",    ""Endpoint - Emails By Destination Count - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - SSHD Configurations By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"`sshdconfig` | stats max(_time) as _time,latest(sshd_protocol) as sshd_protocol by dest | fields _time,dest,sshd_protocol",-48h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - SELinux Configurations By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"`selinuxconfig` | stats max(_time) as _time,latest(selinux) as selinux by dest | fields _time,dest,selinux",-48h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Anomalous New Listening Port - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| from inputlookup:""listeningports_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^d""), tostring(""+0s""),  match(""+0s"", ""^([@+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"" by ""transport"",""dest_port"" | where 'dest_count'>10",-24h@h,+0s,,1,number of events,greater than,0,25 * * * *,1,1,false,,,,Alerts a series of hosts begin listening on a new port within 24 hours. This may be an indication that the devices have been compromised or have had new (and potentially vulnerable) software installed.,,,,,0,1,Anomalous New Listening Port,0,endpoint,low,Anomalous New Listening Port ($transport$/$dest_port$),$dest_count$ hosts were found to begin listening on port $transport$/$dest_port$ within the last 24 hours. This may indicate that software was recently installed on the hosts; this software may be associated with malware which oftentimes opens a backdoor using a network port.,"dest_port,transport",View systems listening on $transport$/$dest_port$,"| from datamodel:""Endpoint"".""Ports"" | search dest_port=""$dest_port$"" transport=""$transport$""",,,1,dest_port,other,40,"transport,dest_port",86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,"[""Endpoint - Listening Ports Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""inputlookup"":  {""lookupName"": ""listeningports_tracker"", ""timeField"":  ""firstTime""},         ""earliest"":     ""-24h@h"",         ""latest"":       ""+0s"",         ""aggregates"":   [{""function"": ""dc"", ""attribute"": ""dest"", ""alias"": ""dest_count""}],         ""splitby"":      [                          {""attribute"": ""transport""},                          {""attribute"": ""dest_port""}                         ],         ""resultFilter"": {""field"": ""dest_count"", ""comparator"": "">"", ""value"": ""10""}        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""transport"",""dest_port""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint"".""Ports']",['Endpoint - Host With Excessive Number Of Listening Ports - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true dc(Ports.transport_dest_port) as ""port_count"" from datamodel=""Endpoint"".""Ports""  by ""Ports.dest"" | rename ""Ports.dest"" as ""dest"" | where 'port_count'>20",-1450m@m,+0s,,1,number of events,greater than,0,10 * * * *,1,1,false,,,,Alerts when host has a high number of listening services. This may be an indication that the device is running services that are not necessary (such as a default installation of a server) or is not running a firewall.,,,,,0,1,Host With High Number Of Listening ports,0,endpoint,medium,Host With High Number Of Listening Ports ($dest$),A host ($dest$) was detected with a high number of listening ports ($port_count$).,dest,View listening ports on $dest$,"| from datamodel:""Endpoint"".""Ports"" | search dest=""$dest$""",,,1,dest,system,60,dest,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":	  ""Endpoint"",         ""object"":		  ""Ports"",         ""earliest"":      ""-1450m@m"",         ""latest"":        ""+0s"",         ""aggregates"":    [{""function"": ""dc"", ""attribute"": ""Ports.transport_dest_port"", ""alias"": ""port_count""}],         ""splitby"":       [{""attribute"": ""Ports.dest"", ""alias"": ""dest""}],         ""resultFilter"":  {""field"": ""port_count"", ""comparator"": "">"", ""value"": ""20""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['Endpoint - Host With Excessive Number Of Processes - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` max(_time) as _time from datamodel=Endpoint.Processes by Processes.dest,Processes.process | `drop_dm_object_name(""Processes"")` | eventstats max(_time) as lastReportTime by dest | where _time==lastReportTime | stats dc(process) as process_count by dest | search process_count>200",-1450m@m,+0s,,1,number of events,greater than,0,30 * * * *,1,1,false,,,,Alerts when host has a high number of processes. This may be due to an infection or a runaway process.,,,,,0,1,High Process Count,0,endpoint,medium,Host With High Process Count ($dest$),A host ($dest$) was detected with a high number of processes ($process_count$).,dest,View processes on $dest$,"| from datamodel:""Endpoint"".""Processes"" | search dest=""$dest$""",,,1,dest,system,60,dest,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint"".""Services']",['Endpoint - Host With Excessive Number Of Services - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true dc(Services.service) as ""service_count"" from datamodel=""Endpoint"".""Services""  by ""Services.dest"" | rename ""Services.dest"" as ""dest"" | where 'service_count'>100",-1450m@m,+0s,,1,number of events,greater than,0,55 * * * *,1,1,false,,,,Alerts when host has a high number of services. This may be an indication that the device is running services that are not necessary (such as a default installation of a server).,,,,,0,1,Host With High Number Of Services,0,endpoint,medium,Host With High Number Of Services ($dest$),A host ($dest$) was detected with a high number of services ($service_count$).,dest,View services on $dest$,"| from datamodel:""Endpoint"".""Services"" | search dest=""$dest$""",,,1,dest,system,60,dest,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":	  ""Endpoint"",         ""object"":		  ""Services"",         ""earliest"":      ""-1450m@m"",         ""latest"":        ""+0s"",         ""aggregates"":    [{""function"": ""dc"", ""attribute"": ""Services.service"", ""alias"": ""service_count""}],         ""splitby"":       [{""attribute"": ""Services.dest"", ""alias"": ""dest""}],         ""resultFilter"":  {""field"": ""service_count"", ""comparator"": "">"", ""value"": ""100""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Ports'],['App State - Ports By System Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Ports.dest) as dest_count from datamodel=Endpoint.Ports by Ports.transport,Ports.dest_port | `drop_dm_object_name(""Ports"")` | sort 100 - dest_count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Ports'],['App State - Systems By Port Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Ports.transport_dest_port) as port_count from datamodel=Endpoint.Ports by Ports.dest | `drop_dm_object_name(""Ports"")` | sort 10 - port_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['App State - Processes By System Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time from datamodel=Endpoint.Processes by Processes.dest,Processes.process_name | `drop_dm_object_name(""Processes"")` | eventstats max(_time) as lastReportTime by dest | where _time==lastReportTime | stats dc(dest) as dest_count by process_name | sort 100 - dest_count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Privileged Account Usage Over Time'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| `tstats` count from datamodel=Authentication.Authentication where nodename=Authentication.Privileged_Authentication by _time span=1h | timechart span=1h count,-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,connect,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['App State - Systems By Process Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time from datamodel=Endpoint.Processes by Processes.dest,Processes.process | `drop_dm_object_name(""Processes"")` | eventstats max(_time) as lastReportTime by dest | where _time==lastReportTime | stats dc(process) as process_count by dest | sort 10 - process_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['App State - Services By System Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Services.dest) as dest_count from datamodel=Endpoint.Services by Services.service | `drop_dm_object_name(""Services"")` | sort 100 - dest_count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['App State - Systems By Service Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Services.service) as service_count from datamodel=Endpoint.Services by Services.dest | `drop_dm_object_name(""Services"")` | sort 10 - service_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.All_Changes']",['Change - Abnormally High Number of Endpoint Changes By User - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| `tstats` count from datamodel=Endpoint.Filesystem where Filesystem.tag=""change"" by Filesystem.user | eval change_type=""filesystem"",user='Filesystem.user' | `tstats` append=T count from datamodel=Endpoint.Registry where Registry.tag=""change"" by Registry.user | eval change_type=if(isnull(change_type),""registry"",change_type),user=if(isnull(user),'Registry.user',user) | `tstats` append=T count from datamodel=Change.All_Changes where nodename=""All_Changes.Endpoint_Changes"" by All_Changes.change_type,All_Changes.user | eval change_type=if(isnull(change_type),'All_Changes.change_type',change_type),user=if(isnull(user),'All_Changes.user',user) | stats count as change_count by change_type,user | xswhere change_count from change_count_by_user_by_change_type_1d in change_analysis by change_type is above high",-1450m@m,+0s,,1,number of events,greater than,0,5 * * * *,1,1,false,,,,"Detects an abnormally high number of endpoint changes by user account, as they relate to restarts, audits, filesystem, user, and registry modifications.",,,,,0,1,Abnormally High Number of Endpoint Changes By User,0,,,Abnormally High Number of Endpoint Changes By User,,,,,,,1,user,user,40,"user, change_type",86300s,false,SplunkEnterpriseSecuritySuite,5,,,,"[""Change - Total Change Count By User By Change Type Per Day - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.All_Changes']",['Change - Endpoint Changes By Action'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Endpoint.Filesystem where Filesystem.tag=""change"" by Filesystem.action | eval action='Filesystem.action' | `tstats` append=T count from datamodel=Endpoint.Registry where Registry.tag=""change"" by Registry.action | eval action=if(isnull(action),'Registry.action',action) | `tstats` append=T count from datamodel=Change.All_Changes where nodename=""All_Changes.Endpoint_Changes"" by All_Changes.action | eval action=if(isnull(action),'All_Changes.action',action) | timechart minspan=10m useother=`useother` count by action",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.All_Changes']",['Change - Endpoint Changes By Type'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Endpoint.Filesystem where Filesystem.tag=""change"" | eval object_category=""file"" | `tstats` append=T count from datamodel=Endpoint.Registry where Registry.tag=""change"" | eval object_category=if(isnull(object_category),""registry"",object_category) | `tstats` append=T count from datamodel=Change.All_Changes where nodename=""All_Changes.Endpoint_Changes"" by All_Changes.object_category | eval object_category=if(isnull(object_category),'All_Changes.object_category',object_category) | stats count by object_category | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.Endpoint_Changes']",['Change - Recent Endpoint Changes'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| multisearch [| from datamodel:Endpoint.Filesystem | search tag=""change""] [| from datamodel:Endpoint.Registry | search tag=""change""] [| from datamodel:Change.Endpoint_Changes | search tag=""change""] | head 1000",-24h@h,now,,,,,,,,,0,,,,,,events,,,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,"[""object_category"", ""action"", ""object_path"", ""dest""]",true,false,list,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.All_Changes']",['Change - Endpoint Changes By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Endpoint.Filesystem where Filesystem.tag=""change"" by _time,Filesystem.dest | eval object_category=""file"",dest='Filesystem.dest' | `tstats` append=T count from datamodel=Endpoint.Registry where Registry.tag=""change"" by _time,Registry.dest | eval object_category=if(isnull(object_category),""registry"",object_category),dest=if(isnull(dest),'Registry.dest',dest) | `tstats` append=T count from datamodel=Change.All_Changes where nodename=""All_Changes.Endpoint_Changes"" by _time,All_Changes.object_category,All_Changes.dest | eval object_category=if(isnull(object_category),'All_Changes.object_category',object_category),dest=if(isnull(dest),'All_Changes.dest',dest) | stats count by _time,object_category,dest | stats sparkline(sum(count)) as sparkline,values(object_category) as object_category,sum(count) as count by dest | sort 100 - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.All_Changes']",['Change - All Changes By Asset - Swimlane'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` values(Filesystem.action),values(Filesystem.file_path),values(Filesystem.dest),values(Filesystem.user),count from datamodel=Endpoint.Filesystem where Filesystem.tag=change ($constraints$) by _time span=$span$ | `sistats_values_rename(Filesystem.action,action)` | `sistats_values_rename(Filesystem.file_path,object)` | `sistats_values_rename(Filesystem.dest,dest)` | `sistats_values_rename(Filesystem.user,user)` | eval object_category=""file"" | `tstats` append=T values(Registry.action),values(Registry.registry_key_name),values(Registry.dest),values(Registry.user),count from datamodel=Endpoint.Registry where Registry.tag=change ($constraints$) by _time span=$span$ | `sistats_values_rename(Registry.action,action)` | `sistats_values_rename(Registry.registry_key_name,object)` | `sistats_values_rename(Registry.dest,dest)` | `sistats_values_rename(Registry.user,user)` | eval object_category=if(isnull(object_category),""registry"",object_category) | `tstats` append=T values(All_Changes.action) as action,values(All_Changes.object) as object,values(All_Changes.src) as src,values(All_Changes.dest) as dest,values(All_Changes.user) as user,count from datamodel=Change.All_Changes where $constraints$ by _time,All_Changes.object_category span=$span$ | `sistats_values_rename(All_Changes.action,action)` | `sistats_values_rename(All_Changes.object,object)` | `sistats_values_rename(All_Changes.src,src)` | `sistats_values_rename(All_Changes.dest,dest)` | `sistats_values_rename(All_Changes.user,user)` | eval object_category=if(isnull(object_category),'All_Changes.object_category',object_category) | stats values(action) as action,values(object) as object,values(src) as src,values(dest) as dest,values(user) as user,count by _time,object_category | stats values(action) as action,values(object_category) as object_category,values(object) as object,values(src) as src,values(dest) as dest,values(user) as user,sum(count) as count by _time",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,All Changes,green,reverse_asset_lookup,"Filesystem.src,Filesystem.dest,Registry.src,Registry.dest,All_Changes.src,All_Changes.dest,src,dest","| multisearch [| from datamodel:Endpoint.Filesystem | search tag=""change"" ($constraints$)] [| from datamodel:Endpoint.Registry | search tag=""change"" ($constraints$)] [| from datamodel:Change.All_Changes | search $constraints$]",Default,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.All_Changes']",['Change - All Changes By Identity - Swimlane'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` values(Filesystem.action),values(Filesystem.file_path),values(Filesystem.dest),values(Filesystem.user),count from datamodel=Endpoint.Filesystem where Filesystem.tag=change ($constraints$) by _time span=$span$ | `sistats_values_rename(Filesystem.action,action)` | `sistats_values_rename(Filesystem.file_path,object)` | `sistats_values_rename(Filesystem.dest,dest)` | `sistats_values_rename(Filesystem.user,user)` | eval object_category=""file"" | `tstats` append=T values(Registry.action),values(Registry.registry_key_name),values(Registry.dest),values(Registry.user),count from datamodel=Endpoint.Registry where Registry.tag=change ($constraints$) by _time span=$span$ | `sistats_values_rename(Registry.action,action)` | `sistats_values_rename(Registry.registry_key_name,object)` | `sistats_values_rename(Registry.dest,dest)` | `sistats_values_rename(Registry.user,user)` | eval object_category=if(isnull(object_category),""registry"",object_category) | `tstats` append=T values(All_Changes.action) as action,values(All_Changes.object) as object,values(All_Changes.src) as src,values(All_Changes.dest) as dest,values(All_Changes.user) as user,count from datamodel=Change.All_Changes where $constraints$ by _time,All_Changes.object_category span=$span$ | `sistats_values_rename(All_Changes.action,action)` | `sistats_values_rename(All_Changes.object,object)` | `sistats_values_rename(All_Changes.src,src)` | `sistats_values_rename(All_Changes.dest,dest)` | `sistats_values_rename(All_Changes.user,user)` | eval object_category=if(isnull(object_category),'All_Changes.object_category',object_category) | stats values(action) as action,values(object) as object,values(src) as src,values(dest) as dest,values(user) as user,count by _time,object_category | stats values(action) as action,values(object_category) as object_category,values(object) as object,values(src) as src,values(dest) as dest,values(user) as user,sum(count) as count by _time",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,All Changes,green,reverse_identity_lookup,"Filesystem.user,Registry.user,All_Changes.Account_Management.src_user,All_Changes.user,user,src_user","| multisearch [| from datamodel:Endpoint.Filesystem | search tag=""change"" ($constraints$)] [| from datamodel:Endpoint.Registry | search tag=""change"" ($constraints$)] [| from datamodel:Change.All_Changes | search $constraints$]",,,Default,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Privileged Accounts In Use'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Authentication.user_category) as user_category,dc(Authentication.dest) as dest_count,max(_time) as lastTime from datamodel=Authentication.Authentication where Authentication.user_category=privileged by Authentication.user | `drop_dm_object_name(""Authentication"")` | sort 100 - lastTime | `uitime(lastTime)`",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['911_calls'],cisco_cdr-default,,,,,,,,,,,,"`cdr_events` `911_numbers` | eval boundary=relative_time(now(),""-5min"") | where _time>boundary OR _indextime>boundary | `customizable_sites_extractions` | `get_sites` | table `911_fields`",-1h,now,search,0,number of events,greater than,0,*/5 * * * *,True,0,1,1,911 call detected.,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Inventory - Operating Systems By System Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,| from inputlookup:system_version_tracker | stats count by os,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Inventory - Users By System Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,| from inputlookup:useraccounts_tracker | stats dc(dest) as dc(dest) by user | sort 10 - dc(dest),,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Inventory - Systems By User Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,| from inputlookup:useraccounts_tracker | stats dc(user) as dc(user) by dest | sort 10 - dc(user),,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - High Number of Hosts Not Updating Malware Signatures - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| `malware_operations_tracker` | rename time_signature_version as _time | `dayDiff(_time)` | search dayDiff>7 | stats count | search count>10 | eval const_dedup_id=""Endpoint - High Number of Hosts Not Updating Malware Signatures - Rule""",0,+0s,,1,number of events,greater than,0,40 * * * *,1,1,false,,,,Alerts when a high number of hosts not updating malware signatures have been discovered.  These hosts should be evaluated to determine why they are not updating their malware signatures.,,,,,0,1,High Number of Hosts Not Updating Malware Signatures,0,endpoint,high,High Number of Hosts Not Updating Malware Signatures,A high number of hosts not updating malware signatures have been discovered.  $count$ hosts have not updated malware signatures in the last week. These hosts should be evaluated to determine why they are not updating their malware signatures.,,View systems not updating malware signatures,"| `malware_operations_tracker` | rename _time_signature_version as _time | `dayDiff(_time)` | search dayDiff>7 | sort - dayDiff | table _time,dest,dest_nt_domain,product_version,signature_version,vendor_product,dayDiff",,,,,,,const_dedup_id,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,"[""Endpoint - Malware Operations Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Malware"".""Malware_Attacks']",['Endpoint - High Number Of Infected Hosts - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true estdc(Malware_Attacks.dest) as ""infected_hosts"" from datamodel=""Malware"".""Malware_Attacks""    | where 'infected_hosts'>100 | eval const_dedup_id=""const_dedup_id""",-15d,+0s,,1,number of events,greater than,0,0 * * * *,1,1,false,,,,Alerts when a high total number of infected hosts is discovered.,,,,,0,1,High Number Of Infected Hosts,0,endpoint,high,High Number Of Infected Hosts ($infected_hosts$),A high number of total infected systems was discovered. $infected_hosts$ hosts currently have an infection that was active in the last 15 days.,,View all malware infections,"| from datamodel:""Malware"".""Malware_Attacks""",,,,,,,const_dedup_id,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":	  ""Malware"",         ""object"":		  ""Malware_Attacks"",         ""earliest"":      ""-15d"",         ""latest"":        ""+0s"",         ""aggregates"":    [{""function"": ""estdc"", ""attribute"": ""Malware_Attacks.dest"", ""alias"": ""infected_hosts""}],         ""resultFilter"":  {""field"": ""infected_hosts"", ""comparator"": "">"", ""value"": ""100""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""const_dedup_id""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Malware"".""Malware_Attacks']",['Endpoint - High Or Critical Priority Host With Malware - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| from datamodel:""Malware"".""Malware_Attacks"" | where ('dest_priority'=""high"" OR 'dest_priority'=""critical"") | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(dest_priority) as ""dest_priority"",count by ""dest"",""signature""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Alerts when an infection is noted on a host with high or critical priority.,,,,,0,1,High Or Critical Priority Host With Malware Detected,0,endpoint,high,High Or Critical Priority Host With Malware Detected,A high or critical priority host ($dest$) was detected with malware.,dest,View infections on $dest$,"| from datamodel:""Malware"".""Malware_Attacks"" | search dest=""$dest$""",,,1,dest,system,80,"dest,signature",86300s,false,SplunkEnterpriseSecuritySuite,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":	  ""Malware"",         ""object"":		  ""Malware_Attacks"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""eventFilter"":   ""('Malware_Attacks.dest_priority'=""high"" OR 'Malware_Attacks.dest_priority'=""critical"")"",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                           {""function"": ""values"", ""attribute"": ""Malware_Attacks.dest_priority"", ""alias"": ""dest_priority""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""Malware_Attacks.dest"", ""alias"": ""dest""},                           {""attribute"": ""Malware_Attacks.signature"", ""alias"": ""signature""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest"",""signature""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Malware"".""Malware_Attacks']",['Endpoint - Host With Multiple Infections - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true dc(Malware_Attacks.signature) as ""infection_count"" from datamodel=""Malware"".""Malware_Attacks""   by ""Malware_Attacks.dest"" | rename ""Malware_Attacks.dest"" as ""dest"" | where 'infection_count'>1",-1450m@m,+0s,,1,number of events,greater than,0,"5,20,35,50 * * * *",1,1,false,,,,Alerts when a host with multiple infections is discovered.,,,,,0,1,Host With Multiple Infections,0,endpoint,high,Host With Multiple Infections ($dest$),The device $dest$ was detected with multiple ($infection_count$) infections.,dest,View all infection events associated with device $dest$,"| from datamodel:""Malware"".""Malware_Attacks"" | search dest=""$dest$""",,,1,dest,system,80,dest,86300s,false,SplunkEnterpriseSecuritySuite,,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Malware"",         ""object"":        ""Malware_Attacks"",         ""earliest"":      ""-1450m@m"",         ""latest"":        ""+0s"",         ""aggregates"":    [{""function"": ""dc"", ""attribute"": ""Malware_Attacks.signature"", ""alias"": ""infection_count""}],         ""splitby"":       [{""attribute"": ""Malware_Attacks.dest"", ""alias"": ""dest""}],         ""resultFilter"":  {""field"": ""infection_count"", ""comparator"": "">"", ""value"": ""1""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Endpoint - Old Malware Infection - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` max(_time) as lastTime from datamodel=Malware.Malware_Attacks by Malware_Attacks.signature,Malware_Attacks.dest | `drop_dm_object_name(""Malware_Attacks"")` | lookup local=true malware_tracker dest,signature OUTPUT firstTime | eval dayDiff=round((lastTime-firstTime)/86400,1) | search dayDiff>30",-70m@m,+0s,,1,number of events,greater than,0,45 * * * *,1,1,false,,,,Alerts when a host with an old infection is discovered (likely a re-infection).,,,,,0,1,Host With Old Infection Or Potential Re-Infection,0,endpoint,high,Host With Old Infection Or Potential Re-Infection ($signature$ On $dest$),The device $dest$ was detected with malware '$signature$' that was present $dayDiff$ days ago. This is either an old infection or a re-infection.,"dest,signature",View all $signature$ events for $dest$,"| from datamodel:""Malware"".""Malware_Attacks"" | search dest=""$dest$"" signature=""$signature$""",,,1,dest,system,80,"dest,signature",86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,"[""Endpoint - Malware Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Infected System Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Malware_Attacks.dest) as current_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s Malware_Attacks.action=allowed | appendcols [| tstats `summariesonly` estdc(Malware_Attacks.dest) as historical_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24h@h Malware_Attacks.action=allowed] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Infected Systems,System Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Malware_Attacks.action%3Dallowed%20by%20Malware_Attacks.dest,1,0,0,all,Infected System Count,singlevalue,malware_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Multiple Infections'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,| tstats `summariesonly` dc(Malware_Attacks.signature) as infection_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s Malware_Attacks.action=allowed by Malware_Attacks.dest | search infection_count>1 | stats count as current_count | appendcols [| tstats `summariesonly` dc(Malware_Attacks.signature) as infection_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24h@h Malware_Attacks.action=allowed by Malware_Attacks.dest | search infection_count>1 | stats count as historical_count] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Multiple Infections,System Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20dc(Malware_Attacks.signature)%20as%20infection_count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Malware_Attacks.action%3Dallowed%20by%20Malware_Attacks.dest%20%7C%20search%20infection_count%3E1%20,1,0,0,all,Infected System Count,singlevalue,malware_center,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Top Access By Source'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name(""Authentication"")` | stats sparkline(sum(count),1h) as sparkline,sum(count) as count by src | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - New Infections'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_tracker | `dayDiff(firstTime)` | eval current_count=if(dayDiff<=1,1,0) | eval historical_count=if(dayDiff>1 AND dayDiff<=2,1,0) | stats sum(current_count) as current_count,sum(historical_count) as historical_count | `get_delta`",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,New Infections,Count,current_count,,delta,false,search?q=%7C%20from%20inputlookup%3Amalware_tracker%20%7C%20%60dayDiff(firstTime)%60%20,1,0,0,all,New Infections,singlevalue,malware_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Total Infection Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.signature) as infection_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s Malware_Attacks.action=allowed by Malware_Attacks.dest | stats sum(infection_count) as current_count | appendcols [| tstats `summariesonly` dc(Malware_Attacks.signature) as infection_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24h@h Malware_Attacks.action=allowed by Malware_Attacks.dest | stats sum(infection_count) as historical_count] | `get_ksi_fields(current_count,historical_count)` | xsFindBestConcept current_count from count_1d in malware as current_count_qual | xsfindbestconcept delta from percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total Infections,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20dc(Malware_Attacks.signature)%20as%20infection_count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Malware_Attacks.action%3Dallowed%20by%20Malware_Attacks.dest,1,0,0,all,Total Infections,singlevalue,malware_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Unique Malware Count'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Malware_Attacks.signature) as current_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s Malware_Attacks.action=allowed | appendcols [| tstats `summariesonly` estdc(Malware_Attacks.signature) as historical_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24h@h Malware_Attacks.action=allowed] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Malware,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Malware_Attacks.action%3Dallowed%20by%20Malware_Attacks.signature,1,0,0,all,Unique Malware Count,singlevalue,malware_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Average Infection Length'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_tracker | `dayDiff(lastTime)` | eval current_diff=if(dayDiff<=7,(lastTime-firstTime)/86400,null()) | eval historical_diff=if(dayDiff>1 AND dayDiff<=8,(lastTime-firstTime)/86400,null()) | stats avg(current_diff) as current_avg,avg(historical_diff) as historical_avg | `round(current_avg,1)` | `round(historical_avg,1)` | `get_delta(current_avg,historical_avg)`",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Avg Infection Length,Days,current_avg,,delta,false,search?q=%7C%20from%20inputlookup%3Amalware_tracker%20%7C%20%60dayDiff(lastTime)%60,1,0,0,all,Average Infection Length,singlevalue,malware_operations,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Old Malware Defintions'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_operations_tracker | rename time_signature_version as _time | `dayDiff` | eval current_count=if(dayDiff>=7,1,0) | eval historical_count=if(dayDiff>=8,1,0) | stats sum(current_count) as current_count,sum(historical_count) as historical_count | `get_delta`",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Old Malware Defs,Client Count,current_count,,delta,false,search?q=%7C%20from%20inputlookup%3Amalware_operations_tracker%20%7C%20rename%20time_signature_version%20as%20_time%20%7C%20%60dayDiff%60%20,1,0,0,all,Systems With Old Malware Definitions,singlevalue,malware_operations,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Oldest Infection'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_tracker | `dayDiff(lastTime)` | eval current_diff=if(dayDiff<=7,(lastTime-firstTime)/86400,null()) | eval historical_diff=if(dayDiff>1 AND dayDiff<=8,(lastTime-firstTime)/86400,null()) | stats max(current_diff) as current_max,max(historical_diff) as historical_max | `round(current_max,1)` | `round(historical_max,1)` | `get_delta(current_max,historical_max)`",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Oldest Infection,Days,current_max,,delta,false,search?q=%7C%20from%20inputlookup%3Amalware_tracker%20%7C%20%60dayDiff(lastTime)%60%20,1,0,0,all,Oldest Infection,singlevalue,malware_operations,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Percent Of Systems Infected'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(Malware_Attacks.dest) as current_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s Malware_Attacks.action=allowed | appendcols [| tstats `summariesonly` estdc(Malware_Attacks.dest) as historical_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24h@h Malware_Attacks.action=allowed] | appendcols [| from inputlookup:malware_operations_tracker | `daysago(30)` | stats count as total_count] | eval current_percent=round(current_count*100/total_count,1) | eval historical_percent=round(historical_count*100/total_count,1) | fields current_percent,historical_percent | `get_delta(current_percent,historical_percent)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Infected Systems,Percent,current_percent,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Malware_Attacks.action%3Dallowed%20by%20Malware_Attacks.dest,1,0,0,all,Percent Of Infected Systems,singlevalue,malware_operations,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,%,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Systems With Anti-Malware'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_operations_tracker | `dayDiff` | eval current_count=if(dayDiff<=7,1,0) | eval historical_count=if(dayDiff>1 AND dayDiff<=8,1,0) | stats sum(current_count) as current_count,sum(historical_count) as historical_count | `get_delta`",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Malware Clients,Client Count,current_count,,delta,true,search?q=%7C%20from%20inputlookup%3Amalware_operations_tracker%20%7C%20%60dayDiff%60%20,1,0,0,all,Systems With Anti-Malware,singlevalue,malware_operations,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Top Infection'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.dest) as current_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s by Malware_Attacks.signature | join type=outer Malware_Attacks.signature [| tstats `summariesonly` dc(Malware_Attacks.dest) as historical_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24@h by Malware_Attacks.signature] | `drop_dm_object_name(""Malware_Attacks"")` | sort 1 - current_count | eval label=signature."" was detected on "".current_count."" systems"" | eval label=if(current_count==1,replace(label,""systems"",""system""),label) | `get_delta` | fields label,signature,current_count,historical_count,delta",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Top Infection,$signature$,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20dc(Malware_Attacks.dest)%20as%20count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Malware_Attacks.signature,1,0,0,all,Top Infection,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Top Infected Domain'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.dest) as current_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s by Malware_Attacks.dest_nt_domain | join type=outer Malware_Attacks.dest_nt_domain [| tstats `summariesonly` dc(Malware_Attacks.dest) as historical_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24@h by Malware_Attacks.dest_nt_domain] | `drop_dm_object_name(""Malware_Attacks"")` | sort 1 - current_count | eval label=dest_nt_domain."" has "".current_count."" infected systems"" | eval label=if(current_count==1,replace(label,""systems"",""system""),label) | `get_delta` | fields label,dest_nt_domain,current_count,historical_count,delta",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Top Infected Domain,$dest_nt_domain$,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20dc(Malware_Attacks.dest)%20as%20count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Malware_Attacks.dest_nt_domain%20,1,0,0,all,Top Infected Domain,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Top Access By Destination'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Authentication.Authentication by _time,Authentication.dest span=1h | `drop_dm_object_name(""Authentication"")` | stats sparkline(sum(count),1h) as sparkline,sum(count) as count by dest | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Top Infected System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.signature) as current_count from datamodel=Malware.Malware_Attacks where earliest=-24h@h latest=+0s by Malware_Attacks.dest | join type=outer Malware_Attacks.dest [| tstats `summariesonly` dc(Malware_Attacks.signature) as historical_count from datamodel=Malware.Malware_Attacks where earliest=-48h@h latest=-24@h by Malware_Attacks.dest] | `drop_dm_object_name(""Malware_Attacks"")` | sort 1 - current_count | eval label=dest."" has "".current_count."" unique infections"" | eval label=if(current_count==1,replace(label,""infections"",""infection""),label) | `get_delta` | fields label,dest,current_count,historical_count,delta",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Top Infected System,$dest$,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20dc(Malware_Attacks.signature)%20as%20count%20from%20datamodel%3DMalware.Malware_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Malware_Attacks.dest,1,0,0,all,Top Infected System,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Application Errors'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,tag=endpoint tag=application tag=error | `get_event_id` | `parse_event_id(event_id)` | head 1000,-24h@h,now,,,,,,,,,0,,,,,,events,,,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,"[""source"", ""sourcetype"", ""host"", ""event_id""]",true,false,list,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Average Infection Length Over Time'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"index=endpoint_summary source=""Endpoint - Average Infection Length - Summary Gen"" | timechart minspan=1h avg(avg_dayDiff) as avg_dayDiff",-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,connect,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Activity Over Time'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,| `tstats` count from datamodel=Malware.Malware_Attacks by _time span=10m | timechart minspan=10m useother=`useother` count,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Activity Over Time By Action'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Malware.Malware_Attacks by _time,Malware_Attacks.action span=10m | timechart minspan=10m useother=`useother` count by Malware_Attacks.action | `drop_dm_object_name(""Malware_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,connect,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Activity Over Time By Infection'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Malware.Malware_Attacks by _time,Malware_Attacks.signature span=10m | timechart minspan=10m useother=`useother` count by Malware_Attacks.signature | `drop_dm_object_name(""Malware_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Clients By Product Version'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_operations_tracker | stats count by product_version,vendor_product | sort 100 - count",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Clients By Signature Version'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_operations_tracker | stats count by signature_version,vendor_product | sort 100 - count",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Clients Not Updating Signatures'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_operations_tracker | rename time_signature_version as _time | eval dayDiff=round((now()-_time)/86400,2) | sort 100 + _time | table _time,dest,dest_nt_domain,product_version,signature_version,vendor_product,dayDiff",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Repeat Infections'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Malware_Attacks.action) as action,count from datamodel=Malware.Malware_Attacks where Malware_Attacks.action!=allowed by _time,Malware_Attacks.signature,Malware_Attacks.dest span=1d | `drop_dm_object_name(""Malware_Attacks"")` | stats values(action) as action,count as day_count by signature,dest | sort 100 - day_count",-30d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Unique Access By App Count'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Authentication.app) as app,count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name(""Authentication"")` | stats sparkline(sum(count),1h) as sparkline,dc(app) as app_count by src | sort - app_count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - New Malware'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from inputlookup:malware_tracker | stats min(firstTime) as firstTime,dc(dest) by signature | eval _time=firstTime | `daysago(30)` | sort 100 - firstTime | `uitime(firstTime)` | fields firstTime,signature,dc(dest)",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Malware - Oldest Infections'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| inputlookup append=T malware_tracker where `tracker_trp(lastTime,lastTime)` | eval days_active=floor((lastTime-firstTime)/86400 + 1) | `uitime(firstTime)` | `uitime(lastTime)` | sort 100 - days_active | fields firstTime,lastTime,signature,dest,days_active",-30d@d,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Top 10 Infected Domains'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.dest) as dest_count from datamodel=Malware.Malware_Attacks by Malware_Attacks.dest_nt_domain | `drop_dm_object_name(""Malware_Attacks"")` | sort 10 - dest_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Top 10 Infected Systems'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.signature) as signature_count from datamodel=Malware.Malware_Attacks by Malware_Attacks.dest | `drop_dm_object_name(""Malware_Attacks"")` | sort 10 - signature_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Top 10 Infections'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.dest) as dest_count from datamodel=Malware.Malware_Attacks by Malware_Attacks.signature | `drop_dm_object_name(""Malware_Attacks"")` | sort 10 - dest_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Unique Infected Systems'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(Malware_Attacks.dest) as estdc(dest) from datamodel=Malware.Malware_Attacks where Malware_Attacks.action=""allowed""",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,Unique Infected Systems,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - Unique Infections'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(Malware_Attacks.signature) as estdc(signature) from datamodel=Malware.Malware_Attacks where Malware_Attacks.action=""allowed""",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,Unique Infections,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - All Malware Attacks By Asset - Swimlane'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Malware_Attacks.action) as action,values(Malware_Attacks.signature) as signature,values(Malware_Attacks.dest) as dest,values(Malware_Attacks.user) as user,count from datamodel=Malware.Malware_Attacks where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Malware Attacks,red,reverse_asset_lookup,"Malware_Attacks.dest,dest","| from datamodel:""Malware"".""Malware_Attacks"" | search $constraints$",Default,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Malware - All Malware Attacks By Identity - Swimlane'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Malware_Attacks.action) as action,values(Malware_Attacks.signature) as signature,values(Malware_Attacks.dest) as dest,values(Malware_Attacks.user) as user,count from datamodel=Malware.Malware_Attacks where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Malware Attacks,red,reverse_identity_lookup,"Malware_Attacks.user,user","| from datamodel:""Malware"".""Malware_Attacks"" | search $constraints$",,,Default,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Number Of Systems Not Time Synchronizing'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as lastTime from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Timesync All_Performance.OS.Timesync.action=success by All_Performance.dest | `drop_dm_object_name(""All_Performance"")` | `timeDiff(lastTime)` | search timeDiff>86400 | stats count as current_count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Timesync Anomalies,System Count,current_count,,,false,search?q=%7C%20tstats%20%60summariesonly%60%20max(_time)%20as%20lastTime%20from%20datamodel%3DPerformance.All_Performance%20where%20nodename%3DAll_Performance.OS.Timesync%20All_Performance.OS.Timesync.action%3Dsuccess%20by%20All_Performance.dest&earliest=-24h%40h&latest=now,1,0,0,all,Timesync Anomalies,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Unique Access By Destination Count'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Authentication.dest) as dest,count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name(""Authentication"")` | stats sparkline(sum(count),1h) as sparkline,dc(dest) as dest_count by src | sort - dest_count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Number Of Systems With Uptime Anomalies'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(All_Performance.OS.Uptime.uptime) as uptime from datamodel=Performance.All_Performance where earliest=-48h@h latest=+0s nodename=All_Performance.OS.Uptime by All_Performance.dest | `drop_dm_object_name(""All_Performance"")` | where (uptime/86400)>30 | stats count as current_count | appendcols [| tstats `summariesonly` latest(All_Performance.OS.Uptime.uptime) as uptime from datamodel=Performance.All_Performance where earliest=-96h@h latest=-48h@h nodename=All_Performance.OS.Uptime by All_Performance.dest | `drop_dm_object_name(""All_Performance"")` | where (uptime/86400)>30 | stats count as historical_count] | `get_delta`",-96h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Uptime Anomalies,System Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20latest(All_Performance.OS.Uptime.uptime)%20as%20uptime%20from%20datamodel%3DPerformance.All_Performance%20where%20earliest%3D-48h%40h%20latest%3D%2B0s%20nodename%3DAll_Performance.OS.Uptime%20by%20All_Performance.dest%20%7C%20%60drop_dm_object_name(%22All_Performance%22)%60%20%7C%20where%20(uptime%2F86400)%3E30,1,0,0,all,Uptime Anomalies,singlevalue,update_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Top-Average CPU Load Over Time By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| `tstats` avg(All_Performance.CPU.cpu_load_percent) from datamodel=Performance.All_Performance where nodename=All_Performance.CPU [| `tstats` avg(All_Performance.CPU.cpu_load_percent) from datamodel=Performance.All_Performance where nodename=All_Performance.CPU by All_Performance.dest | stats avg(All_Performance.CPU.cpu_load_percent) as ""avg"" by All_Performance.dest | sort 10 - ""avg"" | fields All_Performance.dest | format] by _time,All_Performance.dest span=10m | timechart minspan=10m avg(All_Performance.CPU.cpu_load_percent) as ""avg_cpu_load(%)"" by All_Performance.dest | `drop_dm_object_name(""All_Performance"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,connect,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Memory Utilization By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(All_Performance.Memory.mem) as mem,latest(All_Performance.Memory.mem_used) as mem_used,latest(All_Performance.Memory.mem_free) as mem_free from datamodel=Performance.All_Performance where nodename=All_Performance.Memory by All_Performance.dest | `drop_dm_object_name(""All_Performance"")` | eval mem_used=if(isnotnull(mem) AND isnotnull(mem_free),mem-mem_free,null()) | eval mem_used_percent=if(isnotnull(mem) AND mem>0,round(mem_used*100/mem,1),null()) | sort 100 - mem_used_percent | eval ""mem(GB)""=round(mem/1024,1) | eval ""mem_used(GB)""=round(mem_used/1024,1) | eval ""mem_free(GB)""=round(mem_free/1024,1) | fields dest,*(GB),mem_used_percent",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Storage Utilization By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(All_Performance.Storage.storage) as storage, latest(All_Performance.Storage.storage_free) as storage_free, latest(All_Performance.Storage.storage_free_percent) as storage_free_percent, latest(All_Performance.Storage.storage_used) as storage_used, latest(All_Performance.Storage.storage_used_percent) as storage_used_percent from datamodel=Performance.All_Performance where nodename=All_Performance.Storage by All_Performance.dest,All_Performance.Storage.mount | sort 100 + storage_free_percent | `drop_dm_object_name(""All_Performance"")` | `drop_dm_object_name(""Storage"")` | eval storage=if(isnull(storage) AND isnotnull(storage_free) AND isnotnull(storage_free_percent),(storage_free)*(1-(storage_free_percent/100)),storage) | eval storage_used=if(isnotnull(storage) AND isnotnull(storage_free),storage-storage_free,storage_used) | eval ""storage(GB)""=round(storage/1073741824,1) | eval ""storage_free(GB)""=round(storage_free/1073741824,1) | eval storage_free_percent=round(storage_free_percent,1) | eval ""storage_used(GB)""=round(storage_used/1073741824,1) | fields dest,mount,*(GB),storage_free_percent",-48h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Time Synchronization Failures'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,latest(All_Performance.dest_should_timesync) as dest_should_timesync,count from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Timesync All_Performance.OS.Timesync.action=failure by All_Performance.dest | eval action=""failure"" | `drop_dm_object_name(""All_Performance"")` | fields _time,action,dest,dest_should_timesync,count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Systems Not Time Synching'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime,max(_time) as lastTime,latest(All_Performance.dest_should_timesync) as dest_should_timesync from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Timesync All_Performance.OS.Timesync.action=success by All_Performance.dest | `drop_dm_object_name(""All_Performance"")` | `timeDiff(lastTime)` | search timeDiff>86400 | sort 100 + lastTime | `uitime(firstTime)` | `uitime(lastTime)` | fields firstTime,lastTime,dest,dest_should_timesync",-30d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Performance - Indexing Time Delay By Host'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"`index_time_delta` | stats min(min_timeDiff) as min_timeDiff,max(max_timeDiff) as max_timeDiff,sum(sum_timeDiff) as sum_timeDiff,sum(count) as count by host | `get_asset(host)` | eval ""min_diff(minutes)""=round(min_timeDiff/60,1) | eval ""max_diff(minutes)""=round(max_timeDiff/60,1) | eval ""avg_diff(minutes)""=round(sum_timeDiff/(count*60),1) | sort 100 + avg_diff(minutes) | fields host,host_should_timesync,min_diff(minutes),avg_diff(minutes),max_diff(minutes)",-7d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Performance - Indexing Time Delay By Sourcetype'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"`index_time_delta` | stats min(min_timeDiff) as min_timeDiff,max(max_timeDiff) as max_timeDiff,sum(sum_timeDiff) as sum_timeDiff,sum(count) as count by sourcetype | eval ""min_diff(minutes)""=round(min_timeDiff/60,1) | eval ""max_diff(minutes)""=round(max_timeDiff/60,1) | eval ""avg_diff(minutes)""=round(sum_timeDiff/(count*60),1) | sort 100 + avg_diff(minutes) | fields sourcetype,min_diff(minutes),avg_diff(minutes),max_diff(minutes)",-7d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['Performance - Time Service Start Mode Anomalies'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,latest(Services.start_mode) as start_mode,latest(Services.status) as status,latest(Services.dest_should_timesync) as dest_should_timesync from datamodel=Endpoint.Services where (Services.tag=time Services.tag=synchronize) by Services.dest,Services.service | `drop_dm_object_name(""Services"")` | search start_mode!=auto | sort 100 + start_mode | fields _time,dest,dest_should_timesync,service,start_mode,status",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Minimum System Uptime'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(All_Performance.OS.Uptime.uptime) as uptime from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Uptime All_Performance.OS.Uptime.uptime!=unknown All_Performance.OS.Uptime.uptime>=0 by All_Performance.dest | sort 1 + uptime | `drop_dm_object_name(""All_Performance"")` | `uptime2string(uptime,uptime)` | eval label=dest."" has been up for "".uptime | fields label,dest,uptime",-48h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,Minimum System Uptime,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Unique Access By User Count'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Authentication.user) as user,count from datamodel=Authentication.Authentication by _time,Authentication.src span=1h | `drop_dm_object_name(""Authentication"")` | stats sparkline(sum(count),1h) as sparkline,dc(user) as user_count by src | sort - user_count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Average System Uptime'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` avg(All_Performance.OS.Uptime.uptime) as avg_uptime from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Uptime All_Performance.OS.Uptime.uptime!=unknown All_Performance.OS.Uptime.uptime>=0 | `uptime2string(avg_uptime,avg_uptime)` | rename avg_uptime as ""avg(uptime)"" | fields avg(uptime)",-48h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,Average System Uptime,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Maximum System Uptime'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(All_Performance.OS.Uptime.uptime) as uptime from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Uptime All_Performance.OS.Uptime.uptime!=unknown All_Performance.OS.Uptime.uptime>=0 by All_Performance.dest | sort 1 - uptime | `drop_dm_object_name(""All_Performance"")` | `uptime2string(uptime,uptime)` | eval label=dest."" has been up for "".uptime | fields label,dest,uptime",-48h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,Maximum System Uptime,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Performance - Uptime By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(All_Performance.OS.Uptime.uptime) as uptime from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Uptime by All_Performance.dest | `drop_dm_object_name(""All_Performance"")` | sort 100 - uptime | `uptime2string(uptime,uptime)` | fields dest,uptime",-48h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Available Updates'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates where earliest=-30d@d latest=+0s by Updates.dest,Updates.signature_id,Updates.vendor_product | search status=available | stats count as current_count | appendcols [| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates where earliest=-37d@d latest=-7d@d by Updates.dest,Updates.signature_id,Updates.vendor_product | search status=available | stats count as historical_count] | `get_delta`",-37d@d,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Available Updates,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20latest(Updates.status)%20as%20status%20from%20datamodel%3DUpdates.Updates%20where%20earliest%3D-30d%40d%20latest%3D%2B0s%20by%20Updates.dest%2CUpdates.signature_id%2CUpdates.vendor_product,1,0,0,all,Available Updates,singlevalue,update_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Installed Updates'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates where earliest=-30d@d latest=+0s by Updates.dest,Updates.signature_id,Updates.vendor_product | search status=installed | stats count as current_count | appendcols [| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates where earliest=-37d@d latest=-7d@d by Updates.dest,Updates.signature_id,Updates.vendor_product | search status=installed | stats count as historical_count] | `get_delta`",-37d@d,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Installed Updates,Count,current_count,,delta,true,search?q=%7C%20tstats%20%60summariesonly%60%20latest(Updates.status)%20as%20status%20from%20datamodel%3DUpdates.Updates%20where%20earliest%3D-30d%40d%20latest%3D%2B0s%20by%20Updates.dest%2CUpdates.signature_id%2CUpdates.vendor_product%20%7C%20search%20status%3Dinstalled,1,0,0,all,Installed Updates,singlevalue,update_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Number Of Systems Not Updating'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime from datamodel=Updates.Updates where Updates.status=installed by Updates.dest,Updates.signature_id,Updates.vendor_product | `drop_dm_object_name(""Updates"")` | stats max(firstTime) as lastTime by dest | `dayDiff(lastTime)` | search dayDiff>30 | stats count",-1y@d,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Not Updating,System Count,count,,,,search?q=%7C%20tstats%20%60summariesonly%60%20min(_time)%20as%20firstTime%20from%20datamodel%3DUpdates.Updates%20where%20Updates.status%3Dinstalled%20by%20Updates.dest%2CUpdates.signature_id%2CUpdates.vendor_product%20%7C%20%60drop_dm_object_name(%22Updates%22)%60%20%7C%20stats%20max(firstTime)%20as%20lastTime%20by%20dest%20%7C%20%60dayDiff(lastTime)%60%20%7C%20search%20dayDiff%3E30%20,1,0,0,all,Systems Not Updating,singlevalue,update_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['Updates - Number Of Systems With Start Mode Anomalies'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Services.start_mode) as start_mode,latest(Services.status) as status from datamodel=Endpoint.Services where earliest=-24h@h latest=+0s Services.tag=update by Services.dest | `drop_dm_object_name(""Services"")` | search start_mode!=auto | stats count as current_count | appendcols [| tstats `summariesonly` latest(Services.start_mode) as start_mode,latest(Services.status) as status from datamodel=Endpoint.Services where earliest=-48h@h latest=-24h@h Services.tag=update by Services.dest | `drop_dm_object_name(""Services"")` | search start_mode!=auto | stats count as historical_count] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Update Service Anomalies,System Count,current_count,,delta,,search?q=%7C%20tstats%20%60summariesonly%60%20latest(Services.start_mode)%20as%20start_mode%2Clatest(Services.status)%20as%20status%20from%20datamodel%3DEndpoint.Services%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Services.tag%3Dupdate%20by%20Services.dest%20%7C%20%60drop_dm_object_name(%22Services%22)%60%20%7C%20search%20start_mode!%3Dauto,1,0,0,all,Update Service Anomalies,singlevalue,update_center,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Available Updates By System'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates by Updates.dest,Updates.signature_id,Updates.vendor_product | `drop_dm_object_name(""Updates"")` | search status=available | stats count by dest | `get_asset(dest)` | sort 100 - count | fields dest,dest_should_update,count",-30d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Systems By Last Update Time'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(_time) as _time,latest(Updates.dest_should_update) as dest_should_update from datamodel=Updates.Updates where Updates.status=installed by Updates.dest,Updates.signature_id,Updates.vendor_product | `drop_dm_object_name(""Updates"")` | stats max(_time) as lastTime,latest(dest_should_update) as dest_should_update by dest | eval dayDiff=round((now()-lastTime)/86400,1) | sort + lastTime | `uitime(lastTime)`",-1y@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Top Systems Needing Updates'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates by Updates.dest,Updates.signature_id,Updates.vendor_product | `drop_dm_object_name(""Updates"")` | search status=available | stats count by dest | sort 10 - count",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - All Authentication By Asset - Swimlane'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Authentication.action) as action,values(Authentication.app) as app,values(Authentication.src) as src,values(Authentication.dest) as dest,values(Authentication.user) as user,count from datamodel=Authentication.Authentication where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,All Authentication,blue,reverse_asset_lookup,"Authentication.src,Authentication.dest,src,dest","| from datamodel:""Authentication"".""Authentication"" | search $constraints$",Default,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Top Updates Needed'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates by Updates.dest,Updates.signature_id,Updates.vendor_product | `drop_dm_object_name(""Updates"")` | search status=available | stats count by signature_id | sort 10 - count",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Updates"".""Update_Errors']",['Updates - Update Errors'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| from datamodel:""Updates"".""Update_Errors"" | head 1000",-24h@h,now,,,,,,,,,0,,,,,,events,,,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,"[""source"", ""sourcetype"", ""host""]",true,false,list,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['Updates - Update Service Start Mode Anomalies'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Services.start_mode) as start_mode,latest(Services.status) as status from datamodel=Endpoint.Services where Services.tag=update by Services.dest,Services.service | `drop_dm_object_name(""Services"")` | search start_mode!=auto | sort 100 + start_mode | fields dest,service,start_mode,status",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Updates.Updates'],['Updates - Updates By Status'],DA-ESS-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Updates.status) as status from datamodel=Updates.Updates by Updates.dest,Updates.signature_id,Updates.vendor_product | `drop_dm_object_name(""Updates"")` | stats count by status | sort - count",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Anomalous User Account Creation - Rule'],DA-ESS-EndpointProtection-default,,,True,,,,,,,,,"| from inputlookup:""useraccounts_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^d""), tostring(""+0s""),  match(""+0s"", ""^([@+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"" by ""user"" | where 'dest_count'>3",-24h@h,+0s,,1,number of events,greater than,0,40 * * * *,1,1,false,,,,Alerts when a previously unseen account is created on multiple hosts.,,,,,0,1,New User Account Created On Multiple Hosts,0,endpoint,medium,User Account ($user$) Created On $dest_count$ Hosts,A user account ($user$) was created on several $dest_count$ hosts in the last 24 hours.,user,View activity for account $user$,"| from datamodel:""Compute_Inventory"".""User"" | search user=""$user$""",,,1,user,user,60,user,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,"[""Endpoint - User Account Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""inputlookup"":  {""lookupName"": ""useraccounts_tracker"", ""timeField"":  ""firstTime""},         ""earliest"":     ""-24h@h"",         ""latest"":       ""+0s"",         ""aggregates"":   [{""function"": ""dc"", ""attribute"": ""dest"", ""alias"": ""dest_count""}],         ""splitby"":      [{""attribute"": ""user""}],         ""resultFilter"": {""field"": ""dest_count"", ""comparator"": "">"", ""value"": ""3""}        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""user""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Identity - High Volume Email Activity with Non-corporate Domains - Rule'],DA-ESS-IdentityManagement-default,,,True,,,,,,,,,"| tstats `summariesonly` sum(All_Email.size) as bytes, values(All_Email.recipient) as recipient from datamodel=Email.All_Email where NOT `cim_corporate_email_domain_search(""All_Email.recipient"")` by All_Email.src_user | `drop_dm_object_name(""All_Email"")` | xsfindbestconcept bytes from email_volume_1h_noncorp | eval risk_score=case(BestConcept=""extreme"",80,BestConcept=""high"",50,BestConcept=""medium"",20, 1==1, 0) | search risk_score>0",-70m@m,+0s,,1,number of events,greater than,0,25 * * * *,1,1,false,,,,Alerts on high volume email activity by a user to non-corporate domains.,,,,,0,1,High Volume Email Activity to Non-corporate Domains by User,0,identity,high,Emails to Non-corporate Domains from User ($src_user$),High volume email activity from a user to non-corporate domains was detected. This could be indicative of data exfiltration attempts.,user,View email activity from $src_user$,"| from datamodel:""Email"".""All_Email"" | search src_user=$src_user$",,,1,src_user,user,50,src_user,86300s,false,SplunkEnterpriseSecuritySuite,5,,,,"[""Identity - Email Activity to Non-corporate Domains by Users Per 1d - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - All Authentication By Identity - Swimlane'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Authentication.action) as action,values(Authentication.app) as app,values(Authentication.src) as src,values(Authentication.dest) as dest,values(Authentication.user) as user,count from datamodel=Authentication.Authentication where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,All Authentication,blue,reverse_identity_lookup,"Authentication.src_user,Authentication.user,src_user,user","| from datamodel:""Authentication"".""Authentication"" | search $constraints$",,,Default,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Identity - Web Uploads to Non-corporate Domains - Rule'],DA-ESS-IdentityManagement-default,,,True,,,,,,,,,"| tstats `summariesonly` sum(Web.bytes) as bytes from datamodel=Web.Web where (Web.http_method=""POST"" OR Web.http_method=""PUT"")  NOT (`cim_corporate_web_domain_search(""Web.url"")`) by Web.user | `drop_dm_object_name(""Web"")` | xsfindbestconcept bytes from web_volume_1h_noncorp | eval risk_score=case(BestConcept=""extreme"",80,BestConcept=""high"",50,BestConcept=""medium"",20, 1==1, 0) | search risk_score>0",-70m@m,+0s,,1,number of events,greater than,0,35 * * * *,1,1,false,,,,Alerts on high volume web uploads by a user to non-corporate domains.,,,,,0,1,Web Uploads to Non-corporate Sites by Users,0,identity,high,Web Uploads to Non-corporate Domains from User ($user$),Web Uploads by a user to non-corporate domains was detected. This could be indicative of data exfiltration attempts.,user,View web uploads by $user$,"| from datamodel:""Web"".""Web"" | search user=$user$",,,1,user,user,50,user,86300s,false,SplunkEnterpriseSecuritySuite,5,,,,"[""Identity - Web Uploads to Non-corporate Domains by Users Per 1d - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Identity - High Risk Users'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(""All_Risk.risk_object"") as current_count from datamodel=Risk.All_Risk where All_Risk.risk_object_type=""user"" earliest=-24h@h latest=+0s | appendcols [|tstats `summariesonly` estdc(""All_Risk.risk_object"") as historical_count from datamodel=Risk.All_Risk where All_Risk.risk_object_type=""user"" earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total High Risk Users,Count,current_count,,delta,false,search?q=%7C%20from%20datamodel%3A%22Risk%22.%22All_Risk%22%20%7C%20search%20risk_object_type%3D%22user%22&earliest=-48h%40h&latest=now,1,0,,all,Total High Risk Users,singlevalue,user_activity,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Identity - High Risk User Events'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Risk.All_Risk where All_Risk.risk_object_type=""user"" All_Risk.risk_score>60 earliest=-24h@h latest=+0s  | appendcols [|tstats `summariesonly` count as historical_count from datamodel=Risk.All_Risk where All_Risk.risk_object_type=""user"" All_Risk.risk_score>60 earliest=-48h@h latest=-24h@h ]| `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total High Risk User Events,Count,current_count,,delta,false,search?q=%7C%20from%20datamodel%3A%22Risk%22.%22All_Risk%22%20%7C%20search%20risk_object_type%3D%22user%22&earliest=-48h%40h&latest=now,1,0,,all,Total High Risk User Events,singlevalue,user_activity,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Identity - Noncorporate Web Activity'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` sum(Web.bytes) as current_size from datamodel=Web.Web where  earliest=-24h@h latest=+0s NOT(`cim_corporate_web_domain_search(""Web.url"")`) (Web.http_method=""POST"" OR Web.http_method=""PUT"") | appendcols[|tstats `summariesonly` sum(Web.bytes) as historical_size from datamodel=Web.Web where earliest=-48h@h latest=-24h@h NOT(`cim_corporate_web_domain_search(""Web.url"")`) (Web.http_method=""POST"" OR Web.http_method=""PUT"")] |  `get_delta(current_size, historical_size)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Noncorp Web Volume,Bytes,current_size,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(Web.bytes)%20as%20current_size%20from%20datamodel%3DWeb.Web%20where%20%20earliest%3D-24h%40h%20latest%3D%2B0s%20NOT(%60cim_corporate_web_domain_search(%22Web.url%22)%60)%20(Web.http_method%3D%22POST%22%20OR%20Web.http_method%3D%22PUT%22)%20by%20Web.url&earliest=-48h%40h&latest=now,1,0,,all,Noncorp Web Volume,singlevalue,user_activity,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Identity - Noncorporate Email Activity'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Email.size) as current_size from datamodel=Email.All_Email where earliest=-24h@h latest=+0s NOT `cim_corporate_email_domain_search(""All_Email.recipient"")` | appendcols[| tstats `summariesonly` sum(All_Email.size) as historical_size from datamodel=Email.All_Email where earliest=-48h@h latest=-24h@h NOT `cim_corporate_email_domain_search(""All_Email.recipient"")`] | `get_delta(current_size, historical_size)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Noncorp Email Volume,Bytes,current_size,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Email.size)%20as%20current_size%20from%20datamodel%3DEmail.All_Email%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20NOT%20%60cim_corporate_email_domain_search(%22All_Email.recipient%22)%60%20by%20All_Email.recipient,1,0,,all,Noncorp Web Volume,singlevalue,user_activity,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Identity - Watchlisted Website Activity'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Web.Web where  Web.tag=""web_watchlist"" earliest=-24h@h latest=+0s | appendcols[ | tstats `summariesonly` count as historical_count from datamodel=Web.Web where  Web.tag=""web_watchlist"" earliest=-48h@h latest=-24h@h  ] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Watchlisted Websites,Access Count,current_count,,delta,false,search?earliest=-48h%40h&latest=now&q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20Web.tag%3D%22web_watchlist%22%20by%20Web.url,1,0,,all,Watchlisted Websites,singlevalue,user_activity,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Identity - Emails to Noncorporate Domains - Swimlane'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Email.size) as bytes, values(All_Email.src_user) as src_user, values(All_Email.recipient) as recipient, values(All_Email.subject) as subject, count from datamodel=Email.All_Email where $constraints$ NOT `cim_corporate_email_domain_search(""All_Email.recipient"")` by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Non-corporate Emails,orange,reverse_identity_lookup,"All_Email.src_user,src_user","| from datamodel:""Email"".""All_Email"" | search $constraints$",,,User Activity,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Identity - Noncorporate Web Uploads - Swimlane'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` sum(Web.bytes) as bytes, values(Web.user) as user, values(Web.url) as url, values(Web.http_method) as http_method, values(Web.http_content_type) as http_content_type, count from datamodel=Web.Web where $constraints$  NOT(`cim_corporate_web_domain_search(""Web.url"")`) (Web.http_method=""POST"" OR Web.http_method=""PUT"") by _time span=$span$ | `drop_dm_object_name(""Web"")`",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Non-corporate Web Uploads,yellow,reverse_identity_lookup,"Web.user,user","| from datamodel:""Web"".""Web"" | search $constraints$",,,User Activity,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Identity - Watchlisted Sites - Swimlane'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` count, values(Web.user) as user, values(Web.url) as url, values(Web.src) as src  from datamodel=Web.Web where $constraints$ Web.tag=""web_watchlist"" by _time span=$span$ | `drop_dm_object_name(""Web"")`",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Watchlisted Sites,red,reverse_identity_lookup,"Web.user,user","| from datamodel:""Web"".""Web"" |  search $constraints$",,,User Activity,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Identity - Remote Access - Swimlane'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` count, values(Authentication.user) as user, values(Authentication.user_bunit) as user_bunit from datamodel=Authentication.Authentication where $constraints$ by Authentication.src, _time span=$span$ | `drop_dm_object_name(""Authentication"")` | `get_identity4events(user)` | `get_asset(src)` | iplocation src | eval src_city=if(isnull(src_city), City,src_city) | eval src_country=if(isnull(src_country), Country,src_country) | where isnotnull(src_city) AND isnotnull(user_work_city) AND (lower(user_work_city)!=lower(src_city) OR lower(user_work_country)!=lower(src_country)) | stats sum(count) as count, values(user) as user, values(src) as src, values(user_bunit) as user_bunit, values(user_work_city) as user_work_city, values(src_city) as src_city, values(user_work_country) as user_work_country, values(src_country) as src_country by _time | fields count, user, user_bunit, src, user_work_city, user_work_country, src_city, src_country",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Remote Access,blue,reverse_identity_lookup,"Authentication.user,user","| from datamodel:""Authentication"".""Authentication"" |  search $constraints$",,,User Activity,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Geographically Improbable Access - Summary Gen'],DA-ESS-AccessProtection-default,,,True,,,,,,,,,"| `tstats` min(_time),earliest(Authentication.app) from datamodel=Authentication.Authentication where Authentication.action=""success"" by Authentication.src,Authentication.user | eval psrsvd_ct_src_app='psrsvd_ct_Authentication.app',psrsvd_et_src_app='psrsvd_et_Authentication.app',psrsvd_ct_src_time='psrsvd_ct__time',psrsvd_nc_src_time='psrsvd_nc__time',psrsvd_nn_src_time='psrsvd_nn__time',psrsvd_vt_src_time='psrsvd_vt__time',src_time='_time',src_app='Authentication.app',user='Authentication.user',src='Authentication.src' | lookup asset_lookup_by_str key as ""src"" OUTPUTNEW lat as ""src_lat"",long as ""src_long"",city as ""src_city"",country as ""src_country"" | lookup asset_lookup_by_cidr key as ""src"" OUTPUTNEW lat as ""src_lat"",long as ""src_long"",city as ""src_city"",country as ""src_country"" | iplocation src | search (src_lat=* src_long=*) OR (lat=* lon=*) | eval src_lat=if(isnotnull(src_lat),src_lat,lat),src_long=if(isnotnull(src_long),src_long,lon),src_city=case(isnotnull(src_city),src_city,isnotnull(City),City,1=1,""unknown""),src_country=case(isnotnull(src_country),src_country,isnotnull(Country),Country,1=1,""unknown"") | fields psrsvd*src_*,psrsvd_v,src*,user | stats earliest(src_app) as src_app,min(src_time) as src_time by src,src_lat,src_long,src_city,src_country,user | eval key=src.""@@"".src_time.""@@"".src_app.""@@"".src_lat.""@@"".src_long.""@@"".src_city.""@@"".src_country | eventstats dc(key) as key_count,values(key) as key by user | search key_count>1 | stats first(src_app) as src_app,first(src_time) as src_time,first(src_lat) as src_lat,first(src_long) as src_long,first(src_city) as src_city,first(src_country) as src_country by src,key,user | rex field=key ""^(?<dest>.+?)@@(?<dest_time>.+?)@@(?<dest_app>.+)@@(?<dest_lat>.+)@@(?<dest_long>.+)@@(?<dest_city>.+)@@(?<dest_country>.+)"" | where src!=dest | eval key=mvsort(mvappend(src.""->"".dest, NULL, dest.""->"".src)),units=""m"" | dedup key, user | `globedistance(src_lat,src_long,dest_lat,dest_long,units)` | eval speed=distance/(abs(src_time-dest_time+1)/3600) | where speed>=500 | fields user,src_time,src_app,src,src_lat,src_long,src_city,src_country,dest_time,dest_app,dest,dest_lat,dest_long,dest_city,dest_country,distance,speed | eval _time=now()",-1090m@m,+0s,,1,,,,50 * * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,5,,gia_summary,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Ticket_Management.All_Ticket_Management'],['Identity - Tickets by User - Swimlane'],DA-ESS-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` count, values(All_Ticket_Management.src_user) as src_user, values(All_Ticket_Management.description) as description, values(All_Ticket_Management.priority) as priority, values(All_Ticket_Management.severity) as severity from datamodel=Ticket_Management.All_Ticket_Management where $constraints$ by _time span=$span$ | `drop_dm_object_name(""All_Ticket_Management"")`",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Ticket Activity,green,reverse_identity_lookup,"All_Ticket_Management.src_user,src_user","| from datamodel:""Ticket_Management"".""All_Ticket_Management"" |  search $constraints$",,,User Activity,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Network - Unroutable Host Activity - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| `src_dest_tstats(""allowed"")` | `bogonlist_lookup` | search (dest_is_bogon=true dest_is_internal!=true) OR (src_is_bogon=true src_is_internal!=true) | eval bogon_ip=if(dest_is_bogon==""true"" AND dest_is_internal!=""true"",dest,bogon_ip) | eval bogon_ip=if(src_is_bogon==""true"" AND src_is_internal!=""true"",src,bogon_ip) | fields + sourcetype,src,dest,bogon_ip",-70m@m,+0s,,1,number of events,greater than,0,40 * * * *,1,1,false,,,,Alerts when activity to or from a host that is unroutable is detected.,,,,,0,1,Unroutable Activity Detected,0,network,high,Unroutable Activity Detected ($bogon_ip$),$orig_sourcetype$ network communication was discovered to a host that is unroutable ($bogon_ip$). This activity may be indicative of malicious activity (such as IP spoofing) since address ($bogon_ip$) should not be used for legitimate network traffic.,"src,dest",View all $orig_sourcetype$ activity involving $src$ to $dest$,"sourcetype=""$orig_sourcetype$"" ""$src$"" ""$dest$""",,,1,src,system,80,"sourcetype,src,dest",86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Web"".""Web']",['Network - High Volume of Traffic from High or Critical Host - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true sum(Web.bytes_out) as ""bytes_out"" from datamodel=""Web"".""Web"" where    ""Web.bytes_out"">0 AND (""Web.src_priority""=""high"" OR ""Web.src_priority""=""critical"") by ""Web.src"",""Web.dest"" | rename ""Web.src"" as ""src"",""Web.dest"" as ""dest"" | where 'bytes_out'>10485760",-70m@m,+0s,,1,number of events,greater than,0,"5,20,35,50 * * * *",1,1,false,,,,Alerts when a system of high or critical severity generates a high volume of outbound web activity. This may indicate that the system has been compromised.,,,,,0,1,High Volume of Web Activity from Critical System,0,network,high,High Volume of Web Activity from $src$ to $dest$,A large volume of web activity was observed from $src$ to $dest$.,"src,dest",View web activity involving $src$ to $dest$,"| from datamodel:""Web"".""Web"" | where 'bytes_out'>0 AND ('src_priority'=""high"" OR 'src_priority'=""critical"") AND 'src'=""$src$"" AND 'dest'=""$dest$""",,,1,src,system,80,"dest,src",86300s,false,SplunkEnterpriseSecuritySuite,,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Web"",         ""object"":        ""Web"",         ""earliest"":      ""-70m@m"",         ""latest"":        ""+0s"",         ""eventFilter"":   ""'Web.bytes_out'>0 AND ('Web.src_priority'=""high"" OR 'Web.src_priority'=""critical"")"",         ""aggregates"":    [{""function"": ""sum"", ""attribute"": ""Web.bytes_out"", ""alias"": ""bytes_out""}],         ""splitby"":       [                           {""attribute"": ""Web.src"", ""alias"": ""src""},                           {""attribute"": ""Web.dest"", ""alias"": ""dest""}                          ],         ""resultFilter"":  {""field"": ""bytes_out"", ""comparator"": "">"", ""value"": ""10485760""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest"",""src""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Unusual Volume of Network Activity - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` dc(All_Traffic.src) as src_count,count from datamodel=Network_Traffic.All_Traffic | localop | xswhere count from count_30m in network_traffic is extreme or src_count from src_count_30m in network_traffic is extreme | eval const_dedup_id=""Network - Unusual Volume of Network Activity - Rule""",-40m@m,+0s,,1,number of events,greater than,0,*/30 * * * *,1,1,false,,,,Detects unusual network traffic that may be indicative of a DoS attack as indicated by a high number of unique sources or a high volume of firewall packets,,,,,0,1,Unusual Volume of Network Activity,0,network,high,Unusual Volume of Network Activity,An unusual volume of network activity was detected. $src_count$ unique sources have generated network traffic in the past 15 minutes and $count$ network events have been observed in the same time period.,,,,,,,,,,const_dedup_id,14300s,false,SplunkEnterpriseSecuritySuite,,1,notable,,"[    ""Network - Traffic Volume Per 30m - Context Gen"",    ""Network - Traffic Source Count Per 30m - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Resolution"".""DNS']",['Network - Excessive DNS Failures - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true count from datamodel=""Network_Resolution"".""DNS"" where ""DNS.reply_code""!=""No error"" AND ""DNS.reply_code""!=""NoError"" by ""DNS.src""  | rename ""DNS.src"" as ""src"" | where 'count'>100",-70m@m,+0s,,1,number of events,greater than,0,10 * * * *,1,1,0,,,,Alerts when a host receives many DNS failures in a short span,,,,,0,1,Excessive DNS Failures,0,network,high,Excessive DNS Failures ($src$),A host ($src$) was detected receiving a high number of DNS failure responses ($count$).,src,View DNS Activity on $src$,"| from datamodel:""Network_Resolution"".""DNS"" | search src=""$src$""",,,1,src,system,40,src,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Network_Resolution"",         ""object"":        ""DNS"",         ""earliest"":      ""-70m@m"",         ""latest"":        ""+0s"",         ""eventFilter"":   ""'DNS.reply_code'!=""No error"" AND 'DNS.reply_code'!=""NoError"""",         ""aggregates"":    [{""function"": ""count""}],         ""splitby"":       [{""attribute"": ""DNS.src"", ""alias"": ""src""}],         ""resultFilter"":  {""field"": ""count"", ""comparator"": "">"", ""value"": ""100""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""src""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Resolution"".""DNS']",['Network - Excessive DNS Queries - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true count from datamodel=""Network_Resolution"".""DNS"" where    ""DNS.message_type""=""QUERY"" by ""DNS.src"" | rename ""DNS.src"" as ""src"" | where 'count'>100",-70m@m,+0s,,1,number of events,greater than,0,20 * * * *,1,1,0,,,,Alerts when a host starts sending excessive DNS queries,,,,,0,1,Excessive DNS Queries,0,network,high,Excessive DNS Queries ($src$),A host ($src$) was detected sending a high number of DNS queries ($count$).,src,View DNS Activity on $src$,"| from datamodel:""Network_Resolution"".""DNS"" | search src=""$src$""",,,1,src,system,40,src,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Network_Resolution"",         ""object"":        ""DNS"",         ""earliest"":      ""-70m@m"",         ""latest"":        ""+0s"",         ""eventFilter"":   ""'DNS.message_type'=""QUERY"""",         ""aggregates"":    [{""function"":""count""}],         ""splitby"":       [{""attribute"": ""DNS.src"", ""alias"":""src""}],         ""resultFilter"":  {""field"": ""count"", ""comparator"": "">"", ""value"": ""100""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""src""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution.DNS'],['DNS - Messages'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Network_Resolution.DNS where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Network_Resolution.DNS where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total DNS messages,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Resolution.DNS%20where%20earliest%3D-24h%40h%20latest%3D%2B0s,1,0,0,all,Total DNS messages,singlevalue,net_dns_activity,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution.DNS'],['DNS - Errors'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Network_Resolution.DNS where earliest=-24h@h latest=+0s (DNS.reply_code!=""No error"" AND DNS.reply_code!=""NoError"") | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Network_Resolution.DNS where earliest=-48h@h latest=-24h@h (DNS.reply_code!=""No error"" AND DNS.reply_code!=""NoError"") ] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total DNS Errors,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Resolution.DNS%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20(DNS.reply_code!%3D%22No%20error%22%20AND%20DNS.reply_code!%3D%22NoError%22),1,0,,all,Total DNS Errors,singlevalue,net_dns_activity,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution.DNS'],['DNS - Unique Queries'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(DNS.query) as current_count from datamodel=Network_Resolution.DNS where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(DNS.query) as historical_count from datamodel=Network_Resolution.DNS where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Queries,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Resolution.DNS%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20DNS.query,1,0,,all,Unique Query Count,singlevalue,net_dns_activity,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution.DNS'],['DNS - Query Sources'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(DNS.src) as current_count from datamodel=Network_Resolution.DNS where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(DNS.src) as historical_count from datamodel=Network_Resolution.DNS where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Sources,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Resolution.DNS%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20DNS.src,1,0,,all,Unique Query Sources,singlevalue,net_dns_activity,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['Change - Number Of Account Lockouts'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(All_Changes.user) as current_count from datamodel=Change.All_Changes where earliest=-24h@h latest=+0s nodename=All_Changes.Account_Management All_Changes.result=""lockout"" | appendcols [| tstats `summariesonly` estdc(All_Changes.user) as historical_count from datamodel=Change.All_Changes where earliest=-48h@h latest=-24h@h nodename=All_Changes.Account_Management All_Changes.result=""lockout""] | `get_delta`",-48h@h,now,,,number of events,greater than,0,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Account Lockouts,Distinct Accounts,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(All_Changes.user)%20as%20count%20from%20datamodel%3DChange.All_Changes%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20nodename%3DAll_Changes.Account_Management%20All_Changes.result%3D%22lockout%22%20by%20All_Changes.user,1,0,0,all,Account Lockouts,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution.DNS'],['DNS - Errors - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count, values(DNS.src) as src, values(DNS.query) as query, values(DNS.reply_code) as reply_code from datamodel=Network_Resolution.DNS where (DNS.reply_code!=""No error"" AND DNS.reply_code!=""NoError"") $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,DNS Errors,red,reverse_asset_lookup,"DNS.src,DNS.dest,src,dest","| from datamodel:""Network_Resolution"".""DNS"" | search $constraints$",Protocol Intelligence,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Email - Unique Senders'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats  `summariesonly` estdc(All_Email.src_user) as current_count from datamodel=Email.All_Email where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(All_Email.src_user) as historical_count from datamodel=Email.All_Email where earliest=-48h@h latest=-24h@h ] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Senders,Sender Count,current_count,,delta,false,search?q=%7C%20tstats%20%20%60summariesonly%60%20count%20from%20datamodel%3DEmail.All_Email%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Email.src_user,1,0,,all,Unique Senders,singlevalue,net_email_activity,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Email - Unique Receivers'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats  `summariesonly` estdc(All_Email.recipient) as current_count from datamodel=Email.All_Email where earliest=-24h@h latest=+0s | appendcols [| tstats  `summariesonly` estdc(All_Email.recipient) as historical_count from datamodel=Email.All_Email where earliest=-48h@h latest=-24h@h ] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Receivers,Receiver Count,current_count,,delta,false,search?q=%7C%20tstats%20%20%60summariesonly%60%20count%20from%20datamodel%3DEmail.All_Email%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Email.recipient,1,0,,all,Unique Receivers,singlevalue,net_email_activity,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Email - Cloud Activity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Email.All_Email where earliest=-24h@h latest=+0s (`cloud_email_search(""All_Email.src_user"")` OR `cloud_email_search(""All_Email.recipient"")`) | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Email.All_Email where earliest=-48h@h latest=-24h@h (`cloud_email_search(""All_Email.src_user"")` OR `cloud_email_search(""All_Email.recipient"")`) ] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Cloud Activity,Email Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DEmail.All_Email%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20(%60cloud_email_search(%22All_Email.src_user%22)%60%20OR%20%60cloud_email_search(%22All_Email.recipient%22)%60)%20by%20All_Email.src_user%20All_Email.recipient,1,0,,all,Cloud Activity,singlevalue,net_email_activity,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Email - Cloud Activity - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count, values(All_Email.src) as src, values(All_Email.src_user) as sender, values(All_Email.recipient) as recipient from datamodel=Email.All_Email where $constraints$ (`cloud_email_search(""All_Email.src_user"")` OR `cloud_email_search(""All_Email.recipient"")`) by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Cloud Emails,green,reverse_asset_lookup,"All_Email.src,All_Email.dest,src,dest","| from datamodel:""Email"".""All_Email"" | search $constraints$",Protocol Intelligence,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Traffic"".""Allowed_Traffic']",['Network - Unapproved Port Activity Detected - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| from datamodel:""Network_Traffic"".""Allowed_Traffic"" | `is_traffic_prohibited(dest_port)` | search dest_port>0 NOT is_prohibited=false | stats count by dvc,transport,dest_port,is_prohibited | `get_asset(dvc)` | `get_identity4events(dvc_owner)`",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects the use of ports that are prohibited. Useful for detecting the installation of new software or a successful compromise of a host (such as the presence of a backdoor or a system communicating with a botnet).,,,,,0,1,Prohibited Port Activity Detected,0,network,low,Prohibited Port Activity Detected ($transport$/$dest_port$ on $dvc$ ),The device $dvc$ has allowed communication via prohibited port $dest_port$ and $transport$ protocol. Please verify this activity is authorized and modify the prohibited_traffic lookup table if necessary.,"transport,dest_port",View prohibited port usage for device $dvc$ and $transport$/$dest_port$,"| from datamodel:""Network_Traffic"".""Allowed_Traffic"" | search dvc=""$dvc$"" transport=""$transport$"" dest_port=$dest_port$",,,1,dest_port,other,40,"dvc,transport,dest_port",86300s,false,SplunkEnterpriseSecuritySuite,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Traffic Bytes Tracker - Lookup Gen'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(All_Traffic.bytes) as min_bytes,avg(All_Traffic.bytes) as mean_bytes,max(All_Traffic.bytes) as max_bytes,stdev(All_Traffic.bytes) as stdev,count as total_count from datamodel=Network_Traffic.All_Traffic where All_Traffic.bytes>0 | appendcols [| from inputlookup:standard_deviations | rename stdev as standard_deviation] | filldown | fillnull value=0 min_bytes,mean_bytes,max_bytes,stdev,total_count | `stdev_desired_result(standard_deviation,mean_bytes,""gt_bytes"")` | `stdev_desired_result(-standard_deviation,mean_bytes,""lt_bytes"")` | eval search=case(gt_bytes>0 AND lt_bytes>0, ""(All_Traffic.bytes>"".floor(gt_bytes)."" OR All_Traffic.bytes<"".ceil(lt_bytes)."")"",gt_bytes>0 AND lt_bytes<=0,""All_Traffic.bytes>"".floor(gt_bytes),gt_bytes<=0 AND lt_bytes>0,""All_Traffic.bytes<"".ceil(lt_bytes),gt_bytes<=0 AND lt_bytes<=0,""All_Traffic.bytes=-1"") | rename standard_deviation as Z | rename total as total_count | fields min_bytes,mean_bytes,max_bytes,stdev,total_count,Z,search | `round(mean_bytes)` | `round(stdev)` | outputlookup traffic_bytes_tracker | stats count",-90d,+0s,,1,,,,"30 0,4,8,12,16,20 * * *",,,,,,,Maintains Traffic byte statistics,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Long Lived Connections'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s All_Traffic.duration>300000000 | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h All_Traffic.duration>300000000] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Long Lived Connections,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Traffic.duration%3E300000000%20by%20All_Traffic.src%20All_Traffic.dest,1,0,0,all,Long Lived Connections,singlevalue,net_unique_sources,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Maximum Bytes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(All_Traffic.bytes) as current_max from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s All_Traffic.bytes>0 | appendcols [| tstats `summariesonly` max(All_Traffic.bytes) as historical_max from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h All_Traffic.bytes>0] | `get_delta(current_max,historical_max)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Maximum Bytes,Bytes,current_max,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20max(All_Traffic.bytes)%20as%20maximum_bytes%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Traffic.bytes%3E0%20by%20All_Traffic.src%20All_Traffic.dest%20%7C%20sort%20-maximum_bytes,1,0,0,all,Maximum Bytes,singlevalue,traffic_size,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Mean Bytes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` avg(All_Traffic.bytes) as current_mean from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s All_Traffic.bytes>0 | appendcols [| tstats `summariesonly` avg(All_Traffic.bytes) as historical_mean from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h All_Traffic.bytes>0] | `get_delta(current_mean,historical_mean)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Mean Bytes,Bytes,current_mean,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Traffic.bytes)%20as%20bytes%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Traffic.bytes%3E0%20by%20All_Traffic.src%20All_Traffic.dest,1,0,0,all,Mean Bytes,singlevalue,traffic_size,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,traffic_center,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['Change - Account Lockouts'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Change.All_Changes where nodename=All_Changes.Account_Management All_Changes.result=""lockout"" by All_Changes.src,All_Changes.Account_Management.src_nt_domain,All_Changes.user | sort 100 - count | `drop_dm_object_name(""All_Changes"")` |  `drop_dm_object_name(""Account_Management"")`",-24h@h,now,,,number of events,greater than,0,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['example concurrent calls alert'],cisco_cdr-default,,,,,,,,,,,,"`cdr_events` duration>0 ( eventtype=""incoming_call"" OR eventtype=""outgoing_call"" )| search ( gateway=""*"" )| `get_call_concurrency(gateway)`| where _time>relative_time(now(),""-1h"")| stats max(concurrency) as maxConcurrency by gateway| where maxConcurrency>40| sort - concurrency",-4h,now,search,0,number of events,greater than,0,0 * * * *,True,0,1,1,1 or more gateways have exceeded the concurrency threshold.,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Minimum Bytes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(All_Traffic.bytes) as current_min from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s All_Traffic.bytes>0 | appendcols [| tstats `summariesonly` min(All_Traffic.bytes) as historical_min from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h All_Traffic.bytes>0] | `get_delta(current_min,historical_min)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Minimum Bytes,Bytes,current_min,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Traffic.bytes)%20as%20bytes%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Traffic.bytes%3E0%20by%20All_Traffic.src%20All_Traffic.dest,1,0,0,all,Minimum Bytes,singlevalue,traffic_size,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Standard Deviation Bytes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` stdev(All_Traffic.bytes) as current_stdev from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s All_Traffic.bytes>0 | appendcols [| tstats `summariesonly` stdev(All_Traffic.bytes) as historical_stdev from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h All_Traffic.bytes>0] | `get_delta(current_stdev,historical_stdev)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Stdev Bytes,Bytes,current_stdev,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Traffic.bytes)%20as%20bytes%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Traffic.bytes%3E0%20by%20All_Traffic.src%20All_Traffic.dest,1,0,0,all,Standard Deviation Bytes,singlevalue,traffic_size,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Stream Connections'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Network_Traffic.All_Traffic where All_Traffic.transport=tcp `src_stream` earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Network_Traffic.All_Traffic where All_Traffic.transport=tcp `src_stream` earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Stream Connections,Total Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20All_Traffic.transport%3Dtcp%20%60src_stream%60%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Traffic.src%20All_Traffic.dest,1,0,0,all,Stream Connections,singlevalue,net_unique_sources,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Traffic - Network Threat Activity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Threat_Intelligence.Threat_Activity where source=""Threat - Source And Destination Matches - Threat Gen"" earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Threat_Intelligence.Threat_Activity where source=""Threat - Source And Destination Matches - Threat Gen"" earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Network Threat Activity,Count,current_count,,delta,false,search?q=%7C%20from%20datamodel%3A%22Threat_Intelligence%22.%22Threat_Activity%22%20%7C%20search%20source%3D%22Threat%20-%20Source%20And%20Destination%20Matches%20-%20Threat%20Gen%22&earliest=-24h%40h&latest=now,1,0,0,all,Network Threat Activity,singlevalue,traffic_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Total Bytes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Traffic.bytes) as current_bytes from datamodel=Network_Traffic.All_Traffic where All_Traffic.bytes>0 earliest=-24h@h latest=+0s | appendcols [ | tstats `summariesonly` sum(All_Traffic.bytes) as historical_bytes from datamodel=Network_Traffic.All_Traffic where All_Traffic.bytes>0 earliest=-48h@h latest=-24h@h] | `get_delta(current_bytes, historical_bytes)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total Bytes,Bytes,current_bytes,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20All_Traffic.transport%3Dtcp%20%60src_stream%60%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Traffic.src%20All_Traffic.dest,1,0,0,all,Total Bytes,singlevalue,net_unique_sources,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Total Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total Count,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20All_Traffic.transport%3Dtcp%20%60src_stream%60%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Traffic.src%20All_Traffic.dest,1,0,0,all,Traffic Count,singlevalue,traffic_size,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,traffic_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['Traffic - Total Encrypted Connections'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Certificates.All_Certificates where nodename=""All_Certificates.SSL"" All_Certificates.tag=""network"" All_Certificates.tag=""communicate"" earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Certificates.All_Certificates where nodename=""All_Certificates.SSL"" All_Certificates.tag=""network"" All_Certificates.tag=""communicate"" earliest=-24h@h latest=+0s earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Encrypted Connections,SSL/TLS Connection Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DCertificates.All_Certificates%20where%20nodename%3D%22All_Certificates.SSL%22%20All_Certificates.tag%3D%22network%22%20All_Certificates.tag%3D%22communicate%22%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Certificates.src%20All_Certificates.dest,1,0,0,all,Total Encrypted Connections,singlevalue,net_unique_sources,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Unique Sources'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(All_Traffic.src) as current_count from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(All_Traffic.src) as historical_count from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Traffic Sources,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Traffic.src,1,0,0,all,Unique Traffic Sources,singlevalue,traffic_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Unique Network Protocols'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(all_traffic.app) as current_count from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s `cim_filter_unknown_values(All_Traffic.app)` | appendcols [|tstats `summariesonly` estdc(all_traffic.app) as historical_count from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h `cim_filter_unknown_values(All_Traffic.app)`] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Protocol Activity,Unique Protocols,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20%60cim_filter_unknown_values(All_Traffic.app)%60%20by%20All_Traffic.app,1,0,0,all,Unique Protocols,singlevalue,net_unique_sources,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Unique Destinations'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(All_Traffic.dest) as current_count from datamodel=Network_Traffic.All_Traffic where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(All_Traffic.dest) as historical_count from datamodel=Network_Traffic.All_Traffic where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Traffic Destinations,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DNetwork_Traffic.All_Traffic%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Traffic.dest,1,0,0,all,Unique Traffic Destinations,singlevalue,traffic_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['Change - Account Management By Source User'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Change.All_Changes where nodename=All_Changes.Account_Management by All_Changes.Account_Management.src_user| `drop_dm_object_name(""All_Changes"")` | `drop_dm_object_name(""Account_Management"")` | sort 10 - count",-24h,now,,,number of events,greater than,0,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Traffic - New Port Activity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `port_protocol_tracker` | `dayDiff(firstTime)` | search dayDiff<7 | eval _firstTime=firstTime,firstTime=strftime(firstTime, ""%m/%d/%Y %H:%M:%S""),_lastTime=lastTime,lastTime=strftime(lastTime,""%m/%d/%Y %H:%M:%S"") | fields firstTime,lastTime,transport,dest_port,app",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Prohibited Or Insecure Traffic Over Time'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(All_Traffic.src_category) as src_category,values(All_Traffic.dest_category) as dest_category,count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.src,All_Traffic.dest,All_Traffic.transport,All_Traffic.dest_port span=10m | `drop_dm_object_name(""All_Traffic"")` | `is_traffic_prohibited(dest_port)` | search (is_prohibited!=""false"" OR is_secure!=""unknown"") | `get_transport_dest_port` | timechart minspan=10m sum(count) as count by transport_dest_port",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Prohibited Traffic Details'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,values(All_Traffic.src_category) as src_category,values(All_Traffic.dest_category) as dest_category,count from datamodel=Network_Traffic.All_Traffic by All_Traffic.src,All_Traffic.dest,All_Traffic.transport,All_Traffic.dest_port | `drop_dm_object_name(""All_Traffic"")` | `is_traffic_prohibited(dest_port)` | search (is_prohibited!=""false"" OR is_secure!=""unknown"") | fields _time,src,src_category,dest,dest_category,transport,dest_port,is_prohibited,is_secure",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Scan Activity By Destination Ports'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(All_Traffic.dest_port) as dest_port_count from datamodel=Network_Traffic.All_Traffic by All_Traffic.src | `drop_dm_object_name(""All_Traffic"")` | sort 10 - dest_port_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Scan Activity By Destinations'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(All_Traffic.dest) as dest_count from datamodel=Network_Traffic.All_Traffic by All_Traffic.src | `drop_dm_object_name(""All_Traffic"")` | sort 10 - dest_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Top Traffic By Destination'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.dest span=1h | `drop_dm_object_name(""All_Traffic"")` | stats sparkline(sum(count),1h) as sparkline,sum(count) as count by dest | sort 100 - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Top Traffic By Destination Port'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by All_Traffic.action,All_Traffic.dest_port | chart count over All_Traffic.dest_port by All_Traffic.action | `drop_dm_object_name(""All_Traffic"")` | `sort_chart`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Top Traffic By Device'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by All_Traffic.action,All_Traffic.dvc | chart count over All_Traffic.dvc by All_Traffic.action | `drop_dm_object_name(""All_Traffic"")` | `sort_chart`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Top Traffic By Source'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.src span=1h | `drop_dm_object_name(""All_Traffic"")` | stats sparkline(sum(count),1h) as sparkline,sum(count) as count by src | sort 100 - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Top Traffic By Source Port'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by All_Traffic.action,All_Traffic.src_port | chart count over All_Traffic.src_port by All_Traffic.action | `drop_dm_object_name(""All_Traffic"")` | `sort_chart`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['Change - Account Management Over Time By Action'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Change.All_Changes where nodename=All_Changes.Account_Management by _time,All_Changes.action span=10m | timechart minspan=10m useother=`useother` count by All_Changes.action | `drop_dm_object_name(""All_Changes"")`",-24h,now,,,number of events,greater than,0,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Top Traffic By Transport'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by All_Traffic.action,All_Traffic.transport | chart count over All_Traffic.transport by All_Traffic.action | `drop_dm_object_name(""All_Traffic"")` | `sort_chart`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time span=10m | timechart minspan=10m count,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Action'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.action span=10m | timechart minspan=10m count by All_Traffic.action | `drop_dm_object_name(""All_Traffic"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Bytes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` min(All_Traffic.bytes),avg(All_Traffic.bytes),max(All_Traffic.bytes) from datamodel=Network_Traffic.All_Traffic where All_Traffic.bytes>0 by _time span=10m  | timechart minspan=10m min(All_Traffic.bytes) as min(bytes),avg(All_Traffic.bytes) as avg(bytes),max(All_Traffic.bytes) as max(bytes) | eval min(bytes)=round('min(bytes)') | eval max(bytes)=round('max(bytes)') | eval avg(bytes)=round('avg(bytes)')",-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Mega-Bytes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` min(All_Traffic.bytes),avg(All_Traffic.bytes),max(All_Traffic.bytes) from datamodel=Network_Traffic.All_Traffic where All_Traffic.bytes>0 by _time span=10m  | timechart minspan=10m min(All_Traffic.bytes) as min(bytes),avg(All_Traffic.bytes) as avg(bytes),max(All_Traffic.bytes) as max(bytes) | eval min(megabytes)=round('min(bytes)'/1024/1024), max(megabytes)=round('max(bytes)'/1024/1024), avg(megabytes)=round('avg(bytes)'/1024/1024) | fields - min(bytes) max(bytes) avg(bytes)",-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Destination'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.dest span=10m | timechart minspan=10m useother=`useother` count by All_Traffic.dest | `drop_dm_object_name(""All_Traffic"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Destination Port'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.dest_port span=10m | timechart minspan=10m useother=`useother` count by All_Traffic.dest_port | `drop_dm_object_name(""All_Traffic"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Device'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.dvc span=10m | timechart minspan=10m useother=`useother` count by All_Traffic.dvc | `drop_dm_object_name(""All_Traffic"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Source'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.src span=10m | timechart minspan=10m useother=`useother` count by All_Traffic.src | `drop_dm_object_name(""All_Traffic"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Source Port'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.src_port span=10m | timechart minspan=10m useother=`useother` count by All_Traffic.src_port | `drop_dm_object_name(""All_Traffic"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Change"".""Account_Management']",['Change - Recent Account Management'],DA-ESS-AccessProtection-default,,,,,,,,,,,,"| from datamodel:""Change"".""Account_Management"" | head 1000",-24h@h,now,,,number of events,greater than,0,,,,0,,,,,,events,,,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,"[""action"", ""src"", ""src_nt_domain"", ""src_user"", ""dest"", ""dest_nt_domain"", ""user""]",true,false,list,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Over Time By Transport Protocol'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Network_Traffic.All_Traffic by _time,All_Traffic.transport span=10m | timechart minspan=10m useother=`useother` count by All_Traffic.transport | `drop_dm_object_name(""All_Traffic"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Size Anomalies Over Time'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Traffic.All_Traffic where [| from inputlookup:traffic_bytes_tracker | search Z=2 | fields search] by _time,All_Traffic.src,All_Traffic.transport span=10m | `drop_dm_object_name(""All_Traffic"")` | `per_panel_filter(""ppf_traffic_size"",""src"")` | timechart minspan=10m sum(count) by All_Traffic",-7d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Traffic - Traffic Size Anomalies'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as lastTime,min(All_Traffic.bytes) as min_bytes,avg(All_Traffic.bytes) as mean_bytes,max(All_Traffic.bytes) as max_bytes,dc(All_Traffic.dest) as dc(dest),count from datamodel=Network_Traffic.All_Traffic where [| from inputlookup:traffic_bytes_tracker | search Z=2 | fields search] by All_Traffic.src | `drop_dm_object_name(""All_Traffic"")` | appendcols [inputlookup append=T start=0 max=1 traffic_bytes_tracker | rename mean_bytes as tracker_mean | fields tracker_mean,stdev] | filldown tracker_mean,stdev | eval Z=round(((mean_bytes-tracker_mean)/stdev),2) | `per_panel_filter(""ppf_traffic_size"",""src"")` | rename ppf_filter as filter | eval bytes=if(min_bytes==mean_bytes AND mean_bytes==max_bytes,floor(min_bytes),""min: "".floor(min_bytes).""|avg: "".floor(mean_bytes).""|max: "".floor(max_bytes)) | `makemv(bytes)` | sort - filter,Z | `uitime(lastTime)` | table src,filter,bytes,dc(dest),count,Z,lastTime",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Traffic - Threat List Activity By Asset - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Threat_Activity.threat_match_field) as threat_match_field,values(Threat_Activity.threat_match_value) as threat_match_value,values(Threat_Activity.threat_collection) as threat_collection,count from datamodel=Threat_Intelligence.Threat_Activity where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Threat List Activity,orange,reverse_asset_lookup,"Threat_Activity.src,Threat_Activity.dest,Threat_Activity.threat_match_value,src,dest,threat_match_value","| from datamodel:""Threat_Intelligence"".""Threat_Activity"" | search $constraints$",Default,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Traffic - Threat List Activity By Identity - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Threat_Activity.threat_match_field) as threat_match_field,values(Threat_Activity.threat_match_value) as threat_match_value,values(Threat_Activity.threat_collection) as threat_collection,count from datamodel=Threat_Intelligence.Threat_Activity where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Threat List Activity,orange,reverse_identity_lookup,"Threat_Activity.src_user,Threat_Activity.user,Threat_Activity.threat_match_value,src_user,user,threat_match_value","| from datamodel:""Threat_Intelligence"".""Threat_Activity"" | search $constraints$",,,Default,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - High Severity Attacks'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-24h@h latest=+0s (IDS_Attacks.severity=""critical"" OR IDS_Attacks.severity=""high"") | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-48h@h latest=-24h@h (IDS_Attacks.severity=""critical"" OR IDS_Attacks.severity=""high"")] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,High Sev. Attacks,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DIntrusion_Detection.IDS_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20(IDS_Attacks.severity%3D%22critical%22%20OR%20IDS_Attacks.severity%3D%22high%22)%20by%20IDS_Attacks.src,1,0,0,all,High Severity Attacks,singlevalue,ids_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Unique Categories'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` dc(IDS_Attacks.category) as current_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` dc(IDS_Attacks.category) as historical_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Attack Categories,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DIntrusion_Detection.IDS_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20IDS_Attacks.category,1,0,0,all,Unique Attack Categories,singlevalue,ids_center,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Unique Signature Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(IDS_Attacks.signature) as current_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(IDS_Attacks.signature) as historical_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Attack Signatures,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DIntrusion_Detection.IDS_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20IDS_Attacks.signature,1,0,0,all,Unique Attack Signatures,singlevalue,ids_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Unique Sources'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(IDS_Attacks.src) as current_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(IDS_Attacks.src) as historical_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Attack Sources,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DIntrusion_Detection.IDS_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20IDS_Attacks.src,1,0,0,all,Unique Attack Sources,singlevalue,ids_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Unique Destinations'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(IDS_Attacks.dest) as current_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(IDS_Attacks.dest) as historical_count from datamodel=Intrusion_Detection.IDS_Attacks where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Attack Destinations,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DIntrusion_Detection.IDS_Attacks%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20IDS_Attacks.dest,1,0,0,all,Unique Attack Destinations,singlevalue,ids_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity By IDS Type'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.ids_type | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity By Category'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.category | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity By Severity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.severity | `drop_dm_object_name(""IDS_Attacks"")` | sort - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Top Attacks By Device'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.signature) as attack_count,dc(IDS_Attacks.src) as src_count,dc(IDS_Attacks.dest) as dest_count,count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.dvc | `drop_dm_object_name(""IDS_Attacks"")` | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Top Attacks By Category'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.signature) as attack_count,dc(IDS_Attacks.src) as src_count,dc(IDS_Attacks.dest) as dest_count,count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.category | `drop_dm_object_name(""IDS_Attacks"")` | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Top Attacks By Severity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.signature) as attack_count,dc(IDS_Attacks.src) as src_count,dc(IDS_Attacks.dest) as dest_count,count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.severity | `drop_dm_object_name(""IDS_Attacks"")`  | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Top Attacks By Attack'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.src) as src_count,dc(IDS_Attacks.dest) as dest_count,count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.signature | `drop_dm_object_name(""IDS_Attacks"")` | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Top Attacks By Source'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.signature) as attack_count,dc(IDS_Attacks.dest) as dest_count,count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.src | `drop_dm_object_name(""IDS_Attacks"")` | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Top Attacks By Destination'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.signature) as attack_count,dc(IDS_Attacks.src) as src_count,count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.dest | `drop_dm_object_name(""IDS_Attacks"")` | sort - count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity Over Time'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| `tstats` count from datamodel=Intrusion_Detection.IDS_Attacks by _time span=10m | timechart minspan=10m useother=`useother` count,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Cloud Provisioning From Previously Unseen City - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search City=* [search sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search City=* | stats earliest(_time) as firstTime, latest(_time) as lastTime by sourceIPAddress, City, Region, Country | inputlookup append=t previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by sourceIPAddress, City, Region, Country | outputlookup previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by City | eval newCity=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newCity=1 | table City] | spath output=user userIdentity.arn | rename sourceIPAddress as src_ip | table _time, user, src_ip, City, eventName, errorCode",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for AWS provisioning activities from previously unseen cities.  Provisioning activities are defined broadly as any event that begins with ""Run"" or ""Create.""",,,,,,1,AWS Cloud Provisioning From Previously Unseen City,,endpoint,medium,AWS Provision Activity From $city$,"Your AWS infrastructure was provisioned from a city, $city$, which has never before been seen provisioning your infrastructure.","src_ip, city",,,,,1,dest,system,30,dest,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns all events with event names that start with ""Run"" or ""Create,"" and then does a `GeoIP` lookup on the IP address that initiated the action within the last hour. It appends the historical data to those results in the lookup file. Next, it recalculates the `firstTime` and `lastTime` field for each country, region, city, and IP address and outputs this data to the lookup file to update the local cache. It then calculates the `firstTime` and `lastTime` for each city. It returns only those events from cities that have first been seen in the past hour. This is combined with the main search to return the time, user, IP address, city, event name, and error code from the action.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen AWS Provisioning Activity Sources"" support search once to create a history of previously seen locations that have provisioned AWS resources.","This is a strictly behavioral search, so we define ""false positive"" slightly differently. Every time this fires, it will accurately reflect the first occurrence in the time period you're searching within, plus what is stored in the cache feature. But while there are really no ""false positives"" in a traditional sense, there is definitely lots of noise. This search will fire any time a new city is seen in the **GeoIP** database for any kind of provisioning activity. If you typically do all provisioning from tools inside of your city, there should be few false positives. If you are located in countries where the free version of **MaxMind GeoIP** that ships by default with Splunk has weak resolution (particularly small countries in less economically powerful regions), this may be much less valuable to you.",2018-03-16,2018-03-16,medium,ESCU - AWS Cloud Provisioning From Previously Unseen City - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Suspicious Provisioning Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get All AWS Activity From CitynESCU - Get All AWS Activity From CountrynESCU - Get All AWS Activity From RegionnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity Over Time By Device'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Intrusion_Detection.IDS_Attacks by _time,IDS_Attacks.dvc span=10m | timechart minspan=10m useother=`useother` count by IDS_Attacks.dvc | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity Over Time By Category'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Intrusion_Detection.IDS_Attacks by _time,IDS_Attacks.category span=10m | timechart minspan=10m useother=`useother` count by IDS_Attacks.category | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity Over Time By Severity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Intrusion_Detection.IDS_Attacks by _time,IDS_Attacks.severity span=10m | timechart minspan=10m useother=`useother` count by IDS_Attacks.severity | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity Over Time By Attack'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Intrusion_Detection.IDS_Attacks by _time,IDS_Attacks.signature span=10m | timechart minspan=10m useother=`useother` count by IDS_Attacks.signature | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity Over Time By Source'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Intrusion_Detection.IDS_Attacks by _time,IDS_Attacks.src span=10m | timechart minspan=10m useother=`useother` count by IDS_Attacks.src | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Activity Over Time By Destination'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Intrusion_Detection.IDS_Attacks by _time,IDS_Attacks.dest span=10m | timechart minspan=10m useother=`useother` count by IDS_Attacks.dest | `drop_dm_object_name(""IDS_Attacks"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Scanning Activity (Many Attacks)'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.signature) as attack_count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.src | `drop_dm_object_name(""IDS_Attacks"")` | sort 10 - attack_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - Scanning Activity (Many Systems)'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(IDS_Attacks.dest) as dest_count from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.src | `drop_dm_object_name(""IDS_Attacks"")` | sort 10 - dest_count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['IDS - New Attacks'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `ids_attack_tracker(firstTime)` | `uitime(firstTime)` | sort 100 - firstTime | fields firstTime,ids_type,signature,vendor_product",-30d@d,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - All IDS Attacks By Asset - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(IDS_Attacks.severity) as severity,values(IDS_Attacks.signature) as signature,values(IDS_Attacks.src) as src,values(IDS_Attacks.dest) as dest,count from datamodel=Intrusion_Detection.IDS_Attacks where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,IDS Attacks,purple,reverse_asset_lookup,"IDS_Attacks.src,IDS_Attacks.dest,src,dest","| from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | search $constraints$",Default,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Cloud Provisioning From Previously Unseen Country - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search Country=* [search sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search Country=* | stats earliest(_time) as firstTime, latest(_time) as lastTime by sourceIPAddress, City, Region, Country | inputlookup append=t previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by sourceIPAddress, City, Region, Country | outputlookup previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by Country | eval newCountry=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newCountry=1 | table Country] | spath output=user userIdentity.arn | rename sourceIPAddress as src_ip | table _time, user, src_ip, Country, eventName, errorCode",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for AWS provisioning activities from previously unseen countries. Provisioning activities are defined broadly as any event that begins with ""Run"" or ""Create.""",,,,,,1,AWS Cloud Provisioning From Previously Unseen Country,,endpoint,medium,AWS Provision Activity From $country$,"Your AWS infrastructure was provisioned from a country, $country$,  which has never before been seen provisioning your infrastructure.","src_ip, country",,,,,1,dest,system,30,dest,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns all events with event names that start with ""Run"" or ""Create,"" and then does a `GeoIP` lookup on the IP address that initiated the action within the last hour. It appends the historical data to those results in the lookup file. Next, it recalculates the `firstTime` and `lastTime` field for each country, region, city, and IP address and outputs this data to the lookup file to update the local cache. It then calculates the `firstTime` and `lastTime` for each country. It returns only those events from countries that have first been seen in the past hour. This is combined with the main search to return the time, user, IP address, city, event name, and error code from the action.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen AWS Provisioning Activity Sources"" support search once to create a history of previously seen locations that have provisioned AWS resources.","This is a strictly behavioral search, so we define ""false positive"" slightly differently. Every time this fires, it will accurately reflect the first occurrence in the time period you're searching over plus what is stored in the cache feature. But while there are really no ""false positives"" in a traditional sense, there is definitely lots of noise. This search will fire any time a new country is seen in the **GeoIP** database for any kind of provisioning activity. If you typically do all provisioning from tools inside of your country, there should be few false positives. If you are located in countries where the free version of **MaxMind GeoIP** that ships by default with Splunk has weak resolution (particularly small countries in less economically powerful regions), this may be much less valuable to you.",2018-03-16,2018-03-16,medium,ESCU - AWS Cloud Provisioning From Previously Unseen Country - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Suspicious Provisioning Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get All AWS Activity From CitynESCU - Get All AWS Activity From CountrynESCU - Get All AWS Activity From RegionnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['IDS - All IDS Attacks By Identity - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(IDS_Attacks.severity) as severity,values(IDS_Attacks.signature) as signature,values(IDS_Attacks.src) as src,values(IDS_Attacks.dest) as dest,count from datamodel=Intrusion_Detection.IDS_Attacks where $constraints$ by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,IDS Attacks,purple,reverse_identity_lookup,"IDS_Attacks.user,user","| from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | search $constraints$",,,Default,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['Change - Network Changes By Action'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Change.All_Changes where nodename=All_Changes.Network_Changes by _time,All_Changes.action span=10m | timechart minspan=10m useother=`useother` count by All_Changes.action | `drop_dm_object_name(""All_Changes"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['Change - Network Changes By Device'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Change.All_Changes where nodename=All_Changes.Network_Changes by All_Changes.dvc | `drop_dm_object_name(""All_Changes"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,,line,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Change"".""Network_Changes']",['Change - Recent Network Changes'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| from datamodel:""Change"".""Network_Changes"" | head 100",-24h@h,now,,,,,,,,,0,,,,,,events,,,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,"[""dvc"", ""action"", ""command""]",true,false,list,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['SSL - Cloud Sessions'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Certificates.All_Certificates where earliest=-24h@h latest=+0s nodename=All_Certificates.SSL `cloud_domain_search(""All_Certificates.SSL.ssl_subject_common_name"")` | appendcols [tstats `summariesonly` count as historical_count from datamodel=Certificates.All_Certificates where earliest=-48h@h latest=-24h@h nodename=All_Certificates.SSL `cloud_domain_search(""All_Certificates.SSL.ssl_subject_common_name"")`] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Cloud Sessions,Session Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DCertificates.All_Certificates%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20nodename%3DAll_Certificates.SSL%20%60cloud_domain_search(%22All_Certificates.SSL.ssl_subject_common_name%22)%60%20by%20All_Certificates.SSL.ssl_subject_common_name,1,0,,all,Cloud Sessions,singlevalue,net_ssl_activity,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['SSL - Short Duration Certificates'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Certificates.All_Certificates where earliest=-24h@h latest=+0s nodename=All_Certificates.SSL All_Certificates.SSL.ssl_validity_window<7776000 | appendcols [tstats `summariesonly` count as historical_count from datamodel=Certificates.All_Certificates where earliest=-48h@h latest=-24h@h nodename=All_Certificates.SSL All_Certificates.SSL.ssl_validity_window<7776000 ] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Short Validity Certs,Session Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DCertificates.All_Certificates%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20nodename%3DAll_Certificates.SSL%20All_Certificates.SSL.ssl_validity_window%3C7776000%20by%20All_Certificates.SSL.ssl_subject_common_name,1,0,,all,Short Validity Certs,singlevalue,net_ssl_activity,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['SSL - Expired Certificates'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Certificates.All_Certificates where nodename=All_Certificates.SSL All_Certificates.SSL.ssl_is_valid=0 earliest=-24h@h latest=+0s  | appendcols [ | tstats `summariesonly` count as historical_count from datamodel=Certificates.All_Certificates where nodename=All_Certificates.SSL All_Certificates.SSL.ssl_is_valid=0 earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Expired Certs,Session Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DCertificates.All_Certificates%20where%20nodename%3DAll_Certificates.SSL%20All_Certificates.SSL.ssl_is_valid%3D0%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Certificates.SSL.ssl_subject_common_name,1,0,,all,Expired Certs,singlevalue,net_ssl_activity,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['SSL - Total SSL Sessions'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Certificates.All_Certificates where earliest=-24h@h latest=+0s nodename=All_Certificates.SSL | appendcols [ | tstats `summariesonly` count as historical_count from datamodel=Certificates.All_Certificates where earliest=-48h@h latest=-24h@h nodename=All_Certificates.SSL] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total SSL Sessions,Session Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DCertificates.All_Certificates%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20nodename%3DAll_Certificates.SSL%20by%20All_Certificates.SSL.ssl_subject_common_name,1,0,,all,Total SSL Sessions,singlevalue,net_ssl_activity,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['SSL - Expired Certs - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count, values(All_Certificates.src) as src, values(All_Certificates.SSL.ssl_subject_common_name) as subject_common_name from datamodel=Certificates.All_Certificates where $constraints$ nodename=All_Certificates.SSL All_Certificates.SSL.ssl_is_valid=0 by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,SSL Expired Certs,orange,reverse_asset_lookup,"All_Certificates.src,All_Certificates.dest,src,dest","| from datamodel:""Certificates"".""All_Certificates"" | search $constraints$",Protocol Intelligence,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Total Vulnerabilities'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Vulnerabilities.Vulnerabilities where earliest=-30d@d latest=+0s `cim_filter_vuln_severity(""Vulnerabilities"")` by Vulnerabilities.signature,Vulnerabilities.dest | stats count as current_count | appendcols [| tstats `summariesonly` count from datamodel=Vulnerabilities.Vulnerabilities where earliest=-60d@d latest=-30d@d `cim_filter_vuln_severity(""Vulnerabilities"")` by Vulnerabilities.signature,Vulnerabilities.dest | stats count as historical_count] | `get_delta`",-60d@d,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Total Vulns,Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DVulnerabilities.Vulnerabilities%20where%20earliest%3D-30d%40d%20latest%3D%2B0s%20%60cim_filter_vuln_severity(%22Vulnerabilities%22)%60%20by%20Vulnerabilities.signature%2CVulnerabilities.dest%20%20,1,0,0,all,Total Vulns,singlevalue,vuln_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Cloud Provisioning From Previously Unseen IP Address - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search Country=* [search sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search Country=* | stats earliest(_time) as firstTime, latest(_time) as lastTime by sourceIPAddress, City, Region, Country | inputlookup append=t previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by sourceIPAddress, City, Region, Country | outputlookup previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by sourceIPAddress | eval newIP=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newIP=1 | table sourceIPAddress] | spath output=user userIdentity.arn | rename sourceIPAddress as src_ip | table _time, user, src_ip, eventName, errorCode",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for AWS provisioning activities from previously unseen IP addresses. Provisioning activities are defined broadly as any event that begins with ""Run"" or ""Create.""",,,,,,1,AWS Cloud Provisioning From Previously Unseen IP Address,,endpoint,medium,AWS Provision Activity From $src_ip$,"Your AWS infrastructure was provisioned from an IP, $src_ip$, which has never before been seen provisioning your infrastructure.",src_ip,,,,,1,src_ip,system,30,src_ip,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns all events with event names that start with ""Run"" or ""Create,"" and then does a `GeoIP` lookup on the IP address that initiated the action within the last hour. It appends the historical data to those results in the lookup file. Next, it recalculates the `firstTime` and `lastTime` field for each country, region, city, and IP address and outputs this data to the lookup file to update the local cache. It then calculates the `firstTime` and `lastTime` for each city. It returns only those events from IP addresses that have first been seen in the past hour. This is combined with the main search to return the time, user, IP address, city, event name, and error code from the action.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen AWS Provisioning Activity Sources"" support search once to create a history of previously seen locations that have provisioned AWS resources.","This is a strictly behavioral search, so we define ""false positive"" slightly differently. Every time this fires, it will accurately reflect the first occurrence in the time period you're searching within, plus what is stored in the cache feature. But while there are really no ""false positives"" in a traditional sense, there is definitely lots of noise. This search will fire any time a new IP address is seen in the **GeoIP** database for any kind of provisioning activity. If you typically do all provisioning from tools inside of your country, there should be few false positives. If you are located in countries where the free version of **MaxMind GeoIP** that ships by default with Splunk has weak resolution (particularly small countries in less economically powerful regions), this may be much less valuable to you.",2018-03-16,2018-03-16,medium,ESCU - AWS Cloud Provisioning From Previously Unseen IP Address - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Suspicious Provisioning Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get All AWS Activity From CitynESCU - Get All AWS Activity From CountrynESCU - Get All AWS Activity From RegionnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Vulnerable System Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(Vulnerabilities.dest) as current_count from datamodel=Vulnerabilities.Vulnerabilities where earliest=-30d@d latest=+0s `cim_filter_vuln_severity(""Vulnerabilities"")` | appendcols [| tstats `summariesonly` estdc(Vulnerabilities.dest) as historical_count from datamodel=Vulnerabilities.Vulnerabilities where earliest=-60d@d latest=-30d@d `cim_filter_vuln_severity(""Vulnerabilities"")`] | `get_delta`",-60d@d,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Vulnerable Systems,System Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DVulnerabilities.Vulnerabilities%20where%20earliest%3D-30d%40d%20latest%3D%2B0s%20%60cim_filter_vuln_severity(%22Vulnerabilities%22)%60%20by%20Vulnerabilities.signature%2CVulnerabilities.dest%20%20,1,0,0,all,Vulnerable Systems,singlevalue,vuln_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Average Vulns Per System'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Vulnerabilities.signature) as signature_count from datamodel=Vulnerabilities.Vulnerabilities where earliest=-30d@d latest=+0s `cim_filter_vuln_severity(""Vulnerabilities"")` by Vulnerabilities.dest | `drop_dm_object_name(""Vulnerabilities"")` | stats avg(signature_count) as current_avg | appendcols [| tstats `summariesonly` dc(Vulnerabilities.signature) as signature_count from datamodel=Vulnerabilities.Vulnerabilities where earliest=-60d@d latest=-30d@d `cim_filter_vuln_severity(""Vulnerabilities"")` by Vulnerabilities.dest | `drop_dm_object_name(""Vulnerabilities"")` | stats avg(signature_count) as historical_avg] | `get_delta(current_avg,historical_avg)`",-60d@d,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Vulns Per System,Average Count,current_avg,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20dc(Vulnerabilities.signature)%20as%20signature_count%20from%20datamodel%3DVulnerabilities.Vulnerabilities%20where%20earliest%3D-30d%40d%20latest%3D%2B0s%20%60cim_filter_vuln_severity(%22Vulnerabilities%22)%60%20by%20Vulnerabilities.dest%20%7C%20%60drop_dm_object_name(%22Vulnerabilities%22)%60%20,0,0,0,all,Average Vulns Per System,singlevalue,vuln_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Percentage Of Vulnerable Systems'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` values(Vulnerabilities.severity) as severity from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.dest | `drop_dm_object_name(""Vulnerabilities"")` | eval filtered_severity=mvfilter((severity!=""informational"" AND severity!=""low"")) | stats count(eval(isnotnull(severity))) as total_systems,count(eval(isnotnull(filtered_severity))) as vulnerable_systems | eval current_percent=round((vulnerable_systems*100)/total_systems,1) | fillnull value=""?"" current_percent",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Vulnerable Systems,Percent Vulnerable,current_percent,,,false,search?q=%7C%20tstats%20%60summariesonly%60%20values(Vulnerabilities.severity)%20as%20severity%20from%20datamodel%3DVulnerabilities.Vulnerabilities%20by%20Vulnerabilities.dest%20%7C%20%60drop_dm_object_name(%22Vulnerabilities%22)%60%20,1,0,0,all,Percent Of Systems Vulnerable,singlevalue,vuln_center,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,%,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Vuln - Average Vulnerability Age'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| `vulnerability_tracker(lastTime)` | where firstTime!=lastTime | eval dayDiff=(lastTime-firstTime)/86400 | stats avg(dayDiff) as current_avg,-90d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Vulnerability Age,Average days,current_avg,,,false,search?q=%7C%20tstats%20%60summariesonly%60%20min(_time)%20as%20firstTime%2Cmax(_time)%20as%20lastTime%2Ccount%20from%20datamodel%3DVulnerabilities.Vulnerabilities%20by%20Vulnerabilities.signature%2CVulnerabilities.dest%20%7C%20%60drop_dm_object_name(%22Vulnerabilities%22)%60%20%7C%20where%20firstTime!%3DlastTime%20AND%20(now()-lastTime)%3C2592000,1,0,0,all,Average Vulnerability Age,singlevalue,vuln_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Vulnerabilities"".""Vulnerabilities']",['Network - Vulnerability Tracker - Lookup Gen'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true min(_time) as ""firstTime"",max(_time) as ""lastTime"" from datamodel=""Vulnerabilities"".""Vulnerabilities"" where    ""Vulnerabilities.severity"" != ""informational"" AND ""Vulnerabilities.severity"" != ""low"" by ""Vulnerabilities.signature"",""Vulnerabilities.dest""  | rename ""Vulnerabilities.signature"" as ""signature"",""Vulnerabilities.dest"" as ""dest"" | inputlookup append=T ""vulnerability_tracker"" | stats min(firstTime) as ""firstTime"",max(lastTime) as ""lastTime"" by ""signature"",""dest"" | where strptime('lastTime', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""vulnerability_tracker"" | stats count",-70m@m,+0s,,true,,,,50 * * * *,,,,,,,"Maintains a list of Vulnerabilities by signature, destination and the first and last time they were seen.",,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",     ""search"": {        ""datamodel"":     ""Vulnerabilities"",        ""object"":        ""Vulnerabilities"",        ""earliest"":      ""-70m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   ""'Vulnerabilities.severity' != ""informational"" AND 'Vulnerabilities.severity' != ""low"""",        ""aggregates"":    [{""function"":""min"",""attribute"":""_time"",""alias"":""firstTime""},                          {""function"":""max"",""attribute"":""_time"",""alias"":""lastTime""}],        ""splitby"":       [{""attribute"":""Vulnerabilities.signature"",""alias"":""signature""},                          {""attribute"":""Vulnerabilities.dest"",""alias"":""dest""}],        ""summariesonly"": true,        ""outputlookup"":  ""vulnerability_tracker"",        ""retention"":     {            ""earliestTime"":""-5y"",            ""timeField"":""lastTime"",            ""timeFormat"":""%s""        }    }}",,,,,,,,,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Top Vulnerabilities'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Vulnerabilities.dest) as dest_count from datamodel=Vulnerabilities.Vulnerabilities where * `cim_filter_vuln_severity(""Vulnerabilities"")` by Vulnerabilities.signature | `drop_dm_object_name(""Vulnerabilities"")` | sort 10 - dest_count",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Most Vulnerable Hosts'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Vulnerabilities.signature) as vuln_count from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.severity,Vulnerabilities.dest | chart useother=`useother` first(vuln_count) over Vulnerabilities.dest by Vulnerabilities.severity | `drop_dm_object_name(""Vulnerabilities"")` | eval total=case(critical>0 AND high>0,critical+high,critical>0,critical,high>0,high,1==1,0) | eval subTotal=case(medium>0 AND low>0,medium+low,medium>0,medium,low>0,low,1==1,0) | eval subSubTotal=case(informational>0 AND unknown>0,informational+unknown,informational>0,informational,unknown>0,unknown,1==1,0) | sort 10 - total,subTotal,subSubTotal | fields - total,subTotal,subSubTotal",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Vulnerabilities By Category'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Vulnerabilities.signature) as vuln_count from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.category,Vulnerabilities.dest | `drop_dm_object_name(""Vulnerabilities"")` | stats sum(vuln_count) as count by category",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Vulnerabilities By Severity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Vulnerabilities.signature) as vuln_count from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.severity,Vulnerabilities.dest | `drop_dm_object_name(""Vulnerabilities"")` | stats sum(vuln_count) as count by severity",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Vuln - New Vulnerabilities'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `vuln_signature_reference(firstTime)` | `uitime(firstTime)` | sort 100 - firstTime | `makemv(cve)` | fields firstTime,signature,cve,vendor_product",-30d@d,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Cloud Provisioning From Previously Unseen Region - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search Region=* [search sourcetype=aws:cloudtrail (eventName=Run* OR eventName=Create*) | iplocation sourceIPAddress | search Region=* | stats earliest(_time) as firstTime, latest(_time) as lastTime by sourceIPAddress, City, Region, Country | inputlookup append=t previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by sourceIPAddress, City, Region, Country | outputlookup previously_seen_provisioning_activity_src.csv | stats min(firstTime) as firstTime max(lastTime) as lastTime by Region | eval newRegion=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newRegion=1 | table Region] | spath output=user userIdentity.arn | rename sourceIPAddress as src_ip | table _time, user, src_ip, Region, eventName, errorCode",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for AWS provisioning activities from previously unseen regions. Region in this context is similar to a state in the United States. Provisioning activities are defined broadly as any event that begins with ""Run"" or ""Create.""",,,,,,1,AWS Cloud Provisioning From Previously Unseen Region,,endpoint,medium,AWS Provision Activity From $region$,"Your AWS infrastructure was provisioned from a region, $Region$, which has never before been seen provisioning your infrastructure.","src_ip, Region",,,,,1,dest,system,30,dest,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""cis20"": [""CIS 1""], ""nist"": [""ID.AM""]}","The subsearch returns all events with event names that start with ""Run"" or ""Create,"" and then does a `GeoIP` lookup on the IP address that initiated the action within the last hour. It appends the historical data to those results in the lookup file. Next, it recalculates the `firstTime` and `lastTime` field for each country, region, city, and IP address and outputs this data to the lookup file to update the local cache. It then calculates the `firstTime` and `lastTime` for each city. It returns only those events from regions that have first been seen in the past hour. This is combined with the main search to return the time, user, IP address, city, event name, and error code from the action.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. This search works best when you run the ""Previously Seen AWS Provisioning Activity Sources"" support search once to create a history of previously seen locations that have provisioned AWS resources.","This is a strictly behavioral search, so we define ""false positive"" slightly differently. Every time this fires, it will accurately reflect the first occurrence in the time period you're searching within, plus what is stored in the cache feature. But while there are really no ""false positives"" in a traditional sense, there is definitely lots of noise. This search will fire any time a new region is seen in the **GeoIP** database for any kind of provisioning activity. If you typically do all provisioning from tools inside of your region, there should be few false positives. If you are located in regions where the free version of **MaxMind GeoIP** that ships by default with Splunk has weak resolution (particularly small countries in less economically powerful regions), this may be much less valuable to you.",2018-03-16,2018-03-16,medium,ESCU - AWS Cloud Provisioning From Previously Unseen Region - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Suspicious Provisioning Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get All AWS Activity From CitynESCU - Get All AWS Activity From CountrynESCU - Get All AWS Activity From RegionnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Scan Activity Over Time'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` dc(Vulnerabilities.dest) from datamodel=Vulnerabilities.Vulnerabilities by _time span=1d | timechart minspan=1d dc(Vulnerabilities.dest) as ""dc(dest)""",-365d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Vuln - Vulnerabilities By Age'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `vulnerability_tracker(lastTime)` | where firstTime!=lastTime | eval timeDiff=lastTime-firstTime | sort 100 - timeDiff,lastTime | eval ""Age (days)""=round(timeDiff/86400,1) | `uitime(firstTime)` | `uitime(lastTime)` | fields firstTime,lastTime,signature,dest,""Age (days)""",-90d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Vuln - Delinquent Scanning'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime,max(_time) as lastTime from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.dest | `drop_dm_object_name(""Vulnerabilities"")` | `dayDiff(lastTime)` | eval dayDiff=round(dayDiff,1) | `uitime(firstTime)` | `uitime(lastTime)` | sort 100 + lastTime",-365d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Abnormally High Number of HTTP Method Events By Src - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` count as web_event_count from datamodel=Web.Web by Web.src, Web.http_method | `drop_dm_object_name(""Web"")` | xswhere web_event_count FROM count_by_http_method_by_src_1d in web by http_method is above high",-1450m@m,+0s,,1,number of events,greater than,0,50 * * * *,1,1,false,,,,Alerts when a host has an abnormally high number of HTTP requests by http method.,,,,,0,1,Abnormally High Number of HTTP Method Events By Src,0,network,medium,Abnormally High Number of HTTP $http_method$ Request Events By $src$,A system ($src$) was detected as generating an abnormally high number of $http_method$ request events.,"src,http_method",View Web Activity on $src$,"| from datamodel:""Web"".""Web"" | search src=""$src$""",,,1,src,system,60,"src, http_method",86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,"[""Web - Web Event Count By Src By HTTP Method Per 1d - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Web"".""Web']",['Network - Excessive HTTP Failure Responses - Rule'],DA-ESS-NetworkProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true count from datamodel=""Web"".""Web"" where    (""Web.status""=400 OR ""Web.status""=403 OR ""Web.status""=404 OR ""Web.status""=411 OR ""Web.status""=500 OR ""Web.status""=501) by ""Web.dest"" | rename ""Web.dest"" as ""dest"" | where 'count'>50",-70m@m,+0s,,1,number of events,greater than,0,40 * * * *,1,1,0,,,,Alerts when a host generates a lot of HTTP failures in a short span of time,,,,,0,1,Excessive HTTP Failure Responses,0,network,high,Excessive HTTP Failure Responses ($dest$),A system ($dest$) was detected sending a high number of HTTP failure responses ($count$).,dest,View Web Activity on $dest$,"| from datamodel:""Web"".""Web"" | search dest=""$dest$""",,,1,dest,system,60,dest,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Web"",         ""object"":        ""Web"",         ""earliest"":      ""-70m@m"",         ""latest"":        ""+0s"",         ""eventFilter"":   ""('Web.status'=400 OR 'Web.status'=403 OR 'Web.status'=404 OR 'Web.status'=411 OR 'Web.status'=500 OR 'Web.status'=501)"",         ""aggregates"":    [{""function"": ""count""}],         ""splitby"":       [{""attribute"": ""Web.dest"", ""alias"": ""dest""}],         ""resultFilter"":  {""field"": ""count"", ""comparator"": "">"", ""value"": ""50""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Network - User Agent Length Tracker - Lookup Gen'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(Web.http_user_agent_length) as min_length,avg(Web.http_user_agent_length) as mean_length,max(Web.http_user_agent_length) as max_length,stdev(Web.http_user_agent_length) as stdev,count as total_count from datamodel=Web.Web where Web.http_user_agent!=""unknown"" | appendcols [| from inputlookup:standard_deviations | rename stdev as standard_deviation] | filldown | fillnull value=0 min_length,mean_length,max_length,stdev,total_count | `stdev_desired_result(standard_deviation,mean_length,""gt_length"")` | `stdev_desired_result(-standard_deviation,mean_length,""lt_length"")` | eval search=case(gt_length>0 AND lt_length>0, ""(Web.http_user_agent_length>"".floor(gt_length)."" OR Web.http_user_agent_length<"".ceil(lt_length)."")"",gt_length>0 AND lt_length<=0,""Web.http_user_agent_length>"".floor(gt_length),gt_length<=0 AND lt_length>0,""Web.http_user_agent_length<"".ceil(lt_length),gt_length<=0 AND lt_length<=0,""Web.http_user_agent_length=-1"") | rename standard_deviation as Z | rename total as total_count | fields min_length,mean_length,max_length,stdev,total_count,Z,search | `round(mean_length)` | `round(stdev)` | outputlookup user_agent_length_tracker | stats count",-90d,+0s,,1,,,,"10 0,4,8,12,16,20 * * *",,,,,,,Maintains Web user agent length statistics,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Network - URL Length Tracker - Lookup Gen'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(Web.url_length) as min_length,avg(Web.url_length) as mean_length,max(Web.url_length) as max_length,stdev(Web.url_length) as stdev,count as total_count from datamodel=Web.Web where Web.url!=""unknown"" | appendcols [| from inputlookup:standard_deviations | rename stdev as standard_deviation] | filldown | fillnull value=0 min_length,mean_length,max_length,stdev,total_count | `stdev_desired_result(standard_deviation,mean_length,""gt_length"")` | `stdev_desired_result(-standard_deviation,mean_length,""lt_length"")` | eval search=case(gt_length>0 AND lt_length>0,""(Web.url_length>"" .floor(gt_length)."" OR Web.url_length<"".ceil(lt_length)."" OR url_length>"".floor(gt_length)."" OR url_length<"".ceil(lt_length)."")"",gt_length>0 AND lt_length<=0,""(Web.url_length>"".floor(gt_length)."" OR url_length>"".floor(gt_length)."")"",gt_length<=0 AND lt_length>0,""(Web.url_length<"".ceil(lt_length)."" OR url_length<"".ceil(lt_length)."")"",gt_length<=0 AND lt_length<=0,""(Web.url_length=-1 OR url_length=-1)"") | rename standard_deviation as Z | rename total as total_count | fields min_length,mean_length,max_length,stdev,total_count,Z,search | `round(mean_length)` | `round(stdev)` | outputlookup url_length_tracker | stats count",-90d,+0s,,1,,,,"30 0,4,8,12,16,20 * * *",,,,,,,Maintains Web url length statistics,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - HTTP Category Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Web.category) as current_count from datamodel=Web.Web where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Web.category) as historical_count from datamodel=Web.Web where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Categories,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Web.category,1,0,0,all,Unique HTTP Category Count,singlevalue,http_category,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,web_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - HTTP Category Maximum Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_max from datamodel=Web.Web where earliest=-24h@h latest=+0s by Web.category | sort 1 - current_max | `drop_dm_object_name(""Web"")` | eval label=current_max."" event(s) for HTTP category: "".category | appendcols [| tstats `summariesonly` count as historical_max from datamodel=Web.Web where earliest=-48h@h latest=-24h@h by Web.category | sort 1 - historical_max | `drop_dm_object_name(""Web"")`] | fields label,current_max,historical_max | `get_delta(current_max,historical_max)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Maximum Count,Count,current_max,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Web.category%20%7C%20%60drop_dm_object_name(%22Web%22)%60,1,0,0,all,Maximum Count,singlevalue,http_category,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - HTTP Category Mean Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web where earliest=-24h@h latest=+0s by Web.category | stats avg(count) as current_mean | appendcols [| tstats `summariesonly` count from datamodel=Web.Web where earliest=-48h@h latest=-24h@h by Web.category | stats avg(count) as historical_mean] | `get_delta(current_mean,historical_mean)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Mean Count,Count,current_mean,,delta,false,search?q=%20%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Web.category%20,1,0,0,all,Mean Count,singlevalue,http_category,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Cross Account Activity From Previously Unseen Account - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=AssumeRole | spath output=requestingAccountId path=userIdentity.accountId | spath output=requestedAccountId path=resources{}.accountId | search requestingAccountId=* | where requestingAccountId != requestedAccountId | inputlookup append=t previously_seen_aws_cross_account_activity | multireport [| stats min(eval(coalesce(firstTime, strptime(_time,""%Y-%m-%d %H:%M:%S"")))) as firstTime max(eval(coalesce(strptime(_time,""%Y-%m-%d %H:%M:%S""), lastTime))) as lastTime by requestingAccountId, requestedAccountId | outputlookup previously_seen_aws_cross_account_activity | where fact=fiction] [| eventstats min(eval(coalesce(firstTime, strptime(_time,""%Y-%m-%d %H:%M:%S"")))) as firstTime, max(eval(coalesce(strptime(_time,""%Y-%m-%d %H:%M:%S""), lastTime))) as lastTime by requestingAccountId, requestedAccountId | where firstTime >= relative_time(now(), ""-70m@m"") AND isnotnull(_time) | spath output=accessKeyId path=responseElements.credentials.accessKeyId | spath output=requestingARN path=resources{}.ARN | stats values(awsRegion) as awsRegion values(firstTime) as firstTime values(lastTime) as lastTime values(sharedEventID) as sharedEventID, values(requestingARN) as src_user, values(responseElements.assumedRoleUser.arn) as dest_user by _time, requestingAccountId, requestedAccountId, accessKeyId] | table _time, firstTime, lastTime, src_user, requestingAccountId, dest_user, requestedAccountId, awsRegion, accessKeyId, sharedEventID",-70m@m,-10m@m,,1,number of events,greater than,0,5 * * * *,1,1,,,,,This search looks for AssumeRole events where an IAM role in a different account is requested for the first time.,,,,,,1,AWS Cross Account Activity From Previously Unseen Account,,network,medium,AWS Account $dest_user$ access by $src_user$,Access to $dest_user$ was requested for the first time by $src_user$,"requestingAccountId, requestedAccountId, src_user, dest_user",,,,,1,dest_user,user,20,"requestingAccountId, requestedAccountId",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 16""], ""nist"": [""PR.AC"", ""PR.DS"", ""DE.AE""]}","This search1. Retrieves the **AssumeRole** event1. Verifies that the log entry contains a value for the account ID of the requesting account1. Ensures that the requesting account ID does not match the account ID of the requested account1. Pulls in the previously seen requesting and requested account IDs1. Splits up and executes multiple search paths at the same.1. The first path determines the **firstTime** and **lastTime** entries for the cache file1. Outputs the data to the cache file.1. Creates a conditional statement that is always false (both because we don't want these values to exit the search pipeline and because we think we're clever).The second pipeline adds the **firstTime** and **lastTime** entries to search results. Next, it filters out any account pairs that haven't been seen for the first time within the last hour. The `isnotnull(_time)` will remove the entries from the cache file.The search finishes by gathering the data that it will display to the user.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Run the `Previously Seen AWS Cross Account Activity` support search only once to create the baseline of previously seen cross account activity. Thanks to Pablo Vega at Recurly for suggesting improvements to the search.",Using multiple AWS accounts and roles is perfectly valid behavior. It's suspicious when an account requests privileges of an account it hasn't before. You should validate with the account owner that this is a legitimate request.,2018-02-01,2018-11-02,medium,ESCU - AWS Cross Account Activity From Previously Unseen Account - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Cross Account Activity""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - AWS Investigate User Activities By AccessKeyIdnESCU - AWS Investigate User Activities By Source Usern""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - HTTP Category Minimum Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_min from datamodel=Web.Web where earliest=-24h@h latest=+0s by Web.category | sort 1 + current_min | `drop_dm_object_name(""Web"")` | eval label=current_min."" event(s) for HTTP category: "".category | appendcols [| tstats `summariesonly` count as historical_min from datamodel=Web.Web where earliest=-48h@h latest=-24h@h by Web.category | sort 1 + historical_min | `drop_dm_object_name(""Web"")`] | fields label,current_min,historical_min | `get_delta(current_min,historical_min)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Minimum Count,Count,current_min,,delta,false,search?q=%20%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Web.category%20,1,0,0,all,Minimum Count,singlevalue,http_category,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - HTTP Category Standard Deviation Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web where earliest=-24h@h latest=+0s by Web.category | stats stdev(count) as current_stdev | appendcols [| tstats `summariesonly` count from datamodel=Web.Web where earliest=-48h@h latest=-24h@h by Web.category | stats stdev(count) as historical_stdev] | `get_delta(current_stdev,historical_stdev)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Stdev Count,Count,current_stdev,,delta,false,search?q=%20%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Web.category%20,1,0,0,all,Standard Deviation Count,singlevalue,http_category,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Web.url) as current_count from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.url!=unknown | appendcols [| tstats `summariesonly` estdc(Web.url) as historical_count from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.url!=unknown] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique URLs,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.url!%3Dunknown%20by%20Web.url,1,0,0,all,Unique URL Count,singlevalue,url_length,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,web_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Maximum Length'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(Web.url_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.url!=unknown | appendcols [| tstats `summariesonly` max(Web.url_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.url!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Maximum URL Length,Max Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.url!%3Dunknown%20by%20Web.url%20Web.url_length%20%7C%20sort%20-Web.url_length,1,0,0,all,Maximum URL Length,singlevalue,url_length,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Mean Length'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` avg(Web.url_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.url!=unknown | appendcols [| tstats `summariesonly` avg(Web.url_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.url!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Mean URL Length,Mean Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.url!%3Dunknown%20by%20Web.url%20Web.url_length%20%7C%20sort%20-Web.url_length,1,0,0,all,Mean URL Length,singlevalue,url_length,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Minimum Length'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(Web.url_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.url!=unknown | appendcols [| tstats `summariesonly` min(Web.url_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.url!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Minimum URL Length,Min Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.url!%3Dunknown%20by%20Web.url%20Web.url_length%20%7C%20sort%20-Web.url_length,1,0,0,all,Minimum URL Length,singlevalue,url_length,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Length Standard Deviation'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` stdev(Web.url_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.url!=unknown | appendcols [| tstats `summariesonly` stdev(Web.url_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.url!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Stdev URL Length,Stdev Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.url!%3Dunknown%20by%20Web.url%20Web.url_length%20%7C%20sort%20-Web.url_length,1,0,0,all,URL Length Standard Deviation,singlevalue,url_length,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - User Agent Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Web.http_user_agent) as current_count from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.http_user_agent!=unknown | appendcols [| tstats `summariesonly` estdc(Web.http_user_agent) as historical_count from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.http_user_agent!=unknown] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique User Agents,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.http_user_agent!%3Dunknown%20by%20Web.http_user_agent,1,0,0,all,Unique User Agents,singlevalue,http_user_agent,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,web_center,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - User Agent Maximum Length'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(Web.http_user_agent_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.http_user_agent!=unknown | appendcols [| tstats `summariesonly` max(Web.http_user_agent_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.http_user_agent!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Maximum UA Length,Max Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.http_user_agent!%3Dunknown%20by%20Web.http_user_agent,1,0,0,all,Maximum User Agent Length,singlevalue,http_user_agent,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - User Agent Mean Length'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` avg(Web.http_user_agent_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.http_user_agent!=unknown | appendcols [| tstats `summariesonly` avg(Web.http_user_agent_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.http_user_agent!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Mean UA Length,Mean Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.http_user_agent!%3Dunknown%20by%20Web.http_user_agent,1,0,0,all,Mean User Agent Length,singlevalue,http_user_agent,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Network Access Control List Created with All Open Ports - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail eventName=CreateNetworkAclEntry | mvexpand requestParameters | mvexpand responseElements | search requestParameters.portRange.from=1024 requestParameters.portRange.to=65525 requestParameters.ruleAction=allow | rename userIdentity.arn as arn | rename requestParameters.networkAclId as networkAclId | table _time aws_account_id src userName arn networkAclId requestParameters.* responseElements.*,-1d@d,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for CloudTrail events to detect if any network ACLs were created with all the ports open to a specified CIDR.,,,,,,1,AWS Network Access Control List Created with All Open Ports,,network,medium,Network ACL created with all ports open by $src_user$,$src_user$ created a network access control list with all ports open.,"account_id, src, src_user",,,,,1,src_user,user,30,src_user,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 11""], ""nist"": [""DE.DP"", ""DE.AE""]}","A network access control list (ACL) is a layer of security for your VPC that acts as a firewall for controlling traffic in and out of one or more subnets. Network ACLs with all open ports have a larger attack surface. This search looks for events within your CloudTrail logs to check if there were any Network ACLs created with ports ranging from 1024 to 65525. This search will create a table comprised of AWS account id, src, user and all parameters of the request made by the user and the server response.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS, version 4.4.0 or later, and configure your CloudTrail inputs.","It's possible that an admin has created this ACL with all ports open for some legitimate purpose however, this should be scoped and not allowed in production environment.",2017-01-08,2017-01-10,medium,ESCU - AWS Network Access Control List Created with All Open Ports - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Network ACL Activity""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - AWS Network ACL Details from IDnESCU - AWS Network Interface details via resourceIdnESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['example get devices from axl'],cisco_cdr-default,,,1,,,,,,,,,"| ciscoaxlquery ""select 'devices' AS src,eu.userid, eu.lastname, eu.firstname, eu.middlename, eu.manager, eu.department, eu.telephonenumber, eu.mailid, eu.mobile, eu.homephone, eu.title, eu.nickname,d.name AS name, d.description AS description, n.dnorpattern as DN, n.description as numplandescription, rp.name as partition, css.name as callingsearchspacename,dp.name as devicepool, sp.name as securityprofilename, tdp.name as protocol, tp.name as productnamefrom device as dinner join devicenumplanmap as dnpm on dnpm.fkdevice = d.pkidleft join enduserdevicemap as eudm on eudm.fkdevice=d.pkidleft join enduser as eu on eudm.fkenduser=eu.pkidinner join numplan as n on dnpm.fknumplan = n.pkid and d.tkclass = 1left join routepartition as rp on rp.pkid = n.fkroutepartitionleft join callingsearchspace css on css.pkid = d.fkcallingsearchspaceleft join devicepool dp on d.fkdevicepool = dp.pkidleft join securityprofile sp on sp.pkid = d.fksecurityprofileleft join typedeviceprotocol tdp on tdp.enum = d.tkdeviceprotocolleft join typeproduct tp on tp.enum = d.tkproductUNIONselect 'lines' as src,' ' as userid, ' ' as lastname, ' ' as firstname, ' ' as middlename, ' ' as manager, ' ' as department, ' ' as telephonenumber, ' ' as mailid, ' ' as mobile, ' ' as homephone, ' ' as title, ' ' as nickname,d.name AS name, d.description AS description, n.dnorpattern as DN, n.description as numplandescription, rp.name as partition, css.name as callingsearchspacename,dp.name as devicepool, sp.name as securityprofilename, tdp.name as protocol, tp.name as productnamefrom device as dinner join devicenumplanmap as dnpm on dnpm.fkdevice = d.pkidAND dnpm.pkid NOT IN (select dnpeum.fkdevicenumplanmap from devicenumplanmapendusermap as dnpeum)inner join numplan as n on dnpm.fknumplan = n.pkid and d.tkclass = 1left join routepartition as rp on rp.pkid = n.fkroutepartitionleft join callingsearchspace css on css.pkid = d.fkcallingsearchspaceleft join devicepool dp on d.fkdevicepool = dp.pkidleft join securityprofile sp on sp.pkid = d.fksecurityprofileleft join typedeviceprotocol tdp on tdp.enum = d.tkdeviceprotocolleft join typeproduct tp on tp.enum = d.tkproduct""| eval userFullName = lastname . "", "" . firstname| rename devicepool AS devicePool, productname as productName, mailid AS mailId, userid AS userId, callingsearchspacename AS callingSearchSpaceName, securityprofilename AS securityProfileName| fillnull value=""""| stats first(productName) as productName, first(department) AS department, first(mailId) AS mailId, first(userFullName) AS userFullName, first(userId) AS userId count BY name,description,devicePool,callingSearchSpaceName,protocol,securityProfileName| table name,productName,department,description,devicePool,mailId,userFullName,userId,callingSearchSpaceName,protocol,securityProfileName",-24h@h,now,,,,,,,,,0,,,1,Retrieves devices with either device-level assignment or line-level assignment from AXL (relies on sa_cisco_cdr_axl TA).  Should be scheduled.,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - User Agent Minimum Length'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(Web.http_user_agent_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.http_user_agent!=unknown | appendcols [| tstats `summariesonly` min(Web.http_user_agent_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.http_user_agent!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Minimum UA Length,Min Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.http_user_agent!%3Dunknown%20by%20Web.http_user_agent,1,0,0,all,Minimum User Agent Length,singlevalue,http_user_agent,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - User Agent Length Standard Deviation'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` stdev(Web.http_user_agent_length) as current_length from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.http_user_agent!=unknown | appendcols [| tstats `summariesonly` stdev(Web.http_user_agent_length) as historical_length from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.http_user_agent!=unknown] | `get_delta(current_length,historical_length)`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Stdev UA Length,Stdev Length,current_length,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.http_user_agent!%3Dunknown%20by%20Web.http_user_agent,1,0,0,all,User Agent Length Standard Deviation,singlevalue,http_user_agent,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Destination Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Web.dest) as current_count from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.dest!=unknown | appendcols [| tstats `summariesonly` estdc(Web.dest) as historical_count from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.dest!=unknown] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Destinations,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.http_user_agent!%3Dunknown%20by%20Web.http_user_agent,1,0,0,all,Unique Destinations,singlevalue,web_center,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Source Count'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Web.src) as current_count from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.src!=unknown | appendcols [| tstats `summariesonly` estdc(Web.src) as historical_count from datamodel=Web.Web where earliest=-48h@h latest=-24h@h Web.src!=unknown] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Unique Sources,Unique Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20from%20datamodel%3DWeb.Web%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Web.dest!%3Dunknown%20by%20Web.src,1,0,0,all,Unique Sources,singlevalue,web_center,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Events Over Time By Action'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Web.Web by _time,Web.action span=10m | timechart minspan=10m useother=`useother` count by Web.action | `drop_dm_object_name(""Web"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Events Over Time By Content Type'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Web.Web by _time,Web.http_content_type span=10m | timechart minspan=10m useother=`useother` count by Web.http_content_type | `drop_dm_object_name(""Web"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Events Over Time By Method'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Web.Web by _time,Web.http_method span=10m | timechart minspan=10m useother=`useother` count by Web.http_method | `drop_dm_object_name(""Web"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Events Over Time By Status'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Web.Web by _time,Web.status span=10m | timechart minspan=10m useother=`useother` count by Web.status | `drop_dm_object_name(""Web"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Events Over Time By User Agent'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Web.Web by _time,Web.http_user_agent span=10m | timechart minspan=10m useother=`useother` count by Web.http_user_agent | `drop_dm_object_name(""Web"")`",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Total Events By Action'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web by Web.action | `drop_dm_object_name(""Web"")` | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - AWS Network Access Control List Deleted - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail eventName=DeleteNetworkAcl|rename userIdentity.arn as arn  | stats count min(_time) as firstTime max(_time) as lastTime values(errorMessage) values(errorCode) values(userAgent) values(userIdentity.*) by src userName arn eventName | `ctime(lastTime)` | `ctime(firstTime)`,-1d@d,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"Enforcing network-access controls is one of the defensive mechanisms used by cloud administrators to restrict access to a cloud instance. After the attacker has gained control of the AWS console by compromising an admin account, they can delete a network ACL and gain access to the instance from anywhere. This search will query the CloudTrail logs to detect users deleting network ACLs.",,,,,,1,AWS Network Access Control List Deleted,,network,medium,AWS Network ACL deleted by $src_user$,AWS network ACL has been deleted by $src_user.,"src, src_user, eventName",,,,,1,src_user,user,80,src_user,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 11""], ""nist"": [""DE.DP"", ""DE.AE""]}","The search looks for CloudTrail events to detect whether any network ACLs have been deleted and gives you values of error messages and error codes (if any), user details, user source IP, the user who initiated this request, and the name of the event.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",It's possible that a user has legitimately deleted a network ACL.,2017-01-08,2017-01-10,medium,ESCU - AWS Network Access Control List Deleted - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Network ACL Activity""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - AWS Network ACL Details from IDnESCU - AWS Network Interface details via resourceIdnESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Total Events By Content Type'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web by Web.http_content_type | `drop_dm_object_name(""Web"")` | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Total Events By Method'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web by Web.http_method | `drop_dm_object_name(""Web"")` | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Total Events By Status'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web by Web.status | `drop_dm_object_name(""Web"")` | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Total Events By User Agent'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web by Web.http_user_agent | `drop_dm_object_name(""Web"")` | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,350,,,,count,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Top Sources'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Web.dest) as dc(dest),dc(Web.url) as dc(url),count,sum(Web.bytes) as bytes from datamodel=Web.Web by Web.src | `drop_dm_object_name(""Web"")` | sort 100 - bytes",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Top Destinations'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Web.src) as dc(src),dc(Web.url) as dc(url),count,sum(Web.bytes) as bytes from datamodel=Web.Web by Web.dest | `drop_dm_object_name(""Web"")` | sort 100 - bytes",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Length Over Time'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| `tstats` min(Web.url_length),avg(Web.url_length),max(Web.url_length) from datamodel=Web.Web by _time span=10m | timechart minspan=10m min(Web.url_length) as min(length),avg(Web.url_length) as avg(length),max(Web.url_length) as max(length)",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,connect,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - HTTP Category Details'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as lastTime,dc(Web.src) as dc(src),dc(Web.dest) as dc(dest),count from datamodel=Web.Web by Web.category | `drop_dm_object_name(""Web"")` | join type=outer category [| tstats `summariesonly` count from datamodel=Web.Web where earliest=-24h@h latest=+0s by _time,Web.category span=`http_category_sparkline_span` | stats sparkline(sum(count),`http_category_sparkline_span`) as sparkline by Web.category | `drop_dm_object_name(""Web"")`] | `makemv(sparkline,"","")` | eventstats avg(count) as mean_count,stdev(count) as stdev | `get_stdev_index(count)` | `round(Z)` | `per_panel_filter(""ppf_http_category"",""category"")` | rename ppf_filter as filter | sort -filter,+count | `uitime(lastTime)` | table category,filter,sparkline,dc(src),dc(dest),count,Z,lastTime",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - HTTP Category Distribution'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Web.src) as dc(src),count from datamodel=Web.Web by Web.category | eval category='Web.category' | `per_panel_filter(""ppf_http_category"",""category"")` | table category,count,dc(src)",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,,scatter,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Length Anomalies'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as lastTime,latest(Web.url_length) as length,dc(Web.src) as dc(src),dc(Web.dest) as dc(dest),count from datamodel=Web.Web where Web.url!=""unknown"" [| from inputlookup:url_length_tracker | search Z=2 | fields search] by Web.url | `drop_dm_object_name(""Web"")` | appendcols[| inputlookup append=T start=0 max=1 url_length_tracker | fields mean_length,stdev] | filldown mean_length,stdev | `get_stdev_index(length)` | `round(Z)`| `per_panel_filter(""ppf_url_length"",""url"")` | rename ppf_filter as filter | sort - filter,Z | `uitime(lastTime)` | table url,filter,length,dc(src),dc(dest),count,Z,lastTime",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,1,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Abnormally High AWS Instances Launched by User - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success | bucket span=10m _time | stats count AS instances_launched by _time userName | eventstats avg(instances_launched) as total_launched_avg, stdev(instances_launched) as total_launched_stdev | eval threshold_value = 4 | eval isOutlier=if(instances_launched > total_launched_avg+(total_launched_stdev * threshold_value), 1, 0) | search isOutlier=1 AND _time >= relative_time(now(), ""-10m@m"") | eval num_standard_deviations_away = round(abs(instances_launched - total_launched_avg) / total_launched_stdev, 2) | table _time, userName, instances_launched, num_standard_deviations_away, total_launched_avg, total_launched_stdev",-30d@d,-10m@m,,1,number of events,greater than,0,*/10 * * * *,1,1,,,,,This search looks for CloudTrail events where a user successfully launches an abnormally high number of instances.,,,,,,1,Abnormally High AWS Instances Launched by User,,network,medium,High Number of instances launched by $userName$,An abnormally high number of instances were launched by a user within in a 10-minute window,userName,,,,,1,userName,user,30,userName,3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 13""], ""nist"": [""DE.DP"", ""DE.AE""]}","In this search, we query CloudTrail logs to look for events where an instance is successfully launched by a particular user. Since we want to detect a high number of instances launched within a short period, we create event buckets for 10-minute windows. We then calculate the total number of instances launched by a particular user, as well as the average and standard deviation values. Assign a `threshold_value` in the search. Start with 3 (but it will likely need to be tweaked for your environment). The `eval` function will set the outlier 1 if the number of instances is greater than the average number of instances terminated, added to the multiplied value of threshold and standard deviation. For your reference, we then keep only the outliers and calculate the number of standard deviations away the value is from the average.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. The threshold value should be tuned to your environment.",Many service accounts configured within an AWS infrastructure are known to exhibit this behavior. Please adjust the threshold values and filter out service accounts from the output. Always verify if this search alerted on a human user.,2018-02-26,2018-02-26,medium,ESCU - Abnormally High AWS Instances Launched by User - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Cryptomining"", ""Suspicious AWS EC2 Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get EC2 Instance Details by instanceIdnESCU - Investigate AWS activities via region namenESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - URL Length Anomalies Over Time'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Web.http_method) as http_method,count from datamodel=Web.Web where Web.url!=""unknown"" [| from inputlookup:url_length_tracker | search Z=2 | fields search] by _time,Web.url span=10m | `drop_dm_object_name(""Web"")` | `per_panel_filter(""ppf_url_length"",""url"")` | timechart minspan=10m sum(count) as count by http_method",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,connect,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - User Agent Details'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as lastTime,dc(Web.src) as dc(src),dc(Web.dest) as dc(dest),latest(Web.http_user_agent_length) as length,count from datamodel=Web.Web where Web.http_user_agent!=unknown by Web.http_user_agent | `drop_dm_object_name(""Web"")` | join type=outer http_user_agent [| tstats `summariesonly` count from datamodel=Web.Web where earliest=-24h@h latest=+0s Web.http_user_agent!=unknown by _time,Web.http_user_agent span=`http_user_agent_sparkline_span` | stats sparkline(sum(count),`http_user_agent_sparkline_span`) as sparkline by Web.http_user_agent | `drop_dm_object_name(""Web"")`] | `makemv(sparkline,"","")` | appendcols[| inputlookup append=T start=0 max=1 user_agent_length_tracker | fields mean_length,stdev] | filldown mean_length,stdev | `get_stdev_index(length)` | `round(Z)` | `per_panel_filter(""ppf_http_user_agent"",""http_user_agent"")` | rename ppf_filter as filter | sort - filter,Z | `uitime(lastTime)` | table http_user_agent,filter,sparkline,length,dc(src),dc(dest),count,Z,lastTime",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,1,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - User Agent Distribution'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` latest(Web.http_user_agent_length) as length,count from datamodel=Web.Web where Web.http_user_agent!=unknown by Web.http_user_agent | eval http_user_agent='Web.http_user_agent' | `per_panel_filter(""ppf_http_user_agent"",""http_user_agent"")` | table http_user_agent,length,count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,,scatter,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,none,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Errors - Swimlane'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count,values(Web.src) as src, values(Web.dest) as dest, values(Web.status) as status from datamodel=Web.Web where $constraints$ Web.status!=200 by _time span=$span$",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,HTTP Errors,blue,reverse_asset_lookup,"Web.src,Web.dest,src,dest","| from datamodel:""Web"".""Web"" | search $constraints$",Protocol Intelligence,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Network - Whois Tracker - Checkpoint Gen'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time from datamodel=Web.Web by Web.dest | rename Web.dest as domain | `truncate_domain(domain)` | eval keep_count=0 | inputlookup append=T whois_tracker | eval keep_count=if(isnull(keep_count),1,keep_count) | eventstats sum(keep_count) as discard by domain | where discard==0 | stats min(_time) as _time by domain | sort 0 + _time | outputlookup override_if_empty=false append=T whois_tracker | `outputcheckpoint_whois` | stats count",-70m@m,+0s,,1,,,,30 * * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Domain_Analysis.All_Domains'],['Network - Whois Tracker - Lookup Gen'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,latest(All_Domains.resolved_domain) as resolved_domain,latest(All_Domains.created) as created from datamodel=Domain_Analysis.All_Domains by All_Domains.domain | `drop_dm_object_name(""All_Domains"")` | inputlookup append=T whois_tracker | `truncate_domain(domain)` | stats max(_time) as _time,latest(resolved_domain) as resolved_domain,latest(created) as created by domain | outputlookup override_if_empty=false whois_tracker | stats count",-70m@m,+0s,,1,,,,15 * * * *,,,,,,,Maintains a list of whois scan data including the resolved_domain (if domain was an IP) and the date the domain was created,,,,,,,,0,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Whois - New Domain Activity'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,count from datamodel=Web.Web by Web.dest | `drop_dm_object_name(""Web"")` | `get_whois` | search (created=* NOT created=""unknown"") | eval ""Age (days)""=ceil((now()-created)/86400) | where 'Age (days)'<=30 | eval domain=if(isnull(domain), dest, domain) | `swap_resolved_domain(domain)` | `per_panel_filter(""ppf_new_domains"",""domain"")` | rename ppf_filter as filter | eval resolved_domain=if(isnull(resolved_domain) OR resolved_domain==""unknown"",null(),resolved_domain) | sort - filter,_time | `uitime(created)` | fields _time,dest,resolved_domain,filter,created,""Age (days)"",count",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,1,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Whois - New Domain Activity By Age'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web by Web.dest | `drop_dm_object_name(""Web"")` | `get_whois` | search (created=* NOT created=""unknown"") | eval age=ceil((now()-created)/86400) | where age<=30 | eval domain=if(isnull(domain), dest, domain) | `swap_resolved_domain(domain)` | `per_panel_filter(""ppf_new_domains"",""domain"")` | stats sum(count) as count by age | eval ""Age (days)""=age | table ""Age (days)"",count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,,scatter,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,none,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Whois - New Domain Activity By TLD'],DA-ESS-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Web.Web by Web.dest | `drop_dm_object_name(""Web"")` | `get_whois` | search (created=* NOT created=""unknown"") | eval age=ceil((now()-created)/86400) | where age<=30 | eval domain=if(isnull(domain), dest, domain) | `swap_resolved_domain(domain)` | `per_panel_filter(""ppf_new_domains"",""domain"")` | `get_tld(domain)` | stats sum(count) as count by tld | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,none,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Abnormally High AWS Instances Terminated by User - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=TerminateInstances errorCode=success | bucket span=10m _time | stats count AS instances_terminated by _time userName | eventstats avg(instances_terminated) as total_terminations_avg, stdev(instances_terminated) as total_terminations_stdev | eval threshold_value = 4 | eval isOutlier=if(instances_terminated > total_terminations_avg+(total_terminations_stdev * threshold_value), 1, 0) | search isOutlier=1 AND _time >= relative_time(now(), ""-10m@m"")| eval num_standard_deviations_away = round(abs(instances_terminated - total_terminations_avg) / total_terminations_stdev, 2) |table _time, userName, instances_terminated, num_standard_deviations_away, total_terminations_avg, total_terminations_stdev",-30d@d,-10m@m,,1,number of events,greater than,0,*/10 * * * *,1,1,,,,,This search looks for CloudTrail events where an abnormally high number of instances were successfully terminated by a user in a 10-minute window,,,,,,1,Abnormally High AWS Instances Terminated by User,,network,medium,High number of instances terminated by $userName$,An abnormally high number of instances were terminated by a user in a 10-minute window,userName,,,,,1,userName,user,30,userName,3600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 13""], ""nist"": [""DE.DP"", ""DE.AE""]}","In this search, we query CloudTrail logs to look for events where an instance is successfully terminated by a particular user. Since we want to detect a high number of instances terminated within a short period, we create event buckets for 10-minute windows. We then calculate the total number of instances terminated by a particular user, as well as the average- and standard-deviation values. Assign a `threshold_value` in the search. Try starting with 3 (but it will likely need to be tweaked for your environment). The `eval` function will set the outlier to 1 if the number of instances is greater than the average number of instances terminated, added to the multiplied value of threshold and standard deviation. We then filter out outliers with a value of 1 and show only those instance-termination events that happened within the previous 10 minutes.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs.",Many service accounts configured with your AWS infrastructure are known to exhibit this behavior. Please adjust the threshold values and filter out service accounts from the output. Always verify whether this search alerted on a human user.,2018-02-26,2018-02-26,medium,ESCU - Abnormally High AWS Instances Terminated by User - Rule,detection,AWS Instance,[],"[""AWS""]","[""Suspicious AWS EC2 Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get EC2 Instance Details by instanceIdnESCU - Investigate AWS activities via region namenESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Threat_Intelligence"".""Threat_Activity']",['Threat - Threat List Activity - Rule'],DA-ESS-ThreatIntelligence-default,,,True,,,,,,,,,"| from datamodel:""Threat_Intelligence"".""Threat_Activity"" | dedup threat_match_field,threat_match_value | `get_event_id` | table _raw,event_id,source,src,dest,threat*,weight | rename weight as record_weight | `per_panel_filter(""ppf_threat_activity"",""threat_match_field,threat_match_value"")` | `get_threat_attribution(threat_key)` | rename source_* as threat_source_*,description as threat_description | eval risk_score=case(isnum(record_weight), record_weight, isnum(weight), weight, 1=1, null())  | fields - *time | eval risk_object_type=case(threat_match_field=""query"" OR threat_match_field==""src"" OR threat_match_field==""dest"",""system"",threat_match_field==""src_user"" OR threat_match_field==""user"",""user"",1=1,""other"") | eval risk_object=threat_match_value",-65m@m,+0s,,1,number of events,greater than,0,10 * * * *,1,1,false,,,,Alerts when any activity matching threat intelligence is detected.,,,,,0,1,Threat Activity Detected,0,threat,low,Threat Activity Detected ($threat_match_value$),"Threat activity ($threat_match_value$) was discovered in the ""$threat_match_field$"" field based on threat intelligence available in the $threat_collection$ collection","threat_match_field,threat_match_value","View all threat activity involving $threat_match_field$=""$threat_match_value$""","| from datamodel:""Threat_Intelligence"".""Threat_Activity"" | search threat_match_field=""$threat_match_field$"" threat_match_value=""$threat_match_value$""",,,1,src,system,40,"threat_match_field,threat_match_value",86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Unique Categories'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-24h@h latest=+0s by Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | `get_threat_attribution(threat_key)` | stats dc(threat_category) as current_count | appendcols [| tstats `summariesonly` count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-48h@h latest=-24h@h by Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | `get_threat_attribution(threat_key)` | stats dc(threat_category) as historical_count] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Threat Categories,Unique Count,current_count,,delta,false,search?earliest=-48h%40h&latest=now&q=%7C%20from%20datamodel%3A%22Threat_Intelligence%22.%22Threat_Activity%22,1,0,0,all,Unique Threat Categories,singlevalue,threat_activity,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Unique Collections'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Threat_Activity.threat_collection) as current_count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Threat_Activity.threat_collection) as historical_count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Threat Collections,Unique Count,current_count,,delta,false,search?earliest=-48h%40h&latest=now&q=%7C%20from%20datamodel%3A%22Threat_Intelligence%22.%22Threat_Activity%22,1,0,0,all,Unique Threat Collections,singlevalue,threat_activity,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Unique Matches'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-24h@h latest=+0s by Threat_Activity.threat_match_field,Threat_Activity.threat_match_value | stats count as current_count | appendcols [| tstats `summariesonly` count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-48h@h latest=-24h@h by Threat_Activity.threat_match_field,Threat_Activity.threat_match_value | stats count as historical_count] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Threat Matches,Unique Count,current_count,,delta,false,search?earliest=-48h%40h&latest=now&q=%7C%20from%20datamodel%3A%22Threat_Intelligence%22.%22Threat_Activity%22,1,0,0,all,Unique Threat Matches,singlevalue,threat_activity,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Unique Sources'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Threat_Activity.threat_key) as current_count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` estdc(Threat_Activity.threat_key) as historical_count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Threat Sources,Unique Count,current_count,,delta,false,search?earliest=-48h%40h&latest=now&q=%7C%20from%20datamodel%3A%22Threat_Intelligence%22.%22Threat_Activity%22,1,0,0,all,Unique Threat Sources,singlevalue,threat_activity,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Total Count'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Threat_Intelligence.Threat_Activity where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Threat Activity,Total Count,current_count,,delta,false,search?earliest=-48h%40h&latest=now&q=%7C%20from%20datamodel%3A%22Threat_Intelligence%22.%22Threat_Activity%22,1,0,0,all,Threat Activity Count,singlevalue,threat_activity,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Certificate Common Name - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` |`exclude_disabled_entries` | rex field=certificate_issuer ""CNs*=(?<_certificate_issuer_common_name>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""CNs*=(?<_certificate_subject_common_name>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_common_name=if(isnull(certificate_issuer_common_name),_certificate_issuer_common_name,certificate_issuer_common_name) | eval certificate_subject_common_name=if(isnull(certificate_subject_common_name),_certificate_subject_common_name,certificate_subject_common_name) | `mvappend_field(certificate_common_name,certificate_subject_common_name)` | `threatintel_outputlookup(certificate_common_name)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Attempt To Add Certificate To Untrusted Store - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) values(Processes.process) as process max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=certutil.exe (Processes.process=*-addstore* AND Processes.process=*disallowed* ) by Processes.parent_process Processes.process_name Processes.user | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`|`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,Attempt to add a certificate to the untrusted certificate store,,,,,,1,Attempt To Add Certificate To Untrusted Store,,endpoint,high,Attempt To Add Certificate to Untrusted Store,Attempt to add a certificate to the untrusted certificate store,"dest, user, process_name",,,,,1,dest,system,50,"process, dest",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Disabling Security Tools""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","Attackers will often attempt to disable security tools in order to evade detection. It is also possible for end users to attempt to disable anti-virus or other security tools to circumvent restrictions they encounter while trying to execute other programs. One way malware may accomplish this is by adding the legitimate certificate used to sign the security software to the untrusted certificate store. This will cause the system to no longer trust the software signed with this certificate and disallow it from executing. This search simply looks for the execution of **certutil.exe** with the parameters `-addcert` and `disallowed`, which add a certification to the ""untrusted"" certificate store.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","There may be legitimate reasons for administrators to add a certificate to the untrusted certificate store. In such cases, this will typically be done on a large number of systems.",2018-04-09,2018-11-15,high,ESCU - Attempt To Add Certificate To Untrusted Store - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Disabling Security Tools""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Certificate Common Name Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `exclude_disabled_entries` | rex field=certificate_issuer ""CNs*=(?<_certificate_issuer_common_name>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""CNs*=(?<_certificate_subject_common_name>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_common_name=if(isnull(certificate_issuer_common_name),_certificate_issuer_common_name,certificate_issuer_common_name) | eval certificate_subject_common_name=if(isnull(certificate_subject_common_name),_certificate_subject_common_name,certificate_subject_common_name) | `mvappend_field(certificate_common_name,certificate_subject_common_name)` | `threatintel_outputlookup_wildcard(certificate_common_name)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Certificate Organization - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `exclude_disabled_entries` | rex field=certificate_issuer ""Os*=(?<_certificate_issuer_org>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""Os*=(?<_certificate_subject_org>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_organization=if(isnull(certificate_issuer_organization),_certificate_issuer_org,certificate_issuer_organization) | eval certificate_subject_organization=if(isnull(certificate_subject_organization),_certificate_subject_org,certificate_subject_organization) | `mvappend_field(certificate_organization,certificate_subject_organization)` | `threatintel_outputlookup(certificate_organization)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Certificate Organization Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `exclude_disabled_entries` | rex field=certificate_issuer ""Os*=(?<_certificate_issuer_org>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""Os*=(?<_certificate_subject_org>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_organization=if(isnull(certificate_issuer_organization),_certificate_issuer_org,certificate_issuer_organization) | eval certificate_subject_organization=if(isnull(certificate_subject_organization),_certificate_subject_org,certificate_subject_organization) | `mvappend_field(certificate_organization,certificate_subject_organization)` | `threatintel_outputlookup_wildcard(certificate_organization)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Certificate Serial - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel`  | `exclude_disabled_entries` | `mvappend_field(certificate_serial_clean,certificate_serial_dec)` | rename certificate_serial_clean as certificate_serial | `threatintel_outputlookup(certificate_serial)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Certificate Unit - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel`  | `exclude_disabled_entries` | rex field=certificate_issuer ""OUs*=(?<_certificate_issuer_unit>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""OUs*=(?<_certificate_subject_unit>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_unit=if(isnull(certificate_issuer_unit),_certificate_issuer_unit,certificate_issuer_unit) | eval certificate_subject_unit=if(isnull(certificate_subject_unit),_certificate_subject_unit,certificate_subject_unit) | `mvappend_field(certificate_unit,certificate_subject_unit)` | `threatintel_outputlookup(certificate_unit)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Certificate Unit Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `exclude_disabled_entries` | rex field=certificate_issuer ""OUs*=(?<_certificate_issuer_unit>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""OUs*=(?<_certificate_subject_unit>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_unit=if(isnull(certificate_issuer_unit),_certificate_issuer_unit,certificate_issuer_unit) | eval certificate_subject_unit=if(isnull(certificate_subject_unit),_certificate_subject_unit,certificate_subject_unit) | `mvappend_field(certificate_unit,certificate_subject_unit)` | `threatintel_outputlookup_wildcard(certificate_unit)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By CIDR - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `email_intel` | `http_intel` | `ip_intel` | `process_intel` | `exclude_disabled_entries` | `mvappend_field(ip,embedded_ip)` | `mvappend_field(ip,src)` | `mvappend_field(ip,dest)` | `get_threat_download_status` | `threatintel_outputlookup_exclusions` | mvexpand ip | rename ip as cidr,_key as threat_collection_key | dedup cidr,threat_collection_key,threat_key | where isnotnull(cidr) AND match(cidr,""/[0-9]{1,2}"") | fillnull value=""X"" weight | table cidr,threat_collection,threat_collection_key,threat_key,weight | outputlookup threatintel_by_cidr | stats count",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel,http_intel,ip_intel,process_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Domain - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `email_intel` | `http_intel` | `ip_intel` | `exclude_disabled_entries` | `mvappend_field(domain,embedded_domain)` | `threatintel_outputlookup(domain)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel,http_intel,ip_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Email - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `exclude_disabled_entries` | rex field=certificate_issuer ""(?:E|emailAddress)s*=(?<_certificate_issuer_email>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""(?:E|emailAddress)s*=(?<_certificate_subject_email>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_issuer_email=if(isnull(certificate_issuer_email),_certificate_issuer_email,certificate_issuer_email) | eval certificate_subject_email=if(isnull(certificate_subject_email),_certificate_subject_email,certificate_subject_email) | `email_intel` | `mvappend_field(src_user,certificate_issuer_email)` | `mvappend_field(src_user,certificate_subject_email)` | rename src_user as email | `threatintel_outputlookup(email)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Email Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `exclude_disabled_entries` | rex field=certificate_issuer ""(?:E|emailAddress)s*=(?<_certificate_issuer_email>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | rex field=certificate_subject ""(?:E|emailAddress)s*=(?<_certificate_subject_email>.*?)(?=[,;/]s*(?:[A-Z]+|emailAddress)s*=|$)"" | eval certificate_issuer_email=if(isnull(certificate_issuer_email),_certificate_issuer_email,certificate_issuer_email) | eval certificate_subject_email=if(isnull(certificate_subject_email),_certificate_subject_email,certificate_subject_email) | `email_intel` | `mvappend_field(src_user,certificate_issuer_email)` | `mvappend_field(src_user,certificate_subject_email)` | rename src_user as email | `threatintel_outputlookup_wildcard(email)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Attempt To Set Default PowerShell Execution Policy To Unrestricted - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=reg.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)`| search (process=*add*  process=*Software\Microsoft\Powershell\1\ShellIds\Microsoft.PowerShell* process=*ExecutionPolicy* process=*Unrestricted*),-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for the execution of reg.exe with parameters that indicate an attempt to set the default PowerShell execution policy on the system to ""Unrestricted""",,,,,,1,Attempt To Set Default PowerShell Execution Policy To Unrestricted,,endpoint,High,"Attempt To Set PowerShell Execution Policy To ""Unrestricted"" On $dest$.","An attempt to modify the default PowerShell execution policy in the registry to ""Unrestricted"" was detected on $dest$.","dest, user, process_name",,,,,1,dest,system,60,"process_name, dest",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""PowerShell"", ""Scripting""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","This search looks for the process reg.exe with the ""add"" parameter, which indicates the creation of a new value or modification of an existing value in the registry. In addition, it looks for parameters that specify the registry key to be added or modified, as well as the value of ""Unrestricted"". The appearance of ""ExecutionPolicy"" at the beginning of the search is there to optimize the search performance by first looking for that keyword, and then further searching through the matching events for further details.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Administrators may attempt to change the default execution policy on a system for a variety of reasons. However, setting the policy to ""Unrestricted"" as this search is designed to identify would be unusual. Hits should be reviewed and investigated as appropriate.",2018-08-28,2018-12-03,High,ESCU - Attempt To Set Default PowerShell Execution Policy To Unrestricted - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Credential Dumping"", ""Malicious PowerShell""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Email Subject - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `email_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(""subject"",""threatintel_by_email_subject"")`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,email_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Email Subject Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `email_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(""subject"",""threatintel_by_email_subject_wildcard"")`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,email_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By File Hash - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `email_intel` | `file_intel` | `service_intel` | `exclude_disabled_entries` | `mvappend_field(file_hash,service_file_hash)` | `mvappend_field(file_hash,service_dll_file_hash)` | `threatintel_outputlookup(file_hash)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel,file_intel,service_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By File Name - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `email_intel` | `file_intel` | `process_intel` | `exclude_disabled_entries` | `mvappend_field(file_name,process_file_name)` | `threatintel_outputlookup(file_name)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel,file_intel,service_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By File Name Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `email_intel` | `file_intel` | `process_intel` | `exclude_disabled_entries` | `mvappend_field(file_name,process_file_name)` | `threatintel_outputlookup_wildcard(file_name)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel,file_intel,service_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By HTTP User Agent - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `http_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(http_user_agent)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,http_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By HTTP User Agent Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `http_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(http_user_agent)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,http_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Process - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `process_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(process)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,process_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Process Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `process_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(process)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,process_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Registry Path - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(registry_path)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Attempt To Stop Security Service - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where (Processes.process_name = net.exe OR  Processes.process_name = sc.exe) Processes.process=""* stop *"" by Processes.process_name Processes.parent_process_name Processes.dest Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)` |lookup security_services_lookup service as process OUTPUTNEW category, description | search category=security",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for attempts to stop security-related services on the endpoint.,,,,,,1,Attempt To Stop Security Service,,endpoint,high,Attempt to Stop Security Service On $dest$,Attempt to stop a security-related service on $dest$,"dest, process, user",,,,,1,src,system,50,"dest, user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Disabling Security Tools""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","This search looks for the processes **net.exe** and **sc.exe** with a parameter of `""stop""`. It then searches a list of security-related services included in a lookup file for matches on the command line. Results are subsequently returned in table format. The included lookup file can be modified to update the services to monitor.","You must be ingesting data that records the file-system activity from your hosts to populate the Endpoint file-system data-model node. If you are using Sysmon, you will need a Splunk Universal Forwarder on each endpoint from which you want to collect data. The search is shipped with a lookup file, `security_services.csv`, that can be edited to update the list of services to monitor. This lookup file can be edited directly where it lives in `$SPLUNK_HOME/etc/apps/DA-ESS-ContentUpdate/lookups`, or via the Splunk console. You should add the names of services an attacker might use on the command line and surround with asterisks (*****), so that they work properly when searching the command line. The file should be updated with the names of any services you would like to monitor for attempts to stop the service.,",None identified. Attempts to disable security-related services should be identified and understood.,2018-04-09,2017-09-15,high,ESCU - Attempt To Stop Security Service - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Disabling Security Tools""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Registry Path Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(registry_path)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Registry Value Name - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(registry_value_name)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Registry Value Name Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(registry_value_name)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Registry Value Text - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(registry_value_text)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Registry Value Text Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(registry_value_text)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Service - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `service_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(service)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,service_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By Service Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `service_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(service)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,service_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By System - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `certificate_intel` | `email_intel` | `http_intel` | `ip_intel` | `process_intel` | `exclude_disabled_entries` | `mvappend_field(ip,embedded_ip)` | `mvappend_field(ip,src)` | `mvappend_field(ip,dest)` | `get_threat_download_status` | `threatintel_outputlookup_exclusions` | mvexpand ip | rename ip as system,_key as threat_collection_key | dedup system,threat_collection_key,threat_key | where isnotnull(system) AND NOT match(system,""/[0-9]{1,2}"") | fillnull value=""X"" weight | table system,threat_collection,threat_collection_key,threat_key,weight | outputlookup threatintel_by_system | stats count",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"certificate_intel,email_intel,http_intel,ip_intel,process_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By URL - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `http_intel` | `exclude_disabled_entries` | `mvappend_field(url,http_referrer)` | `threatintel_outputlookup(url)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,http_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By URL Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `http_intel` | `exclude_disabled_entries` | `mvappend_field(url,http_referrer)` | `threatintel_outputlookup_wildcard(url)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,http_intel,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Attempted Credential Dump From Registry Via Reg.exe - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=reg.exe  by Processes.user Processes.process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` | search process=*save* (process=*HKLM\sam* OR process=*HKLM\system*),-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for execution of reg.exe with parameters specifying an export of keys that contain hashed credentials that attackers may try to crack offline,",,,,,,1,Attempted Credential Dump From Registry Via Reg.exe,,endpoint,High,Attempted Credential Dump From Registry on $dest$,An attempt to save registry keys holding credentials was identified on $dest$.,"dest, user, process_name",,,,,1,dest,system,80,"process_name, dest",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Credential Dumping""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 16""], ""nist"": [""PR.IP"", ""PR.AC"", ""DE.CM""]}","This search looks for the process reg.exe with the ""save"" parameter, which specifies a binary export from the registry. In addition, it looks for the keys that contain the hashed credentials, which attackers may retrieve and use for brute-force attacks in order to harvest legitimate credentials.","You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",None identified.,2018-08-28,2018-12-02,High,ESCU - Attempted Credential Dump From Registry Via Reg.exe - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Credential Dumping""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By User - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `user_intel` | `exclude_disabled_entries` | `threatintel_outputlookup(user)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"registry_intel,user_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Threat Intelligence By User Wildcard - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,| `registry_intel` | `user_intel` | `exclude_disabled_entries` | `threatintel_outputlookup_wildcard(user)`,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"registry_intel,user_intel",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Certificate Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""certificate_intel"")` | `set_threat_intel_meta_now(""certificate_intel"")`",0,+0s,,true,,,,0 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Email Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""email_intel"")` | `set_threat_intel_meta_now(""email_intel"")`",0,+0s,,true,,,,5 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - File Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""file_intel"")` | `set_threat_intel_meta_now(""file_intel"")`",0,+0s,,true,,,,10 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - HTTP Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""http_intel"")` | `set_threat_intel_meta_now(""http_intel"")`",0,+0s,,true,,,,15 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - IP Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""ip_intel"")` | `set_threat_intel_meta_now(""ip_intel"")`",0,+0s,,true,,,,20 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Process Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""process_intel"")` | `set_threat_intel_meta_now(""process_intel"")`",0,+0s,,true,,,,25 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Registry Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""registry_intel"")` | `set_threat_intel_meta_now(""registry_intel"")`",0,+0s,,true,,,,30 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Service Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""service_intel"")` | `set_threat_intel_meta_now(""service_intel"")`",0,+0s,,true,,,,35 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Batch File Write to System32 - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.dest) as dest values(Filesystem.file_name) as file_name values(Filesystem.user) as user from datamodel=Endpoint.Filesystem by Filesystem.file_path | `drop_dm_object_name(Filesystem)` | `ctime(lastTime)` | `ctime(firstTime)`| rex field=file_name ""(?<file_extension>.[^.]+)$"" | search file_path=*system32* AND file_extension=.bat",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for a batch file (.bat) written to the Windows system directory tree.,,,,,,1,Batch File Write to System32,,endpoint,high,Batch file write to system32 detected on $dest$,A batch file was written to the system directory on $dest$.,"dest, file_name",,,,,1,dest,system,80,"dest,file_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks at file modifications across your hosts, as well as for evidence of batch files being written to paths that include ""system32."" This activity is consistent with some SamSam attacks and is, in general, suspicious.","You must be ingesting data that records the file-system activity from your hosts to populate the Endpoint file-system data-model node. If you are using Sysmon, you will need a Splunk Universal Forwarder on each endpoint from which you want to collect data.","It is possible for this search to generate a notable event for a batch file write to a path that includes the string ""system32"", but is not the actual Windows system directory. As such, you should confirm the path of the batch file identified by the search. In addition, a false positive may be generated by an administrator copying a legitimate batch file in this directory tree. You should confirm that the activity is legitimate and modify the search to add exclusions, as necessary.",2018-12-14,2018-12-14,high,ESCU - Batch File Write to System32 - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - User Threat Intelligence Retention - Lookup Gen'],DA-ESS-ThreatIntelligence-default,,,true,,,,,,,,,"| `filter_threatintel_collection(""user_intel"")` | `set_threat_intel_meta_now(""user_intel"")`",0,+0s,,true,,,,40 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,SplunkEnterpriseSecuritySuite,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Failed Threatlist Downloads'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"index=_internal sourcetype=threatintel:download file=""threatlist.py:download_*"" NOT (status=""*starting"" OR status=""retrying download"" OR status=""threat list downloaded"" OR status=""Retrieved document from TAXII feed"" OR status=""Retrieved documents from TAXII feed"") | stats latest(status) as status, latest(_time) as _time by stanza, host, url",-3h@m,+0s,,1,number of events,greater than,0,0 */3 * * *,true,,0,,,,,true,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,auto,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,HEALTH_CHECK:FAILED_THREAT_DOWNLOAD,healthcheck_failed_threat_download,"info_sid,stanza,host,_time,status",1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Most Active Threats Collections'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` values(source) as search,values(Threat_Activity.threat_collection_key) as threat_collection_key,count from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by _time,Threat_Activity.threat_collection span=1h | `drop_dm_object_name(""Threat_Activity"")` | stats values(search) as search,sparkline(sum(count),1h) as sparkline,dc(threat_collection_key) as dc(artifacts),sum(count) as count by threat_collection | rex max_match=10 field=search ""Threats*-s*(?<friendly_search>.*)(?:s*-s*Threats+Gen)"" | rename friendly_search as search | sort - count",-24h@h,now,,,,,,,,,0,,,,,true,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Most Active Threat Sources'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | `get_threat_attribution(""threat_key"")` | stats sum(count) as count by threat_key,source_id,source_path,source_type | sort 100 - count",-24h@h,now,,,,,,,,,0,,,,,true,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Systems Impacted By Multiple Threats'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` values(Threat_Activity.src) as src,values(Threat_Activity.dest) as dest,count from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by Threat_Activity.threat_match_field,Threat_Activity.threat_match_value,Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | eval src=if(threat_match_field==""src"",null(),src) | eval dest=if(threat_match_field==""dest"",null(),dest) | eval system=mvappend(src,NULL,dest) | stats dc(threat_key) as dc(threat) by system | search system!=""...truncated..."" system!=""unknown"" ""dc(threat)"">1 | sort 100 - dc(threat)",-24h@h,now,,,,,,,,,0,,,,,true,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Threat Activity By Threat Category'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | `get_threat_attribution(threat_key)` | stats sum(count) as count by threat_category | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Threat Activity By Threat Group'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | `get_threat_attribution(threat_key)` | stats sum(count) as count by threat_group | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Threat Activity Details'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` latest(_time) as _time,values(Threat_Activity.orig_sourcetype) as sourcetype,values(Threat_Activity.src) as src,values(Threat_Activity.dest) as dest from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by Threat_Activity.threat_collection,Threat_Activity.threat_match_field,Threat_Activity.threat_match_value,Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | `get_threat_attribution(""threat_key"")` | `per_panel_filter(""ppf_threat_activity"",""threat_match_field,threat_match_value"")` | rename ppf_filter as filter | sort - filter,_time | table _time,threat_match_field,threat_match_value,filter,sourcetype,src,dest,threat_collection,threat_group,threat_category",-24h@h,now,,,,,,,,,0,,,,,true,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,true,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Threat Activity Over Time'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| `tstats` count from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by _time,Threat_Activity.threat_collection span=10m | timechart count by Threat_Activity.threat_collection | `drop_dm_object_name(""Threat_Activity"")`",-24h@h,now,,,,,,,,,0,,,,,true,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Threat_Intelligence.Threat_Activity'],['Threat Activity - Threats Impacting Multiple Systems'],DA-ESS-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` values(Threat_Activity.src) as src,values(Threat_Activity.dest) as dest,count from datamodel=Threat_Intelligence.Threat_Activity where NOT [| `ppf_subsearch_dm(""ppf_threat_activity"",""threat_match_field,threat_match_value"",now(),""Threat_Activity"")`] by Threat_Activity.threat_match_field,Threat_Activity.threat_match_value,Threat_Activity.threat_key | `drop_dm_object_name(""Threat_Activity"")` | `get_threat_attribution(threat_key)` | eval src=if(threat_match_field==""src"",null(),src) | eval dest=if(threat_match_field==""dest"",null(),dest) | eval system=mvappend(src,NULL,dest) | stats dc(system) by source_path | search ""dc(system)"">1 | sort 100 - dc(system)",-24h@h,now,,,,,,,,,0,,,,,true,statistics,,0,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Child Processes of Spoolsv.exe - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process_name) as process_name values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.parent_process_name=spoolsv.exe AND Processes.process_name!=regsvr32.exe by Processes.dest Processes.parent_process Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for child processes of spoolsv.exe. This activity is associated with a POC privilege-escalation exploit associated with CVE-2018-8440. Spoolsv.exe is the process associated with the Print Spooler service in Windows and typically runs as SYSTEM.,,,,,,1,Child Processes of Spoolsv.exe,,endpoint,medium,Spoolsv.exe spawned a child process on $dest$,A child process of spoolsv.exe was detected on $dest$.,"dest, process_name, parent_process_name",,,,,1,dest,system,60,"dest, parent_process_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Privilege Escalation"", ""Exploitation for Privilege Escalation""], ""kill_chain_phases"": [""Exploitation""], ""cis20"": [""CIS 5"", ""CIS 8""], ""nist"": [""PR.AC"", ""PR.PT"", ""DE.CM""]}","This search looks for child processes of spoolsv.exe, which is associated with the Print Spooler service on Windows. Children of this process typically run under the SYSTEM context. This search should address the POC developed for the Windows local-privilege-escalation exploit announced in September of 2018. The associated vulnerability was assigned CVE-2018-8440. More information is available at https://doublepulsar.com/task-scheduler-alpc-exploit-high-level-analysis-ff08cda6ad4f.","You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",Some legitimate printer-related processes may show up as children of spoolsv.exe. You should confirm that any activity as legitimate and may be added as exclusions in the search.,2018-11-26,2018-12-03,medium,ESCU - Child Processes of Spoolsv.exe - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Windows Privilege Escalation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['Threat - Certificate Common Name Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_issuer_common_name | eval certificate_common_name='All_Certificates.SSL.ssl_issuer_common_name' | eval threat_match_field=""ssl_issuer_common_name"" | `tstats` append=true values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_subject_common_name | eval certificate_common_name=if(isnull(certificate_common_name),'All_Certificates.SSL.ssl_subject_common_name',certificate_common_name) | eval threat_match_field=if(isnull(threat_match_field),""ssl_subject_common_name"",threat_match_field) | stats values(sourcetype) as sourcetype,values(All_Certificates.src) as src,values(All_Certificates.dest) as dest by certificate_common_name,threat_match_field | lookup update=true threatintel_by_certificate_common_name certificate_common_name OUTPUT | lookup update=true threatintel_by_certificate_common_name_wildcard certificate_common_name OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"0,30 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"certificate_common_name,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_common_name,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['Threat - Certificate Organization Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_issuer_organization | eval certificate_organization='All_Certificates.SSL.ssl_issuer_organization' | eval threat_match_field=""ssl_issuer_organization"" | `tstats` append=true values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_subject_organization | eval certificate_organization=if(isnull(certificate_organization),'All_Certificates.SSL.ssl_subject_organization',certificate_organization) | eval threat_match_field=if(isnull(threat_match_field),""ssl_subject_organization"",threat_match_field) | stats values(sourcetype) as sourcetype,values(All_Certificates.src) as src,values(All_Certificates.dest) as dest by certificate_organization,threat_match_field | lookup update=true threatintel_by_certificate_organization certificate_organization OUTPUT | lookup update=true threatintel_by_certificate_organization_wildcard certificate_organization OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"5,35 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"certificate_organization,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_organization,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['Threat - Certificate Serial Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats `summariesonly` values(sourcetype) as sourcetype,values(All_Certificates.src) as src,values(All_Certificates.dest) as dest from datamodel=Certificates.All_Certificates where nodename=""All_Certificates.SSL"" by All_Certificates.SSL.ssl_serial | rename All_Certificates.SSL.ssl_serial as certificate_serial | eval threat_match_value=certificate_serial | `get_certificate_serial` | lookup update=true threatintel_by_certificate_serial certificate_serial as certificate_serial_clean OUTPUT | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"10,40 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"certificate_serial,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_serial,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['Threat - Certificate Unit Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_issuer_unit | eval certificate_unit='All_Certificates.SSL.ssl_issuer_unit' | eval threat_match_field=""ssl_issuer_unit"" | `tstats` append=true values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_subject_unit | eval certificate_unit=if(isnull(certificate_unit),'All_Certificates.SSL.ssl_subject_unit',certificate_unit) | eval threat_match_field=if(isnull(threat_match_field),""ssl_subject_unit"",threat_match_field) | stats values(sourcetype) as sourcetype,values(All_Certificates.src) as src,values(All_Certificates.dest) as dest by certificate_unit,threat_match_field | lookup update=true threatintel_by_certificate_unit certificate_unit OUTPUT | lookup update=true threatintel_by_certificate_unit_wildcard certificate_unit OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"15,45 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"certificate_unit,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,certificate_unit,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Certificates.All_Certificates', 'Email.All_Email']",['Threat - Email Address Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_issuer_email | eval email='All_Certificates.SSL.ssl_issuer_email' | eval threat_match_field=""ssl_issuer_email"" | `tstats` append=true values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_subject_email | eval email=if(isnull(email),'All_Certificates.SSL.ssl_subject_email',email) | eval threat_match_field=if(isnull(threat_match_field),""ssl_subject_email"",threat_match_field) | `sistats_values_rename(All_Certificates.src,src)` | `sistats_values_rename(All_Certificates.dest,dest)` | `tstats` append=true values(sourcetype),values(All_Email.src),values(All_Email.dest) from datamodel=Email.All_Email by All_Email.src_user | eval email=if(isnull(email),'All_Email.src_user',email) | eval threat_match_field=if(isnull(threat_match_field),""src_user"",threat_match_field) | `tstats` append=true values(sourcetype),values(All_Email.src),values(All_Email.dest) from datamodel=Email.All_Email by All_Email.recipient | eval email=if(isnull(email),'All_Email.recipient',email) | eval threat_match_field=if(isnull(threat_match_field),""recipient"",threat_match_field) | `sistats_values_rename(All_Email.src,src)` | `sistats_values_rename(All_Email.dest,dest)` | stats values(sourcetype) as sourcetype,values(src) as src,values(dest) as dest by email,threat_match_field | extract cim_email_domain | `truncate_domain_dedup(email_domain,truncated_email_domain)` | lookup update=true threatintel_by_email email OUTPUT | lookup update=true threatintel_by_email_wildcard email OUTPUTNEW | lookup update=true threatintel_by_domain domain as email_domain OUTPUTNEW | lookup update=true threatintel_by_domain domain as truncated_email_domain OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches` | table sourcetype,src,dest,email,threat*,weight",-45m@m,+0s,,True,,,,"20,50 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"email,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,email,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Threat - Email Subject Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats `summariesonly` values(sourcetype) as sourcetype,values(All_Email.src) as src,values(All_Email.dest) as dest from datamodel=Email.All_Email by All_Email.subject | `drop_dm_object_name(""All_Email"")` | lookup update=true threatintel_by_email_subject subject OUTPUT | lookup update=true threatintel_by_email_subject_wildcard subject OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"25,55 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"subject,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,subject,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Certificates.All_Certificates', 'Endpoint.Filesystem', 'Email.All_Email', 'Malware.Malware_Attacks', 'Updates.Updates']",['Threat - File Hash Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(All_Certificates.src),values(All_Certificates.dest) from datamodel=Certificates.All_Certificates by All_Certificates.SSL.ssl_hash | eval file_hash='All_Certificates.SSL.ssl_hash' | eval threat_match_field=""ssl_hash"" | `sistats_values_rename(All_Certificates.src,src)` | `sistats_values_rename(All_Certificates.dest,dest)` | `tstats` append=true values(sourcetype),values(Filesystem.dest) from datamodel=Endpoint.Filesystem by Filesystem.file_hash | eval file_hash=if(isnull(file_hash),'Filesystem.file_hash',file_hash) | `sistats_values_rename(Filesystem.dest,dest)` | `tstats` append=true values(sourcetype),values(All_Email.src),values(All_Email.dest) from datamodel=Email.All_Email by All_Email.file_hash | eval file_hash=if(isnull(file_hash),'All_Email.file_hash',file_hash) | `sistats_values_rename(All_Email.src,src)` | `sistats_values_rename(All_Email.dest,dest)` | `tstats` append=true values(sourcetype),values(Malware_Attacks.src),values(Malware_Attacks.dest) from datamodel=Malware.Malware_Attacks by Malware_Attacks.file_hash | eval file_hash=if(isnull(file_hash),'Malware_Attacks.file_hash',file_hash) | `sistats_values_rename(Malware_Attacks.src,src)` | `sistats_values_rename(Malware_Attacks.dest,dest)` | `tstats` append=true values(sourcetype),values(Updates.src),values(Updates.dest) from datamodel=Updates.Updates by Updates.file_hash | eval file_hash=if(isnull(file_hash),'Updates.file_hash',file_hash) | eval threat_match_field=if(isnull(threat_match_field),""file_hash"",threat_match_field) | `sistats_values_rename(Updates.src,src)` | `sistats_values_rename(Updates.dest,dest)` | stats values(sourcetype) as sourcetype,values(src) as src,values(dest) as dest by file_hash,threat_match_field | lookup update=true threatintel_by_file_hash file_hash OUTPUT | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"0,30 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"file_hash,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,file_hash,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Email.All_Email', 'Malware.Malware_Attacks', 'Updates.Updates']",['Threat - File Name Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(Filesystem.dest) from datamodel=Endpoint.Filesystem by Filesystem.file_name | eval file_name=if(isnull(file_name),'Filesystem.file_name',file_name) | `sistats_values_rename(Filesystem.dest,dest)` | `tstats` append=true values(sourcetype),values(All_Email.src),values(All_Email.dest) from datamodel=Email.All_Email by All_Email.file_name | eval file_name=if(isnull(file_name),'All_Email.file_name',file_name) | `sistats_values_rename(All_Email.src,src)` | `sistats_values_rename(All_Email.dest,dest)` | `tstats` append=true values(sourcetype),values(Malware_Attacks.src),values(Malware_Attacks.dest) from datamodel=Malware.Malware_Attacks by Malware_Attacks.file_name | eval file_name=if(isnull(file_name),'Malware_Attacks.file_name',file_name) | `sistats_values_rename(Malware_Attacks.src,src)` | `sistats_values_rename(Malware_Attacks.dest,dest)` | `tstats` append=true values(sourcetype),values(Updates.src),values(Updates.dest) from datamodel=Updates.Updates by Updates.file_name | eval file_name=if(isnull(file_name),'Updates.file_name',file_name) | eval threat_match_field=if(isnull(threat_match_field),""file_name"",threat_match_field) | `sistats_values_rename(Updates.src,src)` | `sistats_values_rename(Updates.dest,dest)` | stats values(sourcetype) as sourcetype,values(src) as src,values(dest) as dest by file_name,threat_match_field | lookup update=true threatintel_by_file_name file_name OUTPUT | lookup update=true threatintel_by_file_name_wildcard file_name OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"5,35 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"file_name,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,file_name,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Threat - HTTP User Agent Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats `summariesonly` values(sourcetype) as sourcetype,values(Web.src) as src,values(Web.dest) as dest from datamodel=Web.Web by Web.http_user_agent | `drop_dm_object_name(""Web"")` | lookup update=true threatintel_by_http_user_agent http_user_agent OUTPUT | lookup update=true threatintel_by_http_user_agent_wildcard http_user_agent OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"10,40 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"http_user_agent,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,http_user_agent,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Resolution.DNS', 'Domain_Analysis.All_Domains']",['Threat - Network Resolution Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(DNS.src),values(DNS.dest) from datamodel=Network_Resolution.DNS by DNS.query,DNS.answer | eval query='DNS.query' | eval answer='DNS.answer' | `tstats` append=true values(sourcetype) from datamodel=Domain_Analysis.All_Domains by All_Domains.domain,All_Domains.resolved_domain | eval query=if(isnull(query),'All_Domains.domain',query) | eval answer=if(isnull(answer),'All_Domains.resolved_domain',answer) | stats values(sourcetype) as sourcetype,values(DNS.src) as src,values(DNS.dest) as dest by query,answer | `threatintel_multilookup(query)` | `threatintel_multilookup(answer)` | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches` | table sourcetype,src,dest,query,answer,threat*,weight",-45m@m,+0s,,True,,,,"15,45 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"query,answer,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution where'],['ESCU - Clients Connecting to Multiple DNS Servers - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count, values(DNS.dest) AS dest dc(DNS.dest) as dest_count from datamodel=Network_Resolution where DNS.message_type=QUERY by DNS.src | `drop_dm_object_name(""Network_Resolution"")` |where dest_count > 5",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search allows you to identify the endpoints that have connected to more than five DNS servers and made DNS Queries over the time frame of the search.,,,,,,1,Clients Connecting to Multiple DNS Servers,,network,medium,Client $src$ Connecting to Multiple DNS Servers,This search allows you to identify the endpoints that have connected to more than five DNS servers over the time frame specified in the search.,"src, dest",,,,,1,src,system,80,src,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Exfiltration"", ""Exfiltration Over Alternative Protocol"", ""Commonly Used Port"", ""Standard Application Layer Protocol""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 9"", ""CIS 12"", ""CIS 13""], ""nist"": [""PR.PT"", ""DE.AE"", ""PR.DS""]}",DNS Queries with multiple DNS servers from a single client is unusual and may be indicative of malicious activity. This search works by performing a count by the source of the distinct destinations for the DNS traffic. The search uses the `Network_Resolution` data model.,"This search requires that DNS data is being ingested and populating the `Network_Resolution` data model. This data can come from DNS logs or from solutions that parse network traffic for this data, such as Splunk Stream or Bro.","It's possible that an enterprise has more than five DNS servers that are configured in a round-robin rotation. Please customize the search, as appropriate.",2016-09-13,2017-09-18,medium,ESCU - Clients Connecting to Multiple DNS Servers - Rule,detection,Endpoint,"[""dest"", ""src""]","[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""DNS Hijacking"", ""Suspicious DNS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get DNS Server History for a hostn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Concurrent App Accesses - Rule'],DA-ESS-AccessProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` count from datamodel=Authentication.Authentication by _time,Authentication.app,Authentication.src,Authentication.user span=1s | `drop_dm_object_name(""Authentication"")` | eventstats dc(src) as src_count by app,user | search src_count>1 | sort 0 + _time | streamstats current=t window=2 earliest(_time) as previous_time,earliest(src) as previous_src by app,user | where (src!=previous_src) | eval time_diff=abs(_time-previous_time) | where time_diff<300",-70m@m,+0s,,1,number of events,greater than,0,10 * * * *,1,1,false,,,,Alerts on concurrent access attempts to an app from different hosts. These are good indicators of shared passwords and potential misuse.,,,,,0,1,Concurrent Login Attempts Detected,0,access,medium,Concurrent Access Event Detected For $user$,"Concurrent access attempts to $app$ by $user$ from two different sources( $previous_src$, $src$ ) have been detected.",user,View access attemps by $user$,"| from datamodel:""Authentication"".""Authentication"" | search user=""$user$""",,,1,user,user,20,"app,user",86300s,false,SplunkEnterpriseSecuritySuite,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['Threat - Process Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats `summariesonly` values(sourcetype) as sourcetype,values(Processes.dest) as dest from datamodel=Endpoint.Processes by Processes.process_name | rename Processes.process_name as process | lookup update=true threatintel_by_process process OUTPUT | lookup update=true threatintel_by_process_wildcard process OUTPUTNEW | lookup update=true threatintel_by_file_name file_name as process OUTPUTNEW | lookup update=true threatintel_by_file_name_wildcard file_name as process OUTPUTNEW | search threat_collection_key=* | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"20,50 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"process,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,process,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Registry Path Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"sourcetype=WinRegistry | stats values(sourcetype) as sourcetype,values(dest) as dest by registry_path | lookup update=true threatintel_by_registry_path registry_path OUTPUT | lookup update=true threatintel_by_registry_path_wildcard registry_path OUTPUTNEW | search threat_collection_key=* | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"25,55 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"registry_path,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_path,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Registry Value Name Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"sourcetype=WinRegistry | stats values(sourcetype) as sourcetype,values(dest) as dest by registry_value_data | lookup update=true threatintel_by_registry_value_name registry_value_name OUTPUT | lookup update=true threatintel_by_registry_value_name_wildcard registry_value_name OUTPUTNEW | search threat_collection_key=* | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"0,30 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"registry_value_name,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_value_name,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Registry Value Text Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"sourcetype=WinRegistry | stats values(sourcetype) as sourcetype,values(dest) as dest by registry_value_data | rename registry_value_data as registry_value_text | lookup update=true threatintel_by_registry_value_text registry_value_text OUTPUT | lookup update=true threatintel_by_registry_value_text_wildcard registry_value_text OUTPUTNEW | search threat_collection_key=* | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"5,35 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"registry_value_text,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,registry_value_text,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['Threat - Service Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats `summariesonly` values(sourcetype) as sourcetype,values(Services.dest) as dest from datamodel=Endpoint.Services by Services.service | rename Services.service as service | lookup update=true threatintel_by_service service OUTPUT | lookup update=true threatintel_by_service_wildcard service OUTPUTNEW | search threat_collection_key=* | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"10,40 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"service,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,service,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Source And Destination Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `src_dest_tstats(""allowed"")` | `threatintel_multilookup(src)` | `threatintel_multilookup(dest)` | search threat_collection_key=* | fields - count | `zipexpand_threat_matches` | fields sourcetype,src,dest,threat*,weight",-45m@m,+0s,,True,,,,"15,45 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"src,dest,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Threat - URL Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype) as sourcetype,values(Web.src),values(Web.dest) from datamodel=Web.Web by Web.http_referrer | eval url='Web.http_referrer' | eval threat_match_field=""http_referrer"" | `tstats` append=true values(sourcetype) as sourcetype,values(Web.src),values(Web.dest) from datamodel=Web.Web by Web.url | eval url=if(isnull(url),'Web.url',url) | eval threat_match_field=if(isnull(threat_match_field),""url"",threat_match_field) | stats values(sourcetype) as sourcetype,values(Web.src) as src,values(Web.dest) as dest by url,threat_match_field | extract domain_from_url | `threatintel_url_lookup(url)` | `threatintel_domain_lookup(url_domain)` | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"20,50 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"url,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,url,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Authentication.Authentication', 'Compute_Inventory.All_Inventory', 'Web.Web']",['Threat - User Matches - Threat Gen'],DA-ESS-ThreatIntelligence-default,,,False,,,,,,,,,"| `tstats` values(sourcetype),values(Authentication.src),values(Authentication.dest) from datamodel=Authentication.Authentication by Authentication.src_user | eval user='Authentication.src_user' | eval threat_match_field=""src_user"" | `tstats` append=true values(sourcetype),values(Authentication.src),values(Authentication.dest) from datamodel=Authentication.Authentication by Authentication.user | eval user=if(isnull(user),'Authentication.user',user) | `sistats_values_rename(Authentication.src,src)` | `sistats_values_rename(Authentication.dest,dest)` | `tstats` append=true values(sourcetype),values(All_Inventory.src),values(All_Inventory.dest) from datamodel=Compute_Inventory.All_Inventory by All_Inventory.User.user | eval user=if(isnull(user),'All_Inventory.User.user',user) | eval threat_match_field=if(isnull(threat_match_field),""user"",threat_match_field) | `sistats_values_rename(All_Inventory.src,src)` | `sistats_values_rename(All_Inventory.dest,dest)` | `tstats` append=true values(sourcetype),values(Web.src),values(Web.dest) from datamodel=Web.Web by Web.user | eval user=if(isnull(user),'Web.user',user) | `sistats_values_rename(Web.src,src)` | `sistats_values_rename(Web.dest,dest)` | stats values(sourcetype) as sourcetype,values(src) as src,values(dest) as dest by user,threat_match_field | lookup update=true threatintel_by_user user OUTPUT | lookup update=true threatintel_by_user_wildcard user OUTPUTNEW | search threat_collection_key=* | `mvtruncate(src)` | `mvtruncate(dest)` | `zipexpand_threat_matches`",-45m@m,+0s,,True,,,,"25,55 * * * *",1,1,false,,,,,,,,,,,,0,,,,,,,,,,,,,,"user,threat_collection_key",86300s,false,SplunkEnterpriseSecuritySuite,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,user,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Common Ransomware Extensions - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.user) as user values(Filesystem.dest) as dest values(Filesystem.file_path) as file_path from datamodel=Endpoint.Filesystem by Filesystem.file_name | `drop_dm_object_name(Filesystem)` | `ctime(lastTime)` | `ctime(firstTime)`| rex field=file_name ""(?<file_extension>.[^.]+)$"" | `ransomware_extensions`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for file modifications with extensions commonly used by Ransomware,,,,,,1,Common Ransomware Extensions,,endpoint,high,Ransomware Extension detected on $dest$,A file modification was detected on $dest$ with an extension commonly used by ransomware.,"dest, file_name",,,,,1,dest,system,80,"dest,file_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}",This search looks at file modifications across your hosts and identifies files with extensions that are commonly associated with the encrypted files generated by ransomware.,"You must be ingesting data that records the filesystem activity from your hosts to populate the Endpoint file-system data model node. If you are using Sysmon, you will need a Splunk Universal Forwarder on each endpoint from which you want to collect data.","It is possible for a legitimate file with these extensions to be created. If this is a true ransomware attack, there will be a large number of files created with these extensions.",2017-08-21,2018-11-15,high,ESCU - Common Ransomware Extensions - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Ransomware"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage  1 - Reconnaissance, External Network Scan']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"")   NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv | rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned> 9 | dedup src_ip, HostsScanned | rename src_ip as clientip | lookup ipdomain clientip  OUTPUT class | fillnull class | where class=0 | eval rule=""External Network Scan"" | eval stage=""Stage 1 - Reconnaissance"" | rename clientip as src_ip |  table src_ip, HostsScanned, _time, stage, rule, source,sourcetype",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, HostsScanned=$result.HostsScanned$, stage=""$result.stage$"", rule=""$result.rule$""",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 1 - Reconnaissance, External Port Scan']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"")   NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv | rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_port) AS PortsScanned by src_ip, _time |  where PortsScanned> 50 | dedup src_ip, PortsScanned | rename src_ip as clientip | lookup ipdomain clientip  OUTPUT class | fillnull class | where class=0 | eval rule=""External Port Scan"" | eval stage=""Stage 1 - Reconnaissance"" | rename clientip as src_ip |  table src_ip, PortsScanned, _time, stage, rule, source,sourcetype",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, PortsScanned=$result.PortsScanned$, stage=""$result.stage$"", rule=""$result.rule$""",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 3 - Delivery, Outbound Connection to Attacker Host']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" OR tag::eventtype=""communicate"" OR tag::eventtype=""network"")  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=dest ""(?<IP_add>d{1,3}.d{1,3}.d{1,3}.d{1,3}):(?<dest_port>d+)"" | rename src_ip as clientip | lookup ipdomain clientip  OUTPUT class | search class=internal | rename clientip as src_ip | join dest_ip [ search index=apt-framework earliest=-92d latest=now  stage=""Stage 1 - Reconnaissance"" | rename src_ip as dest_ip  | dedup  dest_ip ]  | eval stage=""Stage 3 - Delivery"" | eval rule=""Outbound connection to Attacker Host""  | stats count by src_ip dest_ip rule stage source sourcetype | table _time src_ip dest_ip rule stage count, source,sourcetype",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$trigger_time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, dest_ip=$result.dest_ip$, stage=""$result.stage$"", rule=""$result.rule$"",  count=$result.count$",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 4 - Exploitation, Service or Software Installed']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=*  (EventCode=1022 SourceName=MsiInstaller) OR (EventCode=1033 SourceName=MsiInstaller) OR (EventCode=11707 SourceName=MsiInstaller) OR (EventCode=11728 SourceName=MsiInstaller) OR (EventCode=19 TaskCategory=""Windows Update Agent"") OR (SourceName=""Microsoft-Windows-FilterManager"" EventCode=6) OR (EventCode=4377 SourceName=NtServicePack) OR (LogName=Security EventCode=601) OR (EventCode=7045 SourceName=""Microsoft-Windows-Service Control Manager"") OR (SourceName=""Microsoft-Windows-Security-Auditing"" EventCode=4697) |  lookup dnsLookup  host as ComputerName | eval stage=""Stage 4 - Exploitation"" | eval rule=""Service or Software Installed"" | stats count by ip ComputerName stage rule source sourcetype | rename ip as src_ip",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$trigger_time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, stage=""$result.stage$"", rule=""$result.rule$"", count=$result.count$, src_host=$result.ComputerName$",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 5 - Installation, PsExec Service Installed']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=*  EventCode=7045 SourceName=""*Service Control Manager"" | eval service_name_lower_case=lower(Service_Name) | eval service_file_name_lower_case=lower(Service_File_Name) | search (service_name_lower_case=*psexe* OR service_file_name_lower_case=*psexe*) | lookup dnsLookup  host as ComputerName | eval stage=""Stage 5 - Installation"" | eval rule=""PsExec Service Installed"" |  table _time ip ComputerName stage rule source sourcetype | rename ip as src_ip",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, stage=""$result.stage$"", rule=""$result.rule$"", src_host=$result.ComputerName$",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 5 - Installation, PsExec Service Usage']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=*  EventCode=7036 SourceName=""*Service Control Manager""  | search *psexe*  | lookup dnsLookup  host as ComputerName | eval stage=""Stage 5 - Installation"" | eval rule=""PsExec Service Usage"" |  table _time ip ComputerName stage rule source sourcetype | rename ip as src_ip",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, stage=""$result.stage$"", rule=""$result.rule$"", src_host=$result.ComputerName$",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 6 - C2, Outbound Connection to C2']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" ) earliest=-10m latest=now  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | lookup ipdomain clientip as dest_ip  OUTPUT class as cl  | rex mode=sed field=url ""s/http:////"" | rex mode=sed field=url  ""s/https:////"" | rex mode=sed field=url  ""s/:443//"" | rex mode=sed field=url  ""s//$//"" | rename url as Domain | join Domain [ | inputlookup c2domain.csv ] | append [ search earliest=-10m latest=now index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" OR tag::eventtype=""communicate"" OR tag::eventtype=""network"")   | join dest_ip [ |inputlookup c2ip.csv | rename IPAddress as dest_ip ]] | eval stage=""Stage 6 - C2"" | eval rule=""Outbound connection to C2""  | stats count by src_ip dest_ip rule stage source sourcetype | table src_ip dest_ip rule stage count source sourcetype",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$trigger_time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, dest_ip=$result.dest_ip$, stage=""$result.stage$"", rule=""$result.rule$"",  count=$result.count$",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 7 - Actions on Objective, Internal Network Scan']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"")   NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv | rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned> 50 | dedup src_ip, HostsScanned | lookup ipdomain clientip as src_ip OUTPUT class as class1  | where class1=""internal"" |  lookup ipdomain clientip as dest_ip  OUTPUT class as class2 |  where class2=""internal"" | eval rule=""Internal Network Scan"" | eval stage=""Stage 7 - Reconnaissance"" |  table src_ip, HostsScanned, _time, stage, rule, source, sourcetype",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, HostsScanned=$result.HostsScanned$, stage=""$result.stage$"", rule=""$result.rule$""",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 7 - Actions on Objective, Internal Port Scan']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"")   NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv | rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_port) AS PortsScanned by src_ip, _time |  where PortsScanned> 50 | dedup src_ip, PortsScanned | lookup ipdomain clientip as src_ip OUTPUT class as class1  | where class1=""internal"" |  lookup ipdomain clientip as dest_ip  OUTPUT class as class2 |  where class2=""internal"" | eval rule=""Internal Port Scan"" | eval stage=""Stage 7 - Reconnaissance"" |  table src_ip, PortsScanned, _time, stage, rule, source, sourcetype",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, PortsScanned=$result.PortsScanned$, stage=""$result.stage$"", rule=""$result.rule$""",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 7 - Actions on Objective, Windows Audit Logs Cleared']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=*  (EventCode=1102 SourceName=""Microsoft-Windows-Eventlog"") OR (EventCode=104 SourceName=""Microsoft-Windows-Eventlog"") OR (Security LogName=Security EventCode=517)  |  lookup dnsLookup  host as ComputerName | eval stage=""Stage 7 - Actions on Objective"" | eval rule=""Windows Audit Logs Cleared"" | stats count by ip ComputerName stage rule source sourcetype | rename ip as src_ip",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$trigger_time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, stage=""$result.stage$"", rule=""$result.rule$"" count=$result.count$, src_host=$result.ComputerName$",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Common Ransomware Notes - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.user) as user values(Filesystem.dest) as dest values(Filesystem.file_path) as file_path from datamodel=Endpoint.Filesystem by Filesystem.file_name | `drop_dm_object_name(Filesystem)` | `ctime(lastTime)` | `ctime(firstTime)`|`ransomware_notes`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search looks for files created with names matching those typically used in ransomware notes that tell the victim how to get their data back.,,,,,,1,Common Ransomware Notes,,endpoint,high,Ransomware Note File detected on $dest$,A file modification associated with a ransomware victim notification file detected on $dest$,"dest, file_name",,,,,1,dest,system,80,"dest,file_name",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search looks at file modifications in the Change Analysis data model. It checks modified file names against an included lookup file, which contains the names of note files left behind by ransomware (to inform the victim how they can pay the ransom and retrieve their files). The search returns a list of files with matching names.","You must be ingesting data that records file-system activity from your hosts to populate the Endpoint Filesystem data-model node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or via other endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report file-system reads and writes.",It's possible that a legitimate file could be created with the same name used by ransomware note files.,2017-08-21,2018-11-15,high,ESCU - Common Ransomware Notes - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon""]","[""Ransomware"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Stage 7 - Actions on Objective, Windows System Time Changed']",MTLSOC_APTFrameworkBasic-default,,,,,,,,,,,,"index=*  (EventCode=4616 Windows SourceName=""Microsoft Windows security auditing."") OR (LogName=Security EventCode=520)   |  lookup dnsLookup  host as ComputerName | eval stage=""Stage 7 - Actions on Objective"" | eval rule=""Windows System Time Changed"" | stats count by ip ComputerName stage rule source sourcetype | rename ip as src_ip",-10m,now,,1,number of events,greater than,0,*/10 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCAPTFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$trigger_time$, Source=$result.source$, Sourcetype=$result.sourcetype$, src_ip=$result.src_ip$, stage=""$result.stage$"", rule=""$result.rule$"", count=$result.count$, src_host=$result.ComputerName$",apt-framework,apt-framework,apt-framework,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Brute Force Destination Server'],MTLSOC_BruteForceDetectionBasic-default,,,,,,,,,,,,index=* OR index=_audit tag=authentication  action=fail* earliest=-10m latest=now | transaction src dest maxpause=10m | eval app_count=mvcount(app) | where (eventcount>1 AND app_count>1),-10m,now,,1,number of events,greater than,0,*/10 * * * *,,0,0,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,MTLSOCBruteForceDetectionBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, brute_type=""Brute Force Destination Server"", app=$result.app$, src=$result.src$, dest=$result.dest$, src_user=$result.src_user$, Source=$result.source$, Sourcetype=$result.sourcetype$, eventcount=$result.eventcount$, app_count=$result.app_count$",bruteforce,bruteforce_basic,bruteforce_basic,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Brute Force Destination Service'],MTLSOC_BruteForceDetectionBasic-default,,,,,,,,,,,,index=* OR index=_audit tag=authentication  action=fail* | transaction src dest maxpause=10m | eval user_count=mvcount(src_user) | eval src_count=mvcount(src) | eval dest_count=mvcount(dest) | where (eventcount>1 AND user_count>4),-10m,now,,1,number of events,greater than,0,*/10 * * * *,,0,0,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,MTLSOCBruteForceDetectionBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, brute_type=""Brute Force Destination Service"", app=$result.app$, src=$result.src$, dest=$result.dest$, src_user=$result.src_user$, Source=$result.source$, Sourcetype=$result.sourcetype$, eventcount=$result.eventcount$, user_count=$result.user_count$",bruteforce,bruteforce_basic,bruteforce_basic,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Brute Force Destination User'],MTLSOC_BruteForceDetectionBasic-default,,,,,,,,,,,,index=* OR index=_audit tag=authentication  action=fail* | transaction src dest maxpause=10m | where eventcount>5,-10m,now,,1,number of events,greater than,0,*/10 * * * *,,0,0,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,MTLSOCBruteForceDetectionBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, brute_type=""Brute Force Destination User"", app=$result.app$, src=$result.src$, dest=$result.dest$, src_user=$result.src_user$, Source=$result.source$, Sourcetype=$result.sourcetype$, eventcount=$result.eventcount$",bruteforce,bruteforce_basic,bruteforce_basic,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Brute Force Source Server'],MTLSOC_BruteForceDetectionBasic-default,,,,,,,,,,,,index=* OR index=_audit tag=authentication  action=fail* | transaction src dest maxpause=10m | eval user_count=mvcount(src_user) | where user_count>4,-10m,now,,1,number of events,greater than,0,*/10 * * * *,,0,0,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,MTLSOCBruteForceDetectionBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$, brute_type=""Brute Force Source Server"", app=$result.app$, src=$result.src$, dest=$result.dest$, src_user=$result.src_user$, Source=$result.source$, Sourcetype=$result.sourcetype$, eventcount=$result.eventcount$, user_count=$result.user_count$",bruteforce,bruteforce_basic,bruteforce_basic,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['EternalRocks Worm Detector - Network Scan on 445 Port (by EternalRocks)'],MTLSOC_EternalRocksWormDetector-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"") dest_port=445  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned >= 30 | dedup src_ip, HostsScanned | table src_ip, HostsScanned, _time",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCEternalRocksWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Network Scan on 445 Port"" Severity=""8"" src_ip=""$result.src_ip$"" HostsScanned=$result.HostsScanned$",eternalrocks,eternalrocks,eternalrocks,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['EternalRocks Worm Detector - Activity on Windows Hosts by File Names (Sysmon)'],MTLSOC_EternalRocksWormDetector-default,,,,,,,,,,,,"index=*  sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) |rename process as FileName |  join FileName [| inputlookup eternalrocks_files.csv | table FileName ]  |  rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip FileName",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCEternalRocksWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by File Names"" Severity=""8""src_ip=""$result.ip$"" FileName=$result.FileName$",eternalrocks,eternalrocks,eternalrocks,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['EternalRocks Worm Detector - Activity on Windows Hosts by File Hashes (Sysmon)'],MTLSOC_EternalRocksWormDetector-default,,,,,,,,,,,,"index=*  sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) | rex field=Hashes mode=sed ""s/SHA256=//g"" | rex field=Hashes mode=sed ""s/SHA1=//g"" | rex field=Hashes mode=sed ""s/MD5=//g""| join Hashes [| inputlookup eternalrocks_hashes.csv | table Hash | rename Hash as Hashes] | rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip Hashes",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCEternalRocksWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by File Hashes"" Severity=""8""src_ip=""$result.ip$"" Hashes=$result.Hashes$",eternalrocks,eternalrocks,eternalrocks,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['EternalRocks Worm Detector - Activity on Windows Hosts by Process (Sysmon)'],MTLSOC_EternalRocksWormDetector-default,,,,,,,,,,,,"index=*  sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" )   shadowbrokers.zip OR SharpZLib.zip OR installed.fgh OR ICSharpCode.SharpZipLib.dll OR Microsoft.Win32.TaskScheduler.dll OR tor.zip OR required.glo OR taskhost.exe OR TaskScheduler.zip OR torunzip.exe OR (C:Program FilesMicrosoft UpdatesSharpZLib.zip) OR (C:Program FilesMicrosoft Updatessvchost.exe) OR (C:Program FilesMicrosoft Updatesinstalled.fgh)  OR (C:Program FilesMicrosoft UpdatesICSharpCode.SharpZipLib.dll) OR (C:Program FilesMicrosoft UpdatesMicrosoft.Win32.TaskScheduler.dll) OR (C:Program FilesMicrosoft UpdatesSharpZLib) OR (C:Program FilesMicrosoft Updatestemptor.zip) OR (C:Program FilesMicrosoft UpdatestempTor) OR (C:Program FilesMicrosoft Updatesrequired.glo) OR (C:Program FilesMicrosoft Updatestaskhost.exe) OR (C:Program FilesMicrosoft UpdatesTaskScheduler.zip) OR (C:Program FilesMicrosoft UpdatesTaskScheduler) OR (C:Program FilesMicrosoft Updatestorunzip.exe) | rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip CommandLine",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCEternalRocksWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by Process"" Severity=""8""src_ip=""$result.ip$"" CommandLine=""$result.CommandLine$""",eternalrocks,eternalrocks,eternalrocks,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['EternalRocks Worm Detector - Connection to TORPROJECT.ORG,onion']",MTLSOC_EternalRocksWormDetector-default,,,,,,,,,,,,"index=* tag=proxy ( url=*torproject.org* OR url=*.onion* OR url=*api.nuget.org/packages/taskscheduler.2.5.23.nupkg* OR url=*api.nuget.org/packages/sharpziplib.0.86.0.nupkg* )  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=url ""((?:http(?:s)?://)?(?<domain>[w-.]+)(?::|/)?(?: d+)?[^$]*)"" | table _time src_ip domain",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCEternalRocksWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to TORPROJECT.ORG,onion"" Severity=""7"" src_ip=""$result.src_ip$""  domain=$result.domain$",eternalrocks,eternalrocks,eternalrocks,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Create local admin accounts using net.exe - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.user) as user values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where (Processs.process_name=net.exe OR Processes.process_name=net1.exe) by Processes.process Processes.process_name Processes.dest | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)`  | search (process=*localgroup* OR process=*/add* OR process=*user*),-1440m@m,-10m@m,,1,number of events,greater than,0,0 8 * * *,1,1,,,,,This search looks for the creation of local administrator accounts using net.exe.,,,,,,1,Create local admin accounts using net.exe,,endpoint,medium,Local administrator account created on $dest$,Net.exe was used to create local administrator accounts on $dest$.,dest,,,,,1,dest,system,50,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface"", ""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","Net.exe is a built-in Windows command-line tool that can be used to add, display, or modify user accounts. While Microsoft administrators use this tool to manage user groups, threat actors often leverage it to create local admin accounts to maintain persistence. In this search, we are looking for the execution of process net.exe with command-line parameters such as `localgroup`, `add`, or `user` that may correspond to the creation of local admin accounts or setting user/group properties.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",Administrators often leverage net.exe to create admin accounts.,2018-03-28,2018-11-15,medium,ESCU - Create local admin accounts using net.exe - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""DHS Report TA18-074A""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Connection to Industroyer C&C'],MTLSOC_IndustroyerMalwareDetector-default,,,,,,,,,,,,"index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" OR tag::eventtype=""communicate"" OR tag::eventtype=""network"") NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=dest ""(?<IP_add>d{1,3}.d{1,3}.d{1,3}.d{1,3}):(?<dest_port>d+)"" | rename dest_ip as clientip  | lookup ipdomain clientip  OUTPUT class | search NOT class=*  | rename clientip as IPAddress | search (IPAddress=195.16.88.6 OR IPAddress=46.28.200.132 OR IPAddress=188.42.253.43 OR IPAddress=5.39.218.152 OR IPAddress=93.115.27.57) | table  _time ,src_ip, IPAddress, dest_port",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCIndustroyerMalwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to Industroyer C&C"" Severity=""6"" src_ip=""$result.src_ip$"" dest_ip=$result.IPAddress$ dest_port=$result.dest_port$",industroyer,industroyer,industroyer,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Scan from IP which tried to connect to C&C'],MTLSOC_IndustroyerMalwareDetector-default,,,,,,,,,,,,"index=*  ( tag::eventtype=""communicate"" OR tag::eventtype=""network"") dest_port=102  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned >= 50 | dedup src_ip, HostsScanned | table src_ip, HostsScanned, _time | join type=inner [ search index=""industroyer"" earliest=-30d  latest=now  Name=""Connection to Industroyer C&C"" | dedup src_ip | fields src_ip ]",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCIndustroyerMalwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""SScan from IP which tried to connect to C&C"" Severity=""8"" src_ip=""$result.src_ip$"" HostsScanned=$result.HostsScanned$",industroyer,industroyer,industroyer,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Industroyer hash detected'],MTLSOC_IndustroyerMalwareDetector-default,,,,,,,,,,,,"index=*  source=""WinEventLog:Microsoft-Windows-Sysmon/Operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) | rex field=Hashes mode=sed ""s/SHA256=//g"" | rex field=Hashes mode=sed ""s/SHA1=//g"" | rex field=Hashes mode=sed ""s/MD5=//g"" | search (Hashes=F6C21F8189CED6AE150F9EF2E82A3A57843B587D OR Hashes=CCCCE62996D578B984984426A024D9B250237533 OR Hashes=8E39ECA1E48240C01EE570631AE8F0C9A9637187 OR Hashes=2CB8230281B86FA944D3043AE906016C8B5984D9 OR Hashes=79CA89711CDAEDB16B0CCCCFDCFBD6AA7E57120A OR Hashes=94488F214B165512D2FC0438A581F5C9E3BD4D4C OR Hashes=5A5FAFBC3FEC8D36FD57B075EBF34119BA3BFF04 OR Hashes=B92149F046F00BB69DE329B8457D32C24726EE00 OR Hashes=B335163E6EB854DF5E08E85026B2C3518891EDA8)| rename Computer as host | lookup dnsLookup host  OUTPUT ip | rename ip as src_ip host as Hostname | table _time src_ip Image Hashes",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCIndustroyerMalwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Process runnning with Industroyer hash detected"" Severity=""6"" src_ip=""$result.src_ip$"" ProcessName=$result.Image$ Hash=$result.Hashes$",industroyer,industroyer,industroyer,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['Scan 102 port, 50 hosts per 1 min']",MTLSOC_IndustroyerMalwareDetector-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"") dest_port=102  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned >= 50 | dedup src_ip, HostsScanned | table src_ip, HostsScanned, _time",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCIndustroyerMalwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Scan 102 port, 50 hosts per 1 min"" Severity=""6"" src_ip=""$result.src_ip$"" HostsScanned=$result.HostsScanned$",industroyer,industroyer,industroyer,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Database Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""Database Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 3 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""DNS Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 2 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['FTP Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""FTP Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 1 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['HTTP Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""HTTP(S) Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 4 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['MAIL Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""MAIL (SMTP;POP3) Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 2 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['NETBIOS Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""NETBIOS Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 4 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Create or delete hidden shares using net.exe - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.user) as user values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where (Processs.process_name=net.exe OR Processes.process_name=net1.exe) by Processes.process Processes.process_name Processes.dest | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` | search (process=*share* OR process=*delete*)| regex process=""S+[$]""",-70m@m,-10m@m,,1,number of events,greater than,0,5 * * * *,1,1,,,,,This search looks for the creation or deletion of hidden shares using net.exe.,,,,,,1,Create or delete hidden shares using net.exe,,endpoint,medium,Hidden File shares created/deleted on $dest$,Net.exe was used to create or delete hidden network shares by $user$ on $dest$,"dest,process_name",,,,,1,dest,system,50,"dest,process_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface"", ""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","Net.exe is a built-in command-line tool on Windows that can be used to create, delete, and manage shared resources on the computer, both locally and remotely. Though this tool is used by Microsoft administrators to manage the network shares, attackers also leverage it to create and delete hidden file shares by appending ""$"" after the name of the share. To look for hidden shares, use a regular expression to look for a `(name_file_share)$`. In this search, we are looking for the command-line execution of net.exe with command-line parameters such as `net`, `share`, or `delete` that may correspond to the creation of hidden shares","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.",Administrators often leverage net.exe to create or delete network shares. You should verify that the activity was intentional and is legitimate.,2018-06-14,2018-11-15,medium,ESCU - Create or delete hidden shares using net.exe - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Hidden Cobra Malware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Get Outbound Emails to Hidden Cobra Threat Actorsn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['NTP Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""NTP Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 3 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['RDP Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""RDP Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 1 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['AVG Traffic by Services (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | eval in_mB=Bytes/1000000 |stats sum(in_mB) as MBytes by day traffic_type | chart max(MBytes) min(MBytes) avg(MBytes) by traffic_type | rename traffic_type as ""Traffic Type"" max(MBytes) as MAX(MBytes) min(MBytes) as MIN(MBytes) avg(MBytes) as AVG(MBytes)",0,,,1,,,,0 5 * * *,,,0,,,,,,statistics,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=* eventtype=netflow | lookup services dest_port OUTPUT traffic_type | where traffic_type=""DNS Traffic"" | timechart span=10m count",-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Database Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=* eventtype=netflow | lookup services dest_port OUTPUT traffic_type | where traffic_type=""Database Traffic"" | timechart span=10m count",-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['FTP Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=* eventtype=netflow | lookup services dest_port OUTPUT traffic_type | where traffic_type=""FTP Traffic"" | timechart span=10m count",-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['HTTP(S) Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=* eventtype=netflow | lookup services dest_port OUTPUT traffic_type | where traffic_type=""HTTP(S) Traffic"" | timechart span=10m count",-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['MAIL (SMTP;POP3) Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=* eventtype=netflow | lookup services dest_port OUTPUT traffic_type | where traffic_type=""MAIL (SMTP;POP3) Traffic"" | timechart span=10m count",-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['RDP Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=* eventtype=netflow | lookup services dest_port OUTPUT traffic_type | where traffic_type=""RDP Traffic"" | timechart span=10m count",-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SSH Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=*  eventtype=netflow | lookup services dest_port OUTPUT traffic_type | where traffic_type=""SSH Traffic"" | timechart span=10m count",-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution by'],['ESCU - DNS Query Length With High Standard Deviation - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Resolution by DNS.query DNS.record_type |  `drop_dm_object_name(""DNS"")` | eval query_length = len(query) | table query query_length record_type count stdev | eventstats stdev(query_length) AS stdev avg(query_length) AS avg p50(query_length) AS p50| where query_length>(stdev*2)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search allows you to identify DNS requests and compute the standard deviation on the length of the names being resolved, then filter on two times the standard deviation to show you those queries that are unusually large for your environment.",,,,,,1,DNS Query Length With High Standard Deviation,,network,medium,DNS query length with high standard deviation,Filter DNS requests and compute the standard deviation then filter on 2 times the standard deviation,dest,,,,,1,dest,system,40,query,43200s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Exfiltration"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 8"", ""CIS 12""], ""nist"": [""PR.PT"", ""DE.AE"", ""DE.CM""]}","Attackers often use random, long domain names for their attack infrastructure. This search looks at all the queries observed over the search time frame, and identifies any domains being resolved with names that are greater that 2 times the standard deviation.","To successfully implement this search, you will need to ensure that DNS data is populating the Network_Resolution data model.",It's possible there can be long domain names that are legitimate.,2016-09-13,2017-09-18,medium,ESCU - DNS Query Length With High Standard Deviation - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""Hidden Cobra Malware"", ""Suspicious DNS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get DNS Server History for a hostnESCU - Get DNS traffic rationESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Build trend'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"index=cr | bucket _time span=1d as day  | eval day=strftime(day,""%Y-%m-%d"") | stats sum(bytes) as Bytes by  src_ip dest_ip dest_port day | table src_ip dest_ip dest_port day Bytes",-30d@d,now,,1,,,,0 0 * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SSH Total Daily (Last 30d)'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,"| loadjob [| rest /services/search/jobs count=0 | search isDone=1 isSavedSearch=1  | where label=""Build trend"" | head 1 | return $sid]  | lookup services dest_port OUTPUT traffic_type  | search traffic_type=""SSH Traffic""| eval in_mB=Bytes/1000000 |chart sum(in_mB) over day by dest_port",0,,,1,,,,0 3 * * *,,,0,,,,,,visualizations,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['All Other Traffic'],MTLSOC_NetflowSecurityMonitorBasic-default,,,,,,,,,,,,index=* eventtype=netflow NOT [|inputlookup known_attacker_ports.csv | rename port as src_port | table src_port] | lookup services dest_port OUTPUT traffic_type | fillnull traffic_type | search traffic_type=0 | timechart span=10m count,-24h@h,now,,1,,,,*/10 * * * *,,,0,,,1,,0,statistics,statistics,0,,,,,,,,,,,,,,,,,,,,,MTLSOCNetflowSecurityMonitorBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,1,-1d@h,timeline_app.timeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['User list - Successful login past 30d'],MTLSOC_PasswordSecurityBasic-default,,,,,,,,,,,,"index=* source=""WinEventLog:security"" (EventCode=528 OR EventCode=540 OR EventCode=4624) (Logon_Type=2 OR Logon_Type=3 OR Logon_Type=7 OR Logon_Type=10) | eval User=if(mvcount(Account_Name)>1, mvindex(Account_Name,1), mvindex(Account_Name, 0)) |search NOT  (User=*$ OR User=""ANONYMOUS LOGON"" OR User=""LOCAL SERVICE"" OR User=SYSTEM) | stats count by User | fields User| outputlookup users.csv",-30d,now,,1,number of events,greater than,0,0 * * * *,,0,1,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCPasswordSecurityBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,1,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Successful login IP-User list past 30d'],MTLSOC_PasswordSecurityBasic-default,,,,,,,,,,,,"index=* source=""WinEventLog:security"" (EventCode=528 OR EventCode=540 OR EventCode=4624) (Logon_Type=2 OR Logon_Type=3 OR Logon_Type=7 OR Logon_Type=10) | eval User=if(mvcount(Account_Name)>1, mvindex(Account_Name,1), mvindex(Account_Name, 0)) | search NOT(User=*$ OR User=""ANONYMOUS LOGON"" OR User=""LOCAL SERVICE"" OR User=SYSTEM)  (Source_Network_Address=*  AND Source_Network_Address!=""-"")| lookup dnsLookup ip as Source_Network_Address OUTPUT host as Source_Host | dedup Source_Network_Address User|rename _time as Time |table Time Source_Host Source_Network_Address User | outputlookup successful_logins.csv",-30d,now,,1,number of events,greater than,0,0 * * * *,,0,1,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,MTLSOCPasswordSecurityBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,1,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Petya Ransomware Detector - Activity on Windows Hosts by File Hashes (Sysmon)'],MTLSOC_PetyaRansomwareDetector-default,,,,,,,,,,,,"index=*  source=""WinEventLog:Microsoft-Windows-Sysmon/Operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) | rex field=Hashes mode=sed ""s/SHA256=//g"" | rex field=Hashes mode=sed ""s/SHA1=//g"" | rex field=Hashes mode=sed ""s/MD5=//g""| join Hashes [| inputlookup petya_hashes.csv | table Hash | rename Hash as Hashes] | rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip Hashes",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimePetyaRansomwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by File Hashes"" Severity=""8""src_ip=""$result.ip$"" Hashes=$result.Hashes$",petya_ransomware_detector,petya_ransomware_detector,petya_ransomware_detector,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Petya Ransomware Detector - Activity on Windows Hosts by File Names (Sysmon)'],MTLSOC_PetyaRansomwareDetector-default,,,,,,,,,,,,"index=*  source=""WinEventLog:Microsoft-Windows-Sysmon/Operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) |rename process as FileName |  join FileName [| inputlookup petya_files.csv | table FileName ]  |  rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip FileName",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimePetyaRansomwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by File Names"" Severity=""8""src_ip=""$result.ip$"" FileName=$result.FileName$",petya_ransomware_detector,petya_ransomware_detector,petya_ransomware_detector,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Petya Ransomware Detector - Connection to Petya Distributions Sites'],MTLSOC_PetyaRansomwareDetector-default,,,,,,,,,,,,"index=* tag=proxy (url=*french-cooking.com* OR url=*coffeinoffice.xyz* OR url=""*185.165.29.78/~alex/svchost.exe"" OR url=""*84.200.16.242/myguy.xls"" OR url=""*french-cooking.com/myguy.exe&amp#39"" OR url=*sundanders.online* OR url=*1000kiosks.com* or url=*acb-porte-et-fenetre.com* OR url=*acb-portes-et-fenetres.com* OR url=*acb-portesetfenetres.com* OR url=*acovel.com*  OR url=*afrochicparis.com* OR url=*albon.fr* OR url=*albonweb.com* OR url=*allia-france.com* OR url=*ambianceinformatique.fr* OR url=*angers-loire-aeroport.fr* OR url=*angersnautique.org* OR url=*anjou-sieges.com* OR url=*anjouloireterritoire.com* OR url=*antoinebeaumont.com* OR url=*arbres-de-memoire.com* OR url=*arbres-de-memoire.fr* OR url=*asso-ball.com* OR url=*avenir-meca.com* OR url=*axode-france.com* OR url=*axode-france.net* OR url=*axode-france.org* OR url=*axode.cn* OR url=*axode.com* OR url=*axode.eu* OR url=*axode.fr* OR url=*axode.org* OR url=*axodefrance.com* OR url=*axodefrance.net* OR url=*axodefrance.org* OR url=*bearn-loisirs.com* OR url=*bearn-loisirs.fr* OR url=*beaupreau-en-mauges.com* OR url=*beaupreau-en-mauges.org* OR url=*beaupreauenmauges.com* OR url=*beaute-femme-noire.com* OR url=*beaute-peau-noire.com* OR url=*bertranlotth.com* OR url=*bhrvegetal.com* OR url=*biogenix.fr* OR url=*bioparc-zoo.com* OR url=*bioparc-zoo.mobi* OR url=*biovac-autovaccins.fr* OR url=*biovac-reactifs.fr* OR url=*biovac-reagents.com* OR url=*biovac.fr* OR url=*blackcosmeticsparis.com* OR url=*bois-beton.com* OR url=*bois-beton.fr* OR url=*branly-lacaze.com* OR url=*bruno-pele-energie-renouvelable.com* OR url=*bureaux-locaux49.com* OR url=*campinglayole.mobi* OR url=*cao-concept.com* OR url=*caoconcept.com* OR url=*carre-installateur.com* OR url=*cash-to-card.com* OR url=*centrale-gge.com* OR url=*centredeformationdestaxis49.com* OR url=*chaillou.biz* OR url=*chalonnes-sur-loire.com* OR url=*chalonnes-sur-loire.info* OR url=*chalonnes-sur-loire.net* OR url=*chalonnes-sur-loire.org* OR url=*chemille-en-anjou.com* OR url=*chemilleenanjou.com* OR url=*cheveu-crepu.com* OR url=*chrono-laser.com* OR url=*chyporus.online* OR url=*clawap.fr* OR url=*colaissiere.com* OR url=*cornillelescaves.fr* OR url=*cppinvestissements.com* OR url=*c OR url=s-europe.com* OR url=*c OR url=s-hairs.com* OR url=*c OR url=s-products.com* OR url=*cvl-contract.com* OR url=*cvl-manufacture.com* OR url=*diouda-online.com* OR url=*diouda.biz* OR url=*drugrd.com* OR url=*dupire.com* OR url=*easyweeks.com* OR url=*ece-environnement.com* OR url=*echodesanes.com* OR url=*editionstequi.com* OR url=*effluservice.com* OR url=*emploi-saisonnier49.com* OR url=*esternayauto.com* OR url=*femme-beaute.fr* OR url=*filling-equipment.com* OR url=*formations-entreprises49.com* OR url=*foyerdarwin.com* OR url=*foyerormieres.fr* OR url=*fransal.com* OR url=*ftmeca.com* OR url=*gite-domaine-aux-moines.com* OR url=*groupe-deroure.com* OR url=*groupe-jenny.com* OR url=*imancosmetics.fr* OR url=*infoshow.fr* OR url=*institutdumanagementdigital.com* OR url=*iprim.fr* OR url=*laboiteajoujoux-cndc.com* OR url=*ladyblackparis.com* OR url=*lamaisoncreole.com* OR url=*leader-loisirs.fr* OR url=*lecouteux-branly.com* OR url=*lesvisitesvertes.com* OR url=*lesvisitesvertes.fr* OR url=*ligerim.fr* OR url=*logermonbusiness.com* OR url=*m-tourisme.com* OR url=*maepi.com* OR url=*maison-jamet.com* OR url=*maquillage-des-peaux-noires.com* OR url=*mauges-communaute.com* OR url=*maugescommunaute.com* OR url=*mecschaumiere.fr* OR url=*meublesinstinct.com* OR url=*meublesneova.com* OR url=*meublesneova.net* OR url=*mfam.fr* OR url=*mh-formation.com* OR url=*mieletgourmandises.fr* OR url=*mobilier-mousse-collectivites.com* OR url=*mobilier-mousse-direct.com* OR url=*mobilier-mousse.com* OR url=*modedirecte.com* OR url=*no-stress.org* OR url=*noireinparis.com* OR url=*nostress.net* OR url=*optilogistic.com* OR url=*optilogistic.eu* OR url=*optilogistic.fr* OR url=*optilogistic.net* OR url=*ouest-overseas.org* OR url=*outilleurs-angevins.fr* OR url=*packrasia.com* OR url=*panelia.fr* OR url=*patrimonia-bs.com* OR url=*physipro.fr* OR url=*pjcourtin.com* OR url=*plandanjou.com* OR url=*pomevasion.fr* OR url=*probalu.com* OR url=*probalu.fr* OR url=*profiltech.net* OR url=*prostyl.net* OR url=*prostyl.org* OR url=*ps-algerie.com* OR url=*rb2creations.com* OR url=*rougan-art.com* OR url=*salon-artisans-croisic.com* OR url=*sdmsodimat.com* OR url=*sieges-billes.com* OR url=*sieges-coussins-plein-air-direct.com* OR url=*sifom.com* OR url=*sigpizarras.com* OR url=*softec.fr* OR url=*spin-off.biz* OR url=*sportmaniac.co.in* OR url=*strategie-aims.com* OR url=*swissknot.com* OR url=*tarosani.com* OR url=*technicotheque.com* OR url=*unit-logistique.com* OR url=*viedenoir.com* OR url=*viedenoire.com* OR url=*viedenoire.fr* OR url=*visioptronic.com* OR url=*vita-consult.fr* OR url=*vitaconsult.fr* OR url=*vive-les-cheveux-crepus.com* OR url=*xn--chemill-en-anjou-hqb.com* OR url=*xn--chemillenanjou-hkb.com* OR url=*xn--grzill-cvae.com* OR url=*zoodessables.com* OR url=*zoodessables.mobi* OR url=*alimentsgenouel.alimentsgenouel.fr* OR url=*anena.anena-attelage.com* OR url=*angers.angers-kits-miniatures.com* OR url=*anjou.anjou-sieges.fr* OR url=*arcane.arcane-research.com* OR url=*bertranlotth.bertranlotth.fr* OR url=*caoconcept.caoconcept.fr* OR url=*cheminsdelarose.cheminsdelarose.fr* OR url=*cinemasdafrique.cinemasdafrique.asso.fr* OR url=*cmi.cmi-france.com* OR url=*cvl.cvl-contract.fr* OR url=*editions.editions-crer.fr* OR url=*fondation.fondation-visio.org* OR url=*lecouteux.lecouteux-branly-lacaze.com* OR url=*leraysecurite.leraysecurite.fr* OR url=*mail.tapodhan.de* OR url=*mecaflor.mecaflor.com* OR url=*meublesneova.meublesneova.fr* OR url=*midual.midual.com* OR url=*net.unimedia.fr* OR url=*optik.optik-telecom.fr* OR url=*philippelepape.philippelepape.com* OR url=*php53-1.unimedia.fr* OR url=*php53-3.unimedia.fr* OR url=*rblrei.rblrei-france.com* OR url=*saintmichelauto.saintmichelauto.fr* OR url=*samson.samson-horticulture.com* OR url=*visitesvertes.visitesvertes.tv* OR url=*vita.vita-consult.com* OR url=*www.aeria-ci.com* OR url=*www.grezille.com* OR url=*www.partenaires.anjou-sieges.fr* OR url=*zoodoue.zoodoue.fr*) NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=url ""((?:http(?:s)?://)?(?<domain>[w-.]+)(?::|/)?(?: d+)?[^$]*)"" | table _time src_ip domain",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimePetyaRansomwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to Petya Distributions Sites"" Severity=""7"" src_ip=""$result.src_ip$""  domain=$result.domain$",petya_ransomware_detector,petya_ransomware_detector,petya_ransomware_detector,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Petya Ransomware Detector - Connections to Petya Hosts'],MTLSOC_PetyaRansomwareDetector-default,,,,,,,,,,,,"index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" OR tag::eventtype=""communicate"" OR tag::eventtype=""network"") NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=dest ""(?<IP_add>d{1,3}.d{1,3}.d{1,3}.d{1,3}):(?<dest_port>d+)"" | rename dest_ip as clientip  | lookup ipdomain clientip  OUTPUT class | search NOT class=*  | rename clientip as IPAddress | search (IPAddress=111.90.139.247 OR IPAddress=84.200.16.242 OR IPAddress=95.141.115.108) | table  _time ,src_ip, IPAddress, dest_port",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimePetyaRansomwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to Petya Hosts "" Severity=""6"" src_ip=""$result.src_ip$"" dest_ip=$result.IPAddress$ dest_port=$result.dest_port$",petya_ransomware_detector,petya_ransomware_detector,petya_ransomware_detector,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution where'],['ESCU - DNS Query Requests Resolved by Unauthorized DNS Servers - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Resolution where DNS.dest_category != dns_server AND DNS.src_category != dns_server by DNS.src DNS.dest | `drop_dm_object_name(""DNS"")`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search will detect DNS requests resolved by unauthorized DNS servers. Legitimate DNS servers should be identified in the Enterprise Security Assets and Identity Framework.,,,,,,1,DNS Query Requests Resolved by Unauthorized DNS Servers,,network,medium,DNS requests resolved by unauthorized DNS servers,The table represents a list of unauthorized DNS servers interacting with hosts in your network,"dest, src",,,,,1,src,system,40,"dest,src",28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Exfiltration"", ""Command and Control"", ""Defense Evasion"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 1"", ""CIS 3"", ""CIS 8"", ""CIS 12""], ""nist"": [""ID.AM"", ""PR.DS"", ""PR.IP"", ""DE.AE"", ""DE.CM""]}",Clients should be resolving their DNS requests via a trusted DNS server. This search will identify DNS queries being sent to unauthorized DNS servers by comparing the destination and source of the traffic with assets marked as DNS servers.,To successfully implement this search you will need to ensure that DNS data is populating the Network_Resolution data model. It also requires that your DNS servers are identified correctly in the Assets and Identity table of Enterprise Security.,"Legitimate DNS activity can be detected in this search. Investigate, verify and update the list of authorized DNS servers as appropriate.",2017-07-08,2017-09-18,medium,ESCU - DNS Query Requests Resolved by Unauthorized DNS Servers - Rule,detection,Endpoint,"[""dest"", ""src""]","[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""DNS Hijacking"", ""Suspicious DNS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get DNS Server History for a hostn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Petya Ransomware Detector -Activity on Windows Hosts by Process'],MTLSOC_PetyaRansomwareDetector-default,,,,,,,,,,,,"index=*  source=""WinEventLog:Microsoft-Windows-Sysmon/Operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" )    (*\10807.exe) OR (*\5295.exe) OR (*\BCA9D6.exe) OR (*\mshta.exe) OR (*\myguy.exe) OR (*\myguy.xls) OR (*\Order-20062017.doc) OR (*\Quote-PO26062017A.msg)  | rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip CommandLine",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimePetyaRansomwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by Process"" Severity=""8""src_ip=""$result.ip$"" CommandLine=""$result.CommandLine$""",petya_ransomware_detector,petya_ransomware_detector,petya_ransomware_detector,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Petya Ransomware Detector - Petya Network Scan'],MTLSOC_PetyaRansomwareDetector-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"") (dest_port=445 OR dest_port=135 OR dest_port=1024 OR dest_port=1025 OR dest_port=1026 OR dest_port=1027 OR dest_port=1028 OR dest_port=1029 OR dest_port=1030 OR dest_port=1031 OR dest_port=1032 OR dest_port=1033 OR dest_port=1034 OR dest_port=1035)  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned >= 30 | dedup src_ip, HostsScanned | table src_ip, HostsScanned, _time",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimePetyaRansomwareDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Petya Network Scan"" Severity=""8"" src_ip=""$result.src_ip$"" HostsScanned=$result.HostsScanned$",petya_ransomware_detector,petya_ransomware_detector,petya_ransomware_detector,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Qualys Integration Framework Basic - Vulnarable Services Lookup'],MTLSOC_QualysIntegrationFrameworkBasic-default,,,,,,,,,,,,| inputlookup vulnerable_services.csv | search NOT [|  inputlookup vulnerable_services.csv | stats count by HostIP | table HostIP |   append  [ search index=*  eventtype=qualys_vm_detection_event VULN_TYPE=Vulnerability PORT=*  STATUS!=FIXED |rename  IP as HostIP| stats count by HostIP |table HostIP  ] | stats count by HostIP | where count=2 | table HostIP ] | append [search index=*  eventtype=qualys_vm_detection_event VULN_TYPE=Vulnerability PORT=*  STATUS!=FIXED |  rename  IP as HostIP DNS as Hostname QID as VulnQID PORT as VulnPort PROTOCOL as VulnProtocol vuln_category as VulnServiceName SEVERITY as VulnSeverity | table _time  HostIP Hostname VulnQID VulnPort VulnProtocol VulnServiceName VulnSeverity] | outputlookup vulnerable_services.csv,-1d,now,,1,number of events,greater than,0,0 0 * * *,,0,1,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeQualysIntegrationFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,1,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Connection to Vulnerable Service'],MTLSOC_QualysIntegrationFrameworkBasic-default,,,,,,,,,,,,"index=* (tag::eventtype=""communicate"" OR tag::eventtype=""network"")  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | join dest_ip dest_port [| inputlookup vulnerable_services.csv | rename HostIP as dest_ip VulnPort as dest_port]  | table _time dest_ip dest_port src_ip",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeQualysIntegrationFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to Vulnerable Service"" dest_ip=$result.dest_ip$ dest_port=$result.dest_port$ src_ip=$result.src_ip$",qifb,qifb,qifb,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Gateway Avoidance by Vulnerable Host'],MTLSOC_QualysIntegrationFrameworkBasic-default,,,,,,,,,,,,"index=* (tag::eventtype=""communicate"" OR tag::eventtype=""network"")  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | lookup ipdomain clientip as src_ip  OUTPUT class | where class=""internal"" | join src_ip [| inputlookup vulnerable_services.csv | dedup HostIP | rename HostIP as src_ip | table src_ip ] | lookup ipdomain clientip as dest_ip  OUTPUT class as class1 | search NOT   [|inputlookup ipdomain | rename class as class1| table class1] | table _time src_ip dest_port dest_ip",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeQualysIntegrationFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Gateway Avoidance by Vulnerable Host"" dest_ip=$result.dest_ip$ dest_port=$result.dest_port$ src_ip=$result.src_ip$",qifb,qifb,qifb,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Ransomware_Basic_rule'],MTLSOC_RansomwareBasic-default,,,,,,,,,,,,"index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" ) | rex mode=sed field=url ""s/http:////"" | rex mode=sed field=url  ""s/https:////"" | rex mode=sed field=url  ""s/:443//"" | rex mode=sed field=url  ""s//$//"" | rename url as URL | join URL [ | inputlookup ransomware.csv | rex mode=sed field=url ""s/http:////"" | rex mode=sed field=url  ""s/https:////"" | rex mode=sed field=url  ""s//$//"" | rename url as URL   | eval matching=""url""]  | append [ search index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" OR tag::eventtype=""communicate"" OR tag::eventtype=""network"") | join dest_ip [ |inputlookup ransomware.csv | search ip_address=* |rename ip_address as dest_ip ] | eval matching=""ip"" ] | append [ search index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"") | rex field=url ""((http://)?(?<domain>[a-zA-Z0-9-.]+)(:|/)?(d+)?.*)""  | join domain [ |inputlookup ransomware.csv | rename host as domain ] | eval matching=""domain"" ] | eval priority = case(threat == ""C2"" AND ( matching == ""domain"" OR matching == ""ip"" ), ""3"",threat == ""C2"" AND matching == ""url"", ""9"", threat == ""Distribution Site"" AND (matching == ""ip"" OR matching == ""domain""), ""3"", threat == ""Distribution Site"" AND matching == ""url"", ""7"", threat == ""Payment Site"" and ( matching == ""domain"" OR matching == ""ip"" ), ""4"", threat == ""Payment Site"" and  matching == ""url"", ""9"" ) | eval event_name = case( action == ""allowed"" AND threat == ""C2"" AND ( matching == ""domain"" OR matching == ""ip"" ), ""Ransomware - Successful Connection to C2 IP or Domain"", action == ""allowed"" AND threat == ""C2"" AND matching == ""url"", ""Ransomware - Successful Connection to C2 URL"", action == ""allowed"" AND threat == ""Distribution Site"" AND (matching == ""ip"" OR matching == ""domain""), ""Ransomware - Successful Connection to Distribution IP or Domain"", action == ""allowed"" AND threat == ""Distribution Site"" AND matching == ""url"", ""Ransomware - Successful Connection to Distribution URL"", action == ""allowed"" AND threat == ""Payment Site"" and ( matching == ""domain"" OR matching == ""ip"" ), ""Ransomware - Successful Connection to Payment IP or Domain"", action == ""allowed"" AND threat == ""Payment Site"" and  matching == ""url"", ""Ransomware - Successful Connection to Payment URL"", ( action == ""blocked"" OR action == ""dropped"" ) AND threat == ""C2"" AND matching == ""url"", ""Ransomware - Unsuccessful Connection to C2 URL"", ( action == ""blocked"" OR action == ""dropped"" ) AND threat == ""Payment Site"" and  matching == ""url"", ""Ransomware - Unsuccessful Connection to Payment URL"") | eval kilchain= case( event_name == ""Ransomware - Successful Connection to C2 IP or Domain"", ""C2"", event_name == ""Ransomware - Successful Connection to C2 URL"", ""C2"", event_name == ""Ransomware - Successful Connection to Distribution IP or Domain"", ""Delivery"", event_name == ""Ransomware - Successful Connection to Distribution URL"", ""Delivery"",  event_name == ""Ransomware - Successful Connection to Payment IP or Domain"", ""Payment Site"", event_name == ""Ransomware - Successful Connection to Payment URL"", ""Actions on Objective"", event_name == ""Ransomware - Unsuccessful Connection to C2 URL"", ""C2"", event_name == ""Ransomware - Unsuccessful Connection to Payment URL"", ""Actions on Objective"") | where status=""online"" | eval human_readable_time=strftime(_time, ""%Y-%d-%m %H:%M:%S"")",-6m@m,-1m@m,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,MTLSOCRansomwareBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result.human_readable_time$ , app=$result.app$, Source=$result.source$, Sourcetype=$result.sourcetype$, malware=$result.malware$, bytes=$result.bytes$, matching=$result.matching$, priority=$result.priority$, registrar=$result.registrar$, src_ip=$result.src_ip$, status=$result.status$, dest_ip=$result.dest_ip$, dest_port=$result.dest_port$, event_name=$result.event_name$, killchain=$result.kilchain$, threat=$result.threat$, URL=$result.URL$ , domain=$result.domain$, RAW='$result._raw$'",ransomware_basic,ransomware_basic,ransomware_basic,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Certificate Expired'],MTLSOC_SSLFramework-default,,,,,,,,,,,,"index=ssl_framework product=""SSL Framework"" | stats count dc(src) as ""HostCount"" by domainName,certIssuer,validUntil | eval left=round((((strptime(validUntil,""%b %d %Y %H:%M:%S""))-time())/86400), 0) | where left=0 | table domainName ""HostCount"" certIssuer validUntil left | table domainName HostCount certIssuer validUntil left email | rename domainName as ""Domain"", certIssuer as ""Issuer"", validUntil as ""Valid Until"", left as ""Days left"", HostCount as ""Host Count""",-2d,now,,1,number of events,greater than,0,00 9 * * *,0,0,1,1,"Certificate for $result.Domain$ has expired (was valid until $result.Valid Until$)!Please contact ""$result.Issuer$"" to renew certificate.View Full Report on ssllabs.com: https://www.ssllabs.com/ssltest/analyze.html?d=$result.Domain$&hideResults=onImpressive? Want some more? https://socprime.com",1,"Additional information on SSL Framework dashboard in ""Expired or Revoked Certificates"" panel",,statistics,statistics,,,,,1,,,,,,,,,,,,,,,,,MTLSOCSSLFramework,,,,,,,,0,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,youremail@yourdomain.com,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,1,,,,,,,1,Certificate Expired,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Certificate Revoked'],MTLSOC_SSLFramework-default,,,,,,,,,,,,"index=ssl_framework product=""SSL Framework"" | where revocStatus==""Bad (revoked)"" OR revocStatus=""Bad (no revocation information)"" | stats count dc(src) as ""HostCount"" by domainName,certIssuer,validUntil,revocStatus | table domainName HostCount revocStatus certIssuer validUntil | table domainName HostCount revocStatus  certIssuer validUntil | rename domainName as ""Domain"", certIssuer as ""Issuer"", validUntil as ""Valid Until"", HostCount as ""Host Count"", revocStatus as Status",-2d,now,,1,number of events,greater than,0,00 9 * * *,0,0,1,1,"Certificate for $result.Domain$ has been revoked (Status = $result.Status$)!Please contact ""$result.Issuer$"" to renew certificate.View Full Report on ssllabs.com: https://www.ssllabs.com/ssltest/analyze.html?d=$result.Domain$&hideResults=onImpressive? Want some more? https://socprime.com",1,"Additional information on SSL Framework dashboard in ""Expired or Revoked Certificates"" panel",,statistics,statistics,,,,,1,,,,,,,,,,,,,,,,,MTLSOCSSLFramework,,,,,,,,0,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,youremail@yourdomain.com,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,4,,,,,,,1,Certificate Revoked!,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution where'],['ESCU - DNS record changed - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| inputlookup discovered_dns_records.csv | rename answer as discovered_answer | join domain[|tstats summariesonly=true count values(DNS.record_type) as type, values(DNS.answer) as current_answer values(DNS.src) as src from datamodel=Network_Resolution where DNS.message_type=RESPONSE DNS.answer!=""unknown"" DNS.answer!="""" by DNS.query | rename DNS.query as query | where query!=""unknown"" | rex field=query ""(?<domain>w+.w+?)(?:$|/)""] | makemv delim="" "" answer |  makemv delim="" "" type | sort -count | table count,src,domain,type,query,current_answer,discovered_answer | makemv current_answer  | mvexpand current_answer | makemv discovered_answer | eval n=mvfind(discovered_answer, current_answer) | where isnull(n)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The search takes the DNS records and their answers results of the discovered_dns_records lookup and finds if any records have changed by searching DNS response from the Network_Resolution datamodel across the last day.,,,,,,1,DNS record changed,,network,medium,DNS record changed,The table represents a list of DNS records and their responses for corporate domains that have recently changed,src,,,,,1,src,system,40,src,28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Exfiltration"", ""Command and Control"", ""Defense Evasion"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 1"", ""CIS 3"", ""CIS 8"", ""CIS 12""], ""nist"": [""ID.AM"", ""PR.DS"", ""PR.IP"", ""DE.AE"", ""DE.CM""]}","Using a lookup `discover_dns_records` generated by support search ""Discover DNS records"" we check previous network traffic and make sure the responses have not changed.","To successfully implement this search you will need to ensure that DNS data is populating the `Network_Resolution` data model. It also requires that the `discover_dns_record` lookup table be populated by the included support search ""Discover DNS record"".  **Splunk>Phantom Playbook Integration**If Splunk>Phantom is also configured in your environment, a Playbook called ""DNS Hijack Investigation"" can be configured to run when any results are found by this detection search. The playbook takes in the DNS record changed and uses Geoip, whois, Censys and PassiveTotal to detect if DNS issuers changed. To use this integration, install the Phantom App for Splunk `https://splunkbase.splunk.com/app/3411/`, add the correct hostname to the ""Phantom Instance"" field in the Adaptive Response Actions when configuring this detection search, and set the corresponding Playbook to active. (Playbook Link:`https://my.phantom.us/4.1/playbook/dns-hijack-investigation/`).","Legitimate DNS changes can be detected in this search. Investigate, verify and update the list of provided current answers for the domains in question as appropriate.",2019-02-14,2019-02-14,medium,ESCU - DNS record changed - Rule,detection,Endpoint,"[""src"", ""dest""]","[""Splunk Stream"", ""Bro""]","[""DNS Hijacking""]","runphantomplaybook, escu_investigate","{""version"": 1, ""data"": ""Recommended following                         steps:nn1. [[action|runphantomplaybook]]: Phantom playbook                         recommendations:nSplunk>Phantom Response Playbook - Monitor enrichment of the                         Splunk>Phantom Playbook called DNS Hijack enrichment and answer any                         analyst prompt in Mission Control with a response decision.                         Link to the playbook https://my.phantom.us/4.2/playbook/dns-hijack-enrichment/n2. [[action|escu_investigate]]:                         Based on ESCU investigate recommendations:nESCU - Get DNS Server History for a hostn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Overall Rating Changed'],MTLSOC_SSLFramework-default,,,,,,,,,,,,"index=ssl_framework product=""SSL Framework"" | transaction maxevents=2 fields domainName,src | eval ""Previous Scan Date""=mvindex(devTime,0) | eval ""Last Scan Date""=mvindex(devTime,1) | eval rating_0=mvindex(rating,0) | eval rating_1=mvindex(rating,1) | where rating_0!=rating_1 | table domainName src ""Previous Scan Date"" rating_0 ""Last Scan Date"" rating_1 | table domainName src ""Previous Scan Date"" rating_0 ""Last Scan Date"" rating_1 | rename domainName as ""Domain"" src as ""IP Address"" rating_0 as ""Previous Rating"" rating_1 as ""Current Rating""",-2d,now,,1,number of events,greater than,0,00 9 * * *,0,0,1,1,Overall Rating for $result.Domain$ ($result.IP Address$) has changed from $result.Previous Rating$ to $result.Current Rating$.Please review Full Report on SSL Labs: https://www.ssllabs.com/ssltest/analyze.html?d=$result.Domain$&hideResults=on&latestImpressive? Want some more? https://socprime.com,1,"Additional information on SSL Framework dashboard in ""Overall Rating Changed"" panel",,statistics,statistics,,,,,1,,,,,,,,,,,,,,,,,MTLSOCSLFramework,,,,,,,,0,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,Overall Rating of Host Changed!,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Soon to Expire Certificates'],MTLSOC_SSLFramework-default,,,,,,,,,,,,"index=ssl_framework product=""SSL Framework"" | stats count dc(src) as ""HostCount"" by domainName certIssuer validUntil | eval left=round((((strptime(validUntil,""%b %d %Y %H:%M:%S""))-time())/86400), 0) | where left=30 OR left=7 OR left=60 OR left=1 | table domainName ""HostCount"" certIssuer validUntil left | table domainName HostCount certIssuer validUntil left | rename domainName as ""Domain"", certIssuer as ""Issuer"", validUntil as ""Valid Until"", left as ""Days left"", HostCount as ""Host Count""",-2d,now,,1,number of events,greater than,0,00 9 * * *,0,0,1,1,"Certificate for $result.Domain$ expires in $result.Days left$ days ($result.Valid Until$).Please contact ""$result.Issuer$"" to renew certificate.View Full Report on ssllabs.com: https://www.ssllabs.com/ssltest/analyze.html?d=$result.Domain$&hideResults=onImpressive? Want some more? https://socprime.com",1,Additional information on SSL Framework dashboard,,statistics,statistics,,,,,1,,,,,,,,,,,,,,,,,MTLSOCSSLFramework,,,,,,,,0,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,youremail@yourdomain.com,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,1,,,,,,,1,Certificate Expires in $result.Days left$ days,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Web Server was not scanned for 2 days'],MTLSOC_SSLFramework-default,,,,,,,,,,,,"index=ssl_framework product=""SSL Framework"" earliest=-3d@d  latest=-2d@d [search index=ssl_framework product=""SSL Framework"" earliest=-3d@d  latest=-2d@d| dedup  domainName, src | table domainName, src | append [ search index=ssl_framework product=""SSL Framework"" earliest=-2d@d  latest=now | dedup  domainName, src | table domainName, src] | stats dc(src) AS COUNT by domainName | where COUNT>0 | fields- COUNT] | dedup domainName, src | table domainName, src, devTime | rename domainName AS ""Domain Name"", src AS ""IP Address"", devTime AS ""Last Seen""",-2d,now,,1,number of events,greater than,0,00 9 * * *,0,0,1,1,Web Server was not scanned by Qualys SSL Labs for 2 days!Domain Name: $result.Domain Name$IP Address: $result.IP Address$Last Seen: $result.Last Seen$Impressive? Want some more? https://socprime.com,1,,,statistics,statistics,,,,,1,,,,,,,,,,,,,,,,,MTLSOCSSLFramework,,,,,,,,0,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,youremail@yourdomain.com,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,1,,,,,,,1,Web Server $result.Domain Name$ ($result.IP Address$) was not scanned for 2 days!,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['New Domain or IP Address'],MTLSOC_SSLFramework-default,,,,,,,,,,,,"index=ssl_framework product=""SSL Framework"" earliest=-1d@d  latest=now [search index=ssl_framework product=""SSL Framework"" earliest=-1d@d  latest=now| dedup  domainName, src | table domainName, src | append [ search index=ssl_framework product=""SSL Framework"" earliest=-2d@d  latest=-1d@d | dedup  domainName, src | table domainName, src] | stats dc(src) AS COUNT by domainName | where COUNT=1 | fields- COUNT] | dedup domainName, src | table domainName, validFrom, validUntil, certIssuer, rating, trustStatus, revocStatus, altNames, src, serverHost vulnerabilitiesDomain, fullReportUrl | rename domainName AS ""Domain Name"", validFrom AS ""Valid from"", validUntil AS ""Valid until"", certIssuer AS Issuer, rating AS ""Overall Rating"", trustStatus AS Trusted, revocStatus AS ""Revocation Status"", altNames AS ""Alternative Names"", src AS ""IP Address"", serverHost AS ""Host Name"", vulnerabilitiesDomain AS  Vulnerabilities, fullReportUrl AS ""Qualys SSL Labs Full Report""",-2d,now,,1,number of events,greater than,0,00 9 * * *,0,0,1,1,New Domain added to SSL Framework or new IP Address in Domain.Domain Name: $result.Domain Name$Valid from: $result.Valid from$Valid until: $result.Valid until$Issuer: $result.Issuer$Overall Rating (by Qualys SSL Labs): $result.Overall Rating$Trusted: $result.Trusted$Revocation Status: $result.Revocation Status$Alternative Names: $result.Alternative Names$IP Address: $result.IP Address$Host Name: $result.Host Name$Vulnerabilities: $result.Vulnerabilities$Qualys SSL Labs Full Report: $result.Qualys SSL Labs Full Report$Impressive? Want some more? https://socprime.com,1,New Domain added to SSL Framework or new IP Address in Domain.,,statistics,statistics,,,,,1,,,,,,,,,,,,,,,,,MTLSOCSSLFramework,,,,,,,,0,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,youremail@yourdomain.com,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,1,,,,,,,1,New Domain or IP Address. $result.Domain Name$ ($result.IP Address$),,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SYSMON Integration Framework - 10 files or more creation per 1 min alert'],MTLSOC_SYSMONIntegrationFrameworkBasic-default,,,,,,,,,,,,"index=*  sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational"" EventDescription=""File Create Time"" | streamstats time_window=1m count(EventDescription) AS ""new_files"" by Computer | search new_files>10 | fields + Image Computer | bin _time span=1m | stats count by _time Image Computer",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeSYSMONIntegrationFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Huge count of new files"" Image=$result.Image$ Computer=$result.Computer$ Count=$result.count$",sif,sif,sif,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SYSMON Integration Framework - Long commands detection'],MTLSOC_SYSMONIntegrationFrameworkBasic-default,,,,,,,,,,,,"index =* sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational"" EventCode=1 (Image=""*cmd.exe"" OR Image=""*powershell.exe"") | eval   c_length=len(CommandLine) | where c_length>500 | table _time, Computer, User, Image, CommandLine, ParentImage, ParentCommandLine c_length",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,Detect long  commands that most probably will include obfuscated malicious code by length of command,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeSYSMONIntegrationFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Long commands running""   Image=""$result.Image$""  CommandLine=""$result.CommandLine$"" ParentImage=""$result.ParentImage$"" ParentCommandLine=""$result.ParentCommandLine$"" c_length=$result.c_length$ Computer=""$result.Computer$""",sif,sif,sif,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SYSMON Ingegration Farmework - Suspicious child process running'],MTLSOC_SYSMONIntegrationFrameworkBasic-default,,,,,,,,,,,,"index=* source=""WinEventLog:Microsoft-Windows-Sysmon/Operational""  EventCode=1  ( ParentImage=""*winword.exe"" OR ParentImage=""*outlook.exe"" OR ParentImage=""*excel.exe"" OR ParentImage=""*powerpnt.exe"" OR ParentImage=""*iexplore.exe"" OR ParentImage=""*firefox.exe"" OR ParentImage=""*chrome.exe"") AND (Image=""*powershell.exe"" OR Image=""*cmd.exe"" OR Image=""*cscript.exe"" OR Image=""*wscript.exe"" OR Image=""*rundll32.exe"") | table _time ParentImage Image CommandLine Computer",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeSYSMONIntegrationFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Suspicious child process running""   Image=""$result.Image$"" CommandLine=""$result.CommandLine$"" ParentImage=""$result.ParentImage$"" Computer=""$result.Computer$""",sif,sif,sif,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SYSMON Integration Framework - Non- browsers executables direct connections to Internet'],MTLSOC_SYSMONIntegrationFrameworkBasic-default,,,,,,,,,,,,"index=* source=""WinEventLog:Microsoft-Windows-Sysmon/Operational""  EventCode=3  (Image!=""*firefox.exe"" OR Image!=""*iexplore.exe"" OR Image!=""chrome.exe"") | lookup ipdomain clientip as DestinationIp OUTPUT class | fillnull class | where class=0 |  table _time Image Computer SourceIp DestinationIp action",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeSYSMONIntegrationFrameworkBasic,,,,,,,,,,,,,,,,,,,,,,,,,,line,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Non- browsers executables direct connections to Internet""   Image=""$result.Image$""  SourceIp=""$result.SourceIp$""  DestinationIp=""$result.DestinationIp$"" action=$result.action$ Computer=$result.Computer$",sif,sif,sif,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Connection to WannaCry Distribution IP'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" OR tag::eventtype=""communicate"" OR tag::eventtype=""network"") NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=dest ""(?<IP_add>d{1,3}.d{1,3}.d{1,3}.d{1,3}):(?<dest_port>d+)"" | rename dest_ip as clientip  | lookup ipdomain clientip  OUTPUT class | search NOT class=*  | rename clientip as IPAddress | join IPAddress [| inputlookup wanna_cry_distribution_ip.csv ] | table  _time,src_ip, IPAddress, dest_port",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to WannaCry Distribution IP"" Severity=""8"" src_ip=""$result.src_ip$""  dest_ip=$result.IPAddress$, dest_port=""$result.dest_port$""",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Connection to WannaCry IP_only ip'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=* (tag::eventtype=""web"" OR tag::eventtype=""proxy"" OR tag::eventtype=""communicate"" OR tag::eventtype=""network"") NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=dest ""(?<IP_add>d{1,3}.d{1,3}.d{1,3}.d{1,3}):(?<dest_port>d+)"" | rename dest_ip as clientip  | lookup ipdomain clientip  OUTPUT class | search NOT class=*  | rename clientip as IPAddress | join IPAddress  [|inputlookup wanna_cry_ip.csv ] | table src_ip, IPAddress, dest_port",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to WannaCry IP"" Severity=""6"" src_ip=""$result.src_ip$""  dest_ip=$result.IPAddress$, dest_port=""$result.dest_port$""",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Deleting Shadow Copies - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where (Processes.process_name=vssadmin.exe OR Processes.process_name=wmic.exe)  by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` | search process=*delete* AND process=*shadow*,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,The vssadmin.exe utility is used to interact with the Volume Shadow Copy Service.  Wmic is an interface to the Windows Management Instrumentation.  This search looks for either of these tools being used to delete shadow copies.,,,,,,1,Deleting Shadow Copies,,endpoint,medium,Deleting Shadow Copies on $dest$ with $process_name$,Using $process_name$ to delete shadow copies is common behavior by ransomware. This activity was observed on $dest$,"dest, user, process_name",,,,,1,dest,system,75,"dest, user",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8"", ""CIS 10""], ""nist"": [""PR.PT"", ""DE.CM"", ""PR.IP""]}","This search looks for execution of vssadmin or wmic with both the ""delete"" and ""shadows"" parameters passed on the command-line. The two arguments are searched for separately because we can't predict the number of spaces between the words on the command-line. The search will return the number of times this activity was observed, and the times of the first and last event.","You must be ingesting endpoint data that tracks process activity, including parent-child relationships from your endpoints to populate the Endpoint data model in the Processes node. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","vssadmin.exe and wmic.exe are standard applications shipped with modern versions of windows. They may be used by administrators to legitimately delete old backup copies, although this is typically rare.",2017-02-17,2018-12-03,medium,ESCU - Deleting Shadow Copies - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Ransomware"", ""SamSam Ransomware"", ""Windows Log Manipulation""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Network Scan on 445 137-139 Port (by WannaCry)'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"") (dest_port=445 OR dest_port=137 OR dest_port=138 OR dest_port=139 OR dest_port=3389)  NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned >= 30 | dedup src_ip, HostsScanned | table src_ip, HostsScanned, _time",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Network Scan on 445 137-139 Port"" Severity=""8"" src_ip=""$result.src_ip$"" HostsScanned=$result.HostsScanned$",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Activity on Windows Hosts by File Names (Sysmon)'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=*  sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) |rename process as FileName |  join FileName [| inputlookup wanna_cry_hashes.csv | table FileName ] | search FileName!=cmd.exe |  rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip FileName",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by File Names"" Severity=""8""src_ip=""$result.ip$"" FileName=$result.FileName$",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Activity on Windows Hosts by File Hashes (Sysmon)'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=*  sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) | rex field=Hashes mode=sed ""s/SHA256=//g"" | rex field=Hashes mode=sed ""s/SHA1=//g"" | rex field=Hashes mode=sed ""s/MD5=//g""| join Hashes [| inputlookup wanna_cry_hashes.csv | table HashMD5 | rename HashMD5 as Hashes] | rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip Hashes",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by File Hashes"" Severity=""8""src_ip=""$result.ip$"" Hashes=$result.Hashes$",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Activity on Windows Hosts by Process (Sysmon)'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=*  sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational""  (EventDescription=""Process Create"" OR EventDescription=""File Create"" ) tasksche.exe OR mssecsvc.exe OR taskdl.exe OR WanaDecryptor OR taskhsvc.exe OR taskse.exe OR    (DISABLED vdsldr.exe OR wbengine.exe) OR     ""@Please_Read_Me@.txt"" OR ""@WanaDecryptor@.exe"" OR     "".WNCRYT"" OR "".WNCRY"" OR "".wnry"" OR "".wcry"" OR     (wbadmin delete catalog) OR     (vssadmin delete shadows all quiet) OR     (cscript.exe nologo m.vbs) OR     (icacls grant ""Everyone:F /T /C /Q"") OR (icacls . /grant Everyone:F /T /C /Q) OR (C:mssecsvc.exe) OR (C:WINDOWStasksche.exe /i) OR (C:mssecsvc.exe -m security) OR (cmd.exe /c 'C:ProgramDatahelgycvyviihxp363tasksche.exe') OR (C:ProgramDatahelgycvyviihxp363tasksche.exe) OR (attrib +h .) OR (icacls . /grant Everyone:F /T /C /Q) OR taskdl.exe OR (C:Windowssystem32cmd.exe /c 297451494605691.bat) OR (cscript.exe //nologo m.vbs) OR (@WanaDecryptor@.exe co) OR (TaskDataTortaskhsvc.exe) OR (cmd.exe /c start /b @WanaDecryptor@.exe vs) OR (@WanaDecryptor@.exe vs) OR (cmd.exe /c vssadmin delete shadows /all /quiet & wmic shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no & wbadmin delete catalog -quiet) OR (vssadmin delete shadows /all /quiet) OR (wmic shadowcopy delete) OR (bcdedit /set {default} bootstatuspolicy ignoreallfailures) OR (bcdedit /set {default} recoveryenabled no) OR (wbadmin delete catalog -quiet) OR taskdl.exe OR (taskse.exe C:ProgramDatahelgycvyviihxp363@WanaDecryptor@.exe) OR (C:ProgramDatahelgycvyviihxp363@WanaDecryptor@.exe) OR (cmd.exe /c reg add HKLMSOFTWAREMicrosoftWindowsCurrentVersionRun /v 'helgycvyviihxp363' /t REG_SZ /d ''C:ProgramDatahelgycvyviihxp363tasksche.exe'' /f) OR (reg add HKLMSOFTWAREMicrosoftWindowsCurrentVersionRun /v 'helgycvyviihxp363' /t REG_SZ /d ''C:ProgramDatahelgycvyviihxp363tasksche.exe'' /f) OR taskdl.exe OR (taskse.exe C:ProgramDatahelgycvyviihxp363@WanaDecryptor@.exe) OR (C:ProgramDatahelgycvyviihxp363@WanaDecryptor@.exe) OR (C:Windowssystem32wbengine.exe) | rename Computer as host | lookup dnsLookup host  OUTPUT ip | table _time ip CommandLine",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Activity on Windows Hosts by Process"" Severity=""8""src_ip=""$result.ip$"" CommandLine=""$result.CommandLine$""",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Connection to TORPROJECT.ORG'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=* tag=proxy url=*torproject.org* NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=url ""((?:http(?:s)?://)?(?<domain>[w-.]+)(?::|/)?(?: d+)?[^$]*)"" | table _time src_ip domain",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to TORPROJECT.ORG"" Severity=""7"" src_ip=""$result.src_ip$""  domain=$result.domain$",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Connections to External Multiple Hosts (by WannaCry)'],MTLSOC_WannaCryRansomwareWormDetector-default,,,1,,,,,,,,,"index=* ( tag::eventtype=""communicate"" OR tag::eventtype=""network"")   NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rename dest_ip as clientip  | lookup ipdomain clientip  OUTPUT class | search NOT class=*  | rename clientip as dest_ip | bucket _time span=60 | eventstats dc(dest_ip) AS HostsScanned by src_ip, _time |  where HostsScanned >= 14 | dedup src_ip, HostsScanned | table src_ip, HostsScanned, _time",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connections to External Multiple Hosts (by WannaCry)"" Severity=""5"" src_ip=""$result.src_ip$"" HostsScanned=$result.HostsScanned$",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WannaCry Ransomware Worm Detector - Connection to WannaCry hosts'],MTLSOC_WannaCryRansomwareWormDetector-default,,,,,,,,,,,,"index=* tag=proxy NOT ([|inputlookup exclude.csv| rename ip as src_ip |  fields src_ip ] OR [|inputlookup exclude.csv| rename ip as dest_ip |  fields dest_ip ]) | rex field=url ""((?:http(?:s)?://)?(?<domain>[w-.]+)(?::|/)?(?: d+)?[^$]*)"" |join domain [|inputlookup wanna_cry_hosts.csv | rename HostName as domain]| table _time src_ip domain",-5m,now,,1,number of events,greater than,0,*/5 * * * *,0,0,0,,,1,,,statistics,statistics,,,,,,,,,,,,,,,,,,,,,,SOCPrimeWannaCryRansomwareWormDetector,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,"$result._time$ Name=""Connection to WannaCry hosts"" Severity=""8"" src_ip=""$result.src_ip$""  domain=$result.domain$",wannacry,wannacry,wannacry,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Authentication Failures By Source - Context Gen'],SA-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as failures from datamodel=Authentication.Authentication where Authentication.action=""failure"" by Authentication.src,_time span=1h | stats median(failures) as median, min(failures) as min, count as count | eval max = median*2 | xsUpdateDDContext app=""SA-AccessProtection"" name=failures_by_src_count_1h container=authentication scope=app | stats count",-25h@h,-1h@h,,1,,,,0 3 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Authentication Failures By Source Per Day - Context Gen'],SA-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as failures from datamodel=Authentication.Authentication where Authentication.action=""failure"" by Authentication.src,_time span=1d | stats median(failures) as median, min(failures) as min, count as count | eval max = median*2 | xsCreateDDContext app=""SA-AccessProtection"" name=failures_by_src_count_1d container=authentication scope=app type=domain terms=`xs_default_magnitude_concepts` | stats count",-31d@d,-1d@d,,1,,,,0 5 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Authentication Volume Per Day - Context Gen'],SA-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count as count_1d from datamodel=Authentication.Authentication by _time span=1d | stats count, median(count_1d) as median, stdev(count_1d) as size | search size>0 | xsCreateDDContext name=count_1d container=authentication type=median_centered scope=app app=SA-AccessProtection terms=`xs_default_magnitude_concepts` | stats count",-61d@d,-1d@d,,1,,,,0 4 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect API activity from users without MFA - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail userIdentity.sessionContext.attributes.mfaAuthenticated=false | search NOT [| inputlookup aws_service_accounts | fields identity | rename identity as user]| stats  count min(_time) as firstTime max(_time) as lastTime values(eventName) by userIdentity.arn userIdentity.type user | `ctime(firstTime)`  | `ctime(lastTime)`,-1d@d,-10m@m,,1,number of events,greater than,0,0 8 * * *,1,1,,,,,"This search looks for CloudTrail events where a user logged into the AWS account, is making API calls and has not enabled Multi Factor authentication. Multi factor authentication adds a layer of security by forcing the users to type a unique authentication code from an approved authentication device when they access AWS websites or services. AWS Best Practices recommend that you enable MFA for privileged IAM users.",,,,,,1,Detect API activity from users without MFA,,network,medium,API Activity detected from $user$ without MFA enabled,API Activity detected from $user$ without MFA enabled.,user,,,,,1,user,user,30,user,84600s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""cis20"": [""CIS 16""], ""nist"": [""DE.DP"", ""PR.AC""]}","In this search, we query CloudTrail logs and specifically look for events where the multi factor authentication context of the user's session is false which basically means, that the user does not have MFA enabled on AWS. We then filter out all the known AWS service accounts since service accounts typically do not have MFA enabled. The search then creates a table of the first and last time a user without MFA was detected, the values and count of the API calls made, the type of user identity, ARN and the name of the user.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. Leverage the support search `Create a list of approved AWS service accounts`: run it once every 30 days to create a list of service accounts and validate them.","Many service accounts configured within an AWS infrastructure do not have multi factor authentication enabled. Please ignore the service accounts, if triggered and instead add them to the aws_service_accounts.csv file to fine tune the detection. It is also possible that the search detects users in your environment using Single Sign-On systems, since the MFA is not handled by AWS.",2018-05-17,2018-05-17,medium,ESCU - Detect API activity from users without MFA - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS User Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Investigate AWS User Activities by user fieldn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Change"".""Account_Management']",['Access - Account Deleted - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from datamodel:""Change"".""Account_Management"" | where 'tag'=""delete"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(result) as ""signature"",values(src) as ""src"",values(dest) as ""dest"",count by ""src_user"",""user"" | where 'count'>0",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,0,,,,Detects user and computer account deletion,,,,,0,1,Account Deleted,0,access,medium,Account Deleted,User ($src_user$) deleted account ($user$) on system ($dest$),user,View all account deletions by user ($src_user$),"| from datamodel:""Change"".""Account_Management"" | where 'tag'=""delete"" AND 'src_user'=""$src_user$""",,,1,user,user,60,user,86300s,false,SplunkEnterpriseSecuritySuite,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":	  ""Change"",         ""object"":		  ""Account_Management"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""eventFilter"":   ""'All_Changes.tag'=""delete"""",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                           {""function"": ""values"", ""attribute"": ""All_Changes.result"", ""alias"": ""signature""},                           {""function"": ""values"", ""attribute"": ""All_Changes.src"", ""alias"": ""src""},                           {""function"": ""values"", ""attribute"": ""All_Changes.dest"", ""alias"": ""dest""},                           {""function"": ""count""}                          ],         ""splitby"":       [{""attribute"": ""All_Changes.Account_Management.src_user"", ""alias"": ""src_user""},                           {""attribute"": ""All_Changes.user"", ""alias"": ""user""}                          ],         ""resultFilter"":  {""field"": ""count"", ""comparator"": "">"", ""value"": ""0""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""user""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Authentication"".""Authentication']",['Access - Brute Force Access Behavior Detected - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from datamodel:""Authentication"".""Authentication"" | stats values(tag) as tag,values(app) as app,count(eval('action'==""failure"")) as failure,count(eval('action'==""success"")) as success by src | search success>0 | xswhere failure from failures_by_src_count_1h in authentication is above medium",rt-65m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects excessive number of failed login attempts along with a successful attempt (this could indicate a successful brute force attack),,,,,0,1,Brute Force Access Behavior Detected,0,access,high,Brute Force Access Behavior Detected From $src$,The system $src$ has failed authentication $failure$ times and successfully authenticated $success$ times in the last hour,src,View all login attempts by system $src$,"| from datamodel:""Authentication"".""Authentication"" | search src=""$src$""",,,1,src,system,80,src,86300s,false,,,1,notable,1,"[""Access - Authentication Failures By Source - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Brute Force Access Behavior Detected Over 1d - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` values(Authentication.app) as app,count from datamodel=Authentication.Authentication by Authentication.action,Authentication.src | `drop_dm_object_name(""Authentication"")` | eval success=if(action=""success"",count,0),failure=if(action=""failure"",count,0) | stats values(app) as app,sum(failure) as failure,sum(success) as success by src | where success > 0 | xswhere failure from failures_by_src_count_1d in authentication is above medium",-25h@h,-1h@h,,1,number of events,greater than,0,0 1 * * *,1,1,false,,,,"Detects an excessive number of failed login attempts, along with a successful attempt, over a one day period (this could indicate a successful brute force attack)",,,,,0,1,Brute Force Access Behavior Detected Over One Day,0,access,high,Brute Force Access Behavior Detected Over 1d From $src$,The system $src$ has failed authentication $failure$ times and successfully authenticated $success$ times in the last day.,src,View all login attempts by system $src$,"| from datamodel:""Authentication"".""Authentication"" | search src=""$src$""",,,1,src,system,80,src,86300s,false,,20,1,notable,1,"[""Access - Authentication Failures By Source Per Day - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Compute_Inventory"".""Cleartext_Passwords']",['Access - Cleartext Password At Rest - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from datamodel:""Compute_Inventory"".""Cleartext_Passwords"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(tag) as ""tag"",count by ""dest"",""user"",""password""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects cleartext passwords being stored at rest (such as in the Unix passwd file),,,,,0,1,Cleartext Password At Rest Detected,0,access,high,Cleartext Password At Rest Detected,The system $dest$ is storing the password for user $user$ in the clear,"dest,user,password",View cleartext passwords for user $user$ on device $dest$,"| from datamodel:""Compute_Inventory"".""Cleartext_Passwords"" | search dest=""$dest$"" user=""$user$"" password=""$password$""",,,1,dest,system,80,"dest,user,password",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Compute_Inventory"",         ""object"":        ""Cleartext_Passwords"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                           {""function"": ""values"", ""attribute"": ""All_Inventory.tag"", ""alias"": ""tag""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""All_Inventory.dest"", ""alias"": ""dest""},                           {""attribute"": ""All_Inventory.User.user"", ""alias"": ""user""},                           {""attribute"": ""All_Inventory.User.password"", ""alias"": ""password""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest"",""user"",""password""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - Completely Inactive Account - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from inputlookup:access_tracker | stats min(firstTime) as firstTime,max(lastTime) as lastTime by user | where ((now()-'lastTime')/86400)>90",0,+0s,,1,number of events,greater than,0,55 * * * *,1,1,false,,,,Discovers accounts that are no longer used. Unused accounts should be disabled and are oftentimes used by attackers to gain unauthorized access.,,,,,0,1,Completely Inactive Account,0,access,informational,Completely Inactive Account For $user$,User account $user$ has not successfully authenticated in 90 days.  Please verify this account is still needed.,user,View inactive $user$ accounts,"| `inactive_accounts(90)` | `uitime(firstTime)` | `uitime(second2lastTime)` | `uitime(lastTime)` | search user=""$user$""",,,1,user,user,20,user,86300s,false,,5,1,notable,,"[""Access - Authentication Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Authentication"".""Successful_Default_Authentication']",['Access - Default Account Usage - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from datamodel:""Authentication"".""Successful_Default_Authentication"" | stats max(_time) as ""lastTime"",values(tag) as ""tag"",count by ""dest"",""user"",""app""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,"Discovers use of default accounts (such as admin, administrator, etc.). Default accounts have default passwords and are therefore commonly targeted by attackers using brute force attack tools.",,,,,0,1,Default Account Activity Detected,0,access,low,Default Account Activity Detected,User account $user$ is a default account that successfully authenticated to $dest$ at $lastTime$.  Please verify this activity conforms with your information security policy.,"user,dest",View usage of default account $user$ on device $dest$,"| from datamodel:""Authentication"".""Successful_Default_Authentication"" | search dest=""$dest$"" user=""$user$""",,,1,dest,system,40,"user,dest,app",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Authentication"",         ""object"":        ""Successful_Default_Authentication"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""values"", ""attribute"": ""Authentication.tag"", ""alias"": ""tag""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""Authentication.dest"", ""alias"": ""dest""},                           {""attribute"": ""Authentication.user"", ""alias"": ""user""},                           {""attribute"": ""Authentication.app"", ""alias"": ""app""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest"",""user"",""app""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Compute_Inventory"".""Default_Accounts']",['Access - Default Accounts At Rest - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from datamodel:""Compute_Inventory"".""Default_Accounts"" | where NOT match('enabled', ""0|[Ff]|[Ff][Aa][Ll][Ss][Ee]"") AND NOT 'status'==""Degraded"" AND NOT like('shell',""%nologin"") AND NOT like('shell',""%false"") AND 'user'!=""root"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(tag) as ""tag"",count by ""dest"",""user""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Discovers the presence of default accounts even if they are not being used. Default accounts should be disabled in order to prevent an attacker from using them to gain unauthorized access to remote hosts.,,,,,0,1,Default Account At Rest Detected,0,access,low,Default Account At Rest Detected,The device $dest$ currently allows authentication for the default account $user$.  Please verify your information security policy allows authentication for this account.,"user,dest",View default account $user$ at rest on device $dest$,"| from datamodel:""Compute_Inventory"".""Default_Accounts"" | search dest=""$dest$"" user=""$user$""",,,1,dest,system,40,"user,dest",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Compute_Inventory"",         ""object"":        ""Default_Accounts"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""eventFilter"":   ""NOT match('All_Inventory.enabled', ""0|[Ff]|[Ff][Aa][Ll][Ss][Ee]"") AND NOT 'All_Inventory.status'==""Degraded"" AND NOT like('All_Inventory.User.shell',""%nologin"") AND NOT like('All_Inventory.User.shell',""%false"") AND 'All_Inventory.User.user'!=""root"""",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                           {""function"": ""values"", ""attribute"": ""All_Inventory.tag"", ""alias"": ""tag""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""All_Inventory.dest"", ""alias"": ""dest""},                           {""attribute"": ""All_Inventory.User.user"", ""alias"": ""user""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest"",""user""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Authentication"".""Failed_Authentication']",['Access - Excessive Failed Logins - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from datamodel:""Authentication"".""Failed_Authentication"" | stats values(tag) as ""tag"",dc(user) as ""user_count"",dc(dest) as ""dest_count"",count by ""app"",""src"" | where 'count'>=6",rt-65m@m,rt-5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects excessive number of failed login attempts (this is likely a brute force attack),,,,,0,1,Excessive Failed Logins,0,access,medium,Excessive Failed Logins,The system $src$ has failed $app$ authentication $count$ times using $user_count$ username(s) against $dest_count$ target(s) in the last hour,src,View all login failures by system $src$ for the application $app$,"| from datamodel:""Authentication"".""Failed_Authentication"" | search src=""$src$"" app=""$app$""",,,1,src,system,60,"app,src",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Authentication"",         ""object"":        ""Failed_Authentication"",         ""earliest"":      ""rt-65m@m"",         ""latest"":        ""rt-5m@m"",         ""aggregates"":    [{""function"": ""values"", ""attribute"": ""Authentication.tag"", ""alias"": ""tag""},                           {""function"": ""dc"", ""attribute"": ""Authentication.user"", ""alias"": ""user_count""},                           {""function"": ""dc"", ""attribute"": ""Authentication.dest"", ""alias"": ""dest_count""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""Authentication.app"", ""alias"": ""app""},                           {""attribute"": ""Authentication.src"", ""alias"": ""src""}                          ],         ""resultFilter"":  {""field"": ""count"", ""comparator"": "">="", ""value"": ""6""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""app"",""src""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - Inactive Account Usage - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| `inactive_account_usage(""90"",""2"")` | `ctime(lastTime)` | fields + user,tag,inactiveDays,lastTime",0,+0s,,1,number of events,greater than,0,55 * * * *,1,1,false,,,,Discovers previously inactive accounts that are now being used. This may be due to an attacker that successfully gained access to an account that was no longer being used.,,,,,0,1,Inactive Account Activity Detected,0,access,low,Inactive Account Activity Detected For $user$,User account $user$ was inactive for $inactiveDays$ days but logged in at $lastTime$.  Please verify this account is still needed.,user,View usage of previously inactive account $user$,"| `access_tracker` | search user=""$user$"" | `uitime(firstTime)` | `uitime(second2lastTime)` | `uitime(lastTime)`",,,1,user,user,40,user,86300s,false,,5,1,notable,,"[""Access - Authentication Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Authentication"".""Insecure_Authentication']",['Access - Insecure Or Cleartext Authentication - Rule'],SA-AccessProtection-default,,,True,,,,,,,,,"| from datamodel:""Authentication"".""Insecure_Authentication"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(tag) as ""tag"",count by ""app"",""dest""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects authentication requests that transmit the password over the network as cleartext (unencrypted),,,,,0,1,Insecure Or Cleartext Authentication Detected,0,access,high,Insecure Or Cleartext Authentication Detected,The device $dest$ is accepting insecure or cleartext $app$ authentication,"dest,app",View insecure or cleartext authentication requests for $app$ on device $dest$,"| from datamodel:""Authentication"".""Insecure_Authentication"" | search app=""$app$"" dest=""$dest$""",,,1,dest,system,80,"app,dest",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Authentication"",         ""object"":        ""Insecure_Authentication"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                           {""function"": ""values"", ""attribute"": ""Authentication.tag"", ""alias"": ""tag""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""Authentication.app"", ""alias"": ""app""},                           {""attribute"": ""Authentication.dest"", ""alias"": ""dest""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""app"",""dest""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect AWS API Activities From Unapproved Accounts - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,sourcetype=aws:cloudtrail errorCode=success | rename userName as identity | search NOT [| inputlookup identity_lookup_expanded | fields identity] | search NOT [| inputlookup aws_service_accounts | fields identity] | rename identity as user | stats count min(_time) as firstTime max(_time) as lastTime values(eventName) by user | `ctime(firstTime)` | `ctime(lastTime)`,-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for successful CloudTrail activity by user accounts that are not listed in the identity table or <code>aws_service_accounts.csv</code>. It returns event names and count, as well as the first and last time a specific user or service is detected, grouped by users.",,,,,,1,Detect AWS API Activities From Unapproved Accounts,,access,medium,Successful API activity by a non-approved account: $user$,"A successful API activity was invoked by $user$, an unapproved/unknown account.",user,,,,,1,user,user,30,user,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 16""], ""nist"": [""DE.DP"", ""DE.CM"", ""PR.AC"", ""ID.AM""]}","In this search, we are looking for successful API calls via CloudTrail. We filter out events triggered by known users listed in the `identity_lookup_expanded` lookup file and the service accounts. Once filtered out, we output a table with the event names and count, as well as the first and last time a specific user or service is detected.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. You must also populate the `identity_lookup_expanded` lookup shipped with the Asset and Identity framework to be able to look up users in your identity table in Enterprise Security (ES). Leverage the support search called ""Create a list of approved AWS service accounts"": run it once every 30 days to create and validate a list of service accounts.","It's likely that you'll find activity detected by users/service accounts that are not listed in the `identity_lookup_expanded` or ` aws_service_accounts.csv` file. If the user is a legitimate service account, update the `aws_service_accounts.csv` table with that entry.",2018-03-12,2018-03-13,medium,ESCU - Detect AWS API Activities From Unapproved Accounts - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS User Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Investigate AWS User Activities by user fieldn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Authentication.Authentication', 'Malware.Malware_Attacks']",['Access - High or Critical Priority Individual Logging into Infected Machine - Rule'],DA-ESS-AccessProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` values(Authentication.user) as ""user"" from datamodel=Authentication.Authentication where earliest=-70m@m latest=+0s nodename=Authentication.Successful_Authentication (""Authentication.user_priority""=""high"" OR ""Authentication.user_priority""=""critical"") by ""Authentication.dest"" | rename ""Authentication.dest"" as ""dest"" | eval cs_key='dest' | join type=inner cs_key [| tstats summariesonly=false allow_old_summaries=true values(Malware_Attacks.signature) as ""signature"" from datamodel=Malware.Malware_Attacks where earliest=-1450m@m latest=+0s nodename=Malware_Attacks.Allowed_Malware  by ""Malware_Attacks.dest"" | rename ""Malware_Attacks.dest"" as ""dest"" | eval cs_key='dest']",-1450m@m,+0s,,1,number of events,greater than,0,10 * * * *,1,1,false,,,,Detects users with a high or critical priority logging into a malware infected machine,,,,,0,1,High or Critical Priority Individual Logging into Infected Machine,0,access,critical,High or Critical Priority User Accessed Machine Infected with Malware,$user$ accessed $dest$ which is infected with $signature$,dest,View successful authentication attempts on infected system $dest$,"| from datamodel:""Authentication"".""Successful_Authentication"" | where ('user_priority'=""high"" OR 'user_priority'=""critical"") AND 'dest'=""$dest$""",,,1,dest,system,100,dest,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Authentication Tracker - Lookup Gen'],SA-AccessProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Authentication.Authentication where Authentication.action=success Authentication.dest!=unknown Authentication.user!=unknown by _time,Authentication.dest,Authentication.user span=1s | `drop_dm_object_name(""Authentication"")` | stats min(_time) as firstTime,values(_time) as second2lastTime,max(_time) as lastTime by dest,user | inputlookup append=T access_tracker | eval dest=lower(dest),user=lower(user) | stats min(firstTime) as firstTime,values(second2lastTime) as second2lastTime,values(lastTime) as lastTime_vals,max(lastTime) as lastTime by dest,user | eval `get_second2lastTime_meval(second2lastTime,lastTime_vals,lastTime)` | eventstats min(firstTime) as firstTime_user,max(lastTime) as lastTime_user by user | fields - lastTime_vals | outputlookup override_if_empty=false access_tracker | stats count",-70m@m,+0s,,1,,,,5 * * * *,,,,,,,"Maintains a list of users that have authenticated to each system and the first, second to last, and last time they have been seen",,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Authentication"".""Authentication']",['Access - Access App Tracker - Lookup Gen'],SA-AccessProtection-default,,,,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true min(_time) as ""firstTime"",max(_time) as ""lastTime"" from datamodel=""Authentication"".""Authentication"" where    ""Authentication.app""!=""unknown"" by ""Authentication.app""  | rename ""Authentication.app"" as ""app"" | inputlookup append=T ""access_app_tracker"" | stats min(firstTime) as ""firstTime"",max(lastTime) as ""lastTime"" by ""app"" | where strptime('lastTime', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""access_app_tracker"" | stats count",-30m@m,+0s,,1,,,,*/15 * * * *,,,,,,,Maintains a list of Authentication app values and the first and last time they have been seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",    ""search"":       {	    ""datamodel"":     ""Authentication"",	    ""object"":        ""Authentication"",        ""earliest"":      ""-30m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   ""'Authentication.app'!=""unknown"""",		""aggregates"":    [{""function"": ""min"", ""attribute"": ""_time"", ""alias"": ""firstTime""},	                      {""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""}	                     ],	    ""splitby"":       [{""attribute"": ""Authentication.app"", ""alias"": ""app""}],        ""summariesonly"": ""1"",        ""outputlookup"":  ""access_app_tracker"",        ""retention"":     {            ""earliestTime"":  ""-5y"",            ""timeField"":     ""lastTime"",            ""timeFormat"":    ""%s""        }    }}",,,,,,,,0,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Change"".""Auditing_Changes']",['Audit - Anomalous Audit Trail Activity Detected - Rule'],SA-AuditAndDataProtection-default,,,True,,,,,,,,,"| from datamodel:""Change"".""Auditing_Changes"" | where ('action'=""cleared"" OR 'action'=""stopped"") | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",count by ""dest"",""result"" | rename ""result"" as ""signature""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,"Discovers anomalous activity such as the deletion of or clearing of log files. Attackers oftentimes clear the log files in order to hide their actions, therefore, this may indicate that the system has been compromised.",,,,,0,1,Anomalous Audit Trail Activity Detected,0,audit,low,Anomalous Audit Trail Activity Detected On $dest$,Anomalous audit trail activity (such as clearing or deletion of log entries) was noted on the device $dest$,"dest,signature",View anomalous audit trail activity on device $dest$,"tag=audit (tag=stop OR tag=delete) dest=""$dest$""",,,1,dest,system,40,"dest,signature",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Change"",         ""object"":        ""Auditing_Changes"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""eventFilter"":   ""('All_Changes.action'=""cleared"" OR 'All_Changes.action'=""stopped"")"",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""All_Changes.dest"", ""alias"": ""dest""},                           {""attribute"": ""All_Changes.result"", ""alias"": ""signature""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest"",""signature""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Expected Host Not Reporting - Rule'],SA-AuditAndDataProtection-default,,,True,,,,,,,,,"| `host_eventcount(30,2)` | search is_expected=true | `ctime(lastTime)` | fields + host,lastTime,is_expected,dayDiff",0,+0s,,1,number of events,greater than,0,"0,15,30,45 * * * *",1,1,false,,,,Discovers hosts that are longer reporting events but should be submitting log events. This rule is used to monitor hosts that you know should be providing a constant stream of logs in order to determine why the host has failed to provide log data.,,,,,0,1,Expected Host Not Reporting,0,audit,medium,Expected Host Not Reporting ($orig_host$),The Splunk device $orig_host$ is expected to be forwarding data to Splunk and has not in the last $dayDiff$ days.,orig_host,View events from $orig_host$,"host=""$orig_host$""",,,1,host,system,60,host,86300s,false,,,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Personally Identifiable Information Detection - Rule'],SA-AuditAndDataProtection-default,,,True,,,,,,,,,"NOT sourcetype=stash | `get_integer_seq` | lookup luhn_lite_lookup integer_seq OUTPUTNEW pii,pii_clean | eval pii_length=len(pii_clean) | lookup iin_lookup iin as pii_clean,length as pii_length OUTPUTNEW iin_issuer | search iin_issuer=* | `get_event_id` | fields + event_id,_raw,host,pii,iin_issuer | eval pii_hash=sha1(pii)",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects personally identifiable information (PII) in log files. Some software will inadvertently provide sensitive information in log files and thus causing the information to be exposed unnecessarily to those reviewing the log files.,,,,,0,1,Personally Identifiable Information Detected,0,audit,high,Personally Identifiable Information Detected,Splunk has detected potentially sensitive information ($pii$ issued by $iin_issuer$) in the following event.,pii,View detected PII for $pii$,"NOT sourcetype=stash | `get_integer_seq` | lookup luhn_lite_lookup integer_seq OUTPUTNEW pii,pii_clean | search pii=""$pii$""",,,1,host,system,80,pii_hash,86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Splunk_Audit"".""Scheduler_Activity']",['Audit - Potential Gap in Data - Rule'],SA-AuditAndDataProtection-default,,,True,,,,,,,,,"| from datamodel:""Splunk_Audit"".""Scheduler_Activity"" | where 'status'=""success"" AND ('app' LIKE ""Splunk_%"" OR 'app' LIKE ""SA-%"" OR 'app' LIKE ""DA-%"" OR 'app'=""SplunkEnterpriseSecuritySuite"" OR 'app'=""SplunkPCIComplianceSuite"") | stats count | where 'count'=0 | eval const_dedup_id=""const_dedup_id""",-10m,-5m,,1,number of events,greater than,0,*/2 * * * *,1,1,0,,,,Detects gaps caused by the failure of the search head. If saved searches do not execute then there may be gaps in summary data.,,,,,0,1,Potential Gap in Data,0,audit,medium,No Saved Searches Executed Recently,No saved searches were recently executed over a five minute period. If saved searches do not execute then there may be gaps in summary data.,,View search scheduler log,"| from datamodel:""Splunk_Audit"".""Scheduler_Activity"" | where 'status'=""success"" AND ('app'=""Splunk_*"" OR 'app'=""SA-*"" OR 'app'=""DA-*"" OR 'app'=""SplunkEnterpriseSecuritySuite"" OR 'app'=""SplunkPCIComplianceSuite"")",,,,,,,const_dedup_id,14400s,false,,,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Splunk_Audit"",         ""object"":        ""Scheduler_Activity"",         ""earliest"":      ""-10m"",         ""latest"":        ""-5m"",         ""eventFilter"":   ""'Scheduler_Activity.status'=""success"" AND ('Scheduler_Activity.app' LIKE ""Splunk_%"" OR 'Scheduler_Activity.app' LIKE ""SA-%"" OR 'Scheduler_Activity.app' LIKE ""DA-%"" OR 'Scheduler_Activity.app'=""SplunkEnterpriseSecuritySuite"" OR 'Scheduler_Activity.app'=""SplunkPCIComplianceSuite"")"",         ""aggregates"":    [{""function"": ""count""}],         ""resultFilter"":  {""field"": ""count"", ""comparator"": ""="", ""value"": ""0""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""const_dedup_id""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Licensing - Minimum Events Per Day'],SA-AuditAndDataProtection-default,,,,,,,,,,,,| `licensing_epd` | stats sum(count) as count by _time | stats min(count) as min_count,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Minimum EPD,Count,min_count,,,false,search?q=%7C%20%60licensing_epd%60,1,0,0,all,Minimum EPD,singlevalue,index_auditing,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Activity Related to Pass the Hash Attacks - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"eventtype=wineventlog_security (signature_id=4624 OR signature_id=4625) Logon_Process=NtLmSsp Logon_Type=3 Account_Name !=""ANONYMOUS LOGON"" Key_Length=0 | table _time src_ip user dest dest_nt_domain signature_id signature",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for specific authentication events from the Windows Security Event logs to detect potential attempts at using the Pass-the-Hash technique.,,,,,,1,Detect Activity Related to Pass the Hash Attacks,,access,low,Detect Activity Related to Pass the Hash,This search looks for Authentication log events from the Windows Security Audit logs to detect potential attempts for Passing the Hash,"src_ip, dest, user",,,,,1,dest,system,10,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Lateral Movement"", ""Pass the Hash""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 16""], ""nist"": [""PR.PT"", ""PR.AT"", ""PR.AC"", ""PR.IP""]}","To detect pass the hash activity, we look at all events with event code 4624 or 4625 that specify a logon type 3 (network logons). We are looking for the NtLmSsP account, with a key length set to 0. These indicate lower level protocols that are typically used through Pass the Hash (WMI, SMB, etc.). The search also filters out events with an account name of 'Anonymous' to help reduce false positives.","To successfully implement this search, you must ingest your Windows Security Event logs and leverage the latest TA for Windows.",Legitimate logon activity by authorized NTLM systems may be detected by this search. Please investigate as appropriate.,2016-09-13,2019-02-27,low,ESCU - Detect Activity Related to Pass the Hash Attacks - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Lateral Movement""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process Infon""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Licensing - Average Events Per Day'],SA-AuditAndDataProtection-default,,,,,,,,,,,,| `licensing_epd` | stats sum(count) as count by _time | stats avg(count) as avg_count,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Average EPD,Count,avg_count,,,false,search?q=%7C%20%60licensing_epd%60,1,0,0,all,Average EPD,singlevalue,index_auditing,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Licensing - Maximum Events Per Day'],SA-AuditAndDataProtection-default,,,,,,,,,,,,| `licensing_epd` | stats sum(count) as count by _time | stats max(count) as max_count,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Maximum EPD,Count,max_count,,,false,search?q=%7C%20%60licensing_epd%60,1,0,0,all,Maximum EPD,singlevalue,index_auditing,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Licensing - Recent Events Per Day'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| `licensing_epd` | stats sum(count) as count by _time | sort 0 -_time | head 2 | table count | transpose | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | fields delta,*",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Recent EPD,Count,current_count,,delta,false,search?q=%7C%20%60licensing_epd%60,1,0,0,all,Recent EPD,singlevalue,index_auditing,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Performance - Number Of Systems Not Reporting'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| `host_eventcount(30,2)` | search is_expected=true | stats count as current_count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Not Reporting,System Count,current_count,,,false,search?q=%7C%20%60host_eventcount(30%2C2)%60%20%7C%20search%20is_expected%3Dtrue,1,0,0,all,Expected Hosts Not Reporting,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Performance - Average Run Duration'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| rest splunk_server=local count=0 /services/search/jobs reportSearch=summarize* | fields runDuration | eval runDuration=round(runDuration,2) | stats avg(runDuration) as avg_run_duration",-1h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Avg Run Duration (s),,avg_run_duration,,,false,datamodel_audit,1,0,0,all,Avg Run Duration (s),singlevalue,,,owner,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Events Per Day - Lookup Gen'],SA-AuditAndDataProtection-default,,,False,,,,,,,,,"index=_internal source=*metrics.log* group=thruput name=idxSummary | bin _time span=1d | stats sum(ev) as count by _time,series | rename series as index | eval key=_time.""|"".index | outputlookup key_field=key licensing_epd | stats count",-1d@d,@d,,1,,,,1 0 * * *,,,,,,,Maintains a list of event counts per day per index,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Event Count Over Time By Top 10 Hosts'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| `tstats` count where index=* [| metadata type=hosts | `lower(host)` | sort 10 - totalCount | fields host | format] by _time,host | timechart useother=`useother` count by host",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,area,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Hosts By Last Report Time'],SA-AuditAndDataProtection-default,,,,,,,,,,,,| `host_eventcount` | rename totalCount as count | `uitime(firstTime)` | `uitime(lastTime)` | table host is_expected firstTime lastTime count dayDiff,,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Search_Activity'],['Audit - Searches Over Time By Type'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| `tstats` count from datamodel=Splunk_Audit.Search_Activity where (Search_Activity.info=""granted"" OR (Search_Activity.info=""completed"" Search_Activity.search_type=""subsearch"")) by _time,Search_Activity.search_type span=10m | timechart minspan=10m count by Search_Activity.search_type",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,stacked,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Search_Activity'],['Audit - Searches Over Time By User'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Splunk_Audit.Search_Activity where (Search_Activity.info=""granted"" OR (Search_Activity.info=""completed"" Search_Activity.search_type=""subsearch"")) by Search_Activity.user | rename Search_Activity.* as * | sort 10 - count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Resolution.DNS', 'Web.Web']",['ESCU - Detect DNS requests to Phishing Sites leveraging EvilGinx2 - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true count min(_time) as firstTime max(_time) as lastTime values(DNS.answer) as answer from datamodel=Network_Resolution.DNS by DNS.dest DNS.src DNS.query host | `drop_dm_object_name(DNS)`| rex field=query "".*?(?<domain>[^./:]+.(S{2,3}|S{2,3}.S{2,3}))$"" | stats count values(query) as query by domain dest src answer| search `evilginx_phishlets_amazon` OR `evilginx_phishlets_facebook` OR `evilginx_phishlets_github` OR `evilginx_phishlets_0365` OR `evilginx_phishlets_outlook` OR `evilginx_phishlets_aws` OR `evilginx_phishlets_google` | search NOT [ inputlookup legit_domains.csv | fields domain]| join domain type=outer [| tstats count summariesonly=true allow_old_summaries=true values(Web.url) as url from datamodel=Web.Web by Web.dest Web.site | rename ""Web.*"" as * | rex field=site "".*?(?<domain>[^./:]+.(S{2,3}|S{2,3}.S{2,3}))$"" | table dest domain url] | table count src dest query answer domain url",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for DNS requests for phishing domains that are leveraging EvilGinx tools to mimic websites.,,,,,,1,Detect DNS requests to Phishing Sites leveraging EvilGinx2,,network,high,DNS request for EvilGinx subdomain detected on $src$,The host $src$ issued a DNS request for a domain that could be a phishing site leverating EvilGinx toolkit.,"src, query",,,,,1,src,system,40,"src, query",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Spearphishing Link"", ""Command and Control""], ""kill_chain_phases"": [""Delivery"", ""Command and Control""], ""cis20"": [""CIS 8"", ""CIS 7""], ""nist"": [""ID.AM"", ""PR.DS"", ""PR.IP"", ""DE.AE"", ""DE.CM""]}","This search gathers all the answers to each system's DNS query, then filters for queries that have sub domains extracted from the EvilGinx toolkit. It will then run a regex to extract `legit_domains` from the query and remove that from the detection if it is listed in the `legit_domains.csv`","You need to ingest data from your DNS logs in the Network_Resolution datamodel. Specifically you must ingest the domain that is being queried and the IP of the host originating the request. Ideally, you should also be ingesting the answer to the query and the query type. This approach allows you to also create your own localized passive DNS capability which can aid you in future investigations. You will have to add legitimate domain names to the `legit_domains.csv` file shipped with the app.  **Splunk>Phantom Playbook Integration**If Splunk>Phantom is also configured in your environment, a Playbook called `Lets Encrypt Domain Investigate` can be configured to run when any results are found by this detection search. To use this integration, install the Phantom App for Splunk `https://splunkbase.splunk.com/app/3411/`, add the correct hostname to the ""Phantom Instance"" field in the Adaptive Response Actions when configuring this detection search, and set the corresponding Playbook to active. (Playbook Link:`https://my.phantom.us/4.2/playbook/lets-encrypt-domain-investigate/`).","If a known good domain is not listed in the legit_domains.csv file, then the search could give you false postives. Please update that lookup file to filter out DNS requests to legitimate domains.",2019-04-29,2019-04-29,high,ESCU - Detect DNS requests to Phishing Sites leveraging EvilGinx2 - Rule,detection,Endpoint,"[""src""]","[""Splunk Stream"", ""Bro""]","[""Common Phishing Frameworks""]","runphantomplaybook, escu_investigate","{""version"": 1, ""data"": ""Recommended following                         steps:nn1. [[action|runphantomplaybook]]: Phantom playbook                         recommendations:nSplunk>Phantom Response Playbook - Monitor enrichment of the                         Splunk>Phantom Playbook called Domain Certificate Investigation and answer any                         analyst prompt in Mission Control with a response decision.                         Link to the playbook https://my.phantom.us/4.2/playbook/lets-encrypt-domain-investigate/n2. [[action|escu_investigate]]:                         Based on ESCU investigate recommendations:nESCU - Get Certificate logs for a domainn""}",0,3600,86400,0,,,,,"[""Network_Resolution"", ""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['Audit - Splunkd Process Utilization'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| tstats `summariesonly` avg(Processes.cpu_load_percent) as avg_cpu_load,avg(Processes.mem_used) as avg_mem_used from datamodel=Endpoint.Processes where Processes.process=*splunkd* by Processes.dest | `drop_dm_object_name(""Processes"")` | eval ""avg_cpu_load (%)""=floor(avg_cpu_load) | eval ""avg_mem_used (MB)""=floor(avg_mem_used/1048576) | fields - avg_cpu_load,avg_mem_used | sort 100 - ""avg_cpu_load (%)""",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['Audit - Splunk Service Start Mode Anomalies'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| tstats `summariesonly` max(_time) as _time,latest(Services.start_mode) as start_mode,latest(Services.status) as status from datamodel=Endpoint.Services where (Services.service=splunkd OR Services.service=splunk) by Services.dest | `drop_dm_object_name(""Services"")` | search start_mode!=auto | sort 100 + start_mode | fields _time,dest,start_mode,status",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Search_Activity'],['Audit - Top Searches By Run Time'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| tstats `summariesonly` first(Search_Activity.search_alias) as search_alias,first(Search_Activity.search) as search,first(Search_Activity.total_run_time) as run_time,first(Search_Activity.user) as user from datamodel=Splunk_Audit.Search_Activity by Search_Activity.search_id | stats first(search_alias) as ""search alias"",min(run_time),avg(run_time),max(run_time),values(user) as user,count by search | eval ""min(run_time)""=round('min(run_time)', 1),""avg(run_time)""=round('avg(run_time)', 1),""max(run_time)""=round('max(run_time)', 1) | sort 500 - ""avg(run_time)""",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Splunk_Audit"".""Web_Service_Errors']",['Audit - Web Service Errors'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| from datamodel:""Splunk_Audit"".""Web_Service_Errors"" | head 1000",-24h@h,now,,,,,,,,,0,,,,,,events,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,"[""source"", ""sourcetype"", ""host""]",true,false,list,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Data Protection - Data Integrity Control By Index'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| rest splunk_server=* count=0 /services/data/indexes search=""enableDataIntegrityControl=1"" | stats values(splunk_server) as splunk_server by title,enableDataIntegrityControl | rename title as index | fields index,splunk_server,enableDataIntegrityControl",,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,owner,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Licensing - Events Per Day'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| `licensing_epd` | stats sum(count) as count by _time | eval avg_eps=round(count/86400,1) | sort 0 -_time",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Licensing - Events Per Day Over Time'],SA-AuditAndDataProtection-default,,,,,,,,,,,,| `licensing_epd` | timechart span=1d sum(count) as count,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Licensing - Events Per Index (Last Day)'],SA-AuditAndDataProtection-default,,,,,,,,,,,,"| `licensing_epd` | eventstats max(_time) | where _time='max(_time)' | table _time,index,count | sort 0 - count",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Filesystem', 'Endpoint.Registry', 'Change.All_Changes']",['Change - Total Change Count By User By Change Type Per Day - Context Gen'],SA-EndpointProtection-default,,,False,,,,,,,,,"| `tstats` count from datamodel=Endpoint.Filesystem where Filesystem.tag=""change"" by _time,Filesystem.user span=24h | eval change_type=""filesystem"",user='Filesystem.user' | `tstats` append=T count from datamodel=Endpoint.Registry where Registry.tag=""change"" by _time,Registry.user span=24h | eval change_type=if(isnull(change_type),""registry"",change_type),user=if(isnull(user),'Registry.user',user) | `tstats` append=T count from datamodel=Change.All_Changes by _time,All_Changes.change_type,All_Changes.user span=24h | eval change_type=if(isnull(change_type),'All_Changes.change_type',change_type),user=if(isnull(user),'All_Changes.user',user) | stats count as change_count by _time,change_type,user | `context_stats(change_count, change_type)` | eval min=0 | eval max=median*2 | xsupdateddcontext name=change_count_by_user_by_change_type_1d container=change_analysis class=change_type type=domain app=""SA-EndpointProtection"" scope=app terms=`xs_default_magnitude_concepts` | stats count",-31d@d,-1d@d,,1,,,,0 0 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['ESCU - Detect Excessive Account Lockouts From Endpoint - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Change.All_Changes where nodename=All_Changes.Account_Management All_Changes.result=""lockout"" by All_Changes.dest All_Changes.result |`drop_dm_object_name(""All_Changes"")` |`drop_dm_object_name(""Account_Management"")`| `ctime(firstTime)` | `ctime(lastTime)` | search count > 5",-4h@h,-5m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search identifies endpoints that have caused a relatively high number of account lockouts in a short period.,,,,,,1,Detect Excessive Account Lockouts From Endpoint,,access,low,$dest$ has generated a high number of account lockouts,The system $dest$ has generated a high number of account lockouts.,dest,,,,,1,dest,system,40,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Valid Accounts""], ""cis20"": [""CIS 16""], ""nist"": [""PR.IP""]}","This search queries the `Change.All_Changes` datamodel under the nodename is `Account_Management` , where the result is ""lockout"", which indicates that an account has been locked out. It then counts the number of times an endpoint has caused an account lockout within a four hour window and displays those hosts with a count greater than or equal to five.","You must ingest your Windows security event logs in the `Change` datamodel under the nodename is `Account_Management`, for this search to execute successfully. Please consider updating the cron schedule and the count of lockouts you want to monitor, according to your environment.  **Splunk>Phantom Playbook Integration**If Splunk>Phantom is also configured in your environment, a Playbook called ""Excessive Account Lockouts Enrichment and Response"" can be configured to run when any results are found by this detection search. The Playbook executes the Contextual and Investigative searches in this Story, conducts additional information gathering on Windows endpoints, and takes a response action to shut down the affected endpoint. To use this integration, install the Phantom App for Splunk `https://splunkbase.splunk.com/app/3411/`, add the correct hostname to the ""Phantom Instance"" field in the Adaptive Response Actions when configuring this detection search, and set the corresponding Playbook to active. (Playbook Link:`https://my.phantom.us/4.1/playbook/excessive-account-lockouts-enrichment-and-response/`).","It's possible that a widely used system, such as a kiosk, could cause a large number of account lockouts.",2017-08-17,2019-04-18,low,ESCU - Detect Excessive Account Lockouts From Endpoint - Rule,detection,Windows,"[""dest""]","[""Microsoft Windows""]","[""Account Monitoring and Controls""]","runphantomplaybook, escu_investigate","{""version"": 1, ""data"": ""Recommended following                         steps:nn1. [[action|runphantomplaybook]]: Phantom playbook                         recommendations:nSplunk>Phantom Response Playbook - Monitor enrichment of the                         Splunk>Phantom Playbook called Excessive Account Lockouts Enrichment And Response and answer any                         analyst prompt in Mission Control with a response decision.                         Link to the playbook https://my.phantom.us/4.1/playbook/excessive-account-lockouts-enrichment-and-response/n2. [[action|escu_investigate]]:                         Based on ESCU investigate recommendations:n""}",0,3600,86400,0,,,,,"[""Change""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Anomalous New Processes - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"| from inputlookup:""localprocesses_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^d""), tostring(""+0s""),  match(""+0s"", ""^([@+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"",values(dest) as ""dest"" by ""process"" | where 'dest_count'>9",-24h@h,+0s,,1,number of events,greater than,0,25 * * * *,1,1,false,,,,Alerts when an anomalous number hosts are detected with a new process.,,,,,0,1,Anomalous New Process,0,endpoint,medium,Anomalous New Process ($process$),An suspicious number of new processes were identified. $dest_count$ hosts were discovered with new instances of $process$ in the last 24 hours.,process,View all instances of $process$,"| from datamodel:""Endpoint"".""Processes"" | search process_name=""$process|s$""",,,1,process,other,60,process,86300s,false,,5,1,notable,,"[""Endpoint - Local Processes Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""inputlookup"":  {""lookupName"": ""localprocesses_tracker"", ""timeField"":  ""firstTime""},         ""earliest"":     ""-24h@h"",         ""latest"":       ""+0s"",         ""aggregates"":   [{""function"": ""dc"", ""attribute"": ""dest"", ""alias"": ""dest_count""},                          {""function"": ""values"", ""attribute"": ""dest"", ""alias"": ""dest""}                         ],         ""splitby"":      [{""attribute"": ""process""}],         ""resultFilter"": {""field"": ""dest_count"", ""comparator"": "">"", ""value"": ""9""}        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""process""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Anomalous New Services - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"| from inputlookup:""services_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^d""), tostring(""+0s""),  match(""+0s"", ""^([@+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"",values(dest) as ""dest"" by ""service"" | where 'dest_count'>9",-24h@h,+0s,,1,number of events,greater than,0,25 * * * *,1,1,false,,,,Alerts when an anomalous number hosts are detected with a new service.,,,,,0,1,Anomalous New Service,0,endpoint,medium,Anomalous New Service ($service$),An suspicious number of new services were identified. $dest_count$ hosts were discovered with new instances of the $service$ service in the last 24 hours.,service,View all instances of $service$,"| from datamodel:""Endpoint"".""Services"" | search service=""$service$""",,,1,service,other,60,service,86300s,false,,5,1,notable,,"[""Endpoint - Services Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""inputlookup"":  {""lookupName"": ""services_tracker"", ""timeField"":  ""firstTime""},         ""earliest"":     ""-24h@h"",         ""latest"":       ""+0s"",         ""aggregates"":   [{""function"": ""dc"", ""attribute"": ""dest"", ""alias"": ""dest_count""},                          {""function"": ""values"", ""attribute"": ""dest"", ""alias"": ""dest""}                         ],         ""splitby"":      [{""attribute"": ""service""}],         ""resultFilter"": {""field"": ""dest_count"", ""comparator"": "">"", ""value"": ""9""}        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""service""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint"".""Ports']",['Endpoint - Listening Ports Tracker - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true min(_time) as ""firstTime"",max(_time) as ""lastTime"" from datamodel=""Endpoint"".""Ports""  by ""Ports.dest"",""Ports.transport"",""Ports.dest_port""  | rename ""Ports.dest"" as ""dest"",""Ports.transport"" as ""transport"",""Ports.dest_port"" as ""dest_port"" | inputlookup append=T ""listeningports_tracker"" | stats min(firstTime) as ""firstTime"",max(lastTime) as ""lastTime"" by ""dest"",""transport"",""dest_port"" | where strptime('lastTime', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""listeningports_tracker"" | stats count",-70m@m,+0s,,1,,,,35 * * * *,,,,,,,Maintains a list of all port and protocol combinations listening on each system and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",    ""search"":       {	    ""datamodel"":     ""Endpoint"",	    ""object"":        ""Ports"",        ""earliest"":      ""-70m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   """",		""aggregates"":    [{""function"": ""min"", ""attribute"": ""_time"", ""alias"": ""firstTime""},	                      {""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""}	                     ],	    ""splitby"":       [	                      {""attribute"": ""Ports.dest"", ""alias"": ""dest""},	                      {""attribute"": ""Ports.transport"", ""alias"": ""transport""},	                      {""attribute"": ""Ports.dest_port"", ""alias"": ""dest_port""}	                     ],        ""summariesonly"": ""1"",        ""outputlookup"":  ""listeningports_tracker"",        ""retention"":     {            ""earliestTime"":  ""-5y"",            ""timeField"":     ""lastTime"",            ""timeFormat"":    ""%s""        }    }}",,,,,,,,0,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['Endpoint - Local Processes Tracker - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime,max(_time) as lastTime from datamodel=Endpoint.Processes by Processes.dest,Processes.process | `drop_dm_object_name(""Processes"")` | inputlookup append=T localprocesses_tracker | rex field=process ""^s*(?<process>[^s]+)"" | stats min(firstTime) as firstTime,max(lastTime) as lastTime by dest,process | outputlookup override_if_empty=false localprocesses_tracker | stats count",-70m@m,+0s,,1,,,,40 * * * *,,,,,,,Maintains a list of all processes on each system and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Services'],['Endpoint - Services Tracker - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime,max(_time) as lastTime,latest(Services.start_mode) as start_mode from datamodel=Endpoint.Services by Services.dest,Services.service | `drop_dm_object_name(""Services"")` | inputlookup append=T services_tracker | sort 0 - lastTime | stats min(firstTime) as firstTime,max(lastTime) as lastTime,first(start_mode) as start_mode by dest,service | outputlookup override_if_empty=false services_tracker | stats count",-70m@m,+0s,,1,,,,40 * * * *,,,,,,,Maintains a list of all services (and the most recent startmode) for each system and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Compute_Inventory"".""All_Inventory']",['Endpoint - System Version Tracker - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true max(_time) as ""_time"" from datamodel=""Compute_Inventory"".""All_Inventory"" where   nodename=""All_Inventory.OS""  by ""All_Inventory.dest"",""All_Inventory.OS.os""  | rename ""All_Inventory.dest"" as ""dest"",""All_Inventory.OS.os"" as ""os"" | inputlookup append=T ""system_version_tracker"" | stats max(_time) as ""_time"" by ""dest"",""os"" | where strptime('_time', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""system_version_tracker"" | stats count",-70m@m,+0s,,1,,,,20 * * * *,,,,,,,Maintains a list of the most recent operating system version for each system and the time we got this information,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",    ""search"":       {	    ""datamodel"":     ""Compute_Inventory"",	    ""object"":        ""OS"",        ""earliest"":      ""-70m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   """",		""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""_time""}],	    ""splitby"":       [	                      {""attribute"": ""All_Inventory.dest"", ""alias"": ""dest""},	                      {""attribute"": ""All_Inventory.OS.os"", ""alias"": ""os""}	                     ],        ""summariesonly"": ""0"",        ""outputlookup"":  ""system_version_tracker"",        ""retention"":     {            ""earliestTime"":  ""-5y"",            ""timeField"":     ""_time"",            ""timeFormat"":    ""%s""        }    }}",,,,,,,,0,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Compute_Inventory"".""User']",['Endpoint - User Account Tracker - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| from datamodel:""Compute_Inventory"".""User"" | stats min(_time) as firstTime,max(_time) as lastTime,latest(interactive) as interactive by dest,user | inputlookup append=T useraccounts_tracker | eval _time=lastTime | stats min(firstTime) as firstTime,max(lastTime) as lastTime,latest(interactive) as interactive by dest,user | fields firstTime,lastTime,dest,user,interactive | outputlookup override_if_empty=false useraccounts_tracker | stats count",-70m@m,+0s,,1,,,,10 * * * *,,,,,,,Maintains a list of all local user accounts on each system and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Endpoint - Emails By Source - Context Gen'],SA-EndpointProtection-default,,,true,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true sum(All_Email.recipient_count) as recipient_count from datamodel=Email.All_Email where NOT All_Email.src_category=""email_servers"" by ""All_Email.src"",_time span=1h | stats avg(recipient_count) as avg, count | eval min=0 | eval max=avg * 2 | xsUpdateDDContext app=SA-EndpointProtection name=recipients_by_src_1h container=email type=domain scope=app | stats count",-25h@h,-1h@h,,1,,,,0 3 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Endpoint - Emails By Destination Count - Context Gen'],SA-EndpointProtection-default,,,true,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true dc(All_Email.dest) as dest_count from datamodel=Email.All_Email where NOT All_Email.src_category=""email_servers"" by ""All_Email.src"",_time span=1h | stats avg(dest_count) as avg, count | eval min=0 | eval max=avg * 2 | xsUpdateDDContext app=SA-EndpointProtection name=destinations_by_src_1h container=email type=domain scope=app | stats count",-25h@h,-1h@h,,1,,,,0 4 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Malware.Malware_Attacks'],['Endpoint - Malware Daily Count - Context Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Malware_Attacks.signature) as infection_count from datamodel=Malware.Malware_Attacks where earliest=-31d@d latest=-1d@d Malware_Attacks.action=allowed by Malware_Attacks.dest,_time span=1d | stats sum(infection_count) as total_infection_count by _time | stats count,median(total_infection_count) as median by _time | eval min=0 | eval max=median*2 | xsCreateDDContext name=count_1d container=malware type=domain terms=""minimal,small,medium,large,extreme"" scope=app app=SA-NetworkProtection | stats count",-31d@d,-1d@d,,1,,,,0 3 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['ESCU - Detect Excessive User Account Lockouts - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Change.All_Changes where nodename=All_Changes.Account_Management All_Changes.result=""lockout"" by All_Changes.user All_Changes.result |`drop_dm_object_name(""All_Changes"")` |`drop_dm_object_name(""Account_Management"")`| `ctime(firstTime)` | `ctime(lastTime)` | search count > 5",-4h@h,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search detects user accounts that have been locked out a relatively high number of times in a short period.,,,,,,1,Detect Excessive User Account Lockouts,,access,medium,$user$ locked account an excessive number of times,The account $user$ has been locked out an excessive number of times,user,,,,,1,user,system,40,user,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Valid Accounts""], ""cis20"": [""CIS 16""], ""nist"": [""PR.IP""]}","This search queries the `Change.All_Changes` datamodel under the nodename is `Account_Management` , where the result is ""lockout"", which indicates that an account has been locked out. It then counts the number of times a user  has caused an account lockout within a four hour window and displays those users with a count greater than or equal to five.","ou must ingest your Windows security event logs in the `Change` datamodel under the nodename is `Account_Management`, for this search to execute successfully. Please consider updating the cron schedule and the count of lockouts you want to monitor, according to your environment.",It is possible that a legitimate user is experiencing an issue causing multiple account login failures leading to lockouts.,2017-08-17,2019-03-01,medium,ESCU - Detect Excessive User Account Lockouts - Rule,detection,Windows,[],"[""Microsoft Windows""]","[""Account Monitoring and Controls""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get Notable InfonESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Logon Rights Modifications For UsernESCU - Get Logon Rights Modifications For Endpointn""}",0,3600,86400,0,,,,,"[""Change""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Malware"".""Malware_Attacks']",['Endpoint - Outbreak Observed - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true dc(Malware_Attacks.dest) as ""system_count"",values(Malware_Attacks.tag) as ""tag"" from datamodel=""Malware"".""Malware_Attacks""   by ""Malware_Attacks.signature""  | rename ""Malware_Attacks.signature"" as ""signature"" | where 'system_count'>10",-1450m@m,+0s,,1,number of events,greater than,0,*/15 * * * *,1,1,false,,,,Alerts when a potential outbreak is observed based on newly infected systems all exhibiting the same infection,,,,,0,1,Outbreak Detected,0,endpoint,high,Outbreak Detected Of $signature$,A potential outbreak was noted. $system_count$ hosts have been detected as newly infected by $signature$ within the past 24 hours.,signature,View events associated with potential outbreak of $signature$,"| from datamodel:""Malware"".""Malware_Attacks"" | search signature=""$signature$""",,,1,signature,other,80,signature,86300s,false,,,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Malware"",         ""object"":        ""Malware_Attacks"",         ""earliest"":      ""-1450m@m"",         ""latest"":        ""+0s"",         ""aggregates"":    [{""function"": ""dc"", ""attribute"": ""Malware_Attacks.dest"", ""alias"": ""system_count""},                           {""function"": ""values"", ""attribute"": ""Malware_Attacks.tag"", ""alias"": ""tag""}                          ],         ""splitby"":       [{""attribute"": ""Malware_Attacks.signature"", ""alias"": ""signature""}],         ""resultFilter"":  {""field"": ""system_count"", ""comparator"": "">"", ""value"": ""10""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""signature""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Malware"".""Malware_Attacks']",['Endpoint - Recurring Malware Infection - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true dc(Malware_Attacks.date) as ""day_count"",count from datamodel=""Malware"".""Malware_Attacks""   by ""Malware_Attacks.dest"",""Malware_Attacks.signature"" | rename ""Malware_Attacks.dest"" as ""dest"",""Malware_Attacks.signature"" as ""signature"" | where 'day_count'>3",-10090m@m,+0s,,1,number of events,greater than,0,45 * * * *,1,1,false,,,,Alerts when a host has an infection that has been re-infected remove multiple times over multiple days.,,,,,0,1,Host With A Recurring Malware Infection,0,endpoint,high,Host With A Recurring Malware Infection ($signature$ On $dest$),The device $dest$ was detected with malware '$signature$' that has been detected as active for $day_count$ days in a row. AV has successfully removed the infection each time but the system is continually reinfected; this may indicate the presence of another form of malware is on the system that is prompting the download of '$signature$'.,"dest,signature",View related '$signature$' events for $dest$,"| from datamodel:""Malware"".""Malware_Attacks"" | search dest=""$dest$"" signature=""$signature$""",,,1,dest,system,80,"dest,signature",86300s,false,,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Malware"",         ""object"":        ""Malware_Attacks"",         ""earliest"":      ""-10090m@m"",         ""latest"":        ""+0s"",         ""aggregates"":    [{""function"": ""dc"", ""attribute"": ""Malware_Attacks.date"", ""alias"": ""day_count""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""Malware_Attacks.dest"", ""alias"": ""dest""},                           {""attribute"": ""Malware_Attacks.signature"", ""alias"": ""signature""}                          ],         ""resultFilter"":  {""field"": ""day_count"", ""comparator"": "">"", ""value"": ""3""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dest"",""signature""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Malware"".""Malware_Attacks']",['Endpoint - Malware Tracker - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true min(_time) as ""firstTime"",max(_time) as ""lastTime"" from datamodel=""Malware"".""Malware_Attacks""  by ""Malware_Attacks.dest"",""Malware_Attacks.signature""  | rename ""Malware_Attacks.dest"" as ""dest"",""Malware_Attacks.signature"" as ""signature"" | inputlookup append=T ""malware_tracker"" | stats min(firstTime) as ""firstTime"",max(lastTime) as ""lastTime"" by ""dest"",""signature"" | where strptime('lastTime', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""malware_tracker"" | stats count",-70m@m,+0s,,1,,,,10 * * * *,,,,,,,Maintains a list of all detections (regardless of status) for each system and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",    ""search"":       {	    ""datamodel"":     ""Malware"",	    ""object"":        ""Malware_Attacks"",        ""earliest"":      ""-70m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   """",		""aggregates"":    [{""function"": ""min"", ""attribute"": ""_time"", ""alias"": ""firstTime""},	                      {""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""}	                     ],	    ""splitby"":       [	                      {""attribute"": ""Malware_Attacks.dest"", ""alias"": ""dest""},	                      {""attribute"": ""Malware_Attacks.signature"", ""alias"": ""signature""}	                     ],        ""summariesonly"": ""1"",        ""outputlookup"": ""malware_tracker"",        ""retention"":    {            ""earliestTime"":  ""-5y"",            ""timeField"":     ""lastTime"",            ""timeFormat"":    ""%s""        }    }}",,,,,,,,0,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Malware"".""Malware_Operations']",['Endpoint - Malware Operations Tracker - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| from datamodel:""Malware"".""Malware_Operations"" | search (product_version=* OR signature_version=*) | eval time_product_version=if(isnotnull(product_version),_time,null()) | eval time_signature_version=if(isnotnull(signature_version),_time,null()) | stats latest(_time) as _time,latest(dest_nt_domain) as dest_nt_domain,latest(time_product_version) as time_product_version,latest(product_version) as product_version,latest(time_signature_version) as time_signature_version,latest(signature_version) as signature_version,latest(vendor_product) as vendor_product by dest | lookup malware_operations_tracker dest OUTPUT time_product_version as time_product_version_old,product_version as product_version_old,time_signature_version as time_signature_version_old,signature_version as signature_version_old | eval product_version=case(isnull(product_version_old),product_version,isnull(product_version) OR time_product_version<time_product_version_old,product_version_old,product_version==product_version_old,product_version_old,product_version!=product_version_old,product_version) | eval time_product_version=case(isnull(product_version_old),time_product_version,isnull(product_version) OR time_product_version<time_product_version_old,time_product_version_old,product_version==product_version_old,time_product_version_old,product_version!=product_version_old,time_product_version) | eval signature_version=case(isnull(signature_version_old),signature_version,isnull(signature_version) OR time_signature_version<time_signature_version_old,signature_version_old,signature_version==signature_version_old,signature_version_old,signature_version!=signature_version_old,signature_version) | eval time_signature_version=case(isnull(signature_version_old),time_signature_version,isnull(signature_version) OR time_signature_version<time_signature_version_old,time_signature_version_old,signature_version==signature_version_old,time_signature_version_old,signature_version!=signature_version_old,time_signature_version) | fields - *old | inputlookup append=T malware_operations_tracker | eventstats latest(_time) as _time by dest | eventstats latest(dest_nt_domain) as dest_nt_domain by dest | eventstats latest(vendor_product) as vendor_product by dest | dedup dest | outputlookup override_if_empty=false malware_operations_tracker | stats count",-250m@m,+0s,,1,,,,"15 0,4,8,12,16,20 * * *",,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Average Infection Length - Summary Gen'],SA-EndpointProtection-default,,,,,,,,,,,,| from inputlookup:malware_tracker | eval dayDiff=(lastTime-firstTime)/86400 | stats avg(dayDiff) as avg_dayDiff by dest,0,+0s,,1,,,,50 * * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,endpoint_summary,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Performance.All_Performance'],['Endpoint - Should Timesync Host Not Syncing - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` max(_time) as lastTime from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Timesync All_Performance.OS.Timesync.action=success by All_Performance.dest | rename All_Performance.dest as dest | `get_asset(dest)` | rename dest_* as * | `assets` | search should_timesync=true | stats max(lastTime) as lastTime,first(should_timesync) as should_timesync,values(key) as dest by asset_id | where isnull(lastTime) | addinfo | eval hourDiff=floor((info_max_time-info_min_time)/3600) | fields dest,should_timesync,hourDiff",-1450m@m,+0s,,1,number of events,greater than,0,30 8 * * *,1,1,false,,,,"Detects when hosts that are required to synchronize their clocks have failed to do so. Time synchronization is important because it ensures that the event logs are stamped with the proper time. Additionally, this is required by some regulatory compliance standards (such as PCI).",,,,,0,1,Should Timesync Host Not Syncing,0,endpoint,medium,Should Timesync Host Not Syncing ($dest$),The device $dest$ is expected to be synchronizing its clock and has not in the last $hourDiff$ hours.,dest,View time-sync events for device $dest$,"| from datamodel:""Performance"".""Timesync"" | search dest=$dest$",,,1,dest,system,60,dest,86300s,false,,auto,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Multiple Primary Functions Detected - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"| `primary_functions_tracker` | eval _time=lastTime | `hoursago(24)` | search is_primary=true | stats values(function) as function,dc(function) as function_count by dest | search function_count>1",0,+0s,,1,number of events,greater than,0,25 * * * *,1,1,0,,,,Multiple Primary Functions Detected,,,,,0,1,Multiple Primary Functions Detected,0,endpoint,medium,Multiple Primary Functions Detected,System $dest$ has multiple ($function_count$) primary functions ($function$) enabled,"dest,signature",View primary functions on $dest$,"| `primary_functions_tracker`| search dest=$dest$ | table dest, dest_port, transport, function",,,1,dest,system,60,dest,86300s,false,,5,1,notable,,"[    ""Endpoint - Local Processes Tracker - Lookup Gen"",    ""Endpoint - Services Tracker - Lookup Gen"",    ""Endpoint - Listening Ports Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint"".""Processes']",['Endpoint - Prohibited Process Detection - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"| from datamodel:""Endpoint"".""Processes"" | `get_interesting_processes` | search is_prohibited=true | `get_event_id` | fields + event_id,_raw,dest,process,note",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Alerts when a service in the prohibited process list is detected.,,,,,0,1,Prohibited Process Detected,0,endpoint,medium,Prohibited Process Detected ($process$),A prohibited process ($process$) was detected.,"dest,app",View instances of $process$,"| from datamodel:""Endpoint"".""Processes"" | search process=$process|s$",,,1,dest,system,60,"dest,process",86300s,false,,,1,notable,1,"[""Endpoint - Local Processes Tracker - Lookup Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Prohibited Service Detection - Rule'],SA-EndpointProtection-default,,,True,,,,,,,,,"NOT sourcetype=stash `service` | `get_interesting_services` | search is_prohibited=true | `get_event_id` | fields + event_id,_raw,dest,service,note",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Alerts when a service in the prohibited service list is detected.,,,,,0,1,Prohibited Service Detected,0,endpoint,medium,Prohibited Service Detected ($service$),A prohibited service ($service$) was detected.,"dest,app",View instances of service $service$,"| from datamodel:""Endpoint"".""Services"" | search service=""$service$""",,,1,dest,system,60,"dest,service",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Registry Tracker - Lookup Gen'],SA-EndpointProtection-default,,,True,,,,,,,,,"sourcetype=WinRegistry | fillnull value="""" registry_value_name | stats min(_time) as firstTime,max(_time) as lastTime,values(registry_value_data) as registry_value_data by registry_path,registry_key_name,registry_value_name,dest | inputlookup append=T registry_tracker | stats min(firstTime) as firstTime,max(lastTime) as lastTime,values(registry_value_data) as registry_value_data by registry_path,registry_key_name,registry_value_name,dest | eval registry_value_name=mvfilter(registry_value_name!="""") | outputlookup override_if_empty=false registry_tracker | stats count",-70m@m,+0s,,1,,,,55 * * * *,,,,,,,"Maintains a list of registry paths, keys, and value information by system and the first and last time they were seen",,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Detect Large Outbound ICMP Packets - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count earliest(_time) as earliest latest(_time) as latest values(All_Traffic.action) values(All_Traffic.bytes) from datamodel=Network_Traffic where All_Traffic.action !=blocked All_Traffic.dest_category !=internal (All_Traffic.protocol=icmp OR All_Traffic.transport=icmp) All_Traffic.bytes > 1000 by All_Traffic.src_ip All_Traffic.dest_ip | `drop_dm_object_name(""All_Traffic"")` | search ( dest_ip!=10.0.0.0/8 AND dest_ip!=172.16.0.0/12 AND dest_ip!=192.168.0.0/16) | convert ctime(earliest) ctime(latest)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for outbound ICMP packets with a packet size larger than 1,000 bytes. Various threat actors have been known to use ICMP as a command and control channel for their attack infrastructure. Large ICMP packets from an endpoint to a remote host may be indicative of this activity.",,,,,,1,Detect Large Outbound ICMP Packets,,network,medium,Large ICMP packet from $src_ip$ to $dest_ip$ detected,Large outbound ICMP packet detected.,"src_ip, dest_ip",,,,,1,src_ip,system,50,src_ip,28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Standard Non-Application Layer Protocol""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 9"", ""CIS 12""], ""nist"": [""DE.AE""]}","This search works by looking at fields in the Network_Traffic data model, which is populated by various firewalls and passive networking monitoring technologies. Specifically, the search looks for ICMP packets larger than 1,000 bytes with a destination that is external to your organization.","In order to run this search effectively, we highly recommend that you leverage the Assets and Identity framework. It is important that you have a good understanding of how your network segments are designed and that you are able to distinguish internal from external address space. Add a category named `internal` to the CIDRs that host the company's assets in the `assets_by_cidr.csv` lookup file, which is located in `$SPLUNK_HOME/etc/apps/SA-IdentityManagement/lookups/`. More information on updating this lookup can be found here: https://docs.splunk.com/Documentation/ES/5.0.0/Admin/Addassetandidentitydata. This search also requires you to be ingesting your network traffic and populating the Network_Traffic data model","ICMP packets are used in a variety of ways to help troubleshoot networking issues and ensure the proper flow of traffic. As such, it is possible that a large ICMP packet could be perfectly legitimate. If large ICMP packets are associated with command and control traffic, there will typically be a large number of these packets observed over time. If the search is providing a large number of false positives, you can modify the search to adjust the byte threshold or whitelist specific IP addresses, as necessary.",2018-06-01,2018-06-01,medium,ESCU - Detect Large Outbound ICMP Packets - Rule,detection,Endpoint,[],"[""Bro"", ""Splunk Stream"", ""Palo Alto Firewall""]","[""Command and Control""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - AWS Network Interface details via resourceIdnESCU - Get Process InfonESCU - Get Process responsible for the DNS trafficnESCU - Get DNS Server History for a hostnESCU - Get DNS traffic rationESCU - Get All AWS Activity From IP AddressnESCU - Get Process Information For Port Activityn""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Endpoint - Index Time Delta 2 - Summary Gen'],SA-EndpointProtection-default,,,False,,,,,,,,,"| tstats prestats=true count where index=* NOT sourcetype=stash [| makeresults | `make_ts_value(""-1d@d"",start)` | `make_ts_value(""+0s"",end)` | eval search=""(_indextime>="".start."" AND _indextime<="".end."")""] by _time,_indextime,host,sourcetype span=1s | eval timeDiff=_time-_indextime | fields - psrsvd* | where timeDiff>300 | stats min(timeDiff) as min_timeDiff,max(timeDiff) as max_timeDiff,sum(timeDiff) as sum_timeDiff,count by host,sourcetype | eval _time=now()",-72h@h,+72h@h,,1,,,,0 0 * * 3,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,endpoint_summary,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Updates"".""Updates']",['Endpoint - Update Signature Reference - Lookup Gen'],SA-EndpointProtection-default,,,,,,,,,,,,"| from datamodel:""Updates"".""Updates"" | eval signature_zip=mvzip(signature,signature_id) | mvexpand signature_zip | rex field=signature_zip ""(?<signature>.*),(?<signature_id>.*)"" | stats min(_time) as firstTime,max(_time) as lastTime,latest(signature) as signature by signature_id,vendor_product | inputlookup append=T update_signature_reference_lookup | eval _time=lastTime | stats min(firstTime) as firstTime,max(lastTime) as lastTime,latest(signature) as signature by signature_id,vendor_product | outputlookup override_if_empty=false update_signature_reference_lookup | stats count",-70m@m,+0s,,1,,,,0 * * * *,,,,,,,Maintains a list of all updates by vendor and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Identity_Management"".""All_Assets']",['Asset - Asset Ownership Unspecified - Rule'],SA-IdentityManagement-default,,,1,,,,,,,,,"| from datamodel:""Identity_Management"".""All_Assets"" | where isnotnull('priority') AND len('priority')>0 AND isnotnull('category') AND len('category')>0 AND (isnull('owner') OR len('owner')==0) AND (isnull('ip') OR len('ip')==0 OR mvcount('ip')==1) | stats count | where 'count'>0 | eval const_dedup_id=""const_dedup_id""",0,+0s,,1,number of events,greater than,0,0 */12 * * *,1,1,false,,,,Alerts when there are assets that define a specific priority and category but do not have an assigned owner.,,,,,0,1,Asset Ownership Unspecified,0,identity,low,Identified $count$ Asset(s) without Ownership,$count$ asset(s) were identified as having a defined priority and category without an assigned owner. This may indicate a potential responsibility gap.,,View Affected Asset(s),"| from datamodel:""Identity_Management"".""All_Assets"" | where isnotnull('priority') AND len('priority')>0 AND isnotnull('category') AND len('category')>0 AND (isnull('owner') OR len('owner')==0) AND (isnull('ip') OR len('ip')==0 OR mvcount('ip')==1)",,,,,,,const_dedup_id,86300s,false,,20,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":	 ""Identity_Management"",         ""object"":		 ""All_Assets"",         ""earliest"":     ""0"",         ""latest"":       ""+0s"",         ""eventFilter"":  ""isnotnull('All_Assets.priority') AND len('All_Assets.priority')>0 AND isnotnull('All_Assets.category') AND len('All_Assets.category')>0 AND (isnull('All_Assets.owner') OR len('All_Assets.owner')==0) AND (isnull('All_Assets.ip') OR len('All_Assets.ip')==0 OR mvcount('All_Assets.ip')==1)"",         ""aggregates"":   [{""function"": ""count""}],         ""resultFilter"": {""field"": ""count"", ""comparator"": "">"", ""value"": ""0""}        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""const_dedup_id""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Identity_Management"".""Expired_Identity_Activity']",['Identity - Activity from Expired User Identity - Rule'],SA-IdentityManagement-default,,,True,,,,,,,,,"| from datamodel:""Identity_Management"".""Expired_Identity_Activity"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",count by ""expired_user"" | rename ""expired_user"" as ""user""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,"Alerts when an event is discovered from a user associated with identity that is now expired (that is, the end date of the identity has been passed).",,,,,0,1,Activity from Expired User Identity,0,identity,high,Activity from Expired User Identity ($user$),Activity from an expired identity was observed. This is indicative of activity from a user whose access should have been disabled.,user,View activity from $user$,"| from datamodel:""Identity_Management"".""Expired_Identity_Activity"" | search (user=""$user$"" OR src_user=""$user$"")",,,1,user,user,80,user,86300s,false,SplunkEnterpriseSecuritySuite,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":	""Identity_Management"",         ""object"":		""Expired_Identity_Activity"",         ""earliest"":    ""rt-5m@m"",         ""latest"":      ""rt+5m@m"",         ""aggregates"":  [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                         {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                         {""function"": ""count""}                        ],         ""splitby"":     [{""attribute"": ""Expired_Identity_Activity.expired_user"", ""alias"": ""user""}]        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""user""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Assets - Assets By Priority'],SA-IdentityManagement-default,,,,,,,,,,,,"| pivot Identity_Management All_Assets count(All_Assets) AS ""count"" SPLITROW priority AS ""priority"" | sort - count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Assets - Assets By Business Unit'],SA-IdentityManagement-default,,,,,,,,,,,,"| pivot Identity_Management All_Assets count(All_Assets) AS ""count"" SPLITROW bunit AS ""bunit"" | sort - count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Assets - Assets By Category'],SA-IdentityManagement-default,,,,,,,,,,,,"| pivot Identity_Management All_Assets count(All_Assets) AS ""count"" SPLITROW category AS ""category"" | sort - count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Identity_Management"".""All_Assets']",['Assets - Asset Information'],SA-IdentityManagement-default,,,,,,,,,,,,"| from datamodel:""Identity_Management"".""All_Assets"" | fields dns,nt_host,ip,mac,owner,priority,city,country,lat,long,bunit,category",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identities - Identities By Priority'],SA-IdentityManagement-default,,,,,,,,,,,,"| pivot Identity_Management All_Identities count(All_Identities) AS ""count"" SPLITROW priority AS ""priority"" | sort - count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution where'],['ESCU - Detect Long DNS TXT Record Response - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Resolution where DNS.message_type=response AND DNS.record_type=TXT by DNS.src DNS.dest DNS.answer DNS.record_type |  `drop_dm_object_name(""DNS"")` | eval anslen=len(answer) | search anslen>100 | `ctime(firstTime)` | `ctime(lastTime)` | rename src as ""Source IP"", dest as ""Destination IP"", answer as ""DNS Answer"" anslen as ""Answer Length"" record_type as ""DNS Record Type"" firstTime as ""First Time"" lastTime as ""Last Time"" count as Count | table ""Source IP"" ""Destination IP"" ""DNS Answer"" ""DNS Record Type""  ""Answer Length"" Count ""First Time"" ""Last Time""",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search is used to detect attempts to use DNS tunneling, by calculating the length of responses to DNS TXT queries. Endpoints using DNS as a method of transmission for data exfiltration, command and control, or evasion of security controls can often be detected by noting unusually large volumes of DNS traffic.",,,,,,1,Detect Long DNS TXT Record Response,,network,medium,Long DNS TXT Record Response,A DNS TXT record response of over 100 characters was detected.,"src, query",,,,,1,src,system,70,src,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Command and Control"", ""Exfiltration"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control""], ""cis20"": [""CIS 8"", ""CIS 12"", ""CIS 13""], ""nist"": [""PR.DS"", ""PR.PT"", ""DE.AE"", ""DE.CM""]}",This search uses the Network_Resolution data model and gathers all the answers to DNS queries for TXT records. The query then looks at the answer section and calculates the length of the answer. The search will then return information for those responses that exceed 100 characters in length.,"To successfully implement this search you need to ingest data from your DNS logs, or monitor DNS traffic using Stream, Bro or something similar. Specifically, this query requires that the DNS data model is populated with information regarding the DNS record type that is being returned as well as the data in the answer section of the protocol.",It's possible that legitimate TXT record responses can be long enough to trigger this search. You can modify the packet threshold for this search to help mitigate false positives.,2017-06-18,2017-09-18,medium,ESCU - Detect Long DNS TXT Record Response - Rule,detection,Endpoint,[],"[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""Suspicious DNS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get DNS Server History for a hostnESCU - Get DNS traffic rationESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identities - Identities By Business Unit'],SA-IdentityManagement-default,,,,,,,,,,,,"| pivot Identity_Management All_Identities count(All_Identities) AS ""count"" SPLITROW bunit AS ""bunit"" | sort - count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identities - Identities By Category'],SA-IdentityManagement-default,,,,,,,,,,,,"| pivot Identity_Management All_Identities count(All_Identities) AS ""count"" SPLITROW category AS ""category"" | sort - count",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,pie,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Identity_Management"".""All_Identities']",['Identities - Identity Information'],SA-IdentityManagement-default,,,,,,,,,,,,"| from datamodel:""Identity_Management"".""All_Identities"" | `uitime(startDate)` | `uitime(endDate)` | fields identity,prefix,nick,first,last,suffix,email,phone,phone2,managedBy,priority,bunit,category,watchlist,startDate,endDate",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Sessions.All_Sessions'],['Sessions - Network Sessions Over Time'],SA-IdentityManagement-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Sessions.All_Sessions by _time,nodename span=10m | search nodename!=All_Sessions nodename!=All_Sessions.Session_* | rex field=nodename ""All_Sessions.(?<session_type>.*)"" | timechart minspan=10m sum(count) as count by session_type",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Sessions"".""All_Sessions']",['Sessions - Network Session Details'],SA-IdentityManagement-default,,,,,,,,,,,,"| from datamodel:""Network_Sessions"".""All_Sessions"" | rename dest_ip as ip, dest_mac as mac, dest_nt_host as nt_host, dest_dns as dns | `mvappend_field(src,src_ip)` | `mvappend_field(src,src_mac)` | `mvappend_field(src,src_nt_host)` | `mvappend_field(src,src_dns)` | head 1000 | table _time,src,ip,mac,nt_host,dns,user",-24h@h,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Email.All_Email'],['Identity - Email Activity to Non-corporate Domains by Users Per 1d - Context Gen'],SA-IdentityManagement-default,,,true,,,,,,,,,"| tstats `summariesonly` sum(All_Email.size) as bytes, values(All_Email.recipient) as recipient from datamodel=Email.All_Email  where NOT `cim_corporate_email_domain_search(""All_Email.recipient"")` by _time, All_Email.src_user, All_Email.src_user_bunit span=1h | `drop_dm_object_name(""All_Email"")` | stats avg(bytes) as avg, stdev(bytes) as stdev, count by src_user_bunit | eval min=0 | eval max=avg + 3*stdev | xsUpdateDDContext name=""email_volume_1h_noncorp"" class=src_user_bunit scope=app terms=`xs_default_magnitude_concepts` uom=""email_volume_bytes"" type=domain app=SA-IdentityManagement | stats count",-25h@h,-1h@h,,1,,,,0 0 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Identity - Web Uploads to Non-corporate Domains by Users Per 1d - Context Gen'],SA-IdentityManagement-default,,,true,,,,,,,,,"| tstats `summariesonly` sum(Web.bytes) as bytes from datamodel=Web.Web where NOT(`cim_corporate_web_domain_search(""Web.url"")`) (Web.http_method=""POST"" OR Web.http_method=""PUT"") by _time, Web.user, Web.user_bunit span=1h | `drop_dm_object_name(""Web"")`| stats avg(bytes) as avg, stdev(bytes) as stdev, count by user_bunit | eval min=0 | eval max=avg + 3*stdev |  xsUpdateDDContext name=""web_volume_1h_noncorp"" class=user_bunit scope=app terms=`xs_default_magnitude_concepts` uom=""web_volume_bytes"" type=domain app=SA-IdentityManagement | stats count",-25h@h,-1h@h,,1,,,,0 1 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identity - Asset String Matches - Lookup Gen'],SA-IdentityManagement-default,,,,,,,,,,,,| `asset_sources` | `make_assets_str` | outputlookup output_format=splunk_mv_csv asset_lookup_by_str | stats count,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identity - Asset CIDR Matches - Lookup Gen'],SA-IdentityManagement-default,,,,,,,,,,,,| `asset_sources` | `make_assets_cidr` | outputlookup output_format=splunk_mv_csv asset_lookup_by_cidr | stats count,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identity - Identity Matches - Lookup Gen'],SA-IdentityManagement-default,,,,,,,,,,,,"| `identity_sources` | `make_identities` | eval `iden_mktime_meval(startDate)`,`iden_mktime_meval(endDate)`,identity=mvsort(identity) | sort 0 +identity | outputlookup output_format=splunk_mv_csv identity_lookup_expanded | stats count",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Mimikatz Via PowerShell And EventCode 4663 - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"eventtype = wineventlog_security signature_id=4663 Process_Name=*powershell.exe Object_Name=*lsass.exe Access_Mask=0x10 | stats count min(_time) as firstTime max(_time) as lastTime by dest, Process_Name, Process_ID, Message | rename Process_Name as process | `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for PowerShell reading lsass memory consistent with credential dumping.,,,,,,1,Detect Mimikatz Via PowerShell And EventCode 4663,,access,medium,Event ID 4663 Specifying PowerShell Reading From LSASS.exe Identified on $dest$.,Possible attempt at credential dumping via PowerShell was detected on $dest$ by $user$.,"user, dest",,,,,1,dest,system,40,"user, dest, process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Credential Dumping""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 16""], ""nist"": [""PR.IP"", ""PR.AC"", ""DE.CM""]}","This search looks for Windows Event Code(signature_id) 4663 (object access), where the process performing the access is PowerShell.exe, the target process of the access is lsass.exe, and the access mask is given as 0x10. This is consistent with the use of PowerShell to execute Mimikatz using sekurlsa::logonpasswords. It will return the host where the activity occurred, the process and associated id, the enabled privilege, and the message in the event.","You must be ingesting Windows Security logs. You must also enable the account change auditing here: http://docs.splunk.com/Documentation/Splunk/7.0.2/Data/MonitorWindowseventlogdata. Additionally, this search requires you to enable your Group Management Audit Logs in your Local Windows Security Policy and to be ingesting those logs.  More information on how to enable them can be found here: http://whatevernetworks.com/auditing-group-membership-changes-in-active-directory/. Finally, please make sure that the local administrator group name is ""Administrators"" to be able to look for the right group membership changes.","The activity may be legitimate. PowerShell is often used by administrators to perform various tasks, and it's possible this event could be generated in those cases. In these cases, false positives should be fairly obvious and you may need to tweak the search to eliminate noise.",2018-08-28,2019-02-28,medium,ESCU - Detect Mimikatz Via PowerShell And EventCode 4663 - Rule,detection,Windows,[],"[""Microsoft Windows""]","[""Credential Dumping""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identity - Make Categories - Lookup Gen'],SA-IdentityManagement-default,,,,,,,,,,,,"| from inputlookup:category_lookup | fillnull value=""static"" category_source | inputlookup append=t asset_lookup_by_str | inputlookup append=t asset_lookup_by_cidr | fillnull value=""asset"" category_source | inputlookup append=t identity_lookup_expanded | fillnull value=""identity"" category_source | stats count by category, category_source | sort category, category_source | fields category category_source | outputlookup category_lookup | stats count",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Identity - Make PCI Domains - Lookup Gen'],SA-IdentityManagement-default,,,,,,,,,,,,"| from inputlookup:pci_domains_lookup | fillnull value=""static"" pci_domain_source | inputlookup append=t asset_lookup_by_str | inputlookup append=t asset_lookup_by_cidr | fillnull value=""asset"" pci_domain_source | stats count by pci_domain, pci_domain_source | sort pci_domain, pci_domain_source | fields pci_domain pci_domain_source | outputlookup pci_domains_lookup | stats count",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Change"".""Network_Changes']",['Network - Policy Or Configuration Change - Rule'],SA-NetworkProtection-default,,,True,,,,,,,,,"| from datamodel:""Change"".""Network_Changes"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",count by ""dvc"",""action"",""command""",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects changes to policies of the network protection devices (such as firewall policy changes).,,,,,0,1,Network Change Detected,0,network,medium,Network Change Detected On $dvc$,A configuration or policy change has been made to $dvc$.  Please verify that this is an authorized change.,dvc,View configuration or policy changes on device $dvc$,"| from datamodel:""Change"".""Network_Changes"" | search dvc=""$dvc$"" command=""$command$""",,,1,dvc,system,60,"dvc,command",86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Change"",         ""object"":        ""Network_Changes"",         ""earliest"":      ""rt-5m@m"",         ""latest"":        ""rt+5m@m"",         ""aggregates"":    [{""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""},                           {""function"": ""latest"", ""attribute"": ""_raw"", ""alias"": ""orig_raw""},                           {""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""All_Changes.dvc"", ""alias"": ""dvc""},                           {""attribute"": ""All_Changes.action"", ""alias"": ""action""},                           {""attribute"": ""All_Changes.command"", ""alias"": ""command""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dvc"",""command""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Certificates.All_Certificates'],['Network - Certificate Tracker - Lookup Gen'],SA-NetworkProtection-default,,,True,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true min(_time) as firstTime,max(_time) as lastTime from datamodel=Certificates.All_Certificates where nodename=All_Certificates.SSL by All_Certificates.SSL.ssl_serial,All_Certificates.SSL.ssl_hash,All_Certificates.SSL.ssl_subject,All_Certificates.SSL.ssl_issuer | rename All_Certificates.SSL.ssl* as certificate* | inputlookup append=T certificate_tracker | stats min(firstTime),max(lastTime) by certificate_serial,certificate_hash,certificate_subject,certificate_issuer | rename certificate* as ssl* | extract cim_ssl_issuer_common_name,cim_ssl_issuer_email,cim_ssl_issuer_unit,cim_ssl_subject_common_name,cim_ssl_subject_email,cim_ssl_subject_unit | rename ssl* as certificate* | outputlookup override_if_empty=false certificate_tracker | stats count",-70m@m,+0s,,1,,,,50 * * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Port Activity By Destination Port - Context Gen'],SA-NetworkProtection-default,,,true,,,,,,,,,"| tstats `summariesonly` count as dest_port_traffic_count from datamodel=Network_Traffic.All_Traffic by All_Traffic.dest_port,_time span=1d | `drop_dm_object_name(""All_Traffic"")` | `context_stats(dest_port_traffic_count, dest_port)` | search size>0 | xscreateddcontext name=count_by_dest_port_1d class=dest_port container=network_traffic type=median_centered terms=""minimal,low,medium,high,extreme"" width=3 scope=app app=SA-NetworkProtection | stats count",-30d@d,-1d@d,,1,,,,0 3 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Traffic Source Count Per 30m - Context Gen'],SA-NetworkProtection-default,,,true,,,,,,,,,"| tstats `summariesonly` dc(All_Traffic.src) as src_count from datamodel=Network_Traffic.All_Traffic by _time span=30m | stats count, median(src_count) as median, stdev(src_count) as size | search size>0 | xsupdateddcontext name=src_count_30m container=network_traffic terms=""minimal,low,medium,high,extreme"" type=median_centered width=3 app=SA-NetworkProtection scope=app | stats count",-90m@m,-30m@m,,1,,,,35 * * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Traffic Volume Per 30m - Context Gen'],SA-NetworkProtection-default,,,true,,,,,,,,,"| tstats `summariesonly` count as total_count from datamodel=Network_Traffic.All_Traffic by _time span=30m | stats count, median(total_count) as median, stdev(total_count) as size | search size>0 | xsupdateddcontext name=count_30m container=network_traffic terms=""minimal,low,medium,high,extreme"" type=median_centered width=3 app=SA-NetworkProtection scope=app | stats count",-90m@m,-30m@m,,1,,,,45 * * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web.Web'],['Web - Web Event Count By Src By HTTP Method Per 1d - Context Gen'],SA-NetworkProtection-default,,,False,,,,,,,,,"| tstats `summariesonly` count as web_event_count from datamodel=Web.Web by Web.src, Web.http_method, _time span=24h | `drop_dm_object_name(""Web"")` | where match(http_method, ""^[A-Za-z]+$"") | `context_stats(web_event_count, http_method)` | eval min=0 | eval max=median*2 | xscreateddcontext name=count_by_http_method_by_src_1d container=web class=http_method app=""SA-NetworkProtection"" scope=app type=domain terms=`xs_default_magnitude_concepts` | stats count",-31d@d,-1d@d,,1,,,,0 0 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Communication Rule Tracker - Lookup Gen'],SA-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Traffic.All_Traffic where All_Traffic.rule!=unknown by _time,All_Traffic.dvc,All_Traffic.rule,All_Traffic.vendor_product span=1d | `drop_dm_object_name(""All_Traffic"")` | convert timeformat=""%m"" ctime(_time) as month | convert timeformat=""%Y"" ctime(_time) as year | stats sum(count) as count by month,year,dvc,rule,vendor_product | inputlookup append=T communication_rule_tracker | stats sum(count) as count by month,year,dvc,rule,vendor_product | eval date=month.""-01-"".year | convert timeformat=""%m-%d-%Y"" mktime(date) as _time | `daysago(396)` | fields - _time,date,dayDiff | outputlookup override_if_empty=false communication_rule_tracker | stats count",-70m@m,+0s,,1,,,,45 * * * *,,,,,,,Maintains a list of Traffic rule values by device and vendor and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Traffic"".""All_Traffic']",['Network - Port And Protocol Tracker - Lookup Gen'],SA-NetworkProtection-default,,,,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true min(_time) as ""firstTime"",max(_time) as ""lastTime"" from datamodel=""Network_Traffic"".""All_Traffic"" where    ""All_Traffic.action""!=""allowed"" by ""All_Traffic.transport"",""All_Traffic.dest_port""  | rename ""All_Traffic.transport"" as ""transport"",""All_Traffic.dest_port"" as ""dest_port"" | inputlookup append=T ""port_protocol_tracker"" | stats min(firstTime) as ""firstTime"",max(lastTime) as ""lastTime"" by ""transport"",""dest_port"" | where strptime('lastTime', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""port_protocol_tracker"" | stats count",-70m@m,+0s,,1,,,,50 * * * *,,,,,,,Maintains a list of allowed Traffic by unique transport protocol and destination port combination and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",    ""search"":       {	    ""datamodel"":     ""Network_Traffic"",	    ""object"":        ""All_Traffic"",        ""earliest"":      ""-70m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   ""'All_Traffic.action'!=""allowed"""",		""aggregates"":    [{""function"": ""min"", ""attribute"": ""_time"", ""alias"": ""firstTime""},	                      {""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""}	                     ],	    ""splitby"":       [	                      {""attribute"": ""All_Traffic.transport"", ""alias"": ""transport""},	                      {""attribute"": ""All_Traffic.dest_port"", ""alias"": ""dest_port""}	                     ],        ""summariesonly"": ""1"",        ""outputlookup"":  ""port_protocol_tracker"",        ""retention"":     {            ""earliestTime"":  ""-5y"",            ""timeField"":     ""lastTime"",            ""timeFormat"":    ""%s""        }    }}",,,,,,,,0,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Mimikatz Via PowerShell And EventCode 4703 - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"eventtype=wineventlog_security signature_id=4703 Process_Name=*powershell.exe | rex field=Message ""Enabled Privileges:s+(?<privs>w+)s+Disabled Privileges:"" | where privs=""SeDebugPrivilege"" | stats count min(_time) as firstTime max(_time) as lastTime by dest, Process_Name, privs, Process_ID, Message | rename privs as ""Enabled Privilege"" | rename Process_Name as process |  `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for PowerShell requesting privileges consistent with credential dumping.,,,,,,1,Detect Mimikatz Via PowerShell And EventCode 4703,,access,medium,Event Code 4703 Specifying PowerShell Acquiring A Token with SeDebugPrivilege Identified on $dest$.,Possible attempt at credential dumping via PowerShell was detected on $dest$ by $user$.,"user, dest",,,,,1,dest,system,40,"user, dest, process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Credential Dumping""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 3"", ""CIS 5"", ""CIS 16""], ""nist"": [""PR.IP"", ""PR.AC"", ""DE.CM""]}","This search looks for Windows Event Code(signature_id) 4703 (token right adjusted), where the process requesting the token change is PowerShell.exe and the requested privilege is ""SeDebugPrivilege"". This is consistent with the use of PowerShell to execute Mimikatz using sekurlsa::logonpasswords. It will return the host where the activity occurred, the process and associated id, the enabled privilege, and the message in the event.","You must be ingesting Windows Security logs. You must also enable the account change auditing here: http://docs.splunk.com/Documentation/Splunk/7.0.2/Data/MonitorWindowseventlogdata. Additionally, this search requires you to enable your Group Management Audit Logs in your Local Windows Security Policy and to be ingesting those logs.  More information on how to enable them can be found here: http://whatevernetworks.com/auditing-group-membership-changes-in-active-directory/. Finally, please make sure that the local administrator group name is ""Administrators"" to be able to look for the right group membership changes.","The activity may be legitimate. PowerShell is often used by administrators to perform various tasks, and it's possible this event could be generated in those cases. In these cases, false positives should be fairly obvious and you may need to tweak the search to eliminate noise.",2018-08-28,2019-02-27,medium,ESCU - Detect Mimikatz Via PowerShell And EventCode 4703 - Rule,detection,Windows,[],"[""Microsoft Windows""]","[""Credential Dumping""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['Network - Event Count By Signature Per Hour - Context Gen'],SA-NetworkProtection-default,,,true,,,,,,,,,"| tstats `summariesonly` count as count_by_signature_1h from datamodel=Intrusion_Detection.IDS_Attacks by _time,IDS_Attacks.signature span=1h | `drop_dm_object_name(""IDS_Attacks"")` | `context_stats(count_by_signature_1h, signature)` | search size>0 | xsCreateDDContext name=count_by_signature_1h class=signature container=ids_attacks type=median_centered terms=""minimal,low,medium,high,extreme"" scope=app app=SA-NetworkProtection | stats count",-61d@d,-1d@d,,1,,,,0 3 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Intrusion_Detection.IDS_Attacks'],['Network - Substantial Increase in an Event - Rule'],SA-NetworkProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` count,values(IDS_Attacks.tag) as tag from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.signature | `drop_dm_object_name(""IDS_Attacks"")` | xswhere count from count_by_signature_1h in ids_attacks by signature is above medium",-70m@m,+0s,,1,number of events,greater than,0,15 * * * *,1,1,false,,,,Alerts when a statistically significant increase in a particular intrusion event is observed.,,,,,0,1,Substantial Increase In Intrusion Events,0,network,high,Substantial Increase In $signature$ Events,A statistically significant increase in the volume of $signature$ events was noted. Today's value is $count$.,signature,View all $signature$ events,"| from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | search signature=""$signature$""",,,1,signature,other,80,signature,86300s,false,,5,1,notable,,"[""Network - Event Count By Signature Per Hour - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Intrusion_Detection"".""IDS_Attacks']",['Network - IDS Attack Tracker - Lookup Gen'],SA-NetworkProtection-default,,,,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true min(_time) as ""firstTime"",max(_time) as ""lastTime"" from datamodel=""Intrusion_Detection"".""IDS_Attacks""  by ""IDS_Attacks.ids_type"",""IDS_Attacks.signature"",""IDS_Attacks.vendor_product""  | rename ""IDS_Attacks.ids_type"" as ""ids_type"",""IDS_Attacks.signature"" as ""signature"",""IDS_Attacks.vendor_product"" as ""vendor_product"" | inputlookup append=T ""ids_attack_tracker"" | stats min(firstTime) as ""firstTime"",max(lastTime) as ""lastTime"" by ""ids_type"",""signature"",""vendor_product"" | where strptime('lastTime', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""ids_attack_tracker"" | stats count",-70m@m,+0s,,1,,,,25 * * * *,,,,,,,Maintains a list of IDS attacks by vendor and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",    ""search"":       {	    ""datamodel"":     ""Intrusion_Detection"",	    ""object"":        ""IDS_Attacks"",        ""earliest"":      ""-70m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   """",		""aggregates"":    [{""function"": ""min"", ""attribute"": ""_time"", ""alias"": ""firstTime""},	                      {""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""}	                     ],	    ""splitby"":       [	                      {""attribute"": ""IDS_Attacks.ids_type"", ""alias"": ""ids_type""},	                      {""attribute"": ""IDS_Attacks.signature"", ""alias"": ""signature""},	                      {""attribute"": ""IDS_Attacks.vendor_product"", ""alias"": ""vendor_product""}	                     ],        ""summariesonly"": ""1"",        ""outputlookup"":  ""ids_attack_tracker"",        ""retention"":     {            ""earliestTime"":  ""-5y"",            ""timeField"":     ""lastTime"",            ""timeFormat"":    ""%s""        }    }}",,,,,,,,0,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Intrusion_Detection"".""IDS_Attacks']",['Network - IDS Category Tracker - Lookup Gen'],SA-NetworkProtection-default,,,,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true min(_time) as ""firstTime"",max(_time) as ""lastTime"" from datamodel=""Intrusion_Detection"".""IDS_Attacks"" where    ""IDS_Attacks.category""!=""unknown"" by ""IDS_Attacks.category"",""IDS_Attacks.vendor_product""  | rename ""IDS_Attacks.category"" as ""category"",""IDS_Attacks.vendor_product"" as ""vendor_product"" | inputlookup append=T ""ids_category_tracker"" | stats min(firstTime) as ""firstTime"",max(lastTime) as ""lastTime"" by ""category"",""vendor_product"" | where strptime('lastTime', ""%s"")>=relative_time(now(), ""-5y"") | outputlookup override_if_empty=false ""ids_category_tracker"" | stats count",-30m@m,+0s,,1,,,,"10,25,40,55 * * * *",,,,,,,Maintains a list of IDS attack categories by vendor and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":      ""1.0"",    ""search"":       {	    ""datamodel"":     ""Intrusion_Detection"",	    ""object"":        ""IDS_Attacks"",        ""earliest"":      ""-30m@m"",        ""latest"":        ""+0s"",        ""eventFilter"":   ""'IDS_Attacks.category'!=""unknown"""",		""aggregates"":    [{""function"": ""min"", ""attribute"": ""_time"", ""alias"": ""firstTime""},	                      {""function"": ""max"", ""attribute"": ""_time"", ""alias"": ""lastTime""}	                     ],	    ""splitby"":       [	                      {""attribute"": ""IDS_Attacks.category"", ""alias"": ""category""},	                      {""attribute"": ""IDS_Attacks.vendor_product"", ""alias"": ""vendor_product""}	                     ],        ""summariesonly"": ""1"",        ""outputlookup"":  ""ids_category_tracker"",        ""retention"":     {            ""earliestTime"": ""-5y"",            ""timeField"":    ""lastTime"",            ""timeFormat"":   ""%s""        }    }}",,,,,,,,0,1,make_lookup_generating_search:makeLookupGeneratingSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Change"".""All_Changes']",['Network - Network Device Rebooted - Rule'],SA-NetworkProtection-default,,,1,,,,,,,,,"| tstats summariesonly=true allow_old_summaries=true count from datamodel=""Change"".""All_Changes"" where   nodename=""All_Changes.Network_Changes.Device_Restarts""  by ""All_Changes.dvc"",""_time"" span=""1s"" | rename ""All_Changes.dvc"" as ""dvc""",-70m@m,+0s,,1,number of events,greater than,0,20 * * * *,1,1,0,,,,Increases the risk score of network devices that have been rebooted.,,,,,0,1,Network Device Rebooted,0,,,Network Device Rebooted,,,,,,,1,dvc,system,20,"dvc, orig_time",86300s,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Change"",         ""object"":        ""Device_Restarts"",         ""earliest"":      ""-70m@m"",         ""latest"":        ""+0s"",         ""aggregates"":    [{""function"": ""count""}                          ],         ""splitby"":       [                           {""attribute"": ""All_Changes.dvc"", ""alias"": ""dvc""},                           {""attribute"": ""_time"", ""span"": ""1s""}                          ],         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""dvc"", ""orig_time""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic.All_Traffic'],['Network - Substantial Increase in Port Activity (By Destination) - Rule'],SA-NetworkProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` count,values(All_Traffic.tag) as tag from datamodel=Network_Traffic.All_Traffic by All_Traffic.dest_port | `drop_dm_object_name(""All_Traffic"")` | xswhere count from count_by_dest_port_1d in network_traffic by dest_port is extreme",-1450m@m,+0s,,1,number of events,greater than,0,15 * * * *,1,1,false,,,,Alerts when a statistically significant increase in events on a given port is observed.,,,,,0,1,Substantial Increase In Port Activity,0,network,high,Substantial Increase In Port Activity ($dest_port$),A statistically significant increase in the volume of activity on port $dest_port$ was noted. Today's value is $count$.,dest_port,View all port activity for $dest_port$,"| from datamodel:""Network_Traffic"".""All_Traffic"" | search dest_port=$dest_port$",,,1,dest_port,other,80,dest_port,86300s,false,,5,1,notable,,"[""Network - Port Activity By Destination Port - Context Gen""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Intrusion_Detection"".""IDS_Attacks']",['Network - Vulnerability Scanner Detection (by event) - Rule'],SA-NetworkProtection-default,,,True,,,,,,,,,"| from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | stats values(tag) as ""tag"",dc(signature) as ""count"" by ""src"" | where 'count'>25",rt-65m@m,rt-5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects a potential vulnerability scanner by detecting devices that have triggered a large number of unique events. Vulnerability scanners generally trigger a high number unique events when scanning a host since each vulnerability check tends to trigger a unique event.,,,,,0,1,Vulnerability Scanner Detected (by events),0,network,high,Vulnerability Scanner Detected ($src$),A potential vulnerability scanner was detected. $src$ has generated $count$ events in the last hour. This may be indicative of a vulnerability scanner since vulnerability scanners generally trigger a large volume of unique events.,src,View all attack events from device $src$,"| from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | search src=""$src$""",,,1,src,system,80,src,86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Intrusion_Detection"",         ""object"":        ""IDS_Attacks"",         ""earliest"":      ""rt-65m@m"",         ""latest"":        ""rt-5m@m"",         ""aggregates"":    [{""function"": ""values"", ""attribute"": ""IDS_Attacks.tag"", ""alias"": ""tag""},                           {""function"": ""dc"", ""attribute"": ""IDS_Attacks.signature"", ""alias"": ""count""}                          ],         ""splitby"":       [{""attribute"": ""IDS_Attacks.src"", ""alias"": ""src""}],         ""resultFilter"":  {""field"": ""count"", ""comparator"": "">"", ""value"": ""25""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""src""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Intrusion_Detection"".""IDS_Attacks']",['Network - Vulnerability Scanner Detection (by targets) - Rule'],SA-NetworkProtection-default,,,True,,,,,,,,,"| from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | stats values(tag) as ""tag"",dc(dest) as ""count"" by ""src"" | where 'count'>25",rt-65m@m,rt-5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,Detects a potential vulnerability scanner by detecting devices that have triggered events against a large number of unique targets. Vulnerability scanners generally trigger events against a high number of unique hosts when they are scanning a network for vulnerable hosts.,,,,,0,1,Vulnerability Scanner Detected (by targets),0,network,high,Vulnerability Scanner Detected ($src$),A potential vulnerability scanner was detected. $src$ has generated events against $count$ targets in the last hour. This may be indicative of a vulnerability scanner since vulnerability scanners generally trigger events against a high number of unique targets.,src,View all attack events from device $src$,"| from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | search src=""$src$""",,,1,src,system,80,src,86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"{    ""version"":  ""1.0"",    ""searches"": [        {""datamodel"":     ""Intrusion_Detection"",         ""object"":        ""IDS_Attacks"",         ""earliest"":      ""rt-65m@m"",         ""latest"":        ""rt-5m@m"",         ""aggregates"":    [{""function"": ""values"", ""attribute"": ""IDS_Attacks.tag"", ""alias"": ""tag""},                           {""function"": ""dc"", ""attribute"": ""IDS_Attacks.dest"", ""alias"": ""count""}                          ],         ""splitby"":       [{""attribute"": ""IDS_Attacks.src"", ""alias"": ""src""}],         ""resultFilter"":  {""field"": ""count"", ""comparator"": "">"", ""value"": ""25""},         ""summariesonly"": ""1""        }    ],    ""alert.suppress"":        ""1"",    ""alert.suppress.fields"": [""src""]}",,,,,,,,0,1,make_correlation_search:makeCorrelationSearch,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Vulnerabilities.Vulnerabilities'],['Network - Vulnerability Signature Reference - Lookup Gen'],SA-NetworkProtection-default,,,,,,,,,,,,"| tstats `summariesonly` min(_time) as firstTime,max(_time) as lastTime,values(Vulnerabilities.bugtraq) as bugtraq,values(Vulnerabilities.cert) as cert,values(Vulnerabilities.cve) as cve,values(Vulnerabilities.msft) as msft,values(Vulnerabilities.mskb) as mskb,values(Vulnerabilities.xref) as xref from datamodel=Vulnerabilities.Vulnerabilities by Vulnerabilities.signature,Vulnerabilities.vendor_product | `drop_dm_object_name(""Vulnerabilities"")` | inputlookup append=T vuln_signature_reference | `makemv(bugtraq)` | `makemv(cert)` | `makemv(cve)` | `makemv(msft)` | `makemv(mskb)` | `makemv(xref)` | stats min(firstTime) as firstTime,max(lastTime) as lastTime,values(cve) as cve,values(bugtraq) as bugtraq,values(cert) as cert,values(msft) as msft,values(mskb) as mskb,values(xref) as xref by signature,vendor_product | `makesv(bugtraq)` | `makesv(cert)` | `makesv(cve)` | `makesv(msft)` | `makesv(mskb)` | `makesv(xref)` | outputlookup override_if_empty=false vuln_signature_reference | stats count",-70m@m,+0s,,1,,,,20 * * * *,,,,,,,Maintains a list of vulnerability signatures by vendor (including external reference information such as cve) and the first and last time they were seen,,,,,,,,0,,,,,,,,,,,,,,,,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Incident Review - Main'],SA-ThreatIntelligence-default,,,,,,,,,,,,"$time_filter$ (`get_notable_index` OR `get_sequenced_index`) $source_filter$ | eval `get_event_id_meval`,rule_id=event_id | search $event_id_filter$ | fields - host_* | tags outputfield=tag | `mvappend_field(tag,orig_tag)` | dedup rule_id | `notable_xref_lookup` | `get_correlations` | search $security_domain_filter$ | `get_current_status` | search $status_filter$ | `get_owner` | search $owner_filter$ | `get_urgency` | search $urgency_filter$ | typer | tags outputfield=tag | `mvappend_field(tag,orig_tag)` | search $tag_filter$ | `suppression_extract` | search NOT suppression=* | `risk_correlation`",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect New Local Admin account - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,eventtype = wineventlog_security signature_id=4720 OR (signature_id=4732 Group_Name= Administrators) | transaction Security_ID maxspan=180m | search signature_id=4720 signature_id=4732 | table _time user dest signature_id Security_ID Group_Name src_user Message,-1440m@m,-10m@m,,1,number of events,greater than,0,0 9 * * *,1,1,,,,,This search looks for newly created accounts that have been elevated to local administrators.,,,,,,1,Detect New Local Admin account,,access,medium,New local admin account $user$ created by $src_user$.,The new user account $user$ was created on $dest$ by $src_user$.,"user,src_user, dest",,,,,1,user,system,40,user,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Valid Accounts"", ""Defense Evasion"", ""Persistence""], ""kill_chain_phases"": [""Actions on Objectives"", ""Command and Control""], ""cis20"": [""CIS 16""], ""nist"": [""PR.AC"", ""DE.CM""]}","This search looks for Windows Event Code 4720 (account creation) and 4732 (account added to a security-enabled local group), where the group name is ""Administrators"", and determines whether they are generated for the same user's Security ID within three hours of each other.  It will return the user account that was added, the Security ID, the group name to which the user was added, the account name of the user who initiated the action, and the subsequent message returned.","You must be ingesting Windows Security logs. You must also enable the account change auditing here:http://docs.splunk.com/Documentation/Splunk/7.0.2/Data/MonitorWindowseventlogdata. Additionally, this search requires you to enable your Group Management Audit Logs in your Local Windows Security Policy and to be ingesting those logs.  More information on how to enable them can be found here: http://whatevernetworks.com/auditing-group-membership-changes-in-active-directory/. Finally, please make sure that the local administrator group name is ""Administrators"" to be able to look for the right group membership changes.","The activity may be legitimate. For this reason, it's best to verify the account with an administrator and ask whether there was a valid service request for the account creation. If your local administrator group name is not ""Administrators"", this search may generate an excessive number of false positives",2018-03-26,2019-02-28,medium,ESCU - Detect New Local Admin account - Rule,detection,Windows,[],"[""Microsoft Windows""]","[""DHS Report TA18-074A""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threats - Disable Suppressions - Administrative'],SA-ThreatIntelligence-default,,,,,,,,,,,,| rest splunk_server=local count=0 /services/alerts/suppressions/-/_autodisable,0,+0s,,1,,,,0 3 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Refresh Governance - Administrative'],SA-ThreatIntelligence-default,,,,,,,,,,,,| rest splunk_server=local count=0 /services/alerts/governance/_reload,0,+0s,,1,,,,0 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Refresh Reviewstatuses - Administrative'],SA-ThreatIntelligence-default,,,,,,,,,,,,| rest splunk_server=local count=0 /services/alerts/reviewstatuses/_reload,0,+0s,,1,,,,0 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Median Object Risk Per Day - Context Gen'],SA-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as object_risk from datamodel=Risk.All_Risk by _time,All_Risk.risk_object,All_Risk.risk_object_type span=1d | `drop_dm_object_name(""All_Risk"")` | `context_stats(object_risk, risk_object_type)` | eval min=0 | eval max=median*2 | xsUpdateDDContext app=SA-ThreatIntelligence name=median_object_risk_by_object_type_1d container=risk class=risk_object_type type=domain scope=app | stats count",-30d@d,@d,,1,,,,0 0 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Total Risk By Risk Object Type Per Day - Context Gen'],SA-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk by _time,All_Risk.risk_object_type span=1d | `drop_dm_object_name(""All_Risk"")` | `context_stats(accum_risk, risk_object_type)` | eval min=0 | eval max=median*2 | xsUpdateDDContext app=SA-ThreatIntelligence name=total_risk_by_object_type_1d container=risk class=risk_object_type type=domain scope=app | stats count",-30d@d,@d,,1,,,,0 1 * * *,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,20,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Manual Notable Event - Rule'],SA-ThreatIntelligence-default,,,False,,,,,,,,,| noop,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Untriaged Notable Events - Rule'],SA-ThreatIntelligence-default,,,True,,,,,,,,,"`notable` | search (status_group=""New"" OR owner=""unassigned"") | table _time,rule_id,rule_name,status_label,owner | rename * as orig_*",-48h@h,-4h@h,,1,number of events,greater than,0,35 * * * *,1,1,false,,,,Alerts when notable events have not been triaged,,,,,0,1,Untriaged Notable Events,0,,,Untriaged Notable Events,,,,,,,,,,,orig_rule_id,86300s,false,,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Same Error On Many Systems - Rule'],SA-ThreatIntelligence-default,,,True,,,,,,,,,"tag=error NOT tag=authentication | stats first(_raw) as orig_raw,dc(host) as system_count by sourcetype,punct | where 'system_count'>100",-65m@m,+0s,,1,number of events,greater than,0,40 * * * *,1,1,false,,,,Alerts when multiple systems are exhibiting the same errors,,,,,0,1,Same Error On Many Servers Detected,0,threat,medium,Same Error On Many Servers Detected,"$orig_sourcetype$ errors were discovered on $system_count$ different systems.  Errors are determined to be ""like"" based on the Splunk punctuation field (punct).",orig_sourcetype,View all $orig_sourcetype$ errors,"tag=error NOT tag=authentication sourcetype=""$orig_sourcetype$""",,,,,,,sourcetype,86300s,false,,5,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Watchlisted Events - Rule'],SA-ThreatIntelligence-default,,,True,,,,,,,,,"tag=watchlist NOT sourcetype=stash | eval risk_object=case(isnotnull(user),user,isnotnull(src_user),src_user,isnotnull(dest),dest,isnotnull(src),src,1=1,host) | eval risk_object_type=case(isnotnull(user),""user"",isnotnull(src_user),""user"",isnotnull(dest),""system"",isnotnull(src),""system"",1=1,""system"") | eval risk_score=if(eventtype=""website_watchlist"",50,null()) | eval suppression_value=sourcetype.""|"".risk_object  | `get_event_id` | table _raw,event_id,host,source,sourcetype,src,dest,dvc,src_user,user",rt-5m@m,rt+5m@m,,1,number of events,greater than,0,*/5 * * * *,1,1,false,,,,"Alerts when an event is discovered including text has been identified as important. This rule triggers whenever an event is discovered with the tag of ""watchlist"".",,,,,0,1,Watchlisted Event Observed,0,threat,high,Watchlisted Event Observed,A watchlisted $orig_sourcetype$ event was observed from $orig_host$. This event may have a high priority and ought to be investigated.,"orig_host,orig_sourcetype",,,,,1,host,system,80,suppression_value,86300s,false,,,1,notable,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Distinct Risk Object Count'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(""All_Risk.risk_object"") as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s | appendcols [|tstats `summariesonly` estdc(""All_Risk.risk_object"") as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h] | `get_delta` | fields current_count,*",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Distinct Risk Objects,Object Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(%22All_Risk.risk_object%22)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s,1,0,0,all,Distinct Risk Object Count,singlevalue,risk_analysis,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication where'],['ESCU - Detect New Login Attempts to Routers - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count earliest(_time) as earliest latest(_time) as latest from datamodel=Authentication where Authentication.dest_category=router by Authentication.dest Authentication.user| eval isOutlier=if(earliest >= relative_time(now(), ""-30d@d""), 1, 0) | where isOutlier=1| `ctime(earliest)`| `ctime(latest)` | `drop_dm_object_name(""Authentication"")`",-30d@d,-10m@m,,1,number of events,greater than,0,0 0 * * *,1,1,,,,,"The search queries the authentication logs for assets that are categorized as routers in the ES Assets and Identity Framework, to identify connections that have not been seen before in the last 30 days.",,,,,,1,Detect New Login Attempts to Routers,,network,medium,Detected a New Router Login,This search detects new connections made to the router devices at $dest$,"dest, user",,,,,1,dest,system,20,"dest,user",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 11""], ""nist"": [""PR.PT"", ""PR.AC"", ""PR.IP""]}","Attackers will often attempt to compromise network devices such as routers for a variety of nefarious purposes, including modifying VPN settings or re-routing network traffic. Typically, only a relatively small number of user accounts log into these devices on a regular basis. This search identifies 'new' connections to your routers by checking to see if a similar login was made in the last 30 days. Routers are identified by checking the IP address against those categorized as a ""router"" in the ES assets and identity framework.","To successfully implement this search, you must ensure the network router devices are categorized as ""router"" in the Assets and identity table. You must also populate the Authentication data model with logs related to users authenticating to routing infrastructure.",Legitimate router connections may appear as new connections,2017-07-18,2017-09-12,medium,ESCU - Detect New Login Attempts to Routers - Rule,detection,Endpoint,[],"[""Active Directory"", ""Palo Alto Firewall""]","[""Router & Infrastructure Security""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For Endpointn""}",0,3600,86400,0,,,,,"[""Authentication""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Access - Geographically Improbable Access Detected - Rule'],DA-ESS-AccessProtection-default,,,True,,,,,,,,,"index=gia_summary source=""Access - Geographically Improbable Access - Summary Gen"" | fields user,src_time,src_app,src,src_lat,src_long,src_city,src_country,dest_time,dest_app,dest,dest_lat,dest_long,dest_city,dest_country,distance,speed",-65m@m,+0s,,1,number of events,greater than,0,5 * * * *,1,1,false,,,,Alerts on access attempts that are improbable based on time and geography.,,,,,0,1,Geographically Improbable Access Detected,0,access,high,Geographically Improbable Access Detected For $user$,"Login attempts for $user$ from geographically distant locations ( $src_city$, $dest_city$ ) have been detected.  This is an indication of potentially malicious or unauthorized access attempts.",user,View login attemps by $user$,"| from datamodel:""Authentication"".""Authentication"" | search user=""$user$"" (src=""$src$"" OR src=""$dest$"")",,,1,user,user,80,user,86300s,false,SplunkEnterpriseSecuritySuite,5,1,notable,,"[""Access - Geographically Improbable Access - Summary Gen""]",86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Distinct Risk Object Count By System'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(All_Risk.risk_object) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=system by ""All_Risk.risk_object_type"" | appendcols [| tstats `summariesonly` estdc(All_Risk.risk_object) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=system by ""All_Risk.risk_object_type""] | `get_delta` | fields current_count,*",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Distinct Risk System Objects,System Object Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count(All_Risk.risk_object)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3Dsystem%20by%20%22All_Risk.risk_object%22,1,0,0,all,Distinct System Count,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Distinct Risk Object Count By User'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(All_Risk.risk_object) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=user by All_Risk.risk_object_type | appendcols [| tstats `summariesonly` estdc(All_Risk.risk_object) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=user by All_Risk.risk_object_type] | `get_delta` | fields current_count,*",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Distinct Risk User Objects,User Object Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count(All_Risk.risk_object)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3Duser%20by%20All_Risk.risk_object%20,1,0,0,all,Distinct User Count,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Distinct Risk Object Count By Other'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(All_Risk.risk_object) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=other by All_Risk.risk_object_type | appendcols [| tstats `summariesonly` estdc(All_Risk.risk_object) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=other by All_Risk.risk_object_type] | `get_delta` | fields current_count,*",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Distinct Risk Other Objects,Other Object Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count(All_Risk.risk_object)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3Dother%20by%20All_Risk.risk_object,1,0,0,all,Distinct Other Object Count,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Median Risk Score'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s by All_Risk.risk_object | stats median(accum_risk) as current_count | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h by All_Risk.risk_object | stats median(accum_risk) as historical_count] | `get_ksi_fields(current_count, historical_count)` | xsfindbestconcept current_count FROM median_object_risk_by_object_type_1d IN risk as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Median Risk Score,Overall Median Risk,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(All_Risk.risk_object)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3Dother%20by%20All_Risk.risk_object,1,0,0,all,Median Risk,singlevalue,risk_analysis,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Median Risk Score By System'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=""system"" by All_Risk.risk_object, All_Risk.risk_object_type | stats median(accum_risk) as current_count | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=""system"" by All_Risk.risk_object, All_Risk.risk_object_type | stats median(accum_risk) as historical_count] | eval risk_object_type=""system"" | `get_ksi_fields(current_count, historical_count)` | `drop_dm_object_name(""All_Risk"")` | xsfindbestconcept current_count FROM median_object_risk_by_object_type_1d IN risk BY risk_object_type as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Median System Risk,System Risk,current_count,,delta,false,search?q=%20%7C%20tstats%20%60summariesonly%60%20sum(All_Risk.risk_score)%20as%20accum_risk%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3D%22system%22%20by%20All_Risk.risk_object%2C%20All_Risk.risk_object_type,1,0,0,all,Median Risk,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Median Risk Score By User'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=""user"" by All_Risk.risk_object, All_Risk.risk_object_type | stats median(accum_risk) as current_count | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=""user"" by All_Risk.risk_object, All_Risk.risk_object_type | stats median(accum_risk) as historical_count] | eval risk_object_type=""user"" | `get_ksi_fields(current_count, historical_count)` | `drop_dm_object_name(""All_Risk"")` | xsfindbestconcept current_count FROM median_object_risk_by_object_type_1d IN risk BY risk_object_type as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Median User Risk,User Risk,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Risk.risk_score)%20as%20accum_risk%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3D%22user%22%20by%20All_Risk.risk_object%2C%20All_Risk.risk_object_type%20,1,0,0,all,Median Risk,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Median Risk Score By Other'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=""other"" by All_Risk.risk_object, All_Risk.risk_object_type | stats median(accum_risk) as current_count | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as accum_risk from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=""other"" by All_Risk.risk_object, All_Risk.risk_object_type | stats median(accum_risk) as historical_count] | eval risk_object_type=""other"" | `get_ksi_fields(current_count, historical_count)` | `drop_dm_object_name(""All_Risk"")` | xsfindbestconcept current_count FROM median_object_risk_by_object_type_1d IN risk BY risk_object_type as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Median Other Risk,Other Object Risk,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Risk.risk_score)%20as%20accum_risk%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3D%22other%22%20by%20All_Risk.risk_object%2C%20All_Risk.risk_object_type,1,0,0,all,Median Risk,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Aggregated Risk'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h] | `get_ksi_fields(current_count, historical_count)` | xsfindbestconcept current_count FROM total_risk_by_object_type_1d IN risk as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Aggregated Risk,Total Risk,current_count,,delta,false,search?q=%20%7C%20tstats%20%60summariesonly%60%20sum(All_Risk.risk_score)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20All_Risk.risk_object,1,0,0,all,Aggregated Risk,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Aggregated System Risk'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=""system"" by All_Risk.risk_object_type | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=""system"" by All_Risk.risk_object_type] | `get_ksi_fields(current_count, historical_count)` | `drop_dm_object_name(""All_Risk"")` | xsfindbestconcept current_count FROM total_risk_by_object_type_1d IN risk BY risk_object_type as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Aggregated System Risk,Total System Risk,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Risk.risk_score)%20as%20current_count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3D%22system%22%20by%20All_Risk.risk_object,1,0,0,all,Aggregated Risk,singlevalue,risk_analysis,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Aggregated User Risk'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=""user"" by All_Risk.risk_object_type | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=""user"" by All_Risk.risk_object_type] | `get_ksi_fields(current_count, historical_count)` | `drop_dm_object_name(""All_Risk"")` | xsfindbestconcept current_count FROM total_risk_by_object_type_1d IN risk BY risk_object_type as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Aggregated User Risk,Total User Risk,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Risk.risk_score)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3D%22user%22%20by%20All_Risk.risk_object,1,0,0,all,Aggregated Risk,singlevalue,risk_analysis,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect New Open S3 buckets - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail AllUsers eventName=PutBucketAcl | spath output=userIdentityArn path=userIdentity.arn | spath output=bucketName path=requestParameters.bucketName | spath output=aclControlList path=requestParameters.AccessControlPolicy.AccessControlList | spath input=aclControlList output=grantee path=Grant{} | mvexpand grantee | spath input=grantee | search Grantee.URI=*AllUsers | rename userIdentityArn as user| table _time, src,awsRegion Permission, Grantee.URI, bucketName, user",-70m@m,-10m@m,,1,number of events,greater than,0,5 * * * *,1,1,,,,,This search looks for CloudTrail events where a user has created an open/public S3 bucket.,,,,,,1,Detect New Open S3 buckets,,network,medium,Public S3 bucket $bucketName$ created by $user$,"An open/public S3 bucket, $bucketName$, was created by $user$.",user,,,,,1,user,user,70,"user,bucketName",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Initial Access"", ""Exfiltration""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 13""], ""nist"": [""PR.DS"", ""PR.AC"", ""DE.CM""]}","This search queries CloudTrail logs for events with S3 bucket access controls given to the ""All Users"" group, which allows anyone in the world access to the resource. This search generates a table displaying the time when the bucket was made public, the permission of the S3 bucket, the bucket name, and the ARN of the user who created the bucket.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), and then configure your CloudTrail inputs. The threshold value should be tuned to your environment.","While this search has no known false positives, it is possible that an AWS admin has legitimately created a public bucket for a specific purpose. That said, AWS strongly advises against granting full control to the ""All Users"" group.",2018-07-25,2018-07-25,medium,ESCU - Detect New Open S3 buckets - Rule,detection,S3 Bucket,[],"[""AWS""]","[""Suspicious AWS S3 Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - AWS S3 Bucket details via bucketNamenESCU - Investigate AWS activities via region namenESCU - AWS Investigate User Activities By ARNnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Aggregated Other Risk'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` sum(All_Risk.risk_score) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s All_Risk.risk_object_type=""other"" by All_Risk.risk_object_type | appendcols [| tstats `summariesonly` sum(All_Risk.risk_score) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h All_Risk.risk_object_type=""other"" by All_Risk.risk_object_type] | `get_ksi_fields(current_count, historical_count)` | `drop_dm_object_name(""All_Risk"")` | xsfindbestconcept current_count FROM total_risk_by_object_type_1d IN risk BY risk_object_type as current_count_qual | xsfindbestconcept delta FROM percentile in default as delta_qual",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Aggregated Other Risk,Total Other Risk,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20sum(All_Risk.risk_score)%20as%20score%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20All_Risk.risk_object_type%3D%22other%22%20by%20All_Risk.risk_object,1,0,0,all,Aggregated Risk,singlevalue,risk_analysis,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Distinct Modifier Sources'],SA-ThreatIntelligence-default,,,,,,,,,,,,| tstats `summariesonly` estdc(source) as current_count from datamodel=Risk.All_Risk where earliest=-24h@h latest=+0s | appendcols[| tstats `summariesonly` estdc(source) as historical_count from datamodel=Risk.All_Risk where earliest=-48h@h latest=-24h@h] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Distinct Modifier Sources,Source Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count(source)%20as%20count%20from%20datamodel%3DRisk.All_Risk%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20source,1,0,0,all,Modifier Sources,singlevalue,risk_analysis,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Correlation Searches - Lookup Gen'],SA-ThreatIntelligence-default,,,False,,,,,,,,,"| rest splunk_server=local count=0 ""/servicesNS/-/-/saved/searches?listDefaultActionArgs=1"" | where match('action.correlationsearch.enabled', ""1|[Tt]|[Tt][Rr][Uu][Ee]"") OR match('action.notable', ""1|[Tt]|[Tt][Rr][Uu][Ee]"") OR match('action.risk', ""1|[Tt]|[Tt][Rr][Uu][Ee]"") | eval rule_name=if(isnotnull('action.correlationsearch.label'),'action.correlationsearch.label',title) | rename title as _key,action.notable.param.* as * | append [| rest splunk_server=local count=0 /servicesNS/-/-/configs/conf-correlationsearches | rename title as _key] | eval security_domain=if(security_domain="""",null(),security_domain),severity=if(severity="""",null(),severity),rule_name=if(rule_name="""",null(),rule_name),description=if(description="""",null(),description),rule_title=if(rule_title="""",null(),rule_title),rule_description=if(rule_description="""",null(),rule_description),drilldown_name=if(drilldown_name="""",null(),drilldown_name),drilldown_search=if(drilldown_search="""",null(),drilldown_search),drilldown_earliest_offset=if(drilldown_earliest_offset="""",null(),drilldown_earliest_offset),drilldown_latest_offset=if(drilldown_latest_offset="""",null(),drilldown_latest_offset),default_status=if(default_status="""",null(),default_status),default_owner=if(default_owner="""",null(),default_owner),next_steps=if(next_steps="""",null(),next_steps),investigation_profiles=if(investigation_profiles="""",null(),investigation_profiles),extract_assets=if(extract_assets="""",null(),extract_assets),extract_identities=if(extract_identities="""",null(),extract_identities),recommended_actions=if(recommended_actions="""",null(),recommended_actions) | appendpipe [ where _key LIKE ""%""%"" | eval _key=replace(_key, """""", ""_"") ] | stats first(security_domain) as security_domain,first(severity) as severity,first(rule_name) as rule_name,first(description) as description,first(rule_title) as rule_title,first(rule_description) as rule_description,first(drilldown_name) as drilldown_name,first(drilldown_search) as drilldown_search,first(drilldown_earliest_offset) as drilldown_earliest_offset,first(drilldown_latest_offset) as drilldown_latest_offset,first(default_status) as default_status,first(default_owner) as default_owner,first(next_steps) as next_steps,first(investigation_profiles) as investigation_profiles,first(extract_assets) as extract_assets,first(extract_identities) as extract_identities,first(recommended_actions) as recommended_actions by _key | outputlookup correlationsearches_lookup append=T key_field=_key | stats count",0,+0s,,1,,,,* * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Notable Owners - Lookup Gen'],SA-ThreatIntelligence-default,,,False,,,,,,,,,"| rest splunk_server=local count=0 /services/authentication/users | search capabilities=""can_own_notable_events"" | rename title as owner | append [| makeresults | eval owner=""unassigned"" ] | eval _key=owner | eval realname=if(isnull(realname) or realname="""", null(), realname) | table _key owner realname | outputlookup notable_owners_lookup | stats count",0,+0s,,1,,,,*/10 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Threat - Risk Correlation By System - Lookup Gen'],SA-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true sum(All_Risk.risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type=""system"" by All_Risk.risk_object | eval dest=lower('All_Risk.risk_object') | `get_asset(dest)` | eval dest=if(isnotnull(dest_asset_id),mvappend(dest,NULL,lower(dest_mac)),dest),dest=if(isnotnull(dest_asset_id),mvappend(dest,NULL,lower(dest_nt_host)),dest),dest=if(isnotnull(dest_asset_id),mvappend(dest,NULL,lower(dest_dns)),dest) | stats sum(risk_score) as risk_score by dest | rename dest as risk_object | outputlookup risk_correlation_by_system_lookup | stats count",-7d@h,+0s,,1,,,,*/30 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Threat - Risk Correlation By User - Lookup Gen'],SA-ThreatIntelligence-default,,,False,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true sum(All_Risk.risk_score) as risk_score from datamodel=Risk.All_Risk where All_Risk.risk_object_type=""user"" by All_Risk.risk_object | eval user=lower('All_Risk.risk_object') | `get_identity4events(user)` | eval risk_object=if(isnotnull(user_identity),lower(user_identity),user) | stats sum(risk_score) as risk_score by risk_object | outputlookup risk_correlation_by_user_lookup | stats count",-7d@h,+0s,,1,,,,*/30 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Threat - Risk Correlation By Other - Lookup Gen'],SA-ThreatIntelligence-default,,,True,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true sum(All_Risk.risk_score) as risk_score from datamodel=Risk.All_Risk where (All_Risk.risk_object_type!=""user"" AND All_Risk.risk_object_type!=""system"") by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name(""All_Risk"")` | eval risk_object=lower('risk_object'),risk_object_type=lower('risk_object_type') | stats sum(risk_score) as risk_score by risk_object,risk_object_type | outputlookup risk_correlation_by_other_lookup | stats count",-7d@h,+0s,,1,,,,*/30 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Alexa Top Sites - Lookup Gen'],SA-ThreatIntelligence-default,,,1,,,,,,,,,| inputintelligence `top_1m_sites` | outputlookup alexa_lookup_by_str | stats count,0,+0s,,1,,,,1 5 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - ASN String Matches - Lookup Gen'],SA-ThreatIntelligence-default,,,1,,,,,,,,,"| inputintelligence maxmind_geoip_asn_ipv4 | expandiprange ip | eval ip=mvfilter(!match(ip, `ipv4_cidr_regex`)) | where isnotnull(ip) | mvexpand ip| outputlookup output_format=splunk_mv_csv asn_lookup_by_str | stats count",0,+0s,,1,,,,1 15 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - ASN CIDR Matches - Lookup Gen'],SA-ThreatIntelligence-default,,,1,,,,,,,,,"| inputintelligence maxmind_geoip_asn_ipv4 | expandiprange ip | eval ip=mvfilter(match(ip, `ipv4_cidr_regex`)) | where isnotnull(ip) | mvexpand ip | outputlookup output_format=splunk_mv_csv asn_lookup_by_cidr | stats count",0,+0s,,1,,,,1 15 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,
"['Endpoint.Processes', 'Endpoint.Filesystem']",['ESCU - Detect Oulook.exe writing a .zip file - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly`  min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes where Processes.process_name=outlook.exe OR Processes.process_name=explorer.exe by _time span=5m Processes.parent_process_id Processes.process_id Processes.dest Processes.process_name Processes.parent_process_name Processes.user | `drop_dm_object_name(Processes)` | `ctime(firstTime)` | `ctime(lastTime)` | rename process_id as malicious_id| rename parent_process_id as outlook_id| join malicious_id type=inner[| tstats `summariesonly` count values(Filesystem.file_path) as file_path values(Filesystem.file_name) as file_name  FROM datamodel=Endpoint.Filesystem where (Filesystem.file_path=*zip*   OR Filesystem.file_name=*.lnk ) AND (Filesystem.file_path=C:\Users* OR Filesystem.file_path=*Local\Temp*) by  _time span=5m Filesystem.process_id Filesystem.file_hash Filesystem.dest  | `drop_dm_object_name(Filesystem)` | `ctime(firstTime)` | `ctime(lastTime)` | rename process_id as malicious_id| fields malicious_id outlook_id dest file_path file_name file_hash count file_id] | table firstTime lastTime user malicious_id outlook_id process_name parent_process_name file_name  file_path | where file_name != """"",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for execution of process `outlook.exe` where the process is writing a `.zip` file to the disk.,,,,,,1,Detect Oulook.exe writing a .zip file,,network,high,Oulook.exe is writing a zip file $file_name$ on $dest$,Oulook.exe is writing a zip file $file_name$ on $dest$,"dest, process_name, file_name",,,,,1,dest,system,20,"dest,file_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Spearphishing Attachment""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 7"", ""CIS 8""], ""nist"": [""ID.AM"", ""PR.DS""]}","In this search, we are essentially trying to detect if outlook.exe is writing a `.zip` file to the disk. The way this search would run is, it will execute the the subsearch first which looks for all .zip files being written to the disk and outputs a crucial field ""process_id"", that we use the main search to check if that process_id belongs to a process_name of outlook.exe. The search uses a join command to essentially give you an end result of the first and last time that zip file was written by outlook.exe, the dest and user logged on the system, the hash value and the complete path to the zip file on disk","You must be ingesting data that records filesystem and process activity from your hosts to populate the Endpoint data model. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or endpoint data sources, such as Sysmon.",It is not uncommon for outlook to write legitimate zip files to the disk.,2019-04-29,2019-04-29,high,ESCU - Detect Oulook.exe writing a .zip file - Rule,detection,Endpoint,"[""dest""]","[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Phishing Payloads""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - ASN IPv6 CIDR Matches - Lookup Gen'],SA-ThreatIntelligence-default,,,1,,,,,,,,,| inputintelligence maxmind_geoip_asn_ipv6 | outputlookup asn_lookup_by_cidr_ipv6 | stats count,0,+0s,,1,,,,1 15 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - ICANN Top Level Domain - Lookup Gen'],SA-ThreatIntelligence-default,,,0,,,,,,,,,| inputintelligence icann_top_level_domain_list | eval tld=lower(domain) | fields tld | outputlookup cim_http_tld_lookup | stats count,0,+0s,,1,,,,1 15 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Mozilla Public Suffix - Lookup Gen'],SA-ThreatIntelligence-default,,,0,,,,,,,,,"| inputintelligence mozilla_public_suffix_list | eval segments=mvcount(split(domain, ""."")), length=case(rule==""*"", segments+2, rule==""!"", segments, 1==1, segments+1) | fields length,domain,segments | outputlookup mozilla_public_suffix_lookup | stats count",0,+0s,,1,,,,1 20 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Incident Review - Activity By Reviewer Over Time'],SA-ThreatIntelligence-default,,,,,,,,,,,,| `incident_review` | timechart useother=`useother` count by reviewer_realname,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Incident Review - Notable Events By Status'],SA-ThreatIntelligence-default,,,,,,,,,,,,`notable` | search NOT `suppression` | stats count by status_label | rename status_label as status | sort 10 - count,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Incident Review - Notable Events By Owner'],SA-ThreatIntelligence-default,,,,,,,,,,,,`notable` | search NOT `suppression` | chart count over owner by urgency | `sort_chart`,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,,,,,bar,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Incident_Management.Notable_Events_Meta'],['Incident Review - Mean Time To Closure'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` earliest(_time) as _time from datamodel=Incident_Management.Notable_Events_Meta by source,Notable_Events_Meta.rule_id | `drop_dm_object_name(""Notable_Events_Meta"")` | `get_correlations` | `get_current_status` | search status_label=""Closed"" | eval ttc=mvindex(review_time, 0) | eval ttc=ttc-_time | stats count avg(ttc) as avg_ttc,max(ttc) as max_ttc by rule_name | sort - avg_ttc | `uptime2string(avg_ttc, avg_ttc)` | `uptime2string(max_ttc, max_ttc)` | rename *_ttc* as *(time_to_closure)* | fields - *_dec",-60d@d,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Incident_Management.Notable_Events_Meta'],['Incident Review - Mean Time To Triage'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats `summariesonly` earliest(_time) as _time from datamodel=Incident_Management.Notable_Events_Meta by source,Notable_Events_Meta.rule_id | `drop_dm_object_name(""Notable_Events_Meta"")` | `get_correlations` | join rule_id [| from inputlookup:incident_review_lookup | eval _time=time | stats earliest(_time) as review_time by rule_id] | eval ttt=review_time-_time | stats count,avg(ttt) as avg_ttt,max(ttt) as max_ttt by rule_name | sort - avg_ttt | `uptime2string(avg_ttt, avg_ttt)` | `uptime2string(max_ttt, max_ttt)` | rename *_ttt* as *(time_to_triage)* | fields - *_dec",-14d@d,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Incident Review - Top Reviewers'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| `incident_review` | stats sparkline,count,min(_time) as firstTime,max(_time) as lastTime by reviewer_realname | `uitime(firstTime)` | `uitime(lastTime)` | sort 100 - count",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Incident Review - Recent Review Activity'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| `incident_review` | rename status_label as status | sort 100 - _time | table _time,rule_id,status,rule_name,owner_realname,comment,reviewer_realname",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Traffic where'],['ESCU - Detect Outbound SMB Traffic - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count earliest(_time) as earliest latest(_time) as latest values(All_Traffic.action) from datamodel=Network_Traffic where All_Traffic.action !=blocked All_Traffic.dest_category !=internal (All_Traffic.dest_port=139 OR All_Traffic.dest_port=445 OR All_Traffic.app=smb) by All_Traffic.src_ip All_Traffic.dest_ip | `drop_dm_object_name(""All_Traffic"")` | search ( dest_ip!=10.0.0.0/8 AND dest_ip!=172.16.0.0/12 AND dest_ip!=192.168.0.0/16) | convert ctime(earliest) ctime(latest)",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for outbound SMB connections made by hosts within your network to the Internet. SMB traffic is used for Windows file-sharing activity. One of the techniques often used by attackers involves retrieving the credential hash using an SMB request made to a compromised server controlled by the threat actor.,,,,,,1,Detect Outbound SMB Traffic,,network,medium,Outbound SMB traffic from $src_ip$ to $dest_ip$ detected,Outbound SMB network traffic detected.,"src_ip, dest_ip",,,,,1,src_ip,system,50,src_ip,28800s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Commonly Used Port"", ""Credential Access"", ""Lateral Movement""], ""kill_chain_phases"": [""Actions on Objectives"", ""Command and Control""], ""cis20"": [""CIS 12""], ""nist"": [""DE.CM""]}","In this search, we are looking for the network connections that were not blocked by the firewall and that are destined for destination port 139 or 445. We then filter out events that have Classless Inter-Domain Routing (CIDR) blocks categorized as internal in the `assets_by_cidr.csv` lookup file which is located in `$SPLUNK_HOME/etc/apps/SA-IdentityManagement/lookups/`. Since we are only looking for outbound traffic from the hosts made to the Internet, we filter out traffic whose destination IP address is private.","In order to run this search effectively, we highly recommend that you leverage the Assets and Identity framework. It is important that you have good understanding of how your network segments are designed, and be able to distinguish internal from external address space. Add a category named `internal` to the CIDRs that host the company's assets in `assets_by_cidr.csv` lookup file, which is located in `$SPLUNK_HOME/etc/apps/SA-IdentityManagement/lookups/`. More information on updating this lookup can be found here: https://docs.splunk.com/Documentation/ES/5.0.0/Admin/Addassetandidentitydata. This search also requires you to be ingesting your network traffic and populating the Network_Traffic data model","It is likely that the outbound Server Message Block (SMB) traffic is legitimate, if the company's internal networks are not well-defined in the Assets and Identity Framework. Categorize the internal CIDR blocks as `internal` in the lookup file to avoid creating notable events for traffic destined to those CIDR blocks. Any other network connection that is going out to the Internet should be investigated and blocked. Best practices suggest preventing external communications of all SMB versions and related protocols at the network boundary.",2018-03-20,2018-03-20,medium,ESCU - Detect Outbound SMB Traffic - Rule,detection,Endpoint,[],"[""Bro"", ""Splunk Stream""]","[""DHS Report TA18-074A"", ""Hidden Cobra Malware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Get Outbound Emails to Hidden Cobra Threat Actorsn""}",0,3600,86400,0,,,,,"[""Network_Traffic""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Risk Modifiers Over Time'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats prestats=true summariesonly=false allow_old_summaries=`allow_old_summaries_bool` sum(All_Risk.risk_score),count from datamodel=Risk.All_Risk by _time span=10m | timechart minspan=10m sum(All_Risk.risk_score) as risk_score,count",-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,bottom,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,count,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Risk Score By Business Unit'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=`allow_old_summaries_bool` sum(All_Risk.risk_score) as risk_score from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name(""All_Risk"")` | eval dest=if(risk_object_type==""system"",risk_object,null()) | eval user=if(risk_object_type==""user"",risk_object,null()) | `get_asset(dest)` | `get_identity4events(user)` | `mvappend_field(dest_bunit,user_bunit)` | stats sum(risk_score) as risk_score,dc(risk_object) by dest_bunit | eval avg_score=floor('risk_score'/'dc(risk_object)') | rename dest_bunit as bunit",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Risk Score By Object'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=`allow_old_summaries_bool` sum(All_Risk.risk_score) as risk_score,dc(source) as source_count,count from datamodel=Risk.All_Risk by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name(""All_Risk"")` | sort 1000 - risk_score",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Risk - Most Active Sources'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=`allow_old_summaries_bool` sum(All_Risk.risk_score) as risk_score,dc(All_Risk.risk_object) as risk_objects,count from datamodel=Risk.All_Risk by source | sort 1000 - count,risk_score",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Risk"".""All_Risk']",['Risk - Recent Risk Modifiers'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| from datamodel:""Risk"".""All_Risk"" | head 1000 | table _time risk_object risk_object_type source description risk_score",-24h@h,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Suppressions - Currently Suppressed Events Over Time'],SA-ThreatIntelligence-default,,,,,,,,,,,,`suppressed_notables` | timechart minspan=10m count by rule_name,-24h@h,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Suppressions - Suppression History Over Time'],SA-ThreatIntelligence-default,,,,,,,,,,,,"index=notable_summary source=""Threat - Suppressed Notables - Summary Gen"" | timechart minspan=1d sum(count) as count by rule_name",-30d@d,now,,,,,,,,,0,,,,,,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,line,zero,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Suppressions - Suppression Management Activity'],SA-ThreatIntelligence-default,,,,,,,,,,,,`suppression_audit` | table _time suppression action status user,-7d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Suppressions - Expired Suppressions'],SA-ThreatIntelligence-default,,,,,,,,,,,,`suppression_audit-expired` | eval raw=_raw | table _time suppression raw,-7d@d,now,,,,,,,,,0,,,,,,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Suppressed Notables - Summary Gen'],SA-ThreatIntelligence-default,,,,,,,,,,,,"`suppressed_notables` | stats count by security_domain, rule_name, urgency, suppression",-365m@m,-5m@m,,1,,,,"55 0,6,12,18 * * *",,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,false,,10,,notable_summary,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Filesystem'],['ESCU - Detect Path Interception By Creation Of program.exe - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.user) as user values(Filesystem.dest) as dest values(Filesystem.file_hash) as file_hash values(Filesystem.file_path) as file_path from datamodel=Endpoint.Filesystem where Filesystem.file_path=""C:\program.exe"" by Filesystem.file_name | `drop_dm_object_name(Filesystem)` | `ctime(lastTime)` | `ctime(firstTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,30 * * * *,1,1,,,,,The search is looking for the creation of program.exe in the C: drive.  The creation of this file in that location may be driven by a motive to perform path interception.,,,,,,1,Detect Path Interception By Creation Of program.exe,,endpoint,medium,Path Interception attempt discovered $dest$ via creation of program.exe,A potentially malicious file program.exe was detected on the C: drive. The creation of this file is often associated with a motive to perform a path interception attack.,"dest, file_path, file_name",,,,,1,dest,system,50,"dest, file_path, file_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Privilege Escalation"", ""Persistence""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","This search queries the Endpoint file-system data model node to list out all the values of destination machines, as well as the values of file hashes and file paths that have the file ""program.exe"" in the C: drive. Path interception occurs when an executable is placed in a specific path so that it is executed by an application instead of by the intended target. In this case, applications vulnerable to path interception (because of unquoted service paths with spaces in Windows registry) allow attackers to execute maliciously crafted program.exes.","You must be ingesting data that records the file-system activity from your hosts to populate the Endpoint file-system data model node. This is typically populated via endpoint detection-and-response products, such as Carbon Black, or other endpoint data sources, such as Sysmon. The data used for this search is typically generated via logs that report file system reads and writes.",It is unlikely that a normal user may create and place this file in the C: drive.  Confirm with the user.,2017-11-16,2018-11-15,medium,ESCU - Detect Path Interception By Creation Of program.exe - Rule,detection,,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Tanium"", ""Ziften""]","[""Windows Persistence Techniques""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - All Notable Events By Asset - Swimlane'],SA-ThreatIntelligence-default,,,,,,,,,,,,"$constraints$ `notable` | bucket _time span=$span$ | stats values(rule_name) as rule_name,values(urgency) as urgency,values(src) as src,values(dest) as dest,count by _time",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Notable Events,yellow,reverse_asset_lookup,"orig_host,dvc,src,dest",$constraints$ `notable`,Default,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Threat - All Notable Events By Identity - Swimlane'],SA-ThreatIntelligence-default,,,,,,,,,,,,"$constraints$ `notable` | bucket _time span=$span$ | stats values(rule_name) as rule_name,values(urgency) as urgency,values(src) as src,values(dest) as dest,count by _time",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Notable Events,yellow,reverse_identity_lookup,"src_user,user",$constraints$ `notable`,,,Default,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Threat - All Risk Modifiers By Asset - Swimlane'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true values(source) as source,values(All_Risk.risk_object) as risk_object,sum(All_Risk.risk_score) as count from datamodel=Risk.All_Risk where $constraints$ by _time span=$span$ | eval risk_score=count",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Risk Modifiers,blue,reverse_asset_lookup,All_Risk.risk_object,| tstats summariesonly=false allow_old_summaries=true sum(All_Risk.risk_score) as risk_score from datamodel=Risk.All_Risk where $constraints$ by source | sort - risk_score,Default,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Risk.All_Risk'],['Threat - All Risk Modifiers By Identity - Swimlane'],SA-ThreatIntelligence-default,,,,,,,,,,,,"| tstats summariesonly=false allow_old_summaries=true values(source) as source,values(All_Risk.risk_object) as risk_object,sum(All_Risk.risk_score) as count from datamodel=Risk.All_Risk where $constraints$ by _time span=$span$ | eval risk_score=count",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,Risk Modifiers,blue,reverse_identity_lookup,All_Risk.risk_object,| tstats summariesonly=false allow_old_summaries=true sum(All_Risk.risk_score) as risk_score from datamodel=Risk.All_Risk where $constraints$ by source | sort - risk_score,,,Default,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['UEBA"".""UEBA_Threats']",['Threat - UEBA Threat Detected (Notable) - Rule'],SA-UEBA-default,,,False,,,,,,,,,"| from datamodel:""UEBA"".""UEBA_Threats"" | stats values(app) as app,values(dvc) as dvc,values(user) as user,dc(user) as user_count,values(url) as url,latest(action) as action,latest(uba_event_type) as uba_event_type,latest(description) as description,latest(link) as link,latest(modify_time) as modify_time,latest(severity) as severity,latest(signature) as signature,latest(start_time) as start_time,latest(threat_category) as threat_category by uba_host,uba_event_id",-2m@m,@m,,1,number of events,greater than,0,*/2 * * * *,1,1,false,,,,Detects UBA threat events,,,,,0,1,UBA Threat Detected,0,threat,informational,$threat_category$,UBA Threat: $description$,,View threat history,"| from datamodel:""UEBA"".""UEBA_Threats"" | search uba_event_id=""$uba_event_id$""",,,,,,,"uba_host,uba_event_id",188697600s,false,,,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['UEBA"".""UEBA_Threats']",['Threat - UEBA Threat Detected (Risk) - Rule'],SA-UEBA-default,,,False,,,,,,,,,"| from datamodel:""UEBA"".""UEBA_Threats"" | stats latest(description) as description,values(dvc) as dvc,max(severity_id) as score,values(user) as user by uba_host,uba_event_id | eval risk_object_type=""system"" | eval risk_object=dvc | appendpipe [stats first(description) as description,max(score) as score,values(user) as user by uba_host,uba_event_id] | eval risk_object_type=if(isnull(risk_object_type),""user"",risk_object_type) | eval risk_object=if(isnull(risk_object),user,risk_object) | mvexpand risk_object | eval dvc=if(risk_object_type=""system"",risk_object,null()) | eval user=if(risk_object_type=""user"",risk_object,null()) | eval risk_score=score*10",-2m@m,@m,,1,number of events,greater than,0,*/2 * * * *,1,1,false,,,,Detects UBA threat events,,,,,0,1,UBA Threat Detected (Risk),0,,,UBA Threat Detected (Risk),,,,,,,1,src,system,80,"uba_event_id,risk_object,risk_object_type",188697600s,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['UEBA"".""UEBA_Anomalies']",['Threat - UEBA Anomaly Detected (Risk) - Rule'],SA-UEBA-default,,,False,,,,,,,,,"| from datamodel:""UEBA"".""UEBA_Anomalies"" | stats latest(short_description) as description,values(dvc) as dvc,max(severity_id) as score,values(user) as user by uba_host,uba_event_id | eval risk_object_type=""system"" | eval risk_object=dvc | appendpipe [stats first(description) as description,max(score) as score,values(user) as user by uba_host,uba_event_id] | eval risk_object_type=if(isnull(risk_object_type),""user"",risk_object_type) | eval risk_object=if(isnull(risk_object),user,risk_object) | mvexpand risk_object | eval dvc=if(risk_object_type=""system"",risk_object,null()) | eval user=if(risk_object_type=""user"",risk_object,null()) | eval risk_score=score*10",-2m@m,@m,,1,number of events,greater than,0,*/2 * * * *,1,1,false,,,,Detects UBA anomaly events,,,,,0,1,UBA Anomaly Detected (Risk),0,,,UBA Anomaly Detected (Risk),,,,,,,1,src,system,80,"uba_event_id,risk_object,risk_object_type",188697600s,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Total Event From UEBA'],SA-UEBA-default,,,,,,,,,,,,"| `es_notable_events` | search rule_name=""UBA Threat Detected"" | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,UBA Notables,Total Count,current_count,,delta,false,,1,0,0,all,UEBA Notable Events,singlevalue,security_posture,7,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,uba_anomalies,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['UEBA.All_UEBA_Events'],['UBA - Anomaly Actors'],SA-UEBA-default,,,,,,,,,,,,"| tstats `summariesonly` estdc(All_UEBA_Events.dvc) as dvc,estdc(All_UEBA_Events.user) as user from datamodel=UEBA.All_UEBA_Events where nodename=All_UEBA_Events.UEBA_Anomalies earliest=-24h@h latest=+0s | addtotals fieldname=current_count | table current_count | appendcols [| tstats `summariesonly` estdc(All_UEBA_Events.dvc) as dvc,estdc(All_UEBA_Events.user) as user from datamodel=UEBA.All_UEBA_Events where nodename=All_UEBA_Events.UEBA_Anomalies earliest=-48h@h latest=-24h@h | addtotals fieldname=historical_count | table historical_count] | `get_delta`",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,UBA Anomaly Actors,Distinct Count,current_count,,delta,false,,1,0,0,all,UBA Anomaly Actors,singlevalue,uba_anomalies,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['UEBA.All_UEBA_Events'],['UBA - Anomaly Signatures'],SA-UEBA-default,,,,,,,,,,,,| tstats `summariesonly` dc(All_UEBA_Events.signature) as current_count from datamodel=UEBA.All_UEBA_Events where nodename=All_UEBA_Events.UEBA_Anomalies earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` dc(All_UEBA_Events.signature) as historical_count from datamodel=UEBA.All_UEBA_Events where nodename=All_UEBA_Events.UEBA_Anomalies earliest=-48h@h latest=-24h@h] | `get_delta`,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,UBA Anomaly Signatures,Distinct Count,current_count,,delta,false,,1,0,0,all,UBA Anomaly Signatures,singlevalue,uba_anomalies,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Detect Prohibited Applications Spawning cmd.exe - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.user) as user values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=cmd.exe by Processes.parent_process_name Processes.process_name Processes.dest | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)` |search [`prohibited_apps_launching_cmd`],-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for executions of cmd.exe spawned by a process that is often abused by attackers and that does not typically launch cmd.exe.,,,,,,1,Detect Prohibited Applications Spawning cmd.exe,,endpoint,medium,Prohibited application($parent_process$) used to launch cmd.exe on $dest$,A prohibited application from prohibited_apps_launching_cmd.csv was leveraged to launch cmd.exe,"dest, process, parent_process",,,,,1,dest,system,80,"dest, parent_process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface""], ""kill_chain_phases"": [""Exploitation""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","Obtaining access to the Command-Line Interface (CLI) is typically a primary attacker goal. Once an attacker has obtained the ability to execute code on a target system, they will often further manipulate the system via commands passed to the CLI. It is also unusual for many applications to spawn a command shell during normal operation, while it is often observed if an application has been compromised in some way. As such, it is often beneficial to look for cmd.exe being executed by processes that are often targeted for exploitation, or that would not spawn cmd.exe in any other circumstances. A lookup file is provided to easily modify the processes that are being watched for execution of cmd.exe.","You must be ingesting data that records process activity from your hosts and populates the Endpoint data model with the resultant dataset. This search includes a lookup file, `prohibited_apps_launching_cmd.csv`, that contains a list of processes that should not be spawning cmd.exe. You can modify this lookup to better suit your environment.","There are circumstances where an application may legitimately execute and interact with the Windows command-line interface. Investigate and modify the lookup file, as appropriate.",2017-10-07,2018-11-15,medium,ESCU - Detect Prohibited Applications Spawning cmd.exe - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious Command-Line Executions"", ""Suspicious MSHTA Activity""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Registry ActivitiesnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['UEBA.All_UEBA_Events'],['UBA - Anomalies Per Threat'],SA-UEBA-default,,,,,,,,,,,,"| tstats `summariesonly` count from datamodel=UEBA.All_UEBA_Events where earliest=-24h@h latest=+0s by nodename | eval threats=if(nodename=""All_UEBA_Events.UEBA_Threats"",count,0),anomalies=if(nodename=""All_UEBA_Events.UEBA_Anomalies"",count,0) | stats sum(threats) as threats,sum(anomalies) as anomalies | eval current_anomaliesper=floor(anomalies/threats) | table current_anomaliesper | appendcols [| tstats `summariesonly` count from datamodel=UEBA.All_UEBA_Events where earliest=-48h@h latest=-24h@h by nodename | eval threats=if(nodename=""All_UEBA_Events.UEBA_Threats"",count,0),anomalies=if(nodename=""All_UEBA_Events.UEBA_Anomalies"",count,0) | stats sum(threats) as threats,sum(anomalies) as anomalies | eval historical_anomaliesper=floor(anomalies/threats) | table historical_anomaliesper] | `get_delta(current_anomaliesper,historical_anomaliesper)`",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,UBA Anomalies (pT),Per Threat,current_anomaliesper,,delta,false,,1,0,0,all,UBA Anomalies Per Threat,singlevalue,uba_anomalies,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['UEBA.All_UEBA_Events'],['UBA - Total Anomalies'],SA-UEBA-default,,,,,,,,,,,,| tstats `summariesonly` count as current_count from datamodel=UEBA.All_UEBA_Events where nodename=All_UEBA_Events.UEBA_Anomalies earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=UEBA.All_UEBA_Events where nodename=All_UEBA_Events.UEBA_Anomalies earliest=-48h@h latest=-24h@h] | `get_delta`,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,UBA Anomalies,Total Count,current_count,,delta,false,,1,0,0,all,UBA Anomalies,singlevalue,uba_anomalies,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['UEBA.All_UEBA_Events'],['UEBA - UEBA Threats By Asset - Swimlane'],SA-UEBA-default,,,,,,,,,,,,"| tstats `summariesonly` values(All_UEBA_Events.app) as Apps,latest(All_UEBA_Events.description) as Description,latest(All_UEBA_Events.start_time) as ""Detection Time"",values(All_UEBA_Events.dvc) as Devices,values(All_UEBA_Events.url) as Domains,latest(All_UEBA_Events.link) as Link,latest(All_UEBA_Events.severity_id) as Score,latest(All_UEBA_Events.severity) as Severity,latest(All_UEBA_Events.threat_category) as Type,latest(All_UEBA_Events.modify_time) as ""Update Time"",values(All_UEBA_Events.user) as Users,count from datamodel=UEBA.All_UEBA_Events where nodename=""All_UEBA_Events.UEBA_Threats"" $constraints$ by _time,All_UEBA_Events.uba_event_id span=$span$ | `uitime(""Detection Time"")` | `uitime(""Update Time"")` | rename All_UEBA_Events.uba_event_id as ""Event ID"" | fields _time,""Detection Time"",""Update Time"",""Event ID"",Type,Description,Severity,Users,Devices,Score,Apps,Domains,Link,count",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,1,UEBA Threats,red,reverse_asset_lookup,dvc,"| from datamodel:""UEBA"".""UEBA_Threats"" | search $constraints$",Default,7,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['UEBA.All_UEBA_Events'],['UEBA - UEBA Threats By Identity - Swimlane'],SA-UEBA-default,,,,,,,,,,,,"| tstats `summariesonly` values(All_UEBA_Events.app) as Apps,latest(All_UEBA_Events.description) as Description,latest(All_UEBA_Events.start_time) as ""Detection Time"",values(All_UEBA_Events.dvc) as Devices,values(All_UEBA_Events.url) as Domains,latest(All_UEBA_Events.link) as Link,latest(All_UEBA_Events.severity_id) as Score,latest(All_UEBA_Events.severity) as Severity,latest(All_UEBA_Events.threat_category) as Type,latest(All_UEBA_Events.modify_time) as ""Update Time"",values(All_UEBA_Events.user) as Users,count from datamodel=UEBA.All_UEBA_Events where nodename=""All_UEBA_Events.UEBA_Threats"" $constraints$ by _time,All_UEBA_Events.uba_event_id span=$span$ | `uitime(""Detection Time"")` | `uitime(""Update Time"")` | rename All_UEBA_Events.uba_event_id as ""Event ID"" | fields _time,""Detection Time"",""Update Time"",""Event ID"",Type,Description,Severity,Users,Devices,Score,Apps,Domains,Link,count",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,UEBA Threats,red,reverse_identity_lookup,user,"| from datamodel:""UEBA"".""UEBA_Threats"" | search $constraints$",,,Default,7,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['UEBA.All_UEBA_Events'],['UBA - UBA Anomalies By Asset - Swimlane'],SA-UEBA-default,,,,,,,,,,,,"| tstats `summariesonly` values(All_UEBA_Events.app) as Apps,latest(All_UEBA_Events.start_time) as ""Detection Time"",values(All_UEBA_Events.dvc) as Devices,values(All_UEBA_Events.url) as Domains,latest(All_UEBA_Events.link) as Link,latest(All_UEBA_Events.severity_id) as Score,latest(All_UEBA_Events.severity) as Severity,values(All_UEBA_Events.user) as Users,values(All_UEBA_Events.signature) as ""Signature"", values(All_UEBA_Events.category) as ""Category"",count from datamodel=UEBA.All_UEBA_Events where nodename=""All_UEBA_Events.UEBA_Anomalies"" $constraints$ by _time,All_UEBA_Events.uba_event_id span=$span$ | `uitime(""Detection Time"")` | rename All_UEBA_Events.uba_event_id as ""Event ID"" | fields _time,""Detection Time"",""Event ID"",""Signature"",""Category"",Severity,Users,Devices,Score,Apps,Domains,Link,count",,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,UBA Anomalies,red,reverse_asset_lookup,dvc,"| from datamodel:""UEBA"".""UEBA_Anomalies"" | search $constraints$",Default,8,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESS - Percentile - Context Gen'],SA-Utils-default,,,,,,,,,,,,"| xsCreateUDContext scope=app container=default name=percentile terms=""extreme,high,medium,low,minimal,low,medium,high,extreme"" type=domain uom=""percentage"" min=-100 max=100 count=1 | stats count",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Utils - User Realnames - Lookup Gen'],SA-Utils-default,,,False,,,,,,,,,"| rest splunk_server=local count=0 /services/authentication/users | rename title as user | eval _key=user | eval realname=if(isnull(realname) or realname="""", null(), realname) | table _key user realname | outputlookup user_realnames_lookup | stats count",0,+0s,,1,,,,*/10 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Utils - Top REST actions'],SA-Utils-default,,,,,,,,,,,,`rest_handler_transactions` | top action,rt-24h,rt,flashtimeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,flashtimeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Utils - Top REST by duration'],SA-Utils-default,,,,,,,,,,,,`rest_handler_transactions` | stats sum(duration) by handler | sort 10 - sum(duration),rt-24h,rt,flashtimeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,flashtimeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Detect PsExec With accepteula Flag - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` values(Processes.process) as process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name = PsExec.exe Processes.process = ""*accepteula*"" by Processes.process_name Processes.dest  Processes.parent_process_name | `drop_dm_object_name(Processes)`| `ctime(firstTime)`| `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for events where <code>PsExec.exe</code> is run with the <code>accepteula</code> flag in the command line. PsExec is a built-in Windows utility that enables you to execute processes on other systems. It is fully interactive for console applications. This tool is widely used for launching interactive command prompts on remote systems. Threat actors leverage this extensively for executing code on compromised systems. If an attacker is running PsExec for the first time, they will be prompted to accept the end-user license agreement (EULA), which can be passed as the argument <code>accepteula</code> within the command line.",,,,,,1,Detect PsExec With accepteula Flag,,endpoint,medium,PsExec executed with accepteula flag on $dest$.,The process pssxec.exe was run with the -accepteula flag on $dest$ by $user$.,"dest,process_name",,,,,1,dest,system,75,"dest, process_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","In this search, we are looking for the PsExec process with `accepteula` on the command line.","You must be ingesting data that records process activity from your hosts to populate the Endpoint data model in the Processes node. You must also be ingesting logs with both the process name and command line from your endpoints. The command-line arguments are mapped to the ""process"" field in the Endpoint data model.","Administrators can leverage PsExec for accessing remote systems and might pass `accepteula` as an argument if they are running this tool for the first time. However, it is not likely that you'd see multiple occurrences of this event on a machine",2018-03-28,2019-02-26,medium,ESCU - Detect PsExec With accepteula Flag - Rule,detection,Endpoint,[],"[""Sysmon""]","[""DHS Report TA18-074A"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Utils - Top REST actions by sourcetype'],SA-Utils-default,,,,,,,,,,,,"`rest_handler_transactions` | search duration>0.05 | stats sparkline(sum(duration)) as sparkline,min(duration),avg(duration),max(duration),count by handler,action | sort - count",rt-24h,rt,flashtimeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,flashtimeline,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Per-Panel Filtering - Activity By User Over Time'],SA-Utils-default,,,,,,,,,,,,| search `ppf_updates` |  `get_realname(user)` | timechart useother=`useother` count by user_realname,,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,all,,charting,,,user,column,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Per-Panel Filtering - Top Users'],SA-Utils-default,,,,,,,,,,,,"`ppf_updates` |  `get_realname(user)` | stats sparkline,count,min(_time) as firstTime,max(_time) as lastTime by user_realname | `uitime(firstTime)` | `uitime(lastTime)` | sort 100 - count",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Per-Panel Filtering - Recent Activity'],SA-Utils-default,,,,,,,,,,,,"`ppf_updates` |  `get_realname(user)` | sort 100 - _time | fillnull value=""manual edit"" action | table _time,user_realname,action,lookup_file",,now,,,,,,,,,0,,,,,false,statistics,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,1,0,0,,,,,,,,,row,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Default Admin Search Indexes'],SA-Utils-default,,,,,,,,,,,,"| rest /services/authorization/roles/admin splunk_server=* count=0 | where match(srchIndexesDefault, ""^(.*summary[0-9]?|notable)$"") | fields splunk_server, srchIndexesDefault | eval srchIndexesDefault=mvjoin(srchIndexesDefault, "","")",0,+0s,,1,number of events,greater than,0,0 3 * * *,true,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,HEALTH_CHECK:DEFAULT_ADMIN_SEARCH_SUMMARY_INDEXES,healthcheck_default_admin_search_summary_indexes,"splunk_server,srchIndexesDefault",1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Default Admin Search All Non-Internal'],SA-Utils-default,,,,,,,,,,,,"| rest /services/authorization/roles/admin splunk_server=* count=0 | eval is_asterisk=if(srchIndexesDefault == ""*"", 1, 0) | where is_asterisk=1 | fields splunk_server, srchIndexesDefault",0,+0s,,1,number of events,greater than,0,5 3 * * *,true,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,HEALTH_CHECK:DEFAULT_ADMIN_SEARCH_ALL_NON_INTERNAL,healthcheck_default_admin_search_all_noninternal,splunk_server,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Script Errors'],SA-Utils-default,,,,,,,,,,,,"| rest /services/admin/inputstatus/ModularInputs:modular%20input%20commands splunk_server=local count=0 | append [| rest /services/admin/inputstatus/ExecProcessor:exec%20commands splunk_server=local count=0] | fields inputs* | transpose | rex field=column ""inputs(?<script>S+)(?:s((?<stanza>[^(]+)))?.(?<key>(exit status description)|(time closed)|(time opened))"" | eval value=coalesce('row 1', 'row 2'), stanza=coalesce(stanza, ""default""), started=if(key==""time opened"", value, started), stopped=if(key==""time closed"", value, stopped) | rex field=value ""exiteds+withs+codes+(?<exit_status>d+)"" | stats first(started) as started, first(stopped) as stopped, first(exit_status) as exit_status by script, stanza | eval errmsg=case(exit_status==""0"", null(), isnotnull(exit_status), ""A script exited abnormally with exit status: ""+exit_status, isnull(started) or isnotnull(stopped), ""A script is in an unknown state""), ignore=if(`script_error_msg_ignore`, 1, 0) | where isnotnull(errmsg) AND ignore=0",0,+0s,,1,number of events,greater than,0,0 * * * *,true,true,0,,,,,,,,,,,,,,,,,,,,,,,,,,"script,stanza",12h,,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,HEALTH_CHECK:SCRIPT_ERRORS,healthcheck_script_errors,"errmsg,script,stanza",0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Savedsearch Statistics - Lookup Gen'],SA-Utils-default,,,0,,,,,,,,,"index=_audit action=search savedsearch_name=* info=completed | stats avg(total_run_time) as avg_run_time, avg(event_count) as avg_event_count, avg(result_count) as avg_result_count, count as invocations by savedsearch_name | join type=outer savedsearch_name [search index=_internal sourcetype=scheduler search_type=""scheduled"" OR search_type="""" | stats count(eval(status==""success"")) as success, count(eval(status==""skipped"")) as skipped by savedsearch_name] | where savedsearch_name != """" | eval update_time=now() | outputlookup key_field=savedsearch_name savedsearch_stats_lookup | stats count",-24h@h,+0s,,1,,,,*/30 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,user,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Sourcetype Readiness - Lookup Gen'],SA-Utils-default,,,0,,,,,,,,,"| metadata type=sourcetypes splunk_server=* index=* index=_* | eval readiness=if(lastTime > now() - 86400, 1, 0), update_time=now() | fields sourcetype, readiness, update_time | outputlookup key_field=sourcetype sourcetype_readiness_lookup | stats count",0,+0s,,1,,,,*/30 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Audit - Dataset Relation'],SA-Utils-default,,,0,,,,,,,,,| rest /servicesNS/nobody/SA-Utils/contentinfo/_cache timeout=600 splunk_server=local count=0 | stats count,0,+0s,,1,,,,*/30 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,false,,auto,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Detect Rare Executables - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.dest) as dest values(Processes.user) as user min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes by Processes.process_name  | rename Processes.process_name as process | rex field=user ""(?<user_domain>.*)\\(?<user_name>.*)"" | `ctime(firstTime)`| `ctime(lastTime)`| search [| tstats count from datamodel=Endpoint.Processes by Processes.process_name | rare Processes.process_name limit=30 | rename Processes.process_name as process| `filter_rare_process_whitelist`| table process ]",-70m@m,-10m@m,,1,number of events,greater than,0,10 * * * *,1,1,,,,,"This search will return a table of rare processes, the names of the systems running them, and the users who initiated each process.",,,,,,1,Detect Rare Executables,,endpoint,medium,Rare Process $process$,The process $process$ was detected running on $dest. This process is rare in your environment.,"dest, process",,,,,1,dest,system,20,"dest, process",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution""], ""kill_chain_phases"": [""Installation"", ""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 2"", ""CIS 8""], ""nist"": [""ID.AM"", ""PR.PT"", ""PR.DS"", ""DE.CM""]}","This search first executes the subsearch and counts all of your processes to determine the 10 most rare (the limit set is 10). It then filters out whitelisted processes and outputs the first and last time a rare process was encountered, the destination where the process is running, the count of occurrences, and the users who initiated the processes.","To successfully implement this search, you must be ingesting data that records process activity from your hosts and populating the endpoint data model with the resultant dataset. The macro `filter_rare_process_whitelist` searches two lookup files to whitelist your processes.  These consist of `rare_process_whitelist_default.csv` and `rare_process_whitelist_local.csv`. To add your own processes to the whitelist, add them to `rare_process_whitelist_local.csv`. If you wish to remove an entry from the default lookup file, you will have to modify the macro itself to set the whitelist value for that process to false. You can modify the limit parameter and search scheduling to better suit your environment.","Some legitimate processes may be only rarely executed in your environment. As these are identified, update `rare_process_whitelist_local.csv` to filter them out of your search results.",2016-08-09,2018-10-30,medium,ESCU - Detect Rare Executables - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Emotet Malware (TA18-201A)"", ""Unusual Processes""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Errors in the last 24 hours'],search-default,,,,,,,,,,,,error OR failed OR severe OR ( sourcetype=access_* ( 404 OR 500 OR 503 ) ),-1d,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Errors in the last hour'],search-default,,,,,,,,,,,,error OR failed OR severe OR ( sourcetype=access_* ( 404 OR 500 OR 503 ) ),-1h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Messages by minute last 3 hours'],search-default,,,,,,,,,,,,"index=_internal source=""*metrics.log"" eps ""group=per_source_thruput"" NOT filetracker | eval events=eps*kb/kbps | timechart fixedrange=t span=1m limit=5 sum(events) by series",-3h,,report_builder_display,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Splunk errors last 24 hours'],search-default,,,,,,,,,,,,"index=_internal "" error "" NOT debug source=*splunkd.log*",-24h,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Orphaned scheduled searches'],search-default,,,,,,,,,,,,"| rest timeout=600 splunk_server=local /servicesNS/-/-/saved/searches add_orphan_field=yes count=0 | search orphan=1 disabled=0 is_scheduled=1 | eval status = if(disabled = 0, ""enabled"", ""disabled"") | fields title eai:acl.owner eai:acl.app eai:acl.sharing orphan status is_scheduled cron_schedule next_scheduled_time next_scheduled_time actions | rename title AS ""search name"" eai:acl.owner AS owner eai:acl.app AS app eai:acl.sharing AS sharing",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['License Usage Data Cube'],search-default,,,,,,,,,,,,"index=_internal source=*license_usage.log* type=""Usage"" | eval h=if(len(h)=0 OR isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | eval idx=if(len(idx)=0 OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, pool, s, st, h, idx",-31d,-0d,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,-1mon@d,,,,,,,,,,,,,,,"3,13,23,33,43,53 * * * *",,,,,,,,,,,,,,,,,,,,,,
[],['Threat - Testing Rule for app permission - Rule'],search-local,,,1,,,,,,,,,index=*,-1h,now,,1,number of events,greater than,0,*/10 * * * *,,0,1,1,,,Testing Testing,,,,,,1,Testing Rule for app permission,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,{},cyrus_tam@macroview.com,,,,,,,,false,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect S3 access from a new IP - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:s3:accesslogs http_status=200  [search sourcetype=aws:s3:accesslogs http_status=200 | stats earliest(_time) as firstTime latest(_time) as lastTime by bucket_name remote_ip | inputlookup append=t previously_seen_S3_access_from_remote_ip.csv | stats min(firstTime) as firstTime, max(lastTime) as lastTime by bucket_name remote_ip | outputlookup previously_seen_S3_access_from_remote_ip.csv | eval newIP=if(firstTime >= relative_time(now(), ""-70m@m""), 1, 0) | where newIP=1 | convert ctime(firstTime) ctime(lastTime) | table bucket_name remote_ip]| iplocation remote_ip |rename remote_ip as src_ip | table _time bucket_name src_ip City Country operation request_uri",-70m@m,-10m@m,,1,number of events,greater than,0,5 * * * *,1,1,,,,,This search looks at S3 bucket-access logs and detects new or previously unseen remote IP addresses that have successfully accessed an S3 bucket.,,,,,,1,Detect S3 access from a new IP,,network,low,S3 bucket $bucketName$ was accessed by a new $src_ip$,"A remote IP, $src_ip$, has made a successful connection with an S3 $bucket_name$.","bucket_name, src_ip",,,,,1,src_ip,system,20,"bucket_name, src_ip",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Exfiltration""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 13"", ""CIS 14""], ""nist"": [""PR.DS"", ""PR.AC"", ""DE.CM""]}","Here the subsearch executes first and returns all successful S3 bucket-access attempts (HTTP code ""200"") within the last hour. It groups the results by the earliest and latest times it has seen a remote IP accessing a particular bucket. It appends this information to the historical data from the lookup file and then recalculates the `firstTime` and `lastTime` field for each remote IP accessing an S3 bucket. Next, it returns only those remote IP addresses that have first been seen accessing a specific bucket within the past hour. This is combined with the main search to return the time, bucket name, source IP, city, and country operations performed, as well as the requested URI of the resource","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your S3 access logs' inputs. This search works best when you run the ""Previously Seen S3 Bucket Access by Remote IP"" support search once to create a history of previously seen remote IPs and bucket names.","S3 buckets can be accessed from any IP, as long as it can make a successful connection. This will be a false postive, since the search is looking for a new IP within the past hour",2018-06-25,2018-06-28,low,ESCU - Detect S3 access from a new IP - Rule,detection,S3 Bucket,[],"[""AWS""]","[""Suspicious AWS S3 Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - AWS S3 Bucket details via bucketNamenESCU - Investigate AWS activities via region namenESCU - AWS Investigate User Activities By ARNnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['Network_Resolution"".""DNS']",['Threat - Detect DNS Tunneling Activity by Entropy Score - Rule'],search-local,,,,,,,,,,,,"| from datamodel:""Network_Resolution"".""DNS"" | stats  values(query) as query by _time ,src | where query!=""unknown"" | `ut_shannon(query)` | rename ut_shannon as Entropy_score | where Entropy_score > 4.5 | dedup query | sort - _time | eval _time = strftime(_time,""%Y-%m-%d %H:%m:%S"")",-10m,now,,1,number of events,greater than,1,*/5 * * * *,,1,1,1,The alert condition for '$name$' was triggered.Time     : $result._time$Host     : $result.src$Query   : $result.query$Entropy Score : $result.Entropy_score$Severity : HighMacroview SOC,,Discovers DNS Tunneling Activity and there may be abnormal connection related to Ransomware /Malware Activity.,,,,,,1,Detect DNS Tunneling Activity by Entropy Score,,network,high,Detect DNS Tunneling Activity by Entropy Score by host : $src$,Discovers DNS Tunneling Activity and there may be abnormal connection related to Ransomware /Malware Activity.,,Search DNS log by host $src$,"| from datamodel:""Network_Resolution"".""DNS""  | where src = ""$src$""",,,1,src,system,5,"query,src,dest",3600s,,search,,1,,1,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,{},"cyrus_tam@macroview.com,yul_fine@macroview.com","[""src"",""dest"",""dvc"",""orig_host""]","[""src_user"",""user""]",,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,0,0,0,0,0,,,,,,,Detect DNS Tunneling Activity by Entropy Score by host : $result.src$,0,,,,,,,,,,,,,,,,,,,,
[],['Daily license usage'],splunk_app_infrastructure-default,,,,,,,,,,,,"index=_internal source=*license_usage.log* type=""Usage"" | eval _time=_time - 43200 | eval idx=if(len(idx)=0 OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, idx  | timechart span=1d sum(b) AS volumeB by idx | fields - _timediff  | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)] | eval time=strftime(_time,""%m/%d"") | table time em_metrics main",-10d@d,@h,,1,,,,0 */1 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3600,,,,,,,,,,,,,,,,,,,
[],['OS type telemetry'],splunk_app_infrastructure-default,,,,,,,,,,,,"| inputlookup em_entities   | rename dimensions.os AS osTypes   | stats count by osTypes   | eval salted_os_type=""Infra_Insights"" . osTypes, hashed_os_types=sha256(salted_os_type)   | rename hashed_os_types as data.os_name, count as data.os_count   | makejson name data.* output=event",-1d,,,1,,,,0 22 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.sii.os_type,event,aggregate,,,,,,,,,,,
[],['App Version telemetry'],splunk_app_infrastructure-default,,,,,,,,,,,,"| rest /services/apps/local   | search disabled=0 label=""Splunk App for Infrastructure""   | rename label as data.app_name, version as data.app_version   | makejson name data.* output=event",-1d,,,1,,,,0 22 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.sii.app_version,event,aggregate,,,,,,,,,,,
[],['Alert definition telemetry'],splunk_app_infrastructure-default,,,,,,,,,,,,"| rest /servicesNS/-/-/saved/searches   | search eai:acl.app=""splunk_app_infrastructure"" action.em_write_alerts = 1   | rex field=search ""metric_name=""(?<metric_name>[^""]*)""   | rex field=search ""aggregation_method=""(?<aggregation_method>[^""]*)""   | eval salted_alert_title= ""Infra_Insights"" . title, hashed_alert_title=sha256(salted_alert_title)   | rename hashed_alert_title as data.hashed_alert_title, metric_name as data.alert_metric_name, aggregation_method as data.alert_aggregation_method   | makejson name data.* output=event",-1d,,,1,,,,0 22 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.sii.alert_definitions,event,aggregate,,,,,,,,,,,
[],['Group definition telemetry'],splunk_app_infrastructure-default,,,,,,,,,,,,"| inputlookup em_groups | makemv delim="","" filter | mvexpand filter | rex field=filter ""(?<dimension_key>.*)=(?<dimension_value>.*)"" | eval salted_dimension_value= ""Infra_Insights"" . dimension_value,   salted_dimension_key= ""Infra_Insights"" . dimension_key,   salted_group_title= ""Infra_Insights"" . title,   hashed_dim_key=sha256(salted_dimension_key),   hashed_dim_value=sha256(salted_dimension_value),   hashed_group_title=sha256(salted_group_title),   filtered=if(in(dimension_key,""ImageId"",""InstanceId"", ""os"", ""os_version"", ""ip"", ""host"", ""VolumeId"", ""LoadBalancerName""), dimension_key,""""),   hashed_dim_key=if(filtered != """", filtered, hashed_dim_key) | rename hashed_dim_key as data.dimension_key, hashed_dim_value as data.dimension_value, hashed_group_title as data.group_title | stats list(data.*) as data.* by data.group_title | makejson name data.* output=event",-1d,,,1,,,,0 22 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,1,0,0,3,app.sii.group_definitions,event,aggregate,,,,,,,,,,,
[],['ActiveDirectory: Create Computer Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-computer-lookup-update`,0,now,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ActiveDirectory: Update Computer Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-computer-lookup-update`,-30m,now,,1,,,,*/15 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ActiveDirectory: Create GPO Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-gpo-lookup-update`,0,now,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ActiveDirectory: Update GPO Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-gpo-lookup-update`,-30m,now,,1,,,,*/15 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Spike in AWS API Activity - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventType=AwsApiCall [search sourcetype=aws:cloudtrail eventType=AwsApiCall | spath output=arn path=userIdentity.arn | stats count as apiCalls by arn | inputlookup api_call_by_user_baseline append=t | fields - latestCount | stats values(*) as * by arn | rename apiCalls as latestCount | eval newAvgApiCalls=avgApiCalls + (latestCount-avgApiCalls)/720 | eval newStdevApiCalls=sqrt(((pow(stdevApiCalls, 2)*719 + (latestCount-newAvgApiCalls)*(latestCount-avgApiCalls))/720)) | eval avgApiCalls=coalesce(newAvgApiCalls, avgApiCalls), stdevApiCalls=coalesce(newStdevApiCalls, stdevApiCalls), numDataPoints=if(isnull(latestCount), numDataPoints, numDataPoints+1) | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup api_call_by_user_baseline | eval dataPointThreshold = 15, deviationThreshold = 3 | eval isSpike=if((latestCount > avgApiCalls+deviationThreshold*stdevApiCalls) AND numDataPoints > dataPointThreshold, 1, 0) | where isSpike=1 | rename arn as userIdentity.arn | table userIdentity.arn] | spath output=user userIdentity.arn | stats values(eventName) as eventNames, count as numberOfApiCalls, dc(eventName) as uniqueApisCalled by user",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search will detect users creating spikes of API activity in your AWS environment.  It will also update the cache file that factors in the latest data.,,,,,,1,Detect Spike in AWS API Activity,,network,medium,Spike in AWS API activity detected by $user$,A spike in the number of AWS API calls by $user$ was detected.,user,,,,,1,user,user,30,user,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 16""], ""nist"": [""DE.DP"", ""DE.CM"", ""PR.AC""]}","This search and its corresponding subsearch run through a series of steps, as per the following: 1. Retrieves all the AWS CloudTrail log entries that have recorded AWS API calls.1. Kicks off a subsearch that retrieves the same data and pulls out the ARN into a more friendly format.1. Counts the number of API calls per ARN.1. Loads the cache file that contains the number of data points, the count from the latest hour, the API call average, and the standard deviation for each ARN.1. Drops the count from the latest hour, since it is not necessary, and merges the rest of the data with the results of the stats command. 1. Renames `apiCalls` as `latestCount`.1. Calculates the new average value for each ARN with the latest count, weighting the past much more heavily than the current hour. It does the same for the standard deviation--weighting the past more heavily than the current.1. Updates the cache file with the latest results.1. Sets the minimum threshold for the number of data points and sets the number of standard deviations away from the mean it must be to be considered a spike.1. Makes a determination regarding whether or not the current count is a spike by checking to see if the minimum data-point threshold has been met and the count is a sufficient number of standard deviations away from the average.1. Filters out anything that it determines is not a spike and returns the list of ARNs to the main search. The main search subsequently gets the names of all the API calls, the number of unique API calls, and the total number of API calls for each of these ARNs. Finally, it looks up the average and standard deviation and returns both the average and the number of standard deviations the spike is from the average.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. You can modify `dataPointThreshold` and `deviationThreshold` to better fit your environment. The `dataPointThreshold` variable is the minimum number of data points required to have a statistically significant amount of data to determine. The `deviationThreshold` variable is the number of standard deviations away from the mean that the value must be to be considered a spike.",,2018-03-12,2018-04-09,medium,ESCU - Detect Spike in AWS API Activity - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS User Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Investigate AWS User Activities by user fieldn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ActiveDirectory: Create Group Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-group-lookup-update`,0,now,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ActiveDirectory: Update Group Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-group-lookup-update`,-30m,now,,1,,,,*/15 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ActiveDirectory: Create User Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-user-lookup-update`,0,now,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ActiveDirectory: Update User Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`admon-user-lookup-update`,-30m,now,,1,,,,*/15 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS: Failing Domains'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dns-debuglog direction=""Snd"" response!=""NOERROR""|top questiontype,questionname,response|`fix-dnsname(questionname)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS: Top Failing Domains'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dns-debuglog direction=""Rcv"" response!=""NOERROR""|top questiontype,questionname|`fix-dnsname(questionname)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS: Top Hosts sending failing queries'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dns-debuglog direction=""Rcv"" response!=""NOERROR""|top src_ip",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS: Top Non-Authoritative Responses'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dns-debuglog direction=""Snd"" response!=""NOERROR"" flags!=""A*""|top questiontype,questionname|`fix-dnsname(questionname)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS: Top Querying Hosts'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dns-debuglog direction=""Rcv""|top src_ip",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS: Top Recursive Failure Domains'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dns-debuglog direction=""Rcv"" flags=""*DR"" response!=""NOERROR""|top questiontype,questionname|`fix-dnsname(questionname)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Spike in Network ACL Activity - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail `NetworkACLEvents` [search sourcetype=aws:cloudtrail `NetworkACLEvents` | spath output=arn path=userIdentity.arn | stats count as apiCalls by arn | inputlookup network_acl_activity_baseline append=t | fields - latestCount | stats values(*) as * by arn | rename apiCalls as latestCount | eval newAvgApiCalls=avgApiCalls + (latestCount-avgApiCalls)/720 | eval newStdevApiCalls=sqrt(((pow(stdevApiCalls, 2)*719 + (latestCount-newAvgApiCalls)*(latestCount-avgApiCalls))/720)) | eval avgApiCalls=coalesce(newAvgApiCalls, avgApiCalls), stdevApiCalls=coalesce(newStdevApiCalls, stdevApiCalls), numDataPoints=if(isnull(latestCount), numDataPoints, numDataPoints+1) | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup network_acl_activity_baseline | eval dataPointThreshold = 15, deviationThreshold = 3 | eval isSpike=if((latestCount > avgApiCalls+deviationThreshold*stdevApiCalls) AND numDataPoints > dataPointThreshold, 1, 0) | where isSpike=1 | rename arn as userIdentity.arn | table userIdentity.arn] | spath output=user userIdentity.arn | stats values(eventName) as eventNames, count as numberOfApiCalls, dc(eventName) as uniqueApisCalled by user",-70m@m,-10m@m,,1,number of events,greater than,0,10 * * * *,1,1,,,,,This search will detect users creating spikes in API activity related to network access-control lists (ACLs)in your AWS environment.,,,,,,1,Detect Spike in Network ACL Activity,,network,medium,Spike in AWS Network ACL activity detected by $user$,A spike in the number of AWS API calls related to network ACLs by $user$ was detected.,user,,,,,1,user,user,30,user,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Persistence"", ""Exfiltration""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 12"", ""CIS 11""], ""nist"": [""DE.DP"", ""DE.CM"", ""PR.AC""]}","This search and its corresponding subsearch run through the following series of steps: 1. Retrieve all the AWS CloudTrail log entries that have recorded AWS API calls specifically for creating/modifying/replacing network Access Control Lists (ACLs).1. Kick off a subsearch that retrieves the same data and pulls out the ARN into a more friendly format.1. Count the number of API calls per Amazon Resource Name (ARN).1. Load the cache file that contains the number of data points, the count from the latest hour, the API call average, and the standard deviation for each ARN.1. Drop the count from the latest hour, since it is not necessary, and merge the rest of the data with the results of the stats command. 1. Rename `apiCalls` as `latestCount`.1. Calculate the new average value for each ARN with the latest count, weighting the past much more heavily than the current hour. They do the same for the standard deviation--weighting the past more heavily than the current.1. Update the cache file with the latest results.1. Set the minimum threshold for the number of data points and set the number of standard deviations away from the mean it must be to be considered a spike.1. Make a determination regarding whether or not the current count is a spike by checking to see if the minimum data-point threshold has been met and the count is a sufficient number of standard deviations away from the average.1. Filter out anything that it determines is not a spike and return the list of ARNs to the main search. The main search subsequently gets the names of all the API calls, the number of unique API calls, and the total number of API calls for each of these ARNs. Finally, it looks up the average and standard deviation and returns both the average and the number of standard deviations the spike is from the average.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. You can modify `dataPointThreshold` and `deviationThreshold` to better fit your environment. The `dataPointThreshold` variable is the minimum number of data points required to have a statistically significant amount of data to determine. The `deviationThreshold` variable is the number of standard deviations away from the mean that the value must be to be considered a spike. This search works best when you run the ""Baseline of Network ACL Activity by ARN"" support search once to create a lookup file of previously seen Network ACL Activity. To add or remove API event names related to network ACLs, edit the macro `NetworkACLEvents`.",The false-positive rate may vary based on the values of`dataPointThreshold` and `deviationThreshold`. Please modify this according the your environment.,2018-05-17,2018-05-21,medium,ESCU - Detect Spike in Network ACL Activity - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Network ACL Activity""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - AWS Network ACL Details from IDnESCU - AWS Network Interface details via resourceIdnESCU - AWS Investigate User Activities By ARNn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change.All_Changes'],['Access - Short-lived Account Detected - Rule'],DA-ESS-AccessProtection-default,,,True,,,,,,,,,"| tstats `summariesonly` count from datamodel=Change.All_Changes where nodename=""All_Changes.Account_Management"" (All_Changes.action=""created"" OR All_Changes.action=""deleted"") by _time,All_Changes.dest,All_Changes.user span=1s | `drop_dm_object_name(""All_Changes"")` | streamstats range(_time) as delta,sum(count) as count by user,dest window=2 global=f | where count>1 AND delta<`useraccount_minimal_lifetime` | `uptime2string(delta,timestr)` | table user, dest, delta, timestr",-250m@m,+0s,,1,number of events,greater than,0,*/15 * * * *,1,1,0,,,,Detects when a account or credential is created and then removed a short time later. This may be an indication of malicious activities.,,,,,0,1,Short-lived Account Detected,0,access,high,Short-lived Account Detected ($user$),Account $user$ on $dest$ created and deleted within $timestr$,user,View account change events of $user$,"| from datamodel:""Change"".""Account_Management"" | search user=""$user$"" (action=""created"" OR action=""deleted"")",,,1,user,user,80,user,14400s,false,SplunkEnterpriseSecuritySuite,,1,notable,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DNS: Top Requested Queries'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dns-debuglog direction=""Rcv""|top questiontype,questionname|`fix-dnsname(questionname)`",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DomainSelector_Lookup'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`domain-selector-search` | eval _key = host | outputlookup DomainSelector append=true,-1h,now,,1,,,,*/15 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['DomainSelector_Lookup_Migrate'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup DomainSelector | inputlookup append=true DomainSelector.csv | eval _key = host | outputlookup DomainSelector,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['HostToDomain_Lookup_Update'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`domain-list` | sort host | eval _key = host | outputlookup HostToDomain append=true,-24h@h,now,,1,,,,30 2 * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['HostToDomain_Lookup_Migrate'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup HostToDomain | inputlookup append=true DomainList.csv | eval _key = host | outputlookup HostToDomain,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['tHostInfo_Lookup_Update'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"`thostinfo`|inputlookup append=T tHostInfo|where _time > relative_time(now(), ""-30d@d"")|sort 0 src_ip,src_hostdomain,_time|dedup consecutive=T src_ip,src_hostdomain|sort 0 -_time|outputlookup tHostInfo",-5m,now,,1,,,,*/5 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['tHostInfo_Lookup_Migrate'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup tHostInfo.csv | outputlookup tHostInfo,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['tSessions_Lookup_Update'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`tsessions`|eval _key = session_id |sort 0 _time|outputlookup tSessions  append=true,-15m,now,,1,,,,*/10 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['tSessions_Lookup_Update_Per_Day'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| inputlookup tSessions | where _time > relative_time(now(), ""-30d@d"") | outputlookup tSessions",,,,1,,,,0 0 * * 0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['tSessions_Lookup_Update_For_Lost_Data'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,`tsessions`|eval _key = session_id |sort 0 _time|outputlookup tSessions  append=true,-0d@d,now,,1,,,,"2 1,2 * * 0",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Spike in S3 Bucket deletion - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail eventName=DeleteBucket [search sourcetype=aws:cloudtrail eventName=DeleteBucket | spath output=arn path=userIdentity.arn | stats count as apiCalls by arn | inputlookup s3_deletion_baseline append=t | fields - latestCount | stats values(*) as * by arn | rename apiCalls as latestCount | eval newAvgApiCalls=avgApiCalls + (latestCount-avgApiCalls)/720 | eval newStdevApiCalls=sqrt(((pow(stdevApiCalls, 2)*719 + (latestCount-newAvgApiCalls)*(latestCount-avgApiCalls))/720)) | eval avgApiCalls=coalesce(newAvgApiCalls, avgApiCalls), stdevApiCalls=coalesce(newStdevApiCalls, stdevApiCalls), numDataPoints=if(isnull(latestCount), numDataPoints, numDataPoints+1) | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup s3_deletion_baseline | eval dataPointThreshold = 15, deviationThreshold = 3 | eval isSpike=if((latestCount > avgApiCalls+deviationThreshold*stdevApiCalls) AND numDataPoints > dataPointThreshold, 1, 0) | where isSpike=1 | rename arn as userIdentity.arn | table userIdentity.arn] | spath output=user userIdentity.arn | spath output=bucketName path=requestParameters.bucketName | stats values(bucketName) as bucketName, count as numberOfApiCalls, dc(eventName) as uniqueApisCalled by user",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search detects users creating spikes in API activity related to deletion of S3 buckets in your AWS environment. It will also update the cache file that factors in the latest data.,,,,,,1,Detect Spike in S3 Bucket deletion,,network,medium,Spike detected in S3 bucket deletion activity by $user$.,A spike in the number of S3 buckets deleted by $user$ was detected.,user,,,,,1,user,user,30,user,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 13""], ""nist"": [""DE.DP"", ""DE.CM"", ""PR.AC""]}","This search and its corresponding subsearch run through the following series of steps: 1. Retrieve all the AWS CloudTrail log entries that have recorded AWS API calls specifically for deletion of S3 buckets.1. Kick off a subsearch that retrieves the same data and pulls out and converts the ARN into a more friendly format.1. Count the number of API calls per ARN.1. Load the cache file that contains the number of data points, the count from the latest hour, the API call average, and the standard deviation for each ARN.1. Drop the count from the latest hour, since it is unnecessary, and merge the rest of the data with the results of the `stats` command. 1. Rename `apiCalls` as `latestCount`.1. Calculate the new average value for each ARN with the latest count, weighting the past more heavily than the current hour. It does the same for the standard deviation&#151;weighting the past more heavily than the current.1. Update the cache file with the latest results.1. Set the minimum threshold for the number of data points and the number of standard deviations away from the mean it must be to be considered a spike.1. Make a determination regarding whether or not the current count is a spike by checking to see if the minimum data-point threshold has been met and if the count is a sufficient number of standard deviations away from the average.1. Filter out anything that it determines is not a spike and returns the list of ARNs to the main search. The main search subsequently gets the names of the deleted S3 buckets, the number of unique API calls, and the total number of API calls for each of these user ARNs.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. You can modify `dataPointThreshold` and `deviationThreshold` to better fit your environment. The `dataPointThreshold` variable is the minimum number of data points required to have a statistically significant amount of data to determine. The `deviationThreshold` variable is the number of standard deviations away from the mean that the value must be to be considered a spike. This search works best when you run the ""Baseline of S3 Bucket deletion activity by ARN"" support search once to create a baseline of previously seen S3 bucket-deletion activity.","Based on the values of`dataPointThreshold` and `deviationThreshold`, the false positive rate may vary. Please modify this according the your environment.",2018-07-17,2018-11-27,medium,ESCU - Detect Spike in S3 Bucket deletion - Rule,detection,S3 Bucket,[],"[""AWS""]","[""Suspicious AWS S3 Activities""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - AWS S3 Bucket details via bucketNamenESCU - Investigate AWS activities via region namenESCU - AWS Investigate User Activities By ARNnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['tSessions_Lookup_Update_One_Time'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"`wineventlog-index` eventtype=wineventlog_security session_id=""*x*"" session_id!=""0x3e7"" earliest=-30d@d latest=now() | eval login_username = if(eventtype==""msad-successful-user-logons"",user,NULL)     | eval login_domain=if(eventtype==""msad-successful-user-logons"",dest_nt_domain,NULL)     | stats earliest(_time) as _time values(eventtype) as eventtype count as eventcount values(src_ip) as src_ip values(user) as user values(host) as host values(login_username) as login_username values(login_domain) as login_domain by session_id     | where eventtype==""msad-successful-user-logons"" AND eventcount>=1 AND isnotnull(src_ip) AND isnotnull(user)     | eval login_host=if(src_ip==""127.0.0.1"" OR src_ip==""::1"" OR src_ip==""-"",upper(host),src_ip)     | table _time,session_id,login_username,login_domain,login_host |eval _key = session_id |sort 0 _time|outputlookup tSessions  append=true",-30d@d,now,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['tSessions_Lookup_Migrate'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup tSessions.csv | outputlookup tSessions,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SiteInfo_Lookup_Update'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=msad-dc-health | table host,Site | dedup host, Site | eval _key = host | outputlookup SiteInfo append=true",-60m,now,,1,,,,30 * * * *,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['SiteInfo_Lookup_Migrate'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup SiteInfo | inputlookup append=true SiteInfo.csv | eval _key = host | outputlookup SiteInfo,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Event - Event Details'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| inputlookup windows_event_details| table LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription| sort  LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription",0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Event - Host'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup windows_event_system| dedup Host| table Host| sort Host,0,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Event - EventCode Description'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| inputlookup windows_event_details| dedup EventCode| eval Event=EventCode."":"".EventCodeDescription| table EventCode, EventCodeDescription, Event| sort EventCode",0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Event - EventCode'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup windows_event_details| dedup EventCode| table EventCode| sort EventCode,0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Event - LogName'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup windows_event_details| dedup LogName| table LogName| sort LogName,0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Event - TaskCategory'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup windows_event_details| dedup TaskCategory| table TaskCategory| sort TaskCategory,0,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Spike in Security Group Activity - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudtrail `securityGroupAPIs` [search sourcetype=aws:cloudtrail `securityGroupAPIs` | spath output=arn path=userIdentity.arn | stats count as apiCalls by arn | inputlookup security_group_activity_baseline append=t | fields - latestCount | stats values(*) as * by arn | rename apiCalls as latestCount | eval newAvgApiCalls=avgApiCalls + (latestCount-avgApiCalls)/720 | eval newStdevApiCalls=sqrt(((pow(stdevApiCalls, 2)*719 + (latestCount-newAvgApiCalls)*(latestCount-avgApiCalls))/720)) | eval avgApiCalls=coalesce(newAvgApiCalls, avgApiCalls), stdevApiCalls=coalesce(newStdevApiCalls, stdevApiCalls), numDataPoints=if(isnull(latestCount), numDataPoints, numDataPoints+1) | table arn, latestCount, numDataPoints, avgApiCalls, stdevApiCalls | outputlookup security_group_activity_baseline | eval dataPointThreshold = 15, deviationThreshold = 3 | eval isSpike=if((latestCount > avgApiCalls+deviationThreshold*stdevApiCalls) AND numDataPoints > dataPointThreshold, 1, 0) | where isSpike=1 | rename arn as userIdentity.arn | table userIdentity.arn] | spath output=user userIdentity.arn | stats values(eventName) as eventNames, count as numberOfApiCalls, dc(eventName) as uniqueApisCalled by user",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search will detect users creating spikes in API activity related to security groups in your AWS environment.  It will also update the cache file that factors in the latest data.,,,,,,1,Detect Spike in Security Group Activity,,network,medium,Spike in AWS Security Group activity detected by $user$,A spike in the number of AWS API calls related to security groups by $user$ was detected.,user,,,,,1,user,user,30,user,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Credential Access"", ""Execution""], ""kill_chain_phases"": [""Actions on Objectives""], ""cis20"": [""CIS 16""], ""nist"": [""DE.DP"", ""DE.CM"", ""PR.AC""]}","This search and its corresponding subsearch run through the following series of steps: 1. Retrieves all the AWS CloudTrail log entries that have recorded AWS API calls specifically for security groups.1. Kicks off a subsearch that retrieves the same data and pulls out the ARN into a more friendly format.1. Counts the number of API calls per ARN.1. Loads the cache file that contains the number of data points, the count from the latest hour, the API call average, and the standard deviation for each ARN.1. Drops the count from the latest hour, since it is not necessary, and merges the rest of the data with the results of the stats command. 1. Renames `apiCalls` as `latestCount`.1. Calculates the new average value for each ARN with the latest count, weighting the past much more heavily than the current hour. It does the same for the standard deviation--weighting the past more heavily than the current.1. Updates the cache file with the latest results.1. Sets the minimum threshold for the number of data points and sets the number of standard deviations away from the mean it must be to be considered a spike.1. Makes a determination regarding whether or not the current count is a spike by checking to see if the minimum data-point threshold has been met and the count is a sufficient number of standard deviations away from the average.1. Filters out anything that it determines is not a spike and returns the list of ARNs to the main search. The main search subsequently gets the names of all the API calls, the number of unique API calls, and the total number of API calls for each of these ARNs. Finally, it looks up the average and standard deviation and returns both the average and the number of standard deviations the spike is from the average.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your CloudTrail inputs. You can modify `dataPointThreshold` and `deviationThreshold` to better fit your environment. The `dataPointThreshold` variable is the minimum number of data points required to have a statistically significant amount of data to determine. The `deviationThreshold` variable is the number of standard deviations away from the mean that the value must be to be considered a spike.This search works best when you run the ""Baseline of Security Group Activity by ARN"" support search once to create a history of previously seen Security Group Activity. To add or remove API event names for security groups, edit the macro `securityGroupAPIs`.","Based on the values of`dataPointThreshold` and `deviationThreshold`, the false positive rate may vary. Please modify this according the your environment.",2018-04-17,2018-04-18,medium,ESCU - Detect Spike in Security Group Activity - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS User Monitoring""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Investigate AWS User Activities by user fieldn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Perfmon - Combined'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| inputlookup windows_perfmon_details | dedup instance | table object, counter , instance | sort object, counter, instance",0,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Perfmon - Object'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup windows_perfmon_details| dedup object| table object| sort object,0,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['WinApp_Lookup_Perfmon - Collections, Object, and counters']",splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup windows_perfmon_details| stats values(counter) as Perfmon_counters by object| sort object,0,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Perfmon - counters and instances'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| inputlookup windows_perfmon_details| eval Perfmon_counters=object."": "".counter| stats values(instance) as Perfmon_instances by Perfmon_counters| sort Perfmon_counters",0,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Perfmon - Host'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| inputlookup windows_perfmon_system| dedup Host| table Host| sort Host,0,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Perfmon - Update - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""perfmon_windows"" object=* | eval Host=if(isNull(Host),host,Host) | stats count by Host | eval _key = Host | outputlookup windows_perfmon_system append=true",-80m,now,,1,,,,0 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Perfmon - Update - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""perfmon_windows"" object=* | eval instance = if(isnull(instance), ""NA"", instance) | stats count by collection, object, counter, instance | sort collection, object, counter, instance | eval _key = collection . ""___"" . object . ""___"" . counter . ""___"" . instance | outputlookup windows_perfmon_details append=true",-80m,now,,1,,,,1 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Event - Update - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" | eval Host=if(isnull(Host), upper(host), upper(Host)) | stats count by Host | eval _key = Host | outputlookup windows_event_system append=true",-80m,now,,1,,,,2 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Event - Update - Detail'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=""wineventlog_common"" | dedup EventCode, LogName | fields + LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription, Message | eval EventCodeDescription=if(isnull(EventCodeDescription) OR len(trim(EventCodeDescription))==0 OR EventCode==""No Description Available-Update windows_eventcode_definitions"", mvindex(split(Message, "".""), 0), EventCodeDescription) | table LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription | eval _key = LogName . ""___"" . EventCode . ""___"" . SourceName . ""___"" . TaskCategory . ""___"" . Type . ""___"" . EventCodeDescription | outputlookup windows_event_details append=true",-80m,now,search,1,,,,3 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon - Update - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""hostmon_windows"" | eval Host=if(isnull(Host), upper(host), upper(Host)) | stats count by Host | eval _key = Host | outputlookup windows_hostmon_system append=true",-80m,now,,1,,,,4 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['ESCU - Detect Spike in blocked Outbound Traffic from your AWS - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"sourcetype=aws:cloudwatchlogs:vpcflow action=blocked (src_ip=10.0.0.0/8 OR src_ip=172.16.0.0/12 OR src_ip=192.168.0.0/16) ( dest_ip!=10.0.0.0/8 AND dest_ip!=172.16.0.0/12 AND dest_ip!=192.168.0.0/16)  [search  sourcetype=aws:cloudwatchlogs:vpcflow action=blocked (src_ip=10.0.0.0/8 OR src_ip=172.16.0.0/12 OR src_ip=192.168.0.0/16) ( dest_ip!=10.0.0.0/8 AND dest_ip!=172.16.0.0/12 AND dest_ip!=192.168.0.0/16)  | stats count as numberOfBlockedConnections by src_ip | inputlookup baseline_blocked_outbound_connections append=t | fields - latestCount | stats values(*) as * by src_ip | rename numberOfBlockedConnections as latestCount | eval newAvgBlockedConnections=avgBlockedConnections + (latestCount-avgBlockedConnections)/720 | eval newStdevBlockedConnections=sqrt(((pow(stdevBlockedConnections, 2)*719 + (latestCount-newAvgBlockedConnections)*(latestCount-avgBlockedConnections))/720)) | eval avgBlockedConnections=coalesce(newAvgBlockedConnections, avgBlockedConnections), stdevBlockedConnections=coalesce(newStdevBlockedConnections, stdevBlockedConnections), numDataPoints=if(isnull(latestCount), numDataPoints, numDataPoints+1) | table src_ip, latestCount, numDataPoints, avgBlockedConnections, stdevBlockedConnections | outputlookup baseline_blocked_outbound_connections | eval dataPointThreshold = 5, deviationThreshold = 3 | eval isSpike=if((latestCount > avgBlockedConnections+deviationThreshold*stdevBlockedConnections) AND numDataPoints > dataPointThreshold, 1, 0) | where isSpike=1 | table src_ip] | stats values(dest_ip) as ""Blocked Destination IPs"", values(interface_id) as ""resourceId"" count as numberOfBlockedConnections, dc(dest_ip) as uniqueDestConnections by src_ip",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search will detect spike in blocked outbound network connections originating from within your AWS environment.  It will also update the cache file that factors in the latest data.,,,,,,1,Detect Spike in blocked Outbound Traffic from your AWS,,network,medium,Spike in blocked outbound network connections from $src_ip$ detected.,A spike in the blocked outbound connection is detected from source $src_ip$.,src_ip,,,,,1,src_ip,system,30,src_ip,14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Exfiltration"", ""Command and Control""], ""kill_chain_phases"": [""Actions on Objectives"", ""Command and Control""], ""cis20"": [""CIS 11""], ""nist"": [""DE.AE"", ""DE.CM"", ""PR.AC""]}","This search retrieves all the VPC Flow log entries that have recorded a blocked outbound network connection originating from your AWS environment. Then it kicks off a subsearch, which looks at the same data and performs the following series of steps: 1. Counts the number of blocked outbound connections by each source IP1. Loads the cache file that contains the number of data points, the count from the latest hour, the average blocked connections, and the standard deviation for each source IP.1. Drops the count from the latest hour, since it is not necessary, and merges the rest of the data with the results of the stats command. 1. Renames `numberOfBlockedConnections` as `latestCount`.1. Calculates the new average value for each source IP with the latest count, weighting the past much more heavily than the current hour. It does the same for the standard deviation, weighting the past more heavily than the current.1. Updates the cache file with the latest results.1. Sets the minimum threshold for the number of data points and sets the number of standard deviations away from the mean it must be to be considered a spike.1. Makes a determination regarding whether or not the current count is a spike by checking to see if the minimum data-point threshold has been met and the count is a sufficient number of standard deviations away from the average.1. Filters out anything that it determines is not a spike and returns the list of source IPs to the main search. The main search subsequently gets the list of all destination IPs for which the traffic was blocked, the network interface ID, the number of unique destination IP, and the total number of blocked connections for each of these source IP addresses. Finally, it looks up the average and standard deviation and returns both the average and the number of standard deviations the spike is from the average.","You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS (version 4.4.0 or later), then configure your VPC Flow logs. You can modify `dataPointThreshold` and `deviationThreshold` to better fit your environment. The `dataPointThreshold` variable is the number of data points required to meet the definition of ""spike."" The `deviationThreshold` variable is the number of standard deviations away from the mean that the value must be to be considered a spike. This search works best when you run the ""Baseline of Blocked Outbound Connection"" support search once to create a history of previously seen blocked outbound connections.","The false-positive rate may vary based on the values of`dataPointThreshold` and `deviationThreshold`. Additionally, false positives may result when AWS administrators roll out policies enforcing network blocks, causing sudden increases in the number of blocked outbound connections.",2018-04-26,2018-05-07,medium,ESCU - Detect Spike in blocked Outbound Traffic from your AWS - Rule,detection,AWS Instance,[],"[""AWS""]","[""AWS Network ACL Activity"", ""Command and Control"", ""Suspicious AWS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - AWS Network Interface details via resourceIdnESCU - Get All AWS Activity From IP Addressn""}",0,3600,86400,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Machine - Update - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""hostmon_windows"" Type=OperatingSystem | join host [search eventtype=hostmon_windows Type=Computer earliest=-80m] | stats count by OS, Domain, Architecture, Manufacturer | eval _key = OS . ""___"" . Domain . ""___"" . Architecture . ""___"" . Manufacturer | outputlookup windows_hostmon_machine_details append=true",-80m,now,,1,,,,5 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_FS - Update - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=hostmon_windows Type=Disk | eval FreeSpacePct=round(FreeSpaceKB/TotalSpaceKB*100) | eval TotalSpaceGB=round(TotalSpaceKB/1024/1024) | stats count by FileSystem, DriveType, FreeSpacePct, TotalSpaceGB | eval _key = FileSystem . ""___"" . DriveType . ""___"" . FreeSpacePct . ""___"" . TotalSpaceGB | outputlookup windows_hostmon_fs_details append=true",-80m,now,,1,,,,6 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Process - Update - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,eventtype=hostmon_windows Type=Process | stats count by Name | eval _key = Name | outputlookup windows_hostmon_process_details append=true,-80m,now,,1,,,,7 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Services - Update - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=hostmon_windows Type=Service | stats count by Name, StartMode, State | eval _key = Name . ""___"" . StartMode . ""___"" . State | outputlookup windows_hostmon_services_details append=true",-80m,now,,1,,,,8 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Netmon - Update - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""netmon_windows"" | eval Host=if(isnull(Host), upper(host), upper(Host)) | stats count by Host | eval _key = Host | outputlookup windows_netmon_system append=true",-80m,now,,1,,,,9 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Netmon - Update - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""netmon_windows"" | stats count by Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName | sort Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName | eval _key = Direction . ""___"" . Protocol . ""___"" . PacketType . ""___"" . RemoteHostName . ""___"" . RemotePort . ""___"" . LocalPort . ""___"" . ProcessName . ""___"" . UserName | outputlookup windows_netmon_details append=true",-80m,now,,1,,,,10 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Printmon - Update'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"sourcetype=WinPrintMon | eval Host=if(isnull(Host), upper(host), upper(Host)) | stats count by Host printer operation user | sort Host printer operation user | eval _key = Host . ""___"" . printer . ""___"" . operation . ""___"" . user | outputlookup windows_printmon append=true",-80m,now,,1,,,,11 * * * *,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,true,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,1,,true,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Perfmon - CreateNew - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""perfmon_windows"" object=* earliest=-60m | eval Host=if(isNull(Host),host,Host) | stats count by Host | outputlookup windows_perfmon_system",0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Netmon - CreateNew - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""netmon_windows"" | eval Host=if(isnull(Host), upper(host), upper(Host)) | stats count by Host | outputlookup windows_netmon_system",0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Netmon - CreateNew - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""netmon_windows"" | fields Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName | dedup Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName | table Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName | sort Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName | outputlookup windows_netmon_details",0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Change_Analysis where'],['ESCU - Detect USB device insertion - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count earliest(_time) AS earliest latest(_time) AS latest from datamodel=Change_Analysis where (nodename = All_Changes) All_Changes.result=""Removable Storage device"" (All_Changes.result_id=4663 OR All_Changes.result_id=4656) (All_Changes.src_priority=high) by All_Changes.dest | `drop_dm_object_name(""All_Changes"")`| `ctime(earliest)`| `ctime(latest)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"The search is used to detect hosts that generate Windows Event ID 4663 for successful attempts to write to or read from a removable storage and Event ID 4656 for failures, which occurs when a USB drive is plugged in. In this scenario we are querying the Change_Analysis data model to look for Windows Event ID 4656 or 4663 where the priority of the affected host is marked as high in the ES Assets and Identity Framework.",,,,,,1,Detect USB device insertion,,endpoint,low,Read/Write attempt to a USB detected on $dest$,Read/Write attempt to a USB was detected on this host,dest,,,,,1,dest,system,20,dest,86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Exfiltration""], ""kill_chain_phases"": [""Installation"", ""Actions on Objectives""], ""cis20"": [""CIS 13""], ""nist"": [""PR.PT"", ""PR.DS""]}","USB is a common attack vector for delivering or propagating malicious code, or the exfiltration of data. Your corporation may have a policy of not allowing removable media at all, or may only allow approved media to be used on specific hosts by specific users. By logging USB activity from Windows and other endpoints gathered using the Universal Forwarder, you can gain an understanding of what systems might be vulnerable to attack via removable media, or what users might need additional security training. This search is looking for event_id 4656 for failure and 4663 for successful USB read/write attempts from Windows Security Event logs, which is the event code generated when a files are read from and written to a removable storage device","To successfully implement this search, you must ingest Windows Security Event logs and track event code 4663 and 4656. Ensure that the field from the event logs is being mapped to the result_id field in the Change_Analysis data model. To minimize the alert volume, this search leverages the Assets and Identity framework to filter out events from those assets not marked high priority in the Enterprise Security Assets and Identity Framework.",Legitimate USB activity will also be detected. Please verify and investigate as appropriate.,2017-08-03,2017-11-27,low,ESCU - Detect USB device insertion - Rule,detection,Endpoint,[],"[""Microsoft Windows""]","[""Data Protection""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get DNS Server History for a hostnESCU - Get Process responsible for the DNS trafficn""}",0,3600,86400,0,,,,,"[""Change_Analysis""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Printmon - CreateNew'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"sourcetype=WinPrintMon | eval Host=if(isnull(Host), upper(host), upper(Host)) | fields Host printer operation user | dedup Host printer operation user | table Host printer operation user | sort Host printer operation user | outputlookup windows_printmon",0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Perfmon - CreateNew - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""perfmon_windows"" object=* | fillnull value=NA instance | dedup collection, object, counter, instance | table collection, object, counter, instance | outputlookup windows_perfmon_details",0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Event - CreateNew - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" | eval Host=if(isnull(Host), upper(host), upper(Host)) | fields Host | dedup Host | table Host | sort Host | outputlookup windows_event_system",0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Event - CreateNew - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" | dedup EventCode | fields + LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription | dedup EventCode, Type | table LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription | sort  LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription | outputlookup windows_event_details",0,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon - CreateNew - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""hostmon_windows""| eval Host=if(isnull(Host), upper(host), upper(Host)) | fields Host | dedup Host | table Host | sort Host | outputlookup windows_hostmon_system",0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Machine - CreateNew - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""hostmon_windows"" Type=OperatingSystem | join host [search eventtype=hostmon_windows Type=Computer] | dedup OS, Domain, Architecture, Manufacturer | table OS, Domain, Architecture, Manufacturer | outputlookup windows_hostmon_machine_details",0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_FS - CreateNew - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=hostmon_windows Type=Disk | eval FreeSpacePct=round(FreeSpaceKB/TotalSpaceKB*100) | eval TotalSpaceGB=round(TotalSpaceKB/1024/1024) | dedup FileSystem, DriveType, FreeSpacePct, TotalSpaceGB | table FileSystem, DriveType, FreeSpacePct, TotalSpaceGB | outputlookup windows_hostmon_fs_details",0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Process - CreateNew - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,eventtype=hostmon_windows Type=Process | dedup Name | table Name | outputlookup windows_hostmon_process_details,0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Services - CreateNew - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=hostmon_windows Type=Service | dedup Name, StartMode, State | table Name, StartMode, State | outputlookup windows_hostmon_services_details",0,,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Generic event counts'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" | stats count by LogName, EventCode, Keywords, TaskCategory, Type",-60m@m,now,search,,,,,,,,0,,,,Event search try,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Sessions where'],['ESCU - Detect Unauthorized Assets by MAC address - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count from datamodel=Network_Sessions where nodename=All_Sessions.DHCP All_Sessions.signature=DHCPREQUEST by All_Sessions.src_ip All_Sessions.src_mac | dedup All_Sessions.src_mac| `drop_dm_object_name(""Network_Sessions"")`|`drop_dm_object_name(""All_Sessions"")` | search NOT [| inputlookup asset_lookup_by_str |rename mac as src_mac | fields + src_mac]",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"By populating the organization's assets within the assets_by_str.csv, we will be able to detect unauthorized devices that are trying to connect with the organization's network by inspecting DHCP request packets, which are issued by devices when they attempt to obtain an IP address from the DHCP server. The MAC address associated with the source of the DHCP request is checked against the list of known devices, and reports on those that are not found.",,,,,,1,Detect Unauthorized Assets by MAC address,,network,medium,Unauthorized Asset found with mac address: $src_mac$,The host $src$ issued a DHCP request to connect with your network that does not belong to the list of authorized devices,"src, query",,,,,1,src,system,20,"src_mac,src_ip",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion""], ""kill_chain_phases"": [""Reconnaissance"", ""Delivery"", ""Actions on Objectives""], ""cis20"": [""CIS 1""], ""nist"": [""ID.AM"", ""PR.DS""]}","This search requires you to leverage the Enterprise Security Assets and Identity framework to populate assets_by_str.csv. Once the assets_by_str.csv is populated, we then query your DHCP logs to detect unknown systems connecting to your network. More documentation is available at: http://docs.splunk.com/Documentation/ES/4.7.1/Admin/Verifyassetandidentitydata.","This search uses the Network_Sessions data model shipped with Enterprise Security. It leverages the Assets and Identity framework to populate the assets_by_str.csv file located in SA-IdentityManagement, which will contain a list of known authorized organizational assets including their MAC addresses. Ensure that all inventoried systems have their MAC address populated.","This search might be prone to high false positives. Please consider this when conducting analysis or investigations. Authorized devices may be detected as unauthorized. If this is the case, verify the MAC address of the system responsible for the false positive and add it to the Assets and Identity framework with the proper information.",2017-06-11,2017-09-13,medium,ESCU - Detect Unauthorized Assets by MAC address - Rule,detection,Infrastructure,[],"[""Splunk Stream"", ""Bro""]","[""Asset Tracking""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get First Occurrence and Last Occurrence of a MAC AddressnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For Endpointn""}",0,3600,86400,0,,,,,"[""Network_Sessions""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Event categories and counts by host for the last 30 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" | fields host, TaskCategory | stats count as EvtCounts by host, TaskCategory | sort -EvtCounts | eval EvtCatCnt = TaskCategory."" ("".EvtCounts."")"" | stats sum(EvtCounts) as Total_Events, values(EvtCatCnt) as Event_Category_Count by host | sort -Total_Events | eval Host_Count = host."" ("".Total_Events."")"" | table Host_Count, Event_Category_Count",-30d@d,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Event severity counts by host for the last 30 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" (EventType=2 OR EventType=3 OR EventType=1) | eval EventSeverity=case(EventType == 2, ""Error"", EventType == 3,""Warning"", EventType == 1, ""Critical"") | eval host=upper(host) | stats count by host EventSeverity | xyseries host EventSeverity count | eval t=1 | addcoltotals | sort t desc | eval host = if(t>1,""Totals"",host) | fields - t | table host *",-30d@d,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Event severity counts by host for the last 7 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" (EventType=2 OR EventType=3 OR EventType=1) | eval EventSeverity=case(EventType == 2, ""Error"", EventType == 3,""Warning"", EventType == 1, ""Critical"") | eval host=upper(host) | stats count by host EventSeverity | xyseries host EventSeverity count | eval t=1 | addcoltotals | sort t desc | eval host = if(t>1,""Totals"",host) | fields - t | table host *",-7d@h,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Event severity counts by host for the last 24 hours'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" (EventType=2 OR EventType=3 OR EventType=1) | eval EventSeverity=case(EventType == 2, ""Error"", EventType == 3,""Warning"", EventType == 1, ""Critical"") | eval host=upper(host) | stats count by host EventSeverity | xyseries host EventSeverity count | eval t=1 | addcoltotals | sort t desc | eval host = if(t>1,""Totals"",host) | fields - t | table host *",@d,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Performance counter categories and counts by host for the last 7 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""perfmon_windows"" | stats values(object) as Perfmon_counter_Category, dc(counter) as Perfmon_counter_Count by Host | table Host, Perfmon_counter_Category, Perfmon_counter_Count | sort Host",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Number of hosts with Average CPU utilization > 80% in the last 24 hours'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=perfmon_windows Host=* object=""processor"" counter=""% processor time""|stats avg(Value) as Threshold by Host | eval range=case(Threshold<10, ""OK (<50%)"", Threshold<50, ""Warn (80%-94%)"", Threshold>50, ""Critical (95%+)"") | chart values(Host), count by range",-24h,now,,,,None,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2p,,,,,,,,,,,,,,,,,,,
[],"['Average Memory utilization per process, host in the last 24 hours']",splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=perfmon_windows object=Process  counter=""Private Bytes"" | eval MB=Value/(1024*1024) | stats avg(MB) as ""Avg. Memory Utilization in MB"" by instance, host",-24h,now,,,,None,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2p,,,,,,,,,,,,,,,,,,,
[],"['Average CPU utilization per process, host in the last 24 hours']",splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=perfmon_windows object=Process counter=""% Processor Time"" | stats avg(Value) as ""Avg. CPU utilization"" by instance, Host",-24h,now,,,,None,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2p,,,,,,,,,,,,,,,,,,,
[],['Application crash count in the last 24 hours'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" EventCode=""1001"" Event_Name=""*"" | eval application=P1."" (version: "".P2."")"" | timechart count by application",-24h@h,now,,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Application crash count in the last 7 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" EventCode=""1001"" Event_Name=""*"" | eval application=P1."" (version: "".P2."")"" | timechart count by application",-7d@d,now,,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Detect Use of cmd.exe to Launch Script Interpreters - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(Processes.process) min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.parent_process=""*cmd.exe"" (Processes.process_name=cscript.exe OR Processes.process_name =wscript.exe) by Processes.parent_process Processes.process_name Processes.user Processes.dest | `drop_dm_object_name(""Processes"")` | `ctime(firstTime)`|`ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for the execution of the cscript.exe or wscript.exe processes, with a parent of cmd.exe. The search will return the count, the first and last time this execution was seen on a machine, the user, and the destination of the machine",,,,,,1,Detect Use of cmd.exe to Launch Script Interpreters,,endpoint,medium,Command prompt is executing scripts on $dest$ using $process_name$,Potentially malicious script execution detected.,"dest, process_name, parent_process",,,,,1,dest,system,50,"dest, process_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface""], ""kill_chain_phases"": [""Exploitation""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","Attackers often leverage various scripting languages to execute their attacks. In a Windows environment, the Windows Script Host is the tool that interprets the scripts and is included in all modern versions of Windows. The Windows Script Host is available as a command-line tool called ""cscript.exe"" or ""wscript.exe."" To detect this behavior, the search looks for process-creation events for cscript.exe or wscript.exe with a parent process of cmd.exe. The search will return the count, the first and last times this behavior was seen on a destination machine, and user and process information.","To successfully implement this search, you must be ingesting data that records process activity from your hosts to populate the endpoint data model in the processes node. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",Some legitimate applications may exhibit this behavior.,2017-10-09,2018-11-02,medium,ESCU - Detect Use of cmd.exe to Launch Script Interpreters - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Emotet Malware (TA18-201A)"", ""Suspicious Command-Line Executions""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable InfonESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Process InfonESCU - Get Parent Process InfonESCU - Investigate Web Activity From Hostn""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Application crash count in the last 30 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" EventCode=""1001"" Event_Name=""*"" | eval application=P1."" (version: "".P2."")"" | timechart count by application",-30d@d,now,,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Count of total installs per user for the last 7 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 | stats count by User | sort -count",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Count of total installs per user each day for the last 7 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 | timechart count by User",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['System_App Installs - By Host - Timechart - 7days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 | dedup _raw | rex field=Message ""(?s)Product: (?<product_name>.*) --"" | timechart span=1d count by host",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Count of total installs per Application each day for the last 7 days'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 | rex field=Message ""(?s)Product: (?<product_name>.*) --"" | timechart span=1d count by product_name",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],"['List of Applications, Time of install, User and Host for the last 7 days']",splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 | rex field=Message ""(?s)Product: (?<product_name>.*) --"" | table _time host User product_name",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['List of Failed KB installs in the last 7 days'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"NOT [ search eventtype=""Update_Successful"" | dedup package, host | fields + host, package ] eventtype=""Update_Failed"" package=* | dedup host package | stats count, max(_time) as latest_failure_time by host,package | sort - latest_failure_time | convert ctime(latest_failure_time) | eval kb_details=""KB"".package."" (Total Fails="".tostring(count)."") (Last Failure at:"".latest_failure_time."")"" | stats sum(count) as total_fails, values(kb_details) as latest_fail_details by host",-7d,now,,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['List of KB successful and failed KB installation for the last 30 days'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"tag=Windows_Update package=* | dedup package, host | eval status=if(eventtype==""Update_Successful"", ""Success"", if(eventtype==""Update_Failed"", ""Failed"", ""NA"")) | search NOT status=""NA""  | stats latest(_time) as ltime, count by status, host, package | convert ctime(ltime) | eval lsuccess=""Succesful at ("".ltime."")"" | eval lfail=""Failed at ("".ltime."")"" | eval lstatus=if(status==""Success"",lsuccess,lfail) | stats values(lstatus) as Status_History by host, package | sort host,package | eval scount=mvcount(Status_History) | eval Last_Status=if(scount>1,""Success"",if(match(Status_History, ""Success*""),""Success"",""Failed"")) | table host, package, Last_Status, Status_History | sort host,package",-30d@d,now,search,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['List of Successful installations (non-KB) for the last 7 days'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=""Update_Successful"" NOT package=* | dedup package, host | chart count,max(_time) as latest_install_time by package | sort - latest_install_time | convert ctime(latest_install_time)",-7d,now,,,,,,,True,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['List of shutdowns for last 30 days'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"source=wineventlog:system ""EventCode=1076"" OR ""EventCode=6008"" | rex field=Message ""(?m)(?<cause>.*)$"" | fields + _time,host,cause",-30d@d,now,,,,None,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web where'],['ESCU - Detect attackers scanning for vulnerable JBoss servers - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Web where (Web.http_method=""GET"" OR Web.http_method=""HEAD"") AND (Web.url=""*/web-console/ServerInfo.jsp*"" OR Web.url=""*web-console*"" OR Web.url=""*jmx-console*"" OR Web.url = ""*invoker*"") by Web.http_method, Web.url, Web.src, Web.dest | `drop_dm_object_name(""Web"")` | `ctime(firstTime)` | `ctime(lastTime)`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,This search looks for specific GET or HEAD requests to web servers that are indicative of reconnaissance attempts to identify vulnerable JBoss servers. JexBoss is described as the exploit tool of choice for this malicious activity.,,,,,,1,Detect attackers scanning for vulnerable JBoss servers,,network,medium,Detect attackers scanning for vulnerable JBoss servers,This search looks for specific GET/HEAD requests to web servers that are indicative of reconnaissance attempts to identify vulnerable JBoss servers.,,,,,,1,dest,system,20,"dest,url",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Discovery"", ""System Information Discovery""], ""kill_chain_phases"": [""Reconnaissance""]}",This search returns the number of times a URL associated with this type of JexBoss probe is observed.,"You must be ingesting data from the web server or network traffic that contains web specific information, and populating the Web data model.",It's possible for legitimate HTTP requests to be made to URLs containing the suspicious paths.,2016-10-04,2017-09-23,medium,ESCU - Detect attackers scanning for vulnerable JBoss servers - Rule,detection,Web Server,[],"[""Splunk Stream"", ""Palo Alto Firewall"", ""Apache"", ""Bro""]","[""JBoss Vulnerability"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['List of unexpected service terminations for the last 30 days'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"source=wineventlog:system terminated (""EventCode=7034"" OR ""EventCode=7031"") | rex field=Message ""(?i)^The (?<Service_Name>.*) service terminated unexpectedly.s+It has done this (?<num_failures>d+)"" | fields + _time,host,Service_Name",-30d@d,now,,,,None,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['List of failed service starts for the last 30 days'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"source=wineventlog:system SourceName=""Microsoft-Windows-Service Control Manager"" ""service failed to start"" | rex field=Message ""^The (?<Service_Name>.*) service failed"" | fields + _time,host,Service_Name",-30d@d,now,,,,None,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinMgmt_Security_Logon_Success Overall by Host'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=""wineventlog_common""(""EventCode=4776"" AND Keywords=""Audit Success"") OR (""EventCode=680"" AND ""Success Audit"") NOT (Logon_Account=""*$"" OR Logon_account=""*$"") | eval ""User_Account"" = coalesce(Logon_Account,Logon_account) | transaction ""User_Account"",Source_Workstation maxpause=5s | stats count by host | sort 10 -count",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinMgmt_Security_Logon_Success Overtime'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=""wineventlog_common"" (""EventCode=4776"" AND Keywords=""Audit Success"") OR (""EventCode=680"" AND ""Success Audit"") NOT (Logon_Account=""*$"" OR Logon_account=""*$"") | eval ""User_Account"" = coalesce(Logon_Account,Logon_account) | transaction ""User_Account"",Source_Workstation maxpause=5s | timechart bins=1000 count",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinMgmt_Security_Logon_Unsuccessful'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=""wineventlog_common"" (""EventCode=4776"" AND Keywords=""Audit Success"") OR (""EventCode=680"" AND ""Success Audit"") NOT (Logon_Account=""*$"" OR Logon_account=""*$"") | eval ""User_Account"" = coalesce(Logon_Account,Logon_account) | transaction ""User_Account"",Source_Workstation maxpause=5s  | stats latest(_time) as ltime, count by User_Account, Source_Workstation, dest_nt_host, field_match_sum, duration | convert ctime(ltime)",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinMgmt_System_Reboot Overtime'],splunk_app_windows_infrastructure-default,,,,,,,,,,,,"eventtype=""wineventlog_common"" EventCode=1074 SourceName=""USER32"" | rex field=_raw ""Comment:.(?<comment>.*)"" | rex field=Message ""The process.(?<process>[^ ]+)"" | transaction host maxspan=5m | eval user_count=mvcount(User) | eval final_user=case(user_count == 1, User, user_count > 1, mvindex(User, user_count-1))| eval process_count=mvcount(process) | eval final_process=case(process_count == 1, process, process_count > 1, mvindex(process, process_count-1)) | search host=""*"" final_user=""*"" | table _time host final_user final_process comment | rename _time AS Time | convert ctime(Time) | rename final_user AS Username | rename final_process AS ""Process name"" | rename comment AS ""Comment""",-7d@h,now,search,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,search,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Event - Migrate - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| outputlookup windows_event_details | inputlookup append=true windows_event_details.csv | eval _key = LogName . ""___"" . EventCode . ""___"" . SourceName . ""___"" . TaskCategory . ""___"" . Type . ""___"" . EventCodeDescription | outputlookup windows_event_details",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Event - Migrate - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup windows_event_system | inputlookup append=true windows_event_system.csv | eval _key = Host | outputlookup windows_event_system,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon - Migrate - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup windows_hostmon_system | inputlookup append=true windows_hostmon_system.csv | eval _key = Host | outputlookup windows_hostmon_system key_field=Host,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_FS - Migrate - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| outputlookup windows_hostmon_fs_details | inputlookup append=true windows_hostmon_fs_details.csv | eval _key = FileSystem . ""___"" . DriveType . ""___"" . FreeSpacePct . ""___"" . TotalSpaceGB | outputlookup windows_hostmon_fs_details",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Network_Resolution by'],['ESCU - Detect hosts connecting to dynamic domain providers - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count values(DNS.answer) as ""Dynamic DNS Resolutions"" min(_time) as firstTime from datamodel=Network_Resolution by DNS.src, DNS.query | `drop_dm_object_name(""DNS"")` | `ctime(firstTime)` | `dynamic_dns_providers`",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"Malicious actors often abuse legitimate Dynamic DNS services to host malicious payloads or interactive command and control nodes. Attackers will automate domain resolution changes by routing dynamic domains to countless IP addresses to circumvent firewall blocks, blacklists as well as frustrate a network defenders analytic and investigative processes. This search will look for DNS queries made from within your infrastructure to suspicious dynamic domains.",,,,,,1,Detect hosts connecting to dynamic domain providers,,network,medium,Host $src$ detected to make a query to a Dynamic DNS provider,The search has detected a host making outbound queries to Dynamic DNS providers,"answer, src, query",,,,,1,src,system,20,"src, query",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Exfiltration"", ""Exfiltration Over Command and Control Channel"", ""Defense Evasion"", ""Commonly Used Port""], ""kill_chain_phases"": [""Command and Control"", ""Actions on Objectives""], ""cis20"": [""CIS 8"", ""CIS 12"", ""CIS 13""], ""nist"": [""PR.DS"", ""PR.PT"", ""DE.AE"", ""DE.CM""]}",The search is querying an accelerated `Network_Resolution` data model to count and list the values of resolved domains for each DNS query and checks that against the list of Dynamic DNS providers (lookup - `dynamic_dns_providers`) by each host (DNS.src),"First, you'll need to ingest data from your DNS operations. This can be done by ingesting logs from your server or data collected passively by Splunk Stream or similar solutions. Specifically, data that contains the domain that is being queried and the IP of the host originating the request must be populating the Network_Resolution data model. This search also leverages a lookup file, `dynamic_dns_providers_default.csv`, which contains a non-exhaustive list of Dynamic DNS providers. Please consider updating the local lookup periodically by adding new domains to the list of `dynamic_dns_providers_local.csv`.","Some users and applications may leverage Dynamic DNS to reach out to some domains on the Internet since dynamic DNS by itself is not malicious, however this activity must be verified.",2017-11-17,2017-09-18,medium,ESCU - Detect hosts connecting to dynamic domain providers - Rule,detection,Endpoint,"[""dest"", ""query""]","[""Splunk Stream"", ""Bro""]","[""Command and Control"", ""DNS Hijacking"", ""Data Protection"", ""Dynamic DNS"", ""Prohibited Traffic Allowed or Protocol Mismatch"", ""Suspicious DNS Traffic""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get DNS Server History for a hostn""}",0,3600,86400,0,,,,,"[""Network_Resolution""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Machine - Migrate - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| outputlookup windows_hostmon_machine_details | inputlookup append=true windows_hostmon_machine_details.csv | eval _key = OS . ""___"" . Domain . ""___"" . Architecture . ""___"" . Manufacturer | outputlookup windows_hostmon_machine_details",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Process - Migrate - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup windows_hostmon_process_details | inputlookup append=true windows_hostmon_process_details.csv | eval _key = Name | outputlookup windows_hostmon_process_details,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Hostmon_Services - Migrate - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| outputlookup windows_hostmon_services_details | inputlookup append=true windows_hostmon_services_details.csv | eval _key = Name . ""___"" . StartMode . ""___"" . State | outputlookup windows_hostmon_services_details",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Netmon - Migrate - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| outputlookup windows_netmon_details | inputlookup append=true windows_netmon_details.csv | eval _key = Direction . ""___"" . Protocol . ""___"" . PacketType . ""___"" . RemoteHostName . ""___"" . RemotePort . ""___"" . LocalPort . ""___"" . ProcessName . ""___"" . UserName | outputlookup windows_netmon_details",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Netmon - Migrate - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup windows_netmon_system | inputlookup append=true windows_netmon_system.csv | eval _key = Host | outputlookup windows_netmon_system key_field=Host,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Perfmon - Migrate - Detail'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| outputlookup windows_perfmon_details | inputlookup append=true windows_perfmon_details.csv | eval _key = collection . ""___"" . object . ""___"" . counter . ""___"" . instance | outputlookup windows_perfmon_details",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Perfmon - Migrate - Server'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,| outputlookup windows_perfmon_system | inputlookup append=true windows_perfmon_system.csv | eval _key = Host | outputlookup windows_perfmon_system key_field=Host,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['WinApp_Lookup_Build_Printmon - Migrate'],splunk_app_windows_infrastructure-default,,,0,,,,,,,,,"| outputlookup windows_printmon | inputlookup append=true windows_printmon.csv | eval _key = Host . ""___"" . printer . ""___"" . operation . ""___"" . user | outputlookup windows_printmon",,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Bucket Copy Trigger'],splunk_archiver-default,,,,,,,,,,,,| archivebuckets,,,,1,,,,17 * * * *,,,,,,,Triggers bucket copying,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"['size', 'mvdedup(datamodel', 'name type', 'app', 'app size']",['ESS - Content Profile - Base'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `cim_datamodelinfo` | fields datamodel size | join max=0 datamodel [| contentinfo | eval datamodel=mvdedup(datamodel), name=case(isnotnull(search_name), search_name,isnotnull(panel_title), if(isnotnull(view_label), view_label, view_name) + "" - "" + panel_title, isnotnull(view_label), view_label, isnotnull(view_name), view_name, 1==1, null()), subtype=coalesce(subtype, if(isnotnull(panel_title), ""panel"", ""-"")) | fields app datamodel name type subtype| stats list(*) as *, count by datamodel app | eval name=mvjoin(name, "";""), type=mvjoin(type, "";""), subtype=mvjoin(subtype, "";"")] | fields datamodel app size name type subtype count | makemv delim="";"" name | makemv delim="";"" type | makemv delim="";"" subtype",,,,0,,,,,,0,0,,,,,0,,,0,,,,,,,,,,,,,,,,,,,,false,,,,,,,,,0,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Web where'],['ESCU - Detect malicious requests to exploit JBoss servers - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Web where (Web.http_method=""GET"" OR Web.http_method=""HEAD"") by Web.http_method, Web.url,Web.url_length Web.src, Web.dest | search Web.url=""*jmx-console/HtmlAdaptor?action=invokeOpByName&name=jboss.admin*import*"" AND Web.url_length > 200 | `drop_dm_object_name(""Web"")` | `ctime(firstTime)` | `ctime(lastTime)` | table src, dest_ip, http_method, url, firstTime, lastTime",-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search is used to detect malicious HTTP requests crafted to exploit jmx-console in JBoss servers. The malicious requests have a long URL length, as the payload is embedded in the URL.",,,,,,1,Detect malicious requests to exploit JBoss servers,,network,high,Detected malicious requests to exploit JBoss servers,A search for detecting malicious requests made to exploit jmx-console in JBoss servers. The bad requests have a long url length since it serves the payload via the url,"src, dest_ip",,,,,1,dest,system,80,"dest,url,src",14400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Defense Evasion"", ""Exploitation of Vulnerability""], ""kill_chain_phases"": [""Delivery""], ""cis20"": [""CIS 12"", ""CIS 4"", ""CIS 18""], ""nist"": [""ID.RA"", ""PR.PT"", ""PR.IP"", ""DE.AE"", ""PR.MA"", ""DE.CM""]}",This search looks for HTTP requests for a URL that has been used to exploit JBoss servers.,"You must ingest data from the web server or capture network data that contains web specific information with solutions such as Bro or Splunk Stream, and populating the Web data model",No known false positives for this detection.,2016-10-04,2017-09-23,high,ESCU - Detect malicious requests to exploit JBoss servers - Rule,detection,Web Server,[],"[""Splunk Stream"", ""Palo Alto Firewall"", ""Apache"", ""Bro""]","[""JBoss Vulnerability"", ""SamSam Ransomware""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Backup Logs For EndpointnESCU - Get Update Logs For EndpointnESCU - Get Vulnerability Logs For EndpointnESCU - Get Authentication Logs For EndpointnESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Process Information For Port ActivitynESCU - Investigate Web Activity From HostnESCU - Investigate Successful Remote Desktop AuthenticationsnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Web""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Total Events By Access Domain'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search security_domain=access | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Access Notables,Total Count,current_count,,delta,false,incident_review?form.security_domain_form=Access&earliest=-24h%40h&latest=now,1,0,0,all,Access Notable Events,singlevalue,security_posture,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Total Events By Endpoint Domain'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search security_domain=endpoint | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Endpoint Notables,Total Count,current_count,,delta,false,incident_review?form.security_domain_form=Endpoint&earliest=-24h%40h&latest=now,1,0,0,all,Endpoint Notable Events,singlevalue,security_posture,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Total Events By Network Domain'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search security_domain=network | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Network Notables,Total Count,current_count,,delta,false,incident_review?form.security_domain_form=Network&earliest=-24h%40h&latest=now,1,0,0,all,Network Notable Events,singlevalue,security_posture,3,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Total Events By Identity Domain'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search security_domain=identity | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Identity Notables,Total Count,current_count,,delta,false,incident_review?form.security_domain_form=Identity&earliest=-24h%40h&latest=now,1,0,0,all,Identity Notable Events,singlevalue,security_posture,4,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Total Events By Audit Domain'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search security_domain=audit | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Audit Notables,Total Count,current_count,,delta,false,incident_review?form.security_domain_form=Audit&earliest=-24h%40h&latest=now,1,0,0,all,Audit Notable Events,singlevalue,security_posture,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Total Events By Threat Domain'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search security_domain=threat | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Threat Notables,Total Count,current_count,,delta,false,incident_review?form.security_domain_form=Threat&earliest=-24h%40h&latest=now,1,0,0,all,Threat Notable Events,singlevalue,security_posture,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[],['Notable - Notable Events Exceeding Analyst Capacity'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| `es_notable_events` | search NOT status_group=""Closed"" | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename ""row 1"" as current_count,""row 2"" as historical_count | appendcols [| `incident_review_capacity`] | eval current_count=if(current_count>incident_review_capacity, current_count-incident_review_capacity, 0) | eval historical_count=if(historical_count>incident_review_capacity,historical_count-incident_review_capacity,0) | `get_delta` | table current_count,historical_count,delta",,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,Excess Notable Events,Total Count,current_count,,delta,false,search?q=%60notable%60%20%7C%20search%20NOT%20status_group%3D%22Closed%22%20%7C%20stats%20count%20by%20owner&earliest=-24h%40h&latest=now,1,0,0,all,Excess Notable Events,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Modular_Actions'],['Modular Actions - Action Invocations'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| tstats `summariesonly` count as current_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` count as historical_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Action Invocations,count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20as%20current_count%20from%20datamodel%3DSplunk_Audit.Modular_Actions%20where%20nodename%3D%22Modular_Actions.Modular_Action_Invocations%22%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Modular_Actions.action_name,1,0,0,all,Modular Action Invocations,singlevalue,modular_action_center,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Modular_Actions'],['Modular Actions - Distinct Action Names'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Modular_Actions.action_name) as current_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` dc(Modular_Actions.action_name) as historical_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Action Names,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20as%20current_count%20from%20datamodel%3DSplunk_Audit.Modular_Actions%20where%20nodename%3D%22Modular_Actions.Modular_Action_Invocations%22%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Modular_Actions.action_name,1,0,0,all,Distinct Modular Actions,singlevalue,modular_action_center,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Splunk_Audit.Modular_Actions'],['Modular Actions - Distinct Search Names'],SplunkEnterpriseSecuritySuite-default,,,,,,,,,,,,"| tstats `summariesonly` dc(Modular_Actions.search_name) as current_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-24h@h latest=+0s | appendcols [| tstats `summariesonly` dc(Modular_Actions.search_name) as historical_count from datamodel=Splunk_Audit.Modular_Actions where nodename=""Modular_Actions.Modular_Action_Invocations"" earliest=-48h@h latest=-24h@h] | `get_delta`",-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Action Search Names,Distinct Count,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20count%20as%20count%20from%20datamodel%3DSplunk_Audit.Modular_Actions%20where%20nodename%3D%22Modular_Actions.Modular_Action_Invocations%22%20earliest%3D-24h%40h%20latest%3D%2B0s%20by%20Modular_Actions.search_name,1,0,0,all,Distinct Modular Action Search Names,singlevalue,modular_action_center,2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Endpoint.Processes'],['ESCU - Detect mshta.exe running scripts in command-line arguments - Rule'],DA-ESS-ContentUpdate-default,,,true,,,,,,,,,| tstats `summariesonly` count values(Processes.process) as process values(Processes.parent_process) as parent_process min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=mshta.exe by Processes.user Processes.process_name Processes.parent_process_name Processes.dest  | `drop_dm_object_name(Processes)` | `ctime(firstTime)`| `ctime(lastTime)`| search (process=*vbscript* OR process=*javascript*),-70m@m,-10m@m,,1,number of events,greater than,0,0 * * * *,1,1,,,,,"This search looks for the execution of ""mshta.exe"" with command-line arguments that launch a script. The search will return the first time and last time these command-line arguments were used for these executions, as well as the target system, the user, process ""mshta.exe"" and its parent process.",,,,,,1,Detect mshta.exe running scripts in command-line arguments,,endpoint,medium,Mshta.exe is executing scripts on $dest$,Mshta.exe is seen to be executing scripts via the command-line arguments,"dest, process, parent_process_name",,,,,1,dest,system,50,"dest, process, parent_process_name",86400s,false,,auto,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,1,"{""mitre_attack"": [""Execution"", ""Command-Line Interface"", ""Persistence""], ""kill_chain_phases"": [""Exploitation""], ""cis20"": [""CIS 8""], ""nist"": [""PR.PT"", ""DE.CM""]}","Mshta.exe is a built-in Windows utility that can launch HTML files with .hta extensions (HTML applications), javascript, or VBScript. The search detects this behavior by looking for events where the process mshta.exe is executed with command-line arguments that indicate that a script is invoked","To successfully implement this search, you need to be ingesting logs with the process name, parent process, and command-line executions from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.","Although unlikely, some legitimate applications may exhibit this behavior, triggering a false positive.",2018-08-07,2018-12-03,medium,ESCU - Detect mshta.exe running scripts in command-line arguments - Rule,detection,Endpoint,[],"[""Carbon Black Response"", ""CrowdStrike Falcon"", ""Sysmon"", ""Tanium"", ""Ziften""]","[""Suspicious MSHTA Activity""]",escu_investigate,"{""version"": 1, ""data"": ""Recommended following steps:nn1.                         [[action|escu_investigate]]: Based on ESCU investigate recommendations:nESCU - Get Notable HistorynESCU - Get User Information from Identity TablenESCU - Get Authentication Logs For EndpointnESCU - Get Risk Modifiers For UsernESCU - Get Risk Modifiers For EndpointnESCU - Get Process InfonESCU - Get Registry ActivitiesnESCU - Get Parent Process Infon""}",0,3600,86400,0,,,,,"[""Endpoint""]",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
['Authentication.Authentication'],['Access - Number Of Default Accounts In Use'],DA-ESS-AccessProtection-default,,,,,,,,,,,,| tstats `summariesonly` estdc(Authentication.user) as current_count from datamodel=Authentication.Authentication where earliest=-24h@h latest=+0s Authentication.user_category=default | appendcols [| tstats `summariesonly` estdc(Authentication.user) as historical_count from datamodel=Authentication.Authentication where earliest=-48h@h latest=-24h@h Authentication.user_category=default] | `get_delta`,-48h@h,now,,,,,,,,,0,,,,,false,visualizations,,1,,,,,,,,,,,,,,,,,,,,,SplunkEnterpriseSecuritySuite,,,,,,,,0,1,Default Accounts,Distinct Accounts,current_count,,delta,false,search?q=%7C%20tstats%20%60summariesonly%60%20estdc(Authentication.user)%20as%20count%20from%20datamodel%3DAuthentication.Authentication%20where%20earliest%3D-24h%40h%20latest%3D%2B0s%20Authentication.user_category%3Ddefault%20by%20Authentication.user,1,0,0,all,Default Accounts,singlevalue,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
